<html>
<head><meta charset="utf-8"><title>Hiding type class instances · General · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/202961-General/index.html">General</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html">Hiding type class instances</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="206571707"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206571707" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206571707">(Aug 11 2020 at 13:05)</a>:</h4>
<p>In HOL-Library, there are two different instantiations of <code>prod :: (ord, ord) ord</code>. If I import one of them, is everyone who in turn imports my theory forced to use the instance I chose or is there a way to hide those instances?</p>



<a name="206571818"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206571818" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206571818">(Aug 11 2020 at 13:06)</a>:</h4>
<p>No, type class instances are forever. One of the reasons why Isabelle's type classes are… not great.</p>



<a name="206571878"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206571878" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206571878">(Aug 11 2020 at 13:06)</a>:</h4>
<p>Hm, that is quite unfortunate.</p>



<a name="206571912"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206571912" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206571912">(Aug 11 2020 at 13:07)</a>:</h4>
<p>When you instantiate a type class, you're adding a definition for all the overloaded constants that it contains. You cannot have two different definitions for the same thing and you cannot "delete" definitions, so this cannot work.</p>



<a name="206572013"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206572013" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206572013">(Aug 11 2020 at 13:08)</a>:</h4>
<p>To support something like this, I think one would have to overhaul the entire type class system from ground up.</p>



<a name="206572303"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206572303" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206572303">(Aug 11 2020 at 13:10)</a>:</h4>
<p>Ok, what would be the canonical way to customize the comparison operator in <code>linorder.sorted_list_of_set</code>?</p>



<a name="206572617"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206572617" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206572617">(Aug 11 2020 at 13:14)</a>:</h4>
<p>I just now noticed that the type class instance I had in mind would not work anyways...</p>



<a name="206574191"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206574191" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206574191">(Aug 11 2020 at 13:27)</a>:</h4>
<p>I don't think you can simply "customise" it. You can of course make a type copy of whatever your type is, do the ord instance in whichever way you want it to be, and then convert back and forth</p>



<a name="206574377"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206574377" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206574377">(Aug 11 2020 at 13:29)</a>:</h4>
<p>fwiw I defined a <code>sorted_wrt_list_of_set</code> function in the AFP, in <code>Comparison_Sort_Lower_Bound.Linorder_Relations</code>, along with some other operations on orderings that  take the ordering as an explicit relation instead of from the typeclass.</p>



<a name="206574386"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206574386" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206574386">(Aug 11 2020 at 13:29)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="k">definition</span> <span class="n">sorted_wrt_list_of_set</span> <span class="kp">where</span>
  <span class="s">&quot;sorted_wrt_list_of_set R A =</span>
<span class="s">     (if finite A then (THE xs. set xs = A ∧ distinct xs ∧sorted_wrt R xs) else [])&quot;</span>
</code></pre></div>



<a name="206574443"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206574443" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206574443">(Aug 11 2020 at 13:29)</a>:</h4>
<p>If your ordering isn't linear, you'll have to switch the <code>THE</code> to a <code>SOME</code>.</p>



<a name="206575136"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206575136" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206575136">(Aug 11 2020 at 13:34)</a>:</h4>
<p>Concerning the <code>sorted_wrt_list_of_set</code>: I only need <code>sorted_key_list_of_set f ≡ folding.F (insort_key f) []</code>. But then I need to reprove the lemmas that exist about <code>sorted_list_of_set</code>.</p>



<a name="206575235"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206575235" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206575235">(Aug 11 2020 at 13:35)</a>:</h4>
<p>Yeah if you really care about getting around that, you might have to do the <code>typedef</code> trick I told you about</p>



<a name="206575342"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206575342" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206575342">(Aug 11 2020 at 13:36)</a>:</h4>
<p>The problem is that antisymmetry does not hold if <code>f = fst</code>.</p>



<a name="206575555"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206575555" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206575555">(Aug 11 2020 at 13:38)</a>:</h4>
<p>yeah the whole point of sorted_list_of_set is that it is unique</p>



<a name="206575596"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206575596" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206575596">(Aug 11 2020 at 13:38)</a>:</h4>
<p>Otherwise you can just do "sort (list_of_set …)".</p>



<a name="206575608"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206575608" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206575608">(Aug 11 2020 at 13:38)</a>:</h4>
<p>That's not computable though, for obvious reasons.</p>



<a name="206576044"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206576044" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206576044">(Aug 11 2020 at 13:42)</a>:</h4>
<p>One would need some distinctness condition w.r.t. <code>f</code></p>



<a name="206577032"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206577032" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206577032">(Aug 11 2020 at 13:50)</a>:</h4>
<p>How would distinctness be enough? What kind of ordering do you have?</p>



<a name="206577067"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206577067" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206577067">(Aug 11 2020 at 13:50)</a>:</h4>
<p>Ah you have a linear order on the keys, I see. Yeah.</p>



<a name="206577270"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206577270" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206577270">(Aug 11 2020 at 13:52)</a>:</h4>
<p>Yes, my goal is to define a <code>fold</code> operation on Mappings. For this I first need an <code>ordered_entries</code> operation (which orders the entries by the first component).</p>



<a name="206577665"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206577665" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206577665">(Aug 11 2020 at 13:55)</a>:</h4>
<p>I think something like this already exists as long as the operation with which you fold is order-independent</p>



<a name="206577711"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206577711" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206577711">(Aug 11 2020 at 13:56)</a>:</h4>
<p>at least I vaguely remember having done such a thing for PMFs in HOL-Probability</p>



<a name="206577775"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206577775" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206577775">(Aug 11 2020 at 13:56)</a>:</h4>
<p>they are implemented as mappings, and when you want to implement monadic bind/join, you need to fold over that mapping and sum up some values</p>



<a name="206577867"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206577867" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206577867">(Aug 11 2020 at 13:57)</a>:</h4>
<p>Did you look at <code>Mapping.combine</code>?</p>



<a name="206577979"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206577979" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206577979">(Aug 11 2020 at 13:58)</a>:</h4>
<p>Yes, unfortunately this does not help me since my operation depends on both 'a and 'b</p>



<a name="206578180"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206578180" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206578180">(Aug 11 2020 at 14:00)</a>:</h4>
<p>More specifically, I need a nested fold where I combine all 'a with each other.</p>



<a name="206578815"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206578815" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206578815">(Aug 11 2020 at 14:04)</a>:</h4>
<p>I am thinking about going the less  beautiful route and just using RBTs directly.</p>



<a name="206593792"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206593792" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206593792">(Aug 11 2020 at 16:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232736">Manuel Eberl</span> <a href="#narrow/stream/202961-general/topic/Hiding.20type.20class.20instances/near/206577711">said</a>:</p>
<blockquote>
<p>at least I vaguely remember having done such a thing for PMFs in HOL-Probability</p>
</blockquote>
<p>Do you know where exactly? Grepping in <code>src/HOL/Probability</code> didn't yield anything for me.</p>



<a name="206594374"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206594374" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206594374">(Aug 11 2020 at 16:08)</a>:</h4>
<p>Ah maybe <code>fold_combine_plus</code>?</p>



<a name="206598473"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Hiding%20type%20class%20instances/near/206598473" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Hiding.20type.20class.20instances.html#206598473">(Aug 11 2020 at 16:42)</a>:</h4>
<p>Yes, but I think that used <code>Mapping.cobmine</code>.</p>



<hr><p>Last updated: Feb 22 2026 at 20:30 UTC</p>
</html>