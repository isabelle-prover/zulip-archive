<html>
<head><meta charset="utf-8"><title>Simplifier.prems_of · General · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/202961-General/index.html">General</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html">Simplifier.prems_of</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="206156886"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206156886" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206156886">(Aug 06 2020 at 15:28)</a>:</h4>
<p>Does anybody know what Simplifier.prems_of really does? Is it equivalent to the prems I would get from Subgoal.FOCUS?</p>



<a name="206157483"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206157483" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206157483">(Aug 06 2020 at 15:32)</a>:</h4>
<p>Hm, <code>Simplifier.prems_of</code> gives you the premises that are in the simpset.</p>



<a name="206157506"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206157506" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206157506">(Aug 06 2020 at 15:32)</a>:</h4>
<p>I'm… not entirely sure which premises end up there and when.</p>



<a name="206157634"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206157634" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206157634">(Aug 06 2020 at 15:33)</a>:</h4>
<p>I see. Is it better to insert those as premises before calling Subgoal.FOCUS or should I just append those to the premises that I get from Subgoal.FOCUS?</p>



<a name="206157825"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206157825" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206157825">(Aug 06 2020 at 15:34)</a>:</h4>
<p>My guess would be that when the Simplifier simplifies e.g. an implication <code>P ==&gt; Q</code>, it will add <code>P</code> as a premise when simplifying <code>Q</code>.</p>



<a name="206157880"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206157880" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206157880">(Aug 06 2020 at 15:35)</a>:</h4>
<p>So when you do <code>Simplifier.prems_of</code> outside the context of a simplifier run, you will probably get an empty list.</p>



<a name="206157918"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206157918" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206157918">(Aug 06 2020 at 15:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="233155">Lukas Stevens</span> <a href="#narrow/stream/202961-general/topic/Simplifier.2Eprems_of/near/206157634">said</a>:</p>
<blockquote>
<p>I see. Is it better to insert those as premises before calling Subgoal.FOCUS or should I just append those to the premises that I get from Subgoal.FOCUS?</p>
</blockquote>
<p>I don't really understand what you are trying to achieve.</p>



<a name="206158029"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206158029" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206158029">(Aug 06 2020 at 15:36)</a>:</h4>
<p>In my case, I am registering the tactic as a solver. I appended the Simplifier.prems_of and now some proofs work that previously failed. I am not really sure what the semantics of a solver are, i.e. when it is called and what the context is.</p>



<a name="206158089"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206158089" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206158089">(Aug 06 2020 at 15:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232736">Manuel Eberl</span> <a href="#narrow/stream/202961-general/topic/Simplifier.2Eprems_of/near/206157918">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="233155">Lukas Stevens</span> <a href="#narrow/stream/202961-general/topic/Simplifier.2Eprems_of/near/206157634">said</a>:</p>
<blockquote>
<p>I see. Is it better to insert those as premises before calling Subgoal.FOCUS or should I just append those to the premises that I get from Subgoal.FOCUS?</p>
</blockquote>
<p>I don't really understand what you are trying to achieve.</p>
</blockquote>
<p>It seems that I need those premises such that the tactic works as a solver?</p>



<a name="206158302"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206158302" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206158302">(Aug 06 2020 at 15:38)</a>:</h4>
<p>It seems I was right:</p>
<div class="codehilite"><pre><span></span><code><span class="k">consts</span> <span class="n">P</span> <span class="o">::</span> <span class="s">&quot;&#39;a ⇒ bool&quot;</span>

<span class="k">simproc_setup</span> <span class="n">foo</span> <span class="o">(</span><span class="s">&quot;P x&quot;</span><span class="o">)</span> <span class="o">=</span> <span class="err">‹</span>
<span class="n">fn</span> <span class="o">_</span> <span class="o">=</span><span class="err">&gt;</span> <span class="n">fn</span> <span class="n">ctxt</span> <span class="o">=</span><span class="err">&gt;</span> <span class="n">fn</span> <span class="o">_</span> <span class="o">=</span><span class="err">&gt;</span> <span class="k">let</span> <span class="n">val</span> <span class="o">_</span> <span class="o">=</span> <span class="err">@</span><span class="ow">{</span><span class="n">print</span><span class="ow">}</span> <span class="o">(</span><span class="n">Simplifier.prems_of</span> <span class="n">ctxt</span><span class="o">)</span> <span class="kp">in</span> <span class="n">NONE</span> <span class="k">end</span>
<span class="err">›</span>

<span class="kn">lemma</span> <span class="s">&quot;P x&quot;</span>
  <span class="kp">apply</span> <span class="n">simp</span><span class="o">?</span> <span class="c">(* no premises *)</span>
  <span class="gr">oops</span>

<span class="kn">lemma</span> <span class="s">&quot;Q ⟹ P x&quot;</span>
  <span class="kp">apply</span> <span class="n">simp</span><span class="o">?</span> <span class="c">(* premises: [Q] *)</span>
  <span class="gr">oops</span>

<span class="kn">lemma</span> <span class="s">&quot;⋀y. Q y ⟹ P x&quot;</span>
  <span class="kp">apply</span> <span class="n">simp</span><span class="o">?</span> <span class="c">(* premises: [Q :000] *)</span>
  <span class="gr">oops</span>
</code></pre></div>



<a name="206158539"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206158539" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206158539">(Aug 06 2020 at 15:40)</a>:</h4>
<p>Still weird, since one would expect that those premises are already part of the goal when the solver is called.</p>



<a name="206158994"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206158994" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206158994">(Aug 06 2020 at 15:43)</a>:</h4>
<p>My expectation would be the following: the solver is called on the entire goal when everything else has failed (except maybe before the loopers; I can never remember the order). Since it works on the entire goal, there are probably no premises. However, the simplifier is also used recursively to solve preconditions of conditional rewrite rules, and if the solver is called for one of those, there might be premises in the context.</p>



<a name="206159248"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206159248" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206159248">(Aug 06 2020 at 15:45)</a>:</h4>
<p>Ok, then it makes sense to consider the Simplifier prems as well.</p>



<a name="206159936"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206159936" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206159936">(Aug 06 2020 at 15:50)</a>:</h4>
<p>This is just a guess.</p>



<a name="206161646"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206161646" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206161646">(Aug 06 2020 at 16:02)</a>:</h4>
<p>Looks like I guessed correctly. Perhaps this snippet is illuminating to you:</p>
<div class="codehilite"><pre><span></span><code><span class="k">consts</span>
  <span class="n">P</span> <span class="o">::</span> <span class="s">&quot;&#39;a ⇒ bool&quot;</span>
  <span class="n">Q</span> <span class="o">::</span> <span class="s">&quot;&#39;a ⇒ bool&quot;</span>
  <span class="n">P&#39;</span> <span class="o">::</span> <span class="s">&quot;&#39;a ⇒ bool&quot;</span>

<span class="kn">lemma</span> <span class="o">[</span><span class="n">simp</span><span class="o">]:</span> <span class="s">&quot;Q x ⟹ P x = P&#39; x&quot;</span>
  <span class="gr">sorry</span>

<span class="k">setup</span> <span class="err">‹</span><span class="n">map_theory_simpset</span> <span class="o">(</span><span class="n">fn</span> <span class="n">ctxt</span> <span class="o">=</span><span class="err">&gt;</span>
<span class="k">let</span>
  <span class="n">val</span> <span class="n">solver</span> <span class="o">=</span>
    <span class="n">Simplifier.mk_solver</span> <span class="s">&quot;foo&quot;</span>
      <span class="o">(</span><span class="n">fn</span> <span class="n">ctxt</span> <span class="o">=</span><span class="err">&gt;</span> <span class="n">fn</span> <span class="n">i</span> <span class="o">=</span><span class="err">&gt;</span> <span class="n">fn</span> <span class="kt">thm</span> <span class="o">=</span><span class="err">&gt;</span>
        <span class="k">let</span>
          <span class="n">val</span> <span class="o">_</span> <span class="o">=</span> <span class="n">Pretty.writeln</span> <span class="o">(</span><span class="n">Pretty.str</span> <span class="s">&quot; &quot;</span><span class="o">)</span>
          <span class="n">val</span> <span class="o">_</span> <span class="o">=</span> <span class="err">@</span><span class="ow">{</span><span class="n">print</span><span class="ow">}</span> <span class="s">&quot;SOLVER INVOCATION&quot;</span>
          <span class="n">val</span> <span class="o">_</span> <span class="o">=</span> <span class="n">Pretty.writeln</span> <span class="o">(</span><span class="n">Pretty.block</span> <span class="o">(</span><span class="n">Pretty.str</span> <span class="s">&quot;Premises: &quot;</span> <span class="o">::</span>
                    <span class="n">map</span> <span class="o">(</span><span class="n">Syntax.pretty_term</span> <span class="n">ctxt</span> <span class="n">o</span> <span class="n">Thm.prop_of</span><span class="o">)</span> <span class="o">(</span><span class="n">Simplifier.prems_of</span> <span class="n">ctxt</span><span class="o">)))</span>
          <span class="n">val</span> <span class="o">_</span> <span class="o">=</span> <span class="n">Pretty.writeln</span> <span class="o">(</span><span class="n">Pretty.block</span> <span class="o">[</span><span class="n">Pretty.str</span> <span class="s">&quot;Goal: &quot;</span><span class="o">,</span> <span class="n">Syntax.pretty_term</span> <span class="n">ctxt</span> <span class="o">(</span><span class="n">Thm.concl_of</span> <span class="kt">thm</span><span class="o">)])</span>
          <span class="n">val</span> <span class="o">_</span> <span class="o">=</span> <span class="err">@</span><span class="ow">{</span><span class="n">print</span><span class="ow">}</span> <span class="s">&quot;END SOLVER INVOCATION&quot;</span>
        <span class="kp">in</span>
          <span class="n">Seq.empty</span>
        <span class="k">end</span><span class="o">)</span>
<span class="kp">in</span>
  <span class="n">ctxt</span> <span class="n">addSolver</span> <span class="n">solver</span>
<span class="k">end</span><span class="o">)</span>
<span class="err">›</span>

<span class="kn">lemma</span> <span class="s">&quot;P x&quot;</span>
  <span class="kp">apply</span> <span class="n">simp</span><span class="o">?</span>
  <span class="gr">oops</span>

<span class="kn">lemma</span> <span class="s">&quot;R ⟹ P x&quot;</span>
  <span class="kp">apply</span> <span class="n">simp</span><span class="o">?</span>
  <span class="gr">oops</span>

<span class="kn">lemma</span> <span class="s">&quot;⋀y. R y ⟹ P x&quot;</span>
  <span class="kp">apply</span> <span class="n">simp</span><span class="o">?</span>
  <span class="gr">oops</span>
</code></pre></div>



<a name="206161679"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206161679" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206161679">(Aug 06 2020 at 16:03)</a>:</h4>
<p>(Look at the output after those "simp?" commands)</p>



<a name="206163032"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206163032" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206163032">(Aug 06 2020 at 16:14)</a>:</h4>
<p>Thank you, I will have a look at it. The solver now works for all of Main at least <span aria-label="party ball" class="emoji emoji-1f38a" role="img" title="party ball">:party_ball:</span></p>



<a name="206163151"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206163151" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206163151">(Aug 06 2020 at 16:15)</a>:</h4>
<p>What did the old solver do?</p>



<a name="206163158"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206163158" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206163158">(Aug 06 2020 at 16:15)</a>:</h4>
<p>The old linarith solver I mean.</p>



<a name="206163442"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206163442" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206163442">(Aug 06 2020 at 16:18)</a>:</h4>
<p>It is the old order solver. It decides the theory of partial and linear orders.</p>



<a name="206163718"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206163718" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206163718">(Aug 06 2020 at 16:20)</a>:</h4>
<p>The new solver is a bit more powerful in the theory of partial orders. While the core is verified it is quite hard to get the glue code right <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="206165849"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206165849" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206165849">(Aug 06 2020 at 16:41)</a>:</h4>
<p>Then I don't understand. If we're talking about the old solver, then why do things suddenly not work anymore?</p>



<a name="206165921"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206165921" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel Eberl <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206165921">(Aug 06 2020 at 16:42)</a>:</h4>
<p>Or if we are talking about your new one after all, my question was: how does the old one treat premises?</p>



<a name="206166089"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/Simplifier.prems_of/near/206166089" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Stevens <a href="http://isabelle.systems/zulip-archive/stream/202961-General/topic/Simplifier.2Eprems_of.html#206166089">(Aug 06 2020 at 16:44)</a>:</h4>
<p>The old one also added those premises. I carelessly deleted that bit apparently.</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>