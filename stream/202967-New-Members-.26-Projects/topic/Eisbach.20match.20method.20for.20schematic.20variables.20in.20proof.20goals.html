<html>
<head><meta charset="utf-8"><title>Eisbach match method for schematic variables in proof goals · New Members &amp; Projects · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/202967-New-Members-.26-Projects/index.html">New Members &amp; Projects</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/202967-New-Members-.26-Projects/topic/Eisbach.20match.20method.20for.20schematic.20variables.20in.20proof.20goals.html">Eisbach match method for schematic variables in proof goals</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="481973544"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202967-New%20Members%20%26%20Projects/topic/Eisbach%20match%20method%20for%20schematic%20variables%20in%20proof%20goals/near/481973544" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt <a href="http://isabelle.systems/zulip-archive/stream/202967-New-Members-.26-Projects/topic/Eisbach.20match.20method.20for.20schematic.20variables.20in.20proof.20goals.html#481973544">(Nov 12 2024 at 15:20)</a>:</h4>
<p>I've been working on a project with large, repetitive proofs that benefit from Eisbach automation. However, I ran into the same problem as <a href="#narrow/channel/202961-General/topic/Schematics.20in.20Eisbach/near/318379598"><span class="user-mention" data-user-id="570503">@Hanno Becker</span> </a> where the <code>match</code> method included with Eisbach seems to replace  schematic variables/terms in the proof goal with skolem variables/terms.</p>
<p>This behaviour can be replicated in the following example, where the first <code>rule exI</code> tactic produces the schematic variable <code>?x</code>, then the <code>subgoal</code> tactic (?) replaces it with the skolem variable <code>x</code> which can not be instantiated within the subgoal (<code>...</code>).</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="kn">lemma</span><span class="w"> </span><span class="s">"∃x. P x"</span>
<span class="w">  </span><span class="kp">apply</span><span class="w"> </span><span class="o">(</span><span class="n">rule</span><span class="w"> </span><span class="n">exI</span><span class="o">)</span>
<span class="w">  </span><span class="n">subgoal</span>
<span class="w">    </span><span class="ow">...</span>
</code></pre></div>
<p>For my use case, it would be impractical to instantiate the schematic variables/terms when they are introduced. Instead, the repeated application of introduction rules usually resolves them. </p>
<p>Thus, I developed a new <code>match</code> method which preserves schematic variables in proof goals.<br>
This is achieved by adding a flag <code>fix_schematics</code> and guards to the <code>focus_concl</code> method in <code>match_method.ML</code>:</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">fun</span><span class="w"> </span><span class="n">focus_concl</span><span class="w"> </span><span class="n">fix_schematics</span><span class="w"> </span><span class="n">ctxt</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">bindings</span><span class="w"> </span><span class="n">goal</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="k">let</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="o">(</span><span class="ow">{</span><span class="k">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctxt'</span><span class="o">,</span><span class="w"> </span><span class="n">concl</span><span class="o">,</span><span class="w"> </span><span class="n">params</span><span class="o">,</span><span class="w"> </span><span class="n">prems</span><span class="o">,</span><span class="w"> </span><span class="n">asms</span><span class="o">,</span><span class="w"> </span><span class="n">schematics</span><span class="ow">}</span><span class="o">,</span><span class="w"> </span><span class="n">goal'</span><span class="o">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">Subgoal.focus_params</span><span class="w"> </span><span class="n">ctxt</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">bindings</span><span class="w"> </span><span class="n">goal;</span>

<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="o">((_,</span><span class="w"> </span><span class="n">inst</span><span class="o">),</span><span class="w"> </span><span class="n">ctxt''</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Variable.import_inst</span><span class="w"> </span><span class="n">true</span><span class="w"> </span><span class="o">[</span><span class="n">Thm.term_of</span><span class="w"> </span><span class="n">concl</span><span class="o">]</span><span class="w"> </span><span class="n">ctxt';</span>

<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">schematic_terms</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">Vars.fold</span><span class="w"> </span><span class="o">(</span><span class="n">fn</span><span class="w"> </span><span class="o">(</span><span class="n">v</span><span class="o">,</span><span class="w"> </span><span class="n">t</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="n">&gt;</span><span class="w"> </span><span class="n">cons</span><span class="w"> </span><span class="o">(</span><span class="n">v</span><span class="o">,</span><span class="w"> </span><span class="n">Thm.cterm_of</span><span class="w"> </span><span class="n">ctxt''</span><span class="w"> </span><span class="n">t</span><span class="o">))</span><span class="w"> </span><span class="n">inst</span><span class="w"> </span><span class="o">[]</span><span class="n">;</span>

<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">instantiate_goal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="kp">if</span><span class="w"> </span><span class="n">fix_schematics</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">Thm.instantiate</span><span class="w"> </span><span class="o">(</span><span class="n">TVars.empty</span><span class="o">,</span><span class="w"> </span><span class="n">Vars.make</span><span class="w"> </span><span class="n">schematic_terms</span><span class="o">)</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="n">I</span><span class="o">)</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">instantiate_concl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="kp">if</span><span class="w"> </span><span class="n">fix_schematics</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">Thm.instantiate_cterm</span><span class="w"> </span><span class="o">(</span><span class="n">TVars.empty</span><span class="o">,</span><span class="w"> </span><span class="n">Vars.make</span><span class="w"> </span><span class="n">schematic_terms</span><span class="o">)</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="n">I</span><span class="o">)</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">instantiate_schematics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="kp">if</span><span class="w"> </span><span class="n">fix_schematics</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">fold</span><span class="w"> </span><span class="n">Vars.add</span><span class="w"> </span><span class="n">schematic_terms</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="n">I</span><span class="o">)</span>

<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">goal''</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instantiate_goal</span><span class="w"> </span><span class="n">goal';</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">concl'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instantiate_concl</span><span class="w"> </span><span class="n">concl;</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="o">(</span><span class="n">schematic_types</span><span class="o">,</span><span class="w"> </span><span class="n">schematic_terms'</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">schematics;</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">schematics'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">schematic_types</span><span class="o">,</span><span class="w"> </span><span class="n">instantiate_schematics</span><span class="w"> </span><span class="n">schematic_terms'</span><span class="o">)</span><span class="n">;</span>
<span class="w">  </span><span class="kp">in</span>
<span class="w">    </span><span class="o">(</span><span class="ow">{</span><span class="k">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctxt''</span><span class="o">,</span><span class="w"> </span><span class="n">concl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">concl'</span><span class="o">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="o">,</span><span class="w"> </span><span class="n">prems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prems</span><span class="o">,</span>
<span class="w">      </span><span class="n">schematics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">schematics'</span><span class="o">,</span><span class="w"> </span><span class="n">asms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">asms</span><span class="ow">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Subgoal.focus</span><span class="o">,</span><span class="w"> </span><span class="n">goal''</span><span class="o">)</span>
<span class="w">  </span><span class="k">end</span><span class="n">;</span>
</code></pre></div>
<p>I wanted to share these changes, though I am unsure if an AFP entry, or a change to the Eisbach library is the best approach. Could someone advise?</p>



<a name="482120745"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202967-New%20Members%20%26%20Projects/topic/Eisbach%20match%20method%20for%20schematic%20variables%20in%20proof%20goals/near/482120745" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fabian Huch <a href="http://isabelle.systems/zulip-archive/stream/202967-New-Members-.26-Projects/topic/Eisbach.20match.20method.20for.20schematic.20variables.20in.20proof.20goals.html#482120745">(Nov 13 2024 at 09:00)</a>:</h4>
<p>This sounds like something to add to Eisbach, in which case you want to contact the local expert so they can have a look at the proposed changes.<br>
I don't know who the current expert is for Eisbach, perhaps <span class="user-mention" data-user-id="234178">@Fabian Immler</span> or <span class="user-mention" data-user-id="433149">@Maximilian Schäffeler</span> ?</p>



<a name="482456469"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/202967-New%20Members%20%26%20Projects/topic/Eisbach%20match%20method%20for%20schematic%20variables%20in%20proof%20goals/near/482456469" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maximilian Schäffeler <a href="http://isabelle.systems/zulip-archive/stream/202967-New-Members-.26-Projects/topic/Eisbach.20match.20method.20for.20schematic.20variables.20in.20proof.20goals.html#482456469">(Nov 14 2024 at 18:29)</a>:</h4>
<p>Unfortunately, not at all. I put together a single Eisbach method 6 years ago but don’t remember much.</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>