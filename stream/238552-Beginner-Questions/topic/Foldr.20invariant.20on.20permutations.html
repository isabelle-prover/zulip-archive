<html>
<head><meta charset="utf-8"><title>Foldr invariant on permutations · Beginner Questions · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/index.html">Beginner Questions</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html">Foldr invariant on permutations</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="419800146"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419800146" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Francesco Rossetta <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419800146">(Feb 05 2024 at 09:52)</a>:</h4>
<p>Hi, I want to prove that my function "calculate_votes_for_election" is invariant under permutations of list of parties.</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">fun</span><span class="w"> </span><span class="n">count_votes</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b ⇒ 'b Profile ⇒ 'b Votes</span>
<span class="s">                                      ⇒ 'b Votes"</span><span class="w"> </span><span class="kp">where</span>
<span class="w">  </span><span class="s">"count_votes party profile_list votes =</span>
<span class="s">  (let n_votes = foldr (λpref acc. if card (above pref party) = 0</span>
<span class="s">                                      then acc+1</span>
<span class="s">                                  else acc) profile_list 0</span>
<span class="s">   in votes(party := n_votes))"</span>

<span class="k">fun</span><span class="w"> </span><span class="n">empty_votes</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"('b ⇒ rat)"</span><span class="w"> </span><span class="kp">where</span>
<span class="w">  </span><span class="s">"empty_votes b = 0"</span>

<span class="k">fun</span><span class="w"> </span><span class="n">calculate_votes_for_election</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b list ⇒ 'b Profile ⇒ 'b Votes"</span><span class="w"> </span><span class="kp">where</span>
<span class="w">  </span><span class="s">"calculate_votes_for_election parties prof =</span>
<span class="s">      (let v = empty_votes in (if parties = [] then empty_votes else</span>
<span class="s">      (foldr (λparty acc_votes.</span>
<span class="s">              count_votes party prof acc_votes)</span>
<span class="s">              parties v)))"</span>
</code></pre></div>
<p>For the moment i rewrote count_votes without the foldr but in recursion way</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">fun</span><span class="w"> </span><span class="n">count_votes</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b ⇒ 'b Profile ⇒ 'b Votes ⇒ rat</span>
<span class="s">                                      ⇒ 'b Votes"</span><span class="w"> </span><span class="kp">where</span>
<span class="w">  </span><span class="s">"count_votes party [] votes n = votes(party:= n)"</span><span class="w"> </span><span class="o">|</span>
<span class="w">  </span><span class="s">"count_votes party (px # p) votes n =</span>
<span class="s">   count_votes party p votes (if card (above px party) = 0</span>
<span class="s">                                      then n+1</span>
<span class="s">                                  else n)"</span>
</code></pre></div>
<p>thinking that in this way it may be easier to proof. Any help or suggestion? Should i rewrite also calculate_votes_for_election in recursive way to write my proof? Thanks in advance</p>



<a name="419800503"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419800503" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419800503">(Feb 05 2024 at 09:54)</a>:</h4>
<p>Do you need to work on lists? The natural data structure would be multisets…</p>



<a name="419800975"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419800975" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419800975">(Feb 05 2024 at 09:56)</a>:</h4>
<p>Otherwise the natural way would be to interprete the function as comp_fun_commute in the proofs.</p>



<a name="419812500"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419812500" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Francesco Rossetta <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419812500">(Feb 05 2024 at 11:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="233198">Mathias Fleury</span> <a href="#narrow/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations/near/419800503">said</a>:</p>
<blockquote>
<p>Do you need to work on lists? The natural data structure would be multisets…</p>
</blockquote>
<p>I chose lists because I need to extract one element from it and in the theory about multisets I found nothing to extract a single element without knowing in advance the element itself, I only found Min but in my case it's not a linorder type.</p>



<a name="419826903"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419826903" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Francesco Rossetta <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419826903">(Feb 05 2024 at 12:22)</a>:</h4>
<p>Update: I tried to do it with multisets without succeeding so I am trying with lists.</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">fun</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b list ⇒ 'b Profile ⇒'b Votes ⇒ 'b Votes"</span><span class="w"> </span><span class="kp">where</span>
<span class="w">  </span><span class="s">"calculate_votes [] profile_list votes = votes"</span><span class="w"> </span><span class="o">|</span>
<span class="w">  </span><span class="s">"calculate_votes (px # p) profile_list votes =</span>
<span class="s">      calculate_votes p profile_list (count_votes px profile_list empty_votes 0)"</span>

<span class="kn">lemma</span><span class="w"> </span><span class="n">calculate_votes_permutation</span><span class="o">:</span>
<span class="w">  </span><span class="kp">fixes</span>
<span class="w">    </span><span class="n">p1</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b Parties"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">p2</span><span class="w"> </span><span class="o">::</span><span class="s">"'b Parties"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">profile</span><span class="w"> </span><span class="o">::</span><span class="s">"'b Profile"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">votes</span><span class="o">::</span><span class="s">"'b Votes"</span>
<span class="w">  </span><span class="kp">shows</span><span class="w"> </span><span class="s">"∀p1 p2 profile votes. p1 &lt;~~&gt; p2 ⟶ calculate_votes p1 profile votes = calculate_votes p2 profile votes"</span>
<span class="k">proof</span><span class="w"> </span><span class="o">(</span><span class="n">cases</span><span class="o">)</span>
<span class="w">  </span><span class="k">assume</span><span class="w"> </span><span class="s">"p1 = []"</span>
<span class="w">  </span><span class="k">assume</span><span class="w"> </span><span class="s">"p1 &lt;~~&gt; p2"</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"p2 = []"</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">perm_empty_imp</span>
<span class="w">    </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="s">‹p1 = []›</span><span class="o">)</span>
<span class="w">  </span><span class="k">hence</span><span class="w"> </span><span class="s">"calculate_votes p1 profile votes =</span>
<span class="s">         calculate_votes p2 profile votes"</span>
<span class="w">  </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="s">‹p1 = []›</span><span class="o">)</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="o">?</span><span class="n">thesis</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">simp</span>
<span class="k">next</span>
</code></pre></div>
<p>I managed to write something like this and it is not working, even though it seems to "pick" the thesis</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">proof</span><span class="w"> </span><span class="o">(</span><span class="n">chain</span><span class="o">)</span>
<span class="n">picking</span><span class="w"> </span><span class="n">this</span><span class="o">:</span>
<span class="w">  </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span>
<span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">refine</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="n">goal</span>
<span class="n">Local</span><span class="w"> </span><span class="n">statement</span><span class="w"> </span><span class="n">fails</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">refine</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="n">goal</span>
<span class="n">Failed</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">solve</span><span class="w"> </span><span class="n">goal</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">exported</span><span class="w"> </span><span class="n">rule</span><span class="o">:</span>
<span class="w">  </span><span class="o">(</span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[])</span><span class="w"> </span><span class="n">⟹</span>
<span class="w">  </span><span class="o">(</span><span class="n">mset</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mset</span><span class="w"> </span><span class="n">p2</span><span class="o">)</span><span class="w"> </span><span class="n">⟹</span>
<span class="w">  </span><span class="n">∀p1</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes.</span>
<span class="w">     </span><span class="n">mset</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mset</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="n">⟶</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span>
</code></pre></div>
<p>How should I change my proof? Or again is there any way to do it with multisets?</p>



<a name="419830777"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419830777" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419830777">(Feb 05 2024 at 12:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="671670">Salvatore Francesco Rossetta</span> <a href="#narrow/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations/near/419812500">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="233198">Mathias Fleury</span> <a href="#narrow/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations/near/419800503">said</a>:</p>
<blockquote>
<p>Do you need to work on lists? The natural data structure would be multisets…</p>
</blockquote>
<p>I chose lists because I need to extract one element from it and in the theory about multisets I found nothing to extract a single element without knowing in advance the element itself, I only found Min but in my case it's not a linorder type.</p>
</blockquote>
<p>You must have missed <code>fold_mset</code></p>



<a name="419831006"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419831006" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419831006">(Feb 05 2024 at 12:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="671670">Salvatore Francesco Rossetta</span> <a href="#narrow/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations/near/419826903">said</a>:</p>
<blockquote>
<p>Update: I tried to do it with multisets without succeeding so I am trying with lists.</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">fun</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b list ⇒ 'b Profile ⇒'b Votes ⇒ 'b Votes"</span><span class="w"> </span><span class="kp">where</span>
<span class="w">  </span><span class="s">"calculate_votes [] profile_list votes = votes"</span><span class="w"> </span><span class="o">|</span>
<span class="w">  </span><span class="s">"calculate_votes (px # p) profile_list votes =</span>
<span class="s">      calculate_votes p profile_list (count_votes px profile_list empty_votes 0)"</span>

<span class="kn">lemma</span><span class="w"> </span><span class="n">calculate_votes_permutation</span><span class="o">:</span>
<span class="w">  </span><span class="kp">fixes</span>
<span class="w">    </span><span class="n">p1</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b Parties"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">p2</span><span class="w"> </span><span class="o">::</span><span class="s">"'b Parties"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">profile</span><span class="w"> </span><span class="o">::</span><span class="s">"'b Profile"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">votes</span><span class="o">::</span><span class="s">"'b Votes"</span>
<span class="w">  </span><span class="kp">shows</span><span class="w"> </span><span class="s">"∀p1 p2 profile votes. p1 &lt;~~&gt; p2 ⟶ calculate_votes p1 profile votes = calculate_votes p2 profile votes"</span>
<span class="k">proof</span><span class="w"> </span><span class="o">(</span><span class="n">cases</span><span class="o">)</span>
<span class="w">  </span><span class="k">assume</span><span class="w"> </span><span class="s">"p1 = []"</span>
<span class="w">  </span><span class="k">assume</span><span class="w"> </span><span class="s">"p1 &lt;~~&gt; p2"</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"p2 = []"</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">perm_empty_imp</span>
<span class="w">    </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="s">‹p1 = []›</span><span class="o">)</span>
<span class="w">  </span><span class="k">hence</span><span class="w"> </span><span class="s">"calculate_votes p1 profile votes =</span>
<span class="s">         calculate_votes p2 profile votes"</span>
<span class="w">  </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="s">‹p1 = []›</span><span class="o">)</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="o">?</span><span class="n">thesis</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">simp</span>
<span class="k">next</span>
</code></pre></div>
<p>I managed to write something like this and it is not working, even though it seems to "pick" the thesis</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">proof</span><span class="w"> </span><span class="o">(</span><span class="n">chain</span><span class="o">)</span>
<span class="n">picking</span><span class="w"> </span><span class="n">this</span><span class="o">:</span>
<span class="w">  </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span>
<span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">refine</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="n">goal</span>
<span class="n">Local</span><span class="w"> </span><span class="n">statement</span><span class="w"> </span><span class="n">fails</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">refine</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="n">goal</span>
<span class="n">Failed</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">solve</span><span class="w"> </span><span class="n">goal</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">exported</span><span class="w"> </span><span class="n">rule</span><span class="o">:</span>
<span class="w">  </span><span class="o">(</span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[])</span><span class="w"> </span><span class="n">⟹</span>
<span class="w">  </span><span class="o">(</span><span class="n">mset</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mset</span><span class="w"> </span><span class="n">p2</span><span class="o">)</span><span class="w"> </span><span class="n">⟹</span>
<span class="w">  </span><span class="n">∀p1</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes.</span>
<span class="w">     </span><span class="n">mset</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mset</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="n">⟶</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span>
</code></pre></div>
<p>How should I change my proof? Or again is there any way to do it with multisets?</p>
</blockquote>
<p>That is not  a valid proof. You are doing cases of variables under forall-quantors. So obviously it does not work</p>



<a name="419837749"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419837749" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Francesco Rossetta <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419837749">(Feb 05 2024 at 13:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="233198">Mathias Fleury</span> <a href="#narrow/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations/near/419831006">said</a>:</p>
<blockquote>
<p>That is not  a valid proof. You are doing cases of variables under forall-quantors. So obviously it does not work</p>
</blockquote>
<p>I know, I pasted only the first case because that is not working, the other one is simply a "sorry" for now, so it should not be a problem?</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">proof</span><span class="w"> </span><span class="o">(</span><span class="n">cases</span><span class="o">)</span>
<span class="w">  </span><span class="k">assume</span><span class="w"> </span><span class="s">"p1 = []"</span>
<span class="w">  </span><span class="k">assume</span><span class="w"> </span><span class="s">"p1 &lt;~~&gt; p2"</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"p2 = []"</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">perm_empty_imp</span>
<span class="w">    </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="s">‹p1 = []›</span><span class="o">)</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="o">?</span><span class="n">thesis</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="s">‹p1 = []›</span><span class="o">)</span>
<span class="k">next</span>
<span class="w">  </span><span class="k">assume</span><span class="w"> </span><span class="s">"¬(p1 = [])"</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="o">?</span><span class="n">thesis</span><span class="w"> </span><span class="gr">sorry</span>
<span class="k">qed</span>
</code></pre></div>



<a name="419838005"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419838005" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419838005">(Feb 05 2024 at 13:22)</a>:</h4>
<p>The p1 in your fixes has NOTHING to do with the p1 in your goal</p>



<a name="419838126"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419838126" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419838126">(Feb 05 2024 at 13:22)</a>:</h4>
<p>(except having the same name)</p>



<a name="419838221"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419838221" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419838221">(Feb 05 2024 at 13:22)</a>:</h4>
<p>Therefore, the case distinction on p1 is meaningless for the goal</p>



<a name="419838312"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419838312" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419838312">(Feb 05 2024 at 13:23)</a>:</h4>
<p>This is most likely what you want:</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="kn">lemma</span><span class="w"> </span><span class="n">calculate_votes_permutation</span><span class="o">:</span>
<span class="w">  </span><span class="kp">fixes</span>
<span class="w">    </span><span class="n">p1</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b Parties"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">p2</span><span class="w"> </span><span class="o">::</span><span class="s">"'b Parties"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">profile</span><span class="w"> </span><span class="o">::</span><span class="s">"'b Profile"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">votes</span><span class="o">::</span><span class="s">"'b Votes"</span>
<span class="w">  </span><span class="kp">assumes</span><span class="w"> </span><span class="s">"p1 &lt;~~&gt; p2"</span>
<span class="w">  </span><span class="kp">shows</span><span class="w"> </span><span class="s">"calculate_votes p1 profile votes = calculate_votes p2 profile votes"</span>
</code></pre></div>



<a name="419838358"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419838358" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419838358">(Feb 05 2024 at 13:23)</a>:</h4>
<p>and then the proof should actually work</p>



<a name="419839761"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419839761" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Francesco Rossetta <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419839761">(Feb 05 2024 at 13:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="233198">Mathias Fleury</span> <a href="#narrow/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations/near/419838358">said</a>:</p>
<blockquote>
<p>and then the proof should actually work</p>
</blockquote>
<p>it does not, there is the same error as before. today i will try to do it with multisets through fold_mset, but at this point i am just curious to know why it still does not work.</p>



<a name="419841923"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419841923" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419841923">(Feb 05 2024 at 13:42)</a>:</h4>
<p>You removed the <code>assume "p1 &lt;~~&gt; p2"</code> right?</p>



<a name="419896204"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419896204" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Francesco Rossetta <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419896204">(Feb 05 2024 at 17:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="233198">Mathias Fleury</span> <a href="#narrow/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations/near/419841923">said</a>:</p>
<blockquote>
<p>You removed the <code>assume "p1 &lt;~~&gt; p2"</code> right?</p>
</blockquote>
<p>Thank you, I did and changing some details it worked. I slightly rewrote it cleaner and now I am working on the second case</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">proof</span><span class="w"> </span><span class="o">(</span><span class="n">cases</span><span class="w"> </span><span class="s">"p1 = []"</span><span class="o">)</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="n">True</span>
<span class="w">  </span><span class="k">with</span><span class="w"> </span><span class="n">assms</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="o">?</span><span class="n">thesis</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="n">perm_empty_imp</span><span class="o">)</span>
<span class="k">next</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="n">False</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">obtain</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">p1'</span><span class="w"> </span><span class="kp">where</span><span class="w"> </span><span class="s">"p1 = x # p1'"</span>
<span class="w">    </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">meson</span><span class="w"> </span><span class="n">list.exhaust</span><span class="o">)</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">obtain</span><span class="w"> </span><span class="n">p2'</span><span class="w"> </span><span class="kp">where</span><span class="w"> </span><span class="s">"p2 &lt;~~&gt; x # p2'"</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">assms</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">metis</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"p2' &lt;~~&gt; p1'"</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="s">‹p1 = x # p1'›</span><span class="w"> </span><span class="n">assms</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">auto</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"calculate_votes p1 profile votes = calculate_votes (x # p1') profile votes"</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">assms</span>
<span class="w">  </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="s">‹p1 = x # p1'›</span><span class="o">)</span>
<span class="w">  </span><span class="k">also</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"... = calculate_votes p1' profile (count_votes x profile empty_votes 0)"</span>
<span class="w">    </span><span class="k">by</span><span class="w"> </span><span class="n">simp</span>
<span class="w">  </span><span class="k">also</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"... = calculate_votes p2' profile (count_votes x profile empty_votes 0)"</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">assms</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">simp</span>
<span class="w">  </span><span class="k">also</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"... = calculate_votes p2 profile votes"</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="s">‹p2 &lt;~~&gt; x # p2'›</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">simp</span>
<span class="w">  </span><span class="k">finally</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="o">?</span><span class="n">thesis</span><span class="w"> </span><span class="ow">.</span>
<span class="k">qed</span>
</code></pre></div>
<p>I wrote the first steps and they work perfectly but the "... = calculate_votes p2' profile (count_votes x profile empty_votes 0)" step does not work, I think related to the "step n" for which I assume the lemma works in the induction proofs. So I should add this somewhere? but not as an assumption, for what I understood.</p>



<a name="419914919"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419914919" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419914919">(Feb 05 2024 at 19:40)</a>:</h4>
<p><code>step</code> contain all the theorem (IH + all assumptions). Therefore, <code>using step</code> may be what you are missing.</p>



<a name="419997682"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419997682" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Francesco Rossetta <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419997682">(Feb 06 2024 at 08:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="233198">Mathias Fleury</span> <a href="#narrow/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations/near/419914919">said</a>:</p>
<blockquote>
<p><code>step</code> contain all the theorem (IH + all assumptions). Therefore, <code>using step</code> may be what you are missing.</p>
</blockquote>
<p>it's still not working, also the error is the same:</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">have</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p1'</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="o">(</span><span class="n">count_votes</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">empty_votes</span><span class="w"> </span><span class="n">0</span><span class="o">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">     </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p2'</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="o">(</span><span class="n">count_votes</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">empty_votes</span><span class="w"> </span><span class="n">0</span><span class="o">)</span>
<span class="k">proof</span><span class="w"> </span><span class="o">(</span><span class="n">state</span><span class="o">)</span>
<span class="n">this</span><span class="o">:</span>
<span class="w">  </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p1'</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="o">(</span><span class="n">count_votes</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">empty_votes</span><span class="w"> </span><span class="n">0</span><span class="o">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p2'</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="o">(</span><span class="n">count_votes</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">empty_votes</span><span class="w"> </span><span class="n">0</span><span class="o">)</span>

<span class="n">goal</span><span class="w"> </span><span class="o">(</span><span class="n">1</span><span class="w"> </span><span class="n">subgoal</span><span class="o">):</span>
<span class="w"> </span><span class="n">1.</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="n">≠</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="n">⟹</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">votes</span>
<span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="kp">apply</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="k">proof</span><span class="w"> </span><span class="n">method⌂</span><span class="o">:</span>
<span class="k">using</span><span class="w"> </span><span class="n">this</span><span class="o">:</span>
<span class="w">    </span><span class="n">mset</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mset</span><span class="w"> </span><span class="n">p2</span>
<span class="w">    </span><span class="o">?</span><span class="n">x</span><span class="w"> </span><span class="n">∈</span><span class="w"> </span><span class="n">ccpo_class.iterates</span><span class="w"> </span><span class="o">?</span><span class="n">f</span><span class="w"> </span><span class="n">⟹</span><span class="w"> </span><span class="o">?</span><span class="n">f</span><span class="w"> </span><span class="o">?</span><span class="n">x</span><span class="w"> </span><span class="n">∈</span><span class="w"> </span><span class="n">ccpo_class.iterates</span><span class="w"> </span><span class="o">?</span><span class="n">f</span>
<span class="n">goal</span><span class="w"> </span><span class="o">(</span><span class="n">1</span><span class="w"> </span><span class="n">subgoal</span><span class="o">):</span>
<span class="w"> </span><span class="n">1.</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p1'</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="o">(</span><span class="n">count_votes</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">empty_votes</span><span class="w"> </span><span class="n">0</span><span class="o">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">calculate_votes</span><span class="w"> </span><span class="n">p2'</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="o">(</span><span class="n">count_votes</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">empty_votes</span><span class="w"> </span><span class="n">0</span><span class="o">)</span>
</code></pre></div>
<p>It is really weird, since this step should be solved by IH</p>



<a name="419998245"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419998245" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mathias Fleury <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419998245">(Feb 06 2024 at 08:37)</a>:</h4>
<p>I am lost in the proof you are actually running, but where are you doing induction? Currently I see only a case distinction <code>cases</code></p>



<a name="419998941"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/Foldr%20invariant%20on%20permutations/near/419998941" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Francesco Rossetta <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations.html#419998941">(Feb 06 2024 at 08:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="233198">Mathias Fleury</span> <a href="#narrow/stream/238552-Beginner-Questions/topic/Foldr.20invariant.20on.20permutations/near/419998245">said</a>:</p>
<blockquote>
<p>I am lost in the proof you are actually running, but where are you doing induction? Currently I see only a case distinction <code>cases</code></p>
</blockquote>
<p>Currently this is my code</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">fun</span><span class="w"> </span><span class="n">calculate_votes</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b list ⇒ 'b Profile ⇒'b Votes ⇒ 'b Votes"</span><span class="w"> </span><span class="kp">where</span>
<span class="w">  </span><span class="s">"calculate_votes [] profile_list votes = votes"</span><span class="w"> </span><span class="o">|</span>
<span class="w">  </span><span class="s">"calculate_votes (px # p) profile_list votes =</span>
<span class="s">      calculate_votes p profile_list (count_votes px profile_list empty_votes 0)"</span>


<span class="kn">lemma</span><span class="w"> </span><span class="n">calculate_votes_permutation</span><span class="o">:</span>
<span class="w">  </span><span class="kp">fixes</span>
<span class="w">    </span><span class="n">p1</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="s">"'b Parties"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">p2</span><span class="w"> </span><span class="o">::</span><span class="s">"'b Parties"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">profile</span><span class="w"> </span><span class="o">::</span><span class="s">"'b Profile"</span><span class="w"> </span><span class="kp">and</span>
<span class="w">    </span><span class="n">votes</span><span class="o">::</span><span class="s">"'b Votes"</span>
<span class="w">  </span><span class="kp">assumes</span><span class="w"> </span><span class="s">"p1 &lt;~~&gt; p2"</span>
<span class="w">  </span><span class="kp">shows</span><span class="w"> </span><span class="s">"calculate_votes p1 profile votes = calculate_votes p2 profile votes"</span>
<span class="k">proof</span><span class="w"> </span><span class="o">(</span><span class="n">cases</span><span class="w"> </span><span class="s">"p1 = []"</span><span class="o">)</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="n">True</span>
<span class="w">  </span><span class="k">with</span><span class="w"> </span><span class="n">assms</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="o">?</span><span class="n">thesis</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="n">perm_empty_imp</span><span class="o">)</span>
<span class="k">next</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="n">False</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">obtain</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">p1'</span><span class="w"> </span><span class="kp">where</span><span class="w"> </span><span class="s">"p1 = x # p1'"</span>
<span class="w">    </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">meson</span><span class="w"> </span><span class="n">list.exhaust</span><span class="o">)</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">obtain</span><span class="w"> </span><span class="n">p2'</span><span class="w"> </span><span class="kp">where</span><span class="w"> </span><span class="s">"p2 &lt;~~&gt; x # p2'"</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">assms</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">metis</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"p2' &lt;~~&gt; p1'"</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="s">‹p1 = x # p1'›</span><span class="w"> </span><span class="n">assms</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">auto</span>
<span class="w">  </span><span class="k">then</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"calculate_votes p1 profile votes = calculate_votes (x # p1') profile votes"</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">assms</span>
<span class="w">  </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="n">simp</span><span class="w"> </span><span class="n">add</span><span class="o">:</span><span class="w"> </span><span class="s">‹p1 = x # p1'›</span><span class="o">)</span>
<span class="w">  </span><span class="k">also</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"... = calculate_votes p1' profile (count_votes x profile empty_votes 0)"</span>
<span class="w">    </span><span class="k">by</span><span class="w"> </span><span class="n">simp</span>
<span class="w">  </span><span class="k">also</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"... = calculate_votes p2' profile (count_votes x profile empty_votes 0)"</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">simp</span>
<span class="w">  </span><span class="k">also</span><span class="w"> </span><span class="k">have</span><span class="w"> </span><span class="s">"... = calculate_votes p2 profile votes"</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="s">‹p2 &lt;~~&gt; x # p2'›</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">simp</span>
<span class="w">  </span><span class="k">finally</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="o">?</span><span class="n">thesis</span><span class="w"> </span><span class="ow">.</span>
<span class="k">qed</span>
</code></pre></div>
<p>The True case works, I am in the False one, stuck in the step where I use "step" as you suggested. The only thing I can think of is that I define p2 as a permutation of x # p2' and not as being itself p2 = x # p2', so maybe the IH does not work as expected?</p>



<hr><p>Last updated: Feb 22 2026 at 20:30 UTC</p>
</html>