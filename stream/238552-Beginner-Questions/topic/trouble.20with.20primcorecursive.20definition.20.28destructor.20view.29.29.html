<html>
<head><meta charset="utf-8"><title>trouble with primcorecursive definition (destructor view)) · Beginner Questions · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/index.html">Beginner Questions</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/trouble.20with.20primcorecursive.20definition.20.28destructor.20view.29.29.html">trouble with primcorecursive definition (destructor view))</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="320269880"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/trouble%20with%20primcorecursive%20definition%20%28destructor%20view%29%29/near/320269880" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlos <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/trouble.20with.20primcorecursive.20definition.20.28destructor.20view.29.29.html#320269880">(Jan 09 2023 at 16:30)</a>:</h4>
<p>How does the _destructor view_ (datatypes, section 5.1.6) work exactly/what am I doing wrong? Following the example defined:</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">codatatype</span><span class="w"> </span><span class="n n-Type">'a</span><span class="w"> </span><span class="n">llist'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lnil'</span><span class="o">:</span><span class="n">LNil'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">LCons'</span><span class="w"> </span><span class="o">(</span><span class="n">hd'</span><span class="o">:</span><span class="n n-Type">'a</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">tl'</span><span class="o">:</span><span class="s">"'a llist'"</span><span class="o">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">LConsZ'</span><span class="w"> </span><span class="o">(</span><span class="n">ntl'</span><span class="o">:</span><span class="s">"'a llist'"</span><span class="o">)</span><span class="w"></span>

<span class="kn">primcorecursive</span><span class="w"> </span><span class="o">(</span><span class="n">sequential</span><span class="o">)</span><span class="w"> </span><span class="n">lzip'</span><span class="w">  </span><span class="o">::</span><span class="w"> </span><span class="s">"'a llist' ⇒ 'b llist' ⇒ ('a × 'b) llist'"</span><span class="w"> </span><span class="kp">where</span><span class="w"></span>
<span class="w">  </span><span class="s">"⟦lnil' x; lnil' y⟧ ⟹ lnil' (lzip' x y)"</span><span class="w"></span>
</code></pre></div>
<p>which works. but now I am struggling to give it the remaining equations. adding <code>| "hd' (lzip' x y) = (hd' x, hd' y)"</code> leaves me with "No subgoals!" but closing it with <code>done</code> leads to:</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="n">Proof</span><span class="w"> </span><span class="n">failed.</span><span class="w"></span>
<span class="w"> </span><span class="n">1.</span><span class="w"> </span><span class="n">⋀x</span><span class="w"> </span><span class="n">y.</span><span class="w"> </span><span class="n">¬</span><span class="w"> </span><span class="n">lnil'</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">∨</span><span class="w"> </span><span class="n">¬</span><span class="w"> </span><span class="n">lnil'</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">⟹</span><span class="w"> </span><span class="n">False</span><span class="w"></span>
<span class="w"> </span><span class="n">2.</span><span class="w"> </span><span class="n">⋀x</span><span class="w"> </span><span class="n">y.</span><span class="w"> </span><span class="n">¬</span><span class="w"> </span><span class="n">lnil'</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">∨</span><span class="w"> </span><span class="n">¬</span><span class="w"> </span><span class="n">lnil'</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">⟹</span><span class="w"> </span><span class="o">(</span><span class="n">hd'</span><span class="w"> </span><span class="o">(</span><span class="n">fst</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="w"> </span><span class="n">y</span><span class="o">)),</span><span class="w"> </span><span class="n">hd'</span><span class="w"> </span><span class="o">(</span><span class="n">snd</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="w"> </span><span class="n">y</span><span class="o">)))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">hd'</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="w"> </span><span class="n">hd'</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w"></span>
<span class="n">The</span><span class="w"> </span><span class="n">error</span><span class="o">(</span><span class="n">s</span><span class="o">)</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">occurred</span><span class="w"> </span><span class="kp">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">goal</span><span class="w"> </span><span class="n">statement⌂</span><span class="o">:</span><span class="w"></span>
<span class="n">⋀x</span><span class="w"> </span><span class="n">y.</span><span class="w"> </span><span class="n">¬</span><span class="w"> </span><span class="n">lnil'</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">∨</span><span class="w"> </span><span class="n">¬</span><span class="w"> </span><span class="n">lnil'</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">⟹</span><span class="w"> </span><span class="n">hd'</span><span class="w"> </span><span class="o">(</span><span class="n">lzip'</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">hd'</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="w"> </span><span class="n">hd'</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w"></span>
</code></pre></div>
<p>So I guess the remaining equations need some conditions, but this gives me other errors: adding <code>⟦is_LCons' x; is_LCons' y⟧ ⟹ </code> to the second equation leads to "Unexpected condition in selector formula".</p>



<a name="320270407"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/trouble%20with%20primcorecursive%20definition%20%28destructor%20view%29%29/near/320270407" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlos <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/trouble.20with.20primcorecursive.20definition.20.28destructor.20view.29.29.html#320270407">(Jan 09 2023 at 16:32)</a>:</h4>
<p>For what it is worth I can defining zipping on regular llist with two constructors. and also this definition <code>lzip'</code> by using <code>case</code> worked, I am just wondering about that view.</p>



<a name="320274190"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/trouble%20with%20primcorecursive%20definition%20%28destructor%20view%29%29/near/320274190" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlos <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/trouble.20with.20primcorecursive.20definition.20.28destructor.20view.29.29.html#320274190">(Jan 09 2023 at 16:48)</a>:</h4>
<p>With my limited knowledge, my goal was to define</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="n">lnil'</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="n">&gt;</span><span class="w"> </span><span class="n">lnil'</span><span class="w"> </span><span class="o">==</span><span class="n">&gt;</span><span class="w"> </span><span class="n">lnil'</span><span class="w"> </span><span class="o">(</span><span class="n">lzip'</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w"></span>
<span class="n">hd'</span><span class="w"> </span><span class="o">(</span><span class="n">lzip'</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">hd'</span><span class="w"> </span><span class="n">x</span><span class="o">,</span><span class="w"> </span><span class="n">hd'</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w">              </span><span class="o">--</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">@</span><span class="ow">{</span><span class="kt">term</span><span class="w"> </span><span class="s">"hd' x"</span><span class="ow">}</span><span class="w"> </span><span class="kp">and</span><span class="w"> </span><span class="n">@</span><span class="ow">{</span><span class="kt">term</span><span class="w"> </span><span class="s">"hd' y"</span><span class="ow">}</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">clear</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">@</span><span class="ow">{</span><span class="kt">thm</span><span class="w"> </span><span class="s">"is_LCons' x"</span><span class="ow">}</span><span class="w"> </span><span class="kp">and</span><span class="w"> </span><span class="n">@</span><span class="ow">{</span><span class="kt">thm</span><span class="w"> </span><span class="s">"is_LCons' y"</span><span class="ow">}</span><span class="w"></span>
<span class="n">tl'</span><span class="w"> </span><span class="o">(</span><span class="n">lzip'</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lzip'</span><span class="w"> </span><span class="o">(</span><span class="n">tl'</span><span class="w"> </span><span class="n">x</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">tl'</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w">       </span><span class="o">--</span><span class="w"> </span><span class="n">similar</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">pre</span><span class="o">-</span><span class="n">condition</span><span class="w"></span>
<span class="n">ntl'</span><span class="w"> </span><span class="o">(</span><span class="n">lzip'</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lzip'</span><span class="w"> </span><span class="o">(</span><span class="n">ntl'</span><span class="w"> </span><span class="n">x</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">ntl'</span><span class="w"> </span><span class="n">y</span><span class="o">)</span><span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">ditto</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="kp">for</span><span class="w"> </span><span class="n">@</span><span class="ow">{</span><span class="kt">term</span><span class="w"> </span><span class="n">is_LConsZ'</span><span class="ow">}</span><span class="w"></span>
</code></pre></div>



<a name="320471073"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/trouble%20with%20primcorecursive%20definition%20%28destructor%20view%29%29/near/320471073" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dmitriy Traytel <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/trouble.20with.20primcorecursive.20definition.20.28destructor.20view.29.29.html#320471073">(Jan 10 2023 at 15:02)</a>:</h4>
<p>It is not clear what you are attempting to specify. From your four equations that you give it is not clear when the output should be an LCons' and when it should be an LConsZ'.  For a codatatype with 3 constructors, primcorec expects to see 2 discriminator specifications. Something like the following works (even with plain primcorec):</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">codatatype</span><span class="w"> </span><span class="n n-Type">'a</span><span class="w"> </span><span class="n">llist'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lnil'</span><span class="o">:</span><span class="n">LNil'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">lcons'</span><span class="o">:</span><span class="w"> </span><span class="n">LCons'</span><span class="w"> </span><span class="o">(</span><span class="n">hd'</span><span class="o">:</span><span class="n n-Type">'a</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">tl'</span><span class="o">:</span><span class="s">"'a llist'"</span><span class="o">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">LConsZ'</span><span class="w"> </span><span class="o">(</span><span class="n">ntl'</span><span class="o">:</span><span class="s">"'a llist'"</span><span class="o">)</span><span class="w"></span>

<span class="k">abbreviation</span><span class="w"> </span><span class="s">"n_tl x ≡ (if lcons' x then tl' x else ntl' x)"</span><span class="w"></span>

<span class="k">primcorec</span><span class="w"> </span><span class="n">lzip'</span><span class="w">  </span><span class="o">::</span><span class="w"> </span><span class="s">"'a llist' ⇒ 'b llist' ⇒ ('a × 'b) llist'"</span><span class="w"> </span><span class="kp">where</span><span class="w"></span>
<span class="w">  </span><span class="s">"⟦lnil' x ∨ lnil' y⟧ ⟹ lnil' (lzip' x y)"</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="s">"⟦lcons' x ∧ lcons' y⟧ ⟹ lcons' (lzip' x y)"</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="s">"hd' (lzip' x y) = (hd' x, hd' y)"</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="s">"tl' (lzip' x y) = lzip' (tl' x) (tl' y)"</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="s">"ntl' (lzip' x y) = lzip' (n_tl x) (n_tl y)"</span><span class="w"></span>
</code></pre></div>
<p>Note that I've changed and 'and' for and 'or' in the lnil discriminator equation as I believe this is more meaningful for zip.</p>



<a name="320471309"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/trouble%20with%20primcorecursive%20definition%20%28destructor%20view%29%29/near/320471309" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dmitriy Traytel <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/trouble.20with.20primcorecursive.20definition.20.28destructor.20view.29.29.html#320471309">(Jan 10 2023 at 15:03)</a>:</h4>
<p>Of course from the point of view of primcorec(ursive), the low level tactic error should not reach the user (and be replaced by a friendlier error message).</p>



<a name="320473983"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/238552-Beginner%20Questions/topic/trouble%20with%20primcorecursive%20definition%20%28destructor%20view%29%29/near/320473983" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlos <a href="http://isabelle.systems/zulip-archive/stream/238552-Beginner-Questions/topic/trouble.20with.20primcorecursive.20definition.20.28destructor.20view.29.29.html#320473983">(Jan 10 2023 at 15:14)</a>:</h4>
<blockquote>
<p>For a codatatype with 3 constructors, primcorec expects to see 2 discriminator specifications.</p>
</blockquote>
<p>This is the crucial bit I missed, thank you! And indeed the first specification should use ∨, that was not intentional.</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>