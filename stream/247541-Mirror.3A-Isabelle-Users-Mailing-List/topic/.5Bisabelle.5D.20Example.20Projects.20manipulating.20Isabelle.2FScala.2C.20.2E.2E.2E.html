<html>
<head><meta charset="utf-8"><title>[isabelle] Example Projects manipulating Isabelle/Scala, ... · Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Example.20Projects.20manipulating.20Isabelle.2FScala.2C.20.2E.2E.2E.html">[isabelle] Example Projects manipulating Isabelle/Scala, ...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="436901582"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Example%20Projects%20manipulating%20Isabelle/Scala%2C%20.../near/436901582" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Example.20Projects.20manipulating.20Isabelle.2FScala.2C.20.2E.2E.2E.html#436901582">(May 03 2024 at 14:58)</a>:</h4>
<p>From: "Tan, Chengsong" &lt;<a href="mailto:c.tan@imperial.ac.uk">c.tan@imperial.ac.uk</a>&gt;<br>
Hi all,</p>
<p>Are there any existing projects that uses Isabelle/Scala and Isabelle/ML to define custom <code>Scala.Fun</code> functions and also develop custom sledgehammer commands invoking these functions? I want to build an automated tool that copy-pastes sledgehammer proofs for you (details in <a href="#narrow/stream/202961-General/topic/tools.20to.20automatically.20adopt.20sledgehammer.20proofs.20into.20theory">https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/tools.20to.20automatically.20adopt.20sledgehammer.20proofs.20into.20theory</a>),<br>
and I have been looking at the system manual (chapter 5), but without an example it is difficult to set up a "hello world" prototype to start with.</p>
<p>Thanks a lot!</p>
<p>Best wishes,<br>
Chengsong</p>



<a name="437013004"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Example%20Projects%20manipulating%20Isabelle/Scala%2C%20.../near/437013004" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Example.20Projects.20manipulating.20Isabelle.2FScala.2C.20.2E.2E.2E.html#437013004">(May 04 2024 at 11:08)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
In Isabelle2024-RC3 there is src/Tools/Demo to show how to make a command-line <br>
tool in Isabelle/Scala: that directory is registered implicitly as <br>
"component". For your own setup, you need to do this explicitly, e.g. via <br>
"isabelle components -u".</p>
<p>To register Scala functions instead of command-line tools, the relevant <br>
service class is Scala.Functions. If you hyper-search that in all .scala <br>
sources, you will see examples. You need to make your own instance and <br>
register that in etc/build.props in the section "services".</p>
<p>Makarius</p>



<a name="437244367"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Example%20Projects%20manipulating%20Isabelle/Scala%2C%20.../near/437244367" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Example.20Projects.20manipulating.20Isabelle.2FScala.2C.20.2E.2E.2E.html#437244367">(May 06 2024 at 11:37)</a>:</h4>
<p>From: "Tan, Chengsong" &lt;<a href="mailto:c.tan@imperial.ac.uk">c.tan@imperial.ac.uk</a>&gt;<br>
Hi Makarius,</p>
<p>Thanks a lot for the Demo info, I have now created and registered my own command-line tool.<br>
How to I call sledgehammer from Isabelle/Scala (or Isabelle ML)? Like, is there some API that allows me to call sledgehammer from a method in “demo_tool.scala”? Can I do something like: "Here's this thy file. Tell me what's the sledgehammer output at line 100 column 45"?<br>
I can see that there are functions like “run_atp” and “one_line_proof_text” in the relevant .ML files in the “HOL/Tools/Sledgehammer” folder, but am not quite sure how to leverage them to achieve the above effect.</p>
<p>Thanks a lot,<br>
Chengsong</p>



<a name="442030792"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Example%20Projects%20manipulating%20Isabelle/Scala%2C%20.../near/442030792" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Example.20Projects.20manipulating.20Isabelle.2FScala.2C.20.2E.2E.2E.html#442030792">(Jun 02 2024 at 09:51)</a>:</h4>
<p>From: "Tan, Chengsong" &lt;<a href="mailto:c.tan@imperial.ac.uk">c.tan@imperial.ac.uk</a>&gt;</p>
<blockquote>
<p>The offset counts Isabelle symbols from the start of the identified text. One<br>
approach to get line (and column) from it is to turn it into a Text.Offset and<br>
then use Line.Node_Position.advance with the substring in question. If you<br>
search the Isabelle/Scala sources for Line.Node_Position, you will see some<br>
examples.</p>
</blockquote>
<p>How is such id and offset in ML converted to Scala?<br>
The hope is that such id and offset information can be used to calculate the text (line &amp; col) position a certain command, when that command is being evaluated in ML, which usually means that information is no longer available.<br>
ML and Scala interface via some protocol, therefore whenever a command generates some output/causes a state change in ML, then that information must be passed back to Scala via the protocol message. My idea is that we can intercept that message (which will contain necessary info to deduce a Scala offset and id (Symbol.offset and Document_ID.Generic)), so that we can log/render that positional information together with that message. For instance, an ML error causes the jedit proof interface to show several red bits in both the main editor window and the proof state panel, with messages like “Failed to finish proof…”, if we would like to intercept that error message while it is being sent from Isabelle/ML to Isabelle/Scala and add a line number to that message, which files should we modify?</p>
<p>A related question: how are the command_keywords called from the Scala side? These commands are defined in ML, but their calling sites seem not within the ML codebase itself. For instance, sledgehammer’s command keyword is defined with a call to the function “hammer_away”. But who calls hammer_away whenever a sledgehammer is seen in a thy file? Surely in Scala there should be some “handle” that calls hammer_away at sledgehammer?</p>
<p>In a standalone tool like demo_tool.scala, how to convert a thy file (string) into some Isabelle internal representation of proof state? Is that possible?</p>
<p>Thanks a lot,<br>
Chengsong</p>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Date: Monday, 20 May 2024 at 19:37<br>
To: Tan, Chengsong &lt;<a href="mailto:c.tan@imperial.ac.uk">c.tan@imperial.ac.uk</a>&gt;, <a href="mailto:isabelle-users@cl.cam.ac.uk">isabelle-users@cl.cam.ac.uk</a> &lt;<a href="mailto:isabelle-users@cl.cam.ac.uk">isabelle-users@cl.cam.ac.uk</a>&gt;<br>
Subject: Re: [isabelle] Example Projects manipulating Isabelle/Scala, Isabelle/ML &amp; Sledgehammer<br>
On 12/05/2024 01:32, Tan, Chengsong wrote:</p>
<blockquote>
<p>When the line number is not available in Position.T, how to deduce the line<br>
number/character number via “id” and “offset”?</p>
</blockquote>
<p>The id is an abstract handle on the piece of text you are looking at. In the<br>
Prover IDE it is the static or dynamic command-span. In batch-mode it is the<br>
overall theory.</p>
<p>The offset counts Isabelle symbols from the start of the identified text. One<br>
approach to get line (and column) from it is to turn it into a Text.Offset and<br>
then use Line.Node_Position.advance with the substring in question. If you<br>
search the Isabelle/Scala sources for Line.Node_Position, you will see some<br>
examples.</p>
<blockquote>
<p>I can see that the clickable areas are defined via a function called<br>
“sendback_markup_command” in “active.ML”. So surely with “id” it’s possible to<br>
locate where that command is (so that the text is properly inserted back as<br>
done in s/h for example).</p>
</blockquote>
<p>You should look in the vicinity of snapshot.find_command_position and<br>
snapshot.find_command_line to get an idea how this works.</p>
<blockquote>
<p>If deducing the specific line from “id”  is not possible, is to<br>
“automatically” do the click within Isabelle/ML rather than waiting for user<br>
input. Can you explain a bit more about those clickable “sendback”s so that I<br>
can write such a function?</p>
</blockquote>
<p>The sendback markup is produced in Isabelle/ML and interpreted in<br>
Isabelle/Scala in jedit_rendering.scala and active.scala --- the latter uses<br>
build.props "services" of type Active.Handler: that means you could in<br>
principle invent your own markup and provide a specific handler.</p>
<p>This won't help to "do the click in Isabelle/ML", at least not directly. In<br>
fact, the usual approach is abstain from machine generated edits, but merely<br>
offer the user a suitable message with markup to be clicked on.</p>
<p>An example is the document antiquotation for jEdit actions, e.g.</p>
<p>text ‹☛‹about››</p>
<blockquote>
<p>A side question, what’s the meaning of all the variables with the suffix “N”,<br>
like sledgehammerN, markup.idN, etc.?</p>
</blockquote>
<p>It means "Name".</p>
<p>Makarius</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>