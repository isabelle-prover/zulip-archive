<html>
<head><meta charset="utf-8"><title>[isabelle] How to debug the auto method? · Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20How.20to.20debug.20the.20auto.20method.3F.html">[isabelle] How to debug the auto method?</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="434492349"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20How%20to%20debug%20the%20auto%20method%3F/near/434492349" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20How.20to.20debug.20the.20auto.20method.3F.html#434492349">(Apr 20 2024 at 11:16)</a>:</h4>
<p>From: Karolis Petrauskas &lt;<a href="mailto:k.petrauskas@gmail.com">k.petrauskas@gmail.com</a>&gt;<br>
I'm trying to debug the TLA+ proof system (TLAPS), which uses Isabelle as a<br>
backend.<br>
The lemma below is proved by <code>simp</code> but fails to be proved by <code>auto</code>.<br>
While I can set the proof method manually, multiple existing proofs use<br>
<code>auto</code> as the default.<br>
How can I find out why the auto method fails?</p>
<div class="codehilite" data-code-language="Isabelle"><pre><span></span><code><span class="k">theory</span><span class="w"> </span><span class="n">tlapm_e6d04a_debug</span>
<span class="w">  </span><span class="kp">imports</span><span class="w"> </span><span class="n">Constant</span><span class="w"> </span><span class="n">Zenon</span>
<span class="k">begin</span>

<span class="kn">lemma</span><span class="w"> </span><span class="n">ob1</span><span class="o">:</span>
<span class="w">  </span><span class="kp">fixes</span><span class="w"> </span><span class="n">S</span>
<span class="w">    </span><span class="kp">and</span><span class="w"> </span><span class="n">op</span>
<span class="w">    </span><span class="kp">and</span><span class="w"> </span><span class="n">IsFiniteSet</span>
<span class="w">    </span><span class="kp">and</span><span class="w"> </span><span class="n">CardSum</span>
<span class="w">  </span><span class="kp">assumes</span><span class="w"> </span><span class="n">a1</span><span class="o">:</span><span class="w"> </span><span class="s">"IsFiniteSet (S)"</span>
<span class="w">      </span><span class="kp">and</span><span class="w"> </span><span class="n">a2</span><span class="o">:</span><span class="w"> </span><span class="s">"∀ e ∈ (S) : op (e) ∈ Nat"</span>
<span class="w">      </span><span class="kp">and</span><span class="w"> </span><span class="n">a4</span><span class="o">:</span><span class="w"> </span><span class="s">"CardSum ((S), (op)) = 0"</span>
<span class="w">      </span><span class="kp">and</span><span class="w"> </span><span class="n">a5</span><span class="o">:</span><span class="w"> </span><span class="s">"</span>
<span class="s">        ⋀ S' :: c. (</span>
<span class="s">          (IsFiniteSet (S')) ⟹ (⋀ op :: c =&gt; c. (</span>
<span class="s">            (∀ e ∈ (S') :  (op (e)) ∈ Nat) ⟹ (</span>
<span class="s">              ((CardSum ((S'), (op))) = 0) ⟹ (</span>
<span class="s">                ∀ e ∈ S' : (op (e)) = 0</span>
<span class="s">              )</span>
<span class="s">            )</span>
<span class="s">          ))</span>
<span class="s">        )"</span>
<span class="w">  </span><span class="kp">shows</span><span class="w"> </span><span class="s">"∀ e ∈ S : op (e) = 0"</span><span class="w"> </span><span class="o">(</span><span class="kp">is</span><span class="w"> </span><span class="s">"PROP ?P"</span><span class="o">)</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">assms</span>
<span class="w">  </span><span class="k">by</span><span class="w"> </span><span class="n">auto</span><span class="w"> </span><span class="c">(* NOTE: simp works here *)</span>
<span class="k">end</span>
</code></pre></div>
<p>This fragment is a cleaned-up version of a theory generated by TLAPS; the<br>
original version can be found here (<br>
<a href="https://gist.github.com/kape1395/84562bf5679fe9f9f65c4d85715b7827">https://gist.github.com/kape1395/84562bf5679fe9f9f65c4d85715b7827</a>).</p>
<p>This proof is done in the context of the TLA+ theory that can be found here:<br>
<a href="https://github.com/tlaplus/tlapm/tree/isabelle2020-dune-2024RC2/isabelle">https://github.com/tlaplus/tlapm/tree/isabelle2020-dune-2024RC2/isabelle</a></p>
<p>The behavior looks the same in Isabelle2023 and Isabelle2024-RC2.</p>
<p>Karolis Petrauskas</p>



<a name="434496092"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20How%20to%20debug%20the%20auto%20method%3F/near/434496092" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20How.20to.20debug.20the.20auto.20method.3F.html#434496092">(Apr 20 2024 at 12:11)</a>:</h4>
<p>From: "Eugene W. Stark" &lt;<a href="mailto:isabelle-users@starkeffect.com">isabelle-users@starkeffect.com</a>&gt;<br>
I'm certainly not an expert on how "auto" works under the covers, but I can offer some<br>
practical advice based on my experience.</p>
<p>If the goal can be proved with simp but not with auto, then some of the extra things that<br>
auto does beyond simp are getting in the way.  Sometimes this can be lemmas that are<br>
declared as "intro", "elim", or "dest" that are ill-formed for the type of reasoning<br>
they are declared for.  Sometimes this can be the result of case splitting that auto<br>
does but simp does not.  Another thing that I have sometimes seen is that although<br>
auto has a certain capability for "solving" things by instantiating schematic variables,<br>
sometimes it will choose the wrong instance as a "solution", thereby rendering the<br>
resulting set of subgoals that are derived from this choice to be unprovable.</p>
<p>The first major distinction to make is whether auto "loops" or actually terminates with<br>
a failure (you didn't say in your posting).  If it "loops", it could be that ill-formed<br>
"intro", "elim", etc. rules are the culprit.  Or, it could have embarked on a case-splitting<br>
adventure in which it spends a lot of time chopping things up into a huge number of<br>
small cases.  It's hard to give a general strategy for figuring out what is going on<br>
if auto is not terminating, because you don't get any output.  If you declared your own<br>
"intro", "elim", etc. rules that were not in the base package that you were using, then<br>
you might try commenting some of those declarations to see if you can get auto to terminate.<br>
Of course, it could be the underlying package that you are using, but presumably someone<br>
has worked with that longer and there is less likelihood of looping problems remaining.<br>
Case splitting issues often tend to occur when working with function or datatype<br>
definitions.  However, those are not evident in the example you posted.</p>
<p>If "auto" terminates, then the failed subgoals it outputs upon termination are the place<br>
to start.  I would look at them closely to make sure that they are actually true<br>
and that some kind of choice has not been made that created unprovable subgoals,<br>
as I mentioned above.  That strikes me as the most likely thing that would result in<br>
auto terminating with failure when simp succeeds.  If that is what is occurred,<br>
then it might be possible to rewrite whatever rules auto is using, so the unification<br>
or whatever it is doing to find the instantiations will not result in unprovable<br>
subgoals.</p>
<p>I hope that is at least a little bit helpful and not totally off the mark!</p>



<a name="437105250"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20How%20to%20debug%20the%20auto%20method%3F/near/437105250" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20How.20to.20debug.20the.20auto.20method.3F.html#437105250">(May 05 2024 at 11:53)</a>:</h4>
<p>From: Karolis Petrauskas &lt;<a href="mailto:k.petrauskas@gmail.com">k.petrauskas@gmail.com</a>&gt;<br>
Thanks for the hints! They are useful.<br>
I'm still debugging those failures, but now things look clearer.<br>
Logging like <code>simp_trace</code> would be nice to have for the "classical<br>
reasoner" as well.</p>
<p>Karolis</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>