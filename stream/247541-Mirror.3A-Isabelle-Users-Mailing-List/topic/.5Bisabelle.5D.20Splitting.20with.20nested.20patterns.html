<html>
<head><meta charset="utf-8"><title>[isabelle] Splitting with nested patterns · Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Splitting.20with.20nested.20patterns.html">[isabelle] Splitting with nested patterns</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="384257893"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Splitting%20with%20nested%20patterns/near/384257893" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Splitting.20with.20nested.20patterns.html#384257893">(Aug 12 2023 at 12:58)</a>:</h4>
<p>From: Wolfgang Jeltsch &lt;<a href="mailto:wolfgang@well-typed.com">wolfgang@well-typed.com</a>&gt;<br>
Hi!</p>
<p>The split rules that are generated by datatype declarations deal only<br>
with <code>case</code> expressions that use patterns with one constructor each.<br>
However, I’m dealing with goals that contain <code>case</code> expressions that use<br>
patterns with multiple constructors. For example, there may be <code>case</code><br>
expressions of the following form:</p>
<p>case x of None ⇒ … | Some False ⇒ … | Some True ⇒ …</p>
<p>My experience is that the Simplifier cannot really cope with such case<br>
expressions. How can I assist it?</p>
<p>By the way, how are such <code>case</code> expressions represented internally? My<br>
impression is that they are just syntactic sugar for more fundamental<br>
expressions, but I don’t know what these expressions are.</p>
<p>All the best,<br>
Wolfgang</p>



<a name="384272709"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Splitting%20with%20nested%20patterns/near/384272709" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Splitting.20with.20nested.20patterns.html#384272709">(Aug 12 2023 at 13:57)</a>:</h4>
<p>From: Wolfgang Jeltsch &lt;<a href="mailto:wolfgang@well-typed.com">wolfgang@well-typed.com</a>&gt;<br>
Hi, again!</p>
<p>Through some study and experiments I probably found out how the<br>
desugaring of such <code>case</code> expressions works. Apparently, <code>case</code><br>
expressions with one constructor per pattern are internally represented<br>
as full applications of <code>case_⟨type-of-scrutinee⟩</code> and <code>case</code><br>
expressions with multiple constructors per pattern, like the above one,<br>
are internally represented as nested applications of such eliminator<br>
functions, for example <code>case_option … (case_bool … …) x</code>. This, in turn,<br>
should mean that also such more complex <code>case</code> expressions work with the<br>
default split rules.</p>
<p>Maybe I have to search for other reasons why simplification of my goals<br>
doesn’t work. If anyone has some idea what else could go wrong in the<br>
presence of such <code>case</code> expressions, please tell me.</p>
<p>All the best,<br>
Wolfgang</p>



<a name="384494825"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Splitting%20with%20nested%20patterns/near/384494825" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Splitting.20with.20nested.20patterns.html#384494825">(Aug 13 2023 at 13:23)</a>:</h4>
<p>From: Thomas Sewell &lt;<a href="mailto:tals4@cam.ac.uk">tals4@cam.ac.uk</a>&gt;<br>
Indeed, there is one case constant per datatype.</p>
<p>Its name is usually obvious, e.g. "term case_option" in a theory file will tell you the type of the case constant for option.</p>
<p>To break up a goal with a multi-level case structure, you probably just need to add the split rules for all the case constants that are involved, e.g. both option and bool in the case you showed.</p>
<p>If that doesn't work, you probably need to inspect the goal after the splitting and try to figure out what is blocking the simplifier from taking further steps.</p>
<p>The ML sublanguage of Isabelle sometimes helps in learning which constants are involved in certain syntax. For instance, the below makes it clear that a constant called Option.option.case_option is applied to various terms to make a case split:</p>
<p>ML ‹ @{term "case x of None =&gt; 1 | _ =&gt; 2"} ›</p>
<p>Good luck with it,<br>
    Thomas.</p>



<a name="384801466"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Splitting%20with%20nested%20patterns/near/384801466" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Splitting.20with.20nested.20patterns.html#384801466">(Aug 14 2023 at 14:37)</a>:</h4>
<p>From: Wolfgang Jeltsch &lt;<a href="mailto:wolfgang@well-typed.com">wolfgang@well-typed.com</a>&gt;<br>
Wait, I need to explicitly add these split rules? I thought the split<br>
rules that have been automatically generated for a datatype are already<br>
registered to be taken into account by the Simplifier, analogously to<br>
the datatype’s simplification rules already being part of the simpset.<br>
Is this not the case?</p>
<p>All the best,<br>
Wolfgang</p>



<a name="384825946"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Splitting%20with%20nested%20patterns/near/384825946" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Splitting.20with.20nested.20patterns.html#384825946">(Aug 14 2023 at 15:50)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
On 14/08/2023 16:37, Wolfgang Jeltsch wrote:</p>
<blockquote>
<p>Am Sonntag, dem 13.08.2023 um 13:22 +0000 schrieb Thomas Sewell:</p>
<blockquote>
<p>To break up a goal with a multi-level case structure, you probably<br>
just need to add the split rules for all the case constants that are<br>
involved, e.g. both option and bool in the case you showed.</p>
</blockquote>
<p>Wait, I need to explicitly add these split rules? I thought the split<br>
rules that have been automatically generated for a datatype are already<br>
registered to be taken into account by the Simplifier, analogously to<br>
the datatype’s simplification rules already being part of the simpset.<br>
Is this not the case?</p>
</blockquote>
<p>No.</p>
<p>Tobias</p>
<blockquote>
<p>All the best,<br>
Wolfgang</p>
</blockquote>
<p><a href="/user_uploads/14278/1qDmYXJ0DM5i6Hw8LaTr0G5q/smime.p7s">smime.p7s</a></p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>