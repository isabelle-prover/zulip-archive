<html>
<head><meta charset="utf-8"><title>[isabelle] Isabelle2021-1-RC3: excessive Poly/ML heap	req... · Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/index.html">Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-1-RC3.3A.20excessive.20Poly.2FML.20heap.09req.2E.2E.2E.html">[isabelle] Isabelle2021-1-RC3: excessive Poly/ML heap	req...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="262595396"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-1-RC3%3A%20excessive%20Poly/ML%20heap%09req.../near/262595396" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-1-RC3.3A.20excessive.20Poly.2FML.20heap.09req.2E.2E.2E.html#262595396">(Nov 24 2021 at 14:26)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
What is your OS version?</p>
<p>Can you can try this with other versions of Poly/ML? Here are some formal<br>
component names:</p>
<p>#bundled with Isabelle2021<br>
polyml-test-f86ae3dc1686</p>
<p>#official release after Isabelle2021<br>
polyml-5.8.2</p>
<p>#approximations of polyml-5.9 for Isabelle2021-1<br>
polyml-5.9-960de0cd0795<br>
polyml-5.9-5d4caa8f7148<br>
polyml-5.9-cc80e2b43c38<br>
polyml-5.9-610a153b941d</p>
<p>Makarius</p>



<a name="262893925"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-1-RC3%3A%20excessive%20Poly/ML%20heap%09req.../near/262893925" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-1-RC3.3A.20excessive.20Poly.2FML.20heap.09req.2E.2E.2E.html#262893925">(Nov 27 2021 at 21:30)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
I think that only these 2 alternatives are relevant for a comparison.</p>
<p>Generally, I do see lots of heap usage on "small" machines with only 8-24 GB,<br>
especially on weak VM nodes. Sometimes this causes problems to built<br>
HOL-Analysis or HOL-Data_Structures.</p>
<p>The question: Is this really a new problem for Isabelle2021-1 that was absent<br>
in Isabelle2021?</p>
<p>Attached are some measurements for HOL-Analysis in the past 400 days: nothing<br>
special to be seen. Here is further context<br>
<a href="https://isabelle.sketis.net/devel/build_status/macOS_10.15_Catalina_4_threads/index.html#session_HOL-Analysis">https://isabelle.sketis.net/devel/build_status/macOS_10.15_Catalina_4_threads/index.html#session_HOL-Analysis</a></p>
<p>Note that this test line uses 4 threads with a "cold start", i.e. no  previous<br>
information about the timing of proofs.</p>
<p>Makarius<br>
<a href="/user_uploads/14278/oyRIBs0jDAcZclRsGwQ1LQLs/HOL-Analysis_heap.png">HOL-Analysis_heap.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/14278/oyRIBs0jDAcZclRsGwQ1LQLs/HOL-Analysis_heap.png" title="HOL-Analysis_heap.png"><img src="/user_uploads/14278/oyRIBs0jDAcZclRsGwQ1LQLs/HOL-Analysis_heap.png"></a></div>



<a name="262929571"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-1-RC3%3A%20excessive%20Poly/ML%20heap%09req.../near/262929571" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-1-RC3.3A.20excessive.20Poly.2FML.20heap.09req.2E.2E.2E.html#262929571">(Nov 28 2021 at 13:42)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
So how is the situation with these Poly/ML versions?</p>
<p>#bundled with Isabelle2021<br>
polyml-test-f86ae3dc1686</p>
<p>#official release after Isabelle2021<br>
polyml-5.8.2</p>
<p>We need some tangible empirical results to proceed.</p>
<p>Makarius</p>



<a name="263118971"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-1-RC3%3A%20excessive%20Poly/ML%20heap%09req.../near/263118971" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-1-RC3.3A.20excessive.20Poly.2FML.20heap.09req.2E.2E.2E.html#263118971">(Nov 30 2021 at 09:28)</a>:</h4>
<p>From: Matthew Torrence &lt;<a href="mailto:matthew.torrence@twosixtech.com">matthew.torrence@twosixtech.com</a>&gt;<br>
Some further details that were discovered from the Zulip:</p>
<p>The problem is that Auto quickcheck is evaluating 2^129 in nats, with<br>
successor arithmetic, and is running out of memory. Importing<br>
"HOL-Library.Code_Target_Numeral", or disabling auto quickcheck solves the<br>
problem.</p>
<p>It does seem a bit odd though that this is the way auto quickcheck acts<br>
when it encounters such arithmetic, instead of catching itself and giving<br>
up...</p>



<a name="263127927"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-1-RC3%3A%20excessive%20Poly/ML%20heap%09req.../near/263127927" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-1-RC3.3A.20excessive.20Poly.2FML.20heap.09req.2E.2E.2E.html#263127927">(Nov 30 2021 at 10:56)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Great, that is a tangible empirical situation.</p>
<p>I have turned it into the following example:</p>
<p>theory Scratch<br>
  imports Main<br>
begin</p>
<p>definition test :: "nat"<br>
  where "test = 1000"</p>
<p>lemma "test = test + 1"<br>
  quickcheck a</p>
<p>end</p>
<p>Thus it is possible to add digits to the numeral and see how auto quickcheck<br>
reacts -- while watching the ML heap in the Monitor panel. Afterwards the<br>
explicit quickcheck command can be activated by removing the bad argument "a"<br>
and not touching anything else.</p>
<p>The reason for the appearance of non-timeout is this change from Isabelle2019<br>
(June 2019):<br>
<a href="https://isabelle-dev.sketis.net/rISABELLE1bea05713dde">https://isabelle-dev.sketis.net/rISABELLE1bea05713dde</a></p>
<p>"""<br>
physical vs. logical events, the latter takes GC time into account;<br>
Timeout.apply is based on logical ML time;<br>
"""</p>
<p>Attached is a change for Isabelle2021-1-RC4 that returns to physical timeout<br>
specifically for quickcheck / try / auto_try.</p>
<p>I do hope that we can afford this isolated last-minute change on<br>
Isabelle2021-1, for something that has been present in the past 3 releases.</p>
<p>Makarius<br>
<a href="/user_uploads/14278/Tep_fOVziOpWlBTuNlpntN03/ch-physical_timeout">ch-physical_timeout</a></p>



<a name="263128638"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-1-RC3%3A%20excessive%20Poly/ML%20heap%09req.../near/263128638" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-1-RC3.3A.20excessive.20Poly.2FML.20heap.09req.2E.2E.2E.html#263128638">(Nov 30 2021 at 11:03)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Side-remark: the Monitor panel already provides the buttons "GC" and "Sharing"<br>
for the ML heap (since Isabelle2021).</p>
<p>Since the monitoring now works via an external process, it remains active<br>
during GC ("ML cleanup").</p>
<p>Makarius</p>



<hr><p>Last updated: Jul 15 2022 at 23:21 UTC</p>
</html>