<html>
<head><meta charset="utf-8"><title>[isabelle] Isabelle2021-RC2: improved HTML presentation · Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/index.html">Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-RC2.3A.20improved.20HTML.20presentation.html">[isabelle] Isabelle2021-RC2: improved HTML presentation</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="222235040"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-RC2%3A%20improved%20HTML%20presentation/near/222235040" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-RC2.3A.20improved.20HTML.20presentation.html#222235040">(Jan 10 2021 at 18:48)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
As usual, the "Documentation" section of the website refers to "Theory<br>
libraries" in HTML, e.g. see<br>
<a href="https://isabelle.in.tum.de/website-Isabelle2021-RC2/dist/library/HOL/HOL/index.html">https://isabelle.in.tum.de/website-Isabelle2021-RC2/dist/library/HOL/HOL/index.html</a></p>
<p>This is now based on formal PIDE markup produced in batch-builds; so there is<br>
much more fancy coloring and a few more hyperlinks. Further presentation of<br>
markup will come eventually, after this release.</p>
<p>Moreover, formally included Isabelle/ML files get proper attention:<br>
Isabelle/HOL consists of theory specifications and ML tool implementations in<br>
a complex bootstrap process that winds itself towards theory "Main" (or<br>
"Complex_Main").</p>
<p>The overall HTML presentation style is still somewhat crude: like<br>
syntax/semantics highlighting in Isabelle/jEdit.</p>
<p>Eventually, I would like to see journal-quality rendering of formal<br>
mathematical text (not "code"). This requires suitable web-technology that<br>
lasts more than just 6 months as a "cool" or "hot" thing.</p>
<p>Makarius</p>



<a name="222244917"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-RC2%3A%20improved%20HTML%20presentation/near/222244917" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-RC2.3A.20improved.20HTML.20presentation.html#222244917">(Jan 10 2021 at 22:13)</a>:</h4>
<p>From: Jakub Kądziołka &lt;<a href="mailto:kuba@kadziolka.net">kuba@kadziolka.net</a>&gt;<br>
On Sun Jan 10, 2021 at 7:47 PM CET, Makarius wrote:</p>
<blockquote>
<p>On 10/01/2021 16:52, Makarius wrote:</p>
<blockquote>
<p>The current release candidate website is<br>
<a href="https://isabelle.in.tum.de/website-Isabelle2021-RC2">https://isabelle.in.tum.de/website-Isabelle2021-RC2</a></p>
</blockquote>
<p>As usual, the "Documentation" section of the website refers to "Theory<br>
libraries" in HTML, e.g. see<br>
<a href="https://isabelle.in.tum.de/website-Isabelle2021-RC2/dist/library/HOL/HOL/index.html">https://isabelle.in.tum.de/website-Isabelle2021-RC2/dist/library/HOL/HOL/index.html</a></p>
<p>This is now based on formal PIDE markup produced in batch-builds; so<br>
there is<br>
much more fancy coloring and a few more hyperlinks. Further presentation<br>
of<br>
markup will come eventually, after this release.</p>
</blockquote>
<p>Ah, what a coincidence! Just three days ago I started developing a tool<br>
to do this based on the output of 'isabelle dump'.</p>
<p>Some remarks:</p>
<p>The generated files seem to lack a closing &lt;/html&gt; tag</p>
<p>The semi-transparent background color on .quoted is a bit inconsistent,<br>
as sometimes (indeed, most of the time) Isabelle generates two nested<br>
quoted tags. Thus, when only a single tag is generated (see for example<br>
the line "code_datatype holds" in Tools/Code_Generator), the highlight<br>
is very faint.</p>
<p>In my case, I resolved this by pre-baking the transparency, i.e.<br>
  background-color: #f3f3f3;</p>
<blockquote>
<p>Moreover, formally included Isabelle/ML files get proper attention:<br>
Isabelle/HOL consists of theory specifications and ML tool<br>
implementations in<br>
a complex bootstrap process that winds itself towards theory "Main" (or<br>
"Complex_Main").</p>
</blockquote>
<p>Interesting! Does the PIDE markup for included ML files get included in<br>
the output of 'isabelle dump' somewhere?</p>
<blockquote>
<p>The overall HTML presentation style is still somewhat crude: like<br>
syntax/semantics highlighting in Isabelle/jEdit.</p>
<p>Eventually, I would like to see journal-quality rendering of formal<br>
mathematical text (not "code"). This requires suitable web-technology<br>
that<br>
lasts more than just 6 months as a "cool" or "hot" thing.</p>
<p>Makarius</p>
</blockquote>
<p>I suppose I should also say something about my own implementation. The<br>
end goal is to integrate it into a blog authoring tool, so I'm going to<br>
continue my out-of-tree efforts.</p>
<p>As I've mentioned, I get my semantic information from the output of<br>
'isabelle dump'. I have found two small deficiencies in this command:</p>
<ul>
<li>there is no way to render PIDE markup for Pure</li>
<li>it always starts by processing all the dependencies, even if they are<br>
   already included in the image specified with -b</li>
</ul>
<p>The root causes of both seem to be very similar - the pure_base and<br>
skip_base arguments to Context in src/Pure/Tools/dump.scala are both<br>
hardcoded as false, with no commandline flag to control them.</p>
<p>I'm currently halfway through duplicating the tooltips mechanism of<br>
Isabelle/jEdit, and go-to-definition is next on the list. When that is<br>
ready, I will make a proper announcement on this mailing list.</p>
<p>One feature I'm particularily fond of is not even present in<br>
Isabelle/jEdit: when you hover over a non-ASCII symbol, a tooltip will<br>
tell you its name, as well as any abbreviations - as far as I am aware,<br>
the only ways to learn the name of a symbol when you first encounter it,<br>
is to either open a .thy file with Notepad to see the escape code, or a<br>
game of where's waldo in the Symbols tab of jEdit.</p>
<p>Though it's nothing particularily flashy yet, you can see a preview here:<br>
<a href="https://niedzejkob.github.io/isabelle-markup/HOL/HOL.html">https://niedzejkob.github.io/isabelle-markup/HOL/HOL.html</a></p>
<p>The corresponding code is available here:<br>
<a href="https://github.com/NieDzejkob/isabelle-markup">https://github.com/NieDzejkob/isabelle-markup</a></p>
<p>Kind regards,<br>
Jakub Kądziołka</p>



<a name="222309884"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-RC2%3A%20improved%20HTML%20presentation/near/222309884" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-RC2.3A.20improved.20HTML.20presentation.html#222309884">(Jan 11 2021 at 15:18)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On 10/01/2021 21:39, Jakub Kądziołka wrote:</p>
<blockquote>
<p>The generated files seem to lack a closing &lt;/html&gt; tag</p>
</blockquote>
<p>Oops, I have now changed that in<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/rev/ff9cd62d2d20">https://isabelle.sketis.net/repos/isabelle-release/rev/ff9cd62d2d20</a></p>
<blockquote>
<p>The semi-transparent background color on .quoted is a bit inconsistent,<br>
as sometimes (indeed, most of the time) Isabelle generates two nested<br>
quoted tags. Thus, when only a single tag is generated (see for example<br>
the line "code_datatype holds" in Tools/Code_Generator), the highlight<br>
is very faint.</p>
<p>In my case, I resolved this by pre-baking the transparency, i.e.<br>
  background-color: #f3f3f3;</p>
</blockquote>
<p>That is an interesting fine-point.</p>
<p>In Isabelle/jEdit the underlying PIDE rendering works differently:<br>
<a href="http://snapshot.select">snapshot.select</a> in<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/file/Isabelle2021-RC2/src/Pure/PIDE/rendering.scala#l495">https://isabelle.sketis.net/repos/isabelle-release/file/Isabelle2021-RC2/src/Pure/PIDE/rendering.scala#l495</a><br>
traverses the markup tree, such that only one markup element per text interval<br>
take precedence. So there is no stacking-up of markups of the same kind (here<br>
"foreground" color).</p>
<p>I wonder if CSS can imitate the <a href="http://snapshot.select">snapshot.select</a> traversal. Otherwise one could<br>
try to generate "flat" HTML markup from rendering.foreground (and other<br>
rendering selectors), instead of taking the full XML document.</p>
<p>Yet another possibility: quite different HTML presentation with less colors<br>
and more typography (high-quality math fonts). It could be a combination of<br>
parsing in the context of PIDE rendering results. (I will pursue this later,<br>
to see how far we can approximate actual math journal quality, e.g. via<br>
MathJax 3).</p>
<blockquote>
<blockquote>
<p>Moreover, formally included Isabelle/ML files get proper attention:<br>
Isabelle/HOL consists of theory specifications and ML tool<br>
implementations in<br>
a complex bootstrap process that winds itself towards theory "Main" (or<br>
"Complex_Main").</p>
</blockquote>
<p>Interesting! Does the PIDE markup for included ML files get included in<br>
the output of 'isabelle dump' somewhere?</p>
</blockquote>
<p>Probably not. Behind "isabelle dump" is a rather complex "headless PIDE"<br>
session with its own rules what works well and what doesn't.</p>
<p>It is better to switch your application to plain "isabelle build" + retrieval<br>
of the PIDE markup from the build database.</p>
<p>See also the implementation of the new "isabelle document" tool:<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/file/Isabelle2021-RC2/src/Pure/Thy/presentation.scala#l699">https://isabelle.sketis.net/repos/isabelle-release/file/Isabelle2021-RC2/src/Pure/Thy/presentation.scala#l699</a><br>
--- it first makes a regular <a href="http://Build.build">Build.build</a> (the Scala function behind "isabelle<br>
build) to ensure that the sources are consistent with the session databases;<br>
then it accesses the build artefacts (exported tex sources) via<br>
db_context.get_export.</p>
<p>For your application, the database access can work via Build_Job.read_theory,<br>
just like Presentation.session_html, which is the implementation behind<br>
"isabelle build -P:".</p>
<p>Makarius</p>



<a name="222311091"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-RC2%3A%20improved%20HTML%20presentation/near/222311091" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-RC2.3A.20improved.20HTML.20presentation.html#222311091">(Jan 11 2021 at 15:26)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Side-remark: reading Isabelle/Scala sources works best with IntelliJ IDEA. See<br>
the Isabelle "system" manual about the "isabelle scala_project" tool, with<br>
links and hints about Gradle and IntelliJ.</p>
<p>Maybe "isabelle scala_project" should eventually support user-space projects<br>
as well. Right now you have to tinker manually, and then use suitable<br>
"isabelle_scala_service" invocations in your etc/settings: e.g. see<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/file/Isabelle2021-RC2/etc/settings#l23">https://isabelle.sketis.net/repos/isabelle-release/file/Isabelle2021-RC2/etc/settings#l23</a></p>
<p>Makarius</p>



<a name="223139539"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-RC2%3A%20improved%20HTML%20presentation/near/223139539" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-RC2.3A.20improved.20HTML.20presentation.html#223139539">(Jan 18 2021 at 16:14)</a>:</h4>
<p>From: Pedro Sánchez Terraf &lt;<a href="mailto:sterraf@famaf.unc.edu.ar">sterraf@famaf.unc.edu.ar</a>&gt;<br>
Dear Makarius &amp; all,</p>
<p>While testing an AFP entry, I noticed some odd behavior in the rendering <br>
of sub/superscripts in HTML output. It looks that &lt;sub&gt; and &lt;sup&gt; tags <br>
get mixed with surrounding &lt;span&gt; tags.</p>
<p>The output of RC2 looks like</p>
<p>in contrast to Isabelle2020:</p>
<p>(the underlining is there because I crosslink the html afterwards "by <br>
hand").</p>
<p>By the way, I'm still curious about the decision about (not) having <br>
multicharacter sub/supercript rendering support at jEdit.</p>
<p>Thank you very much in advance.<br>
<a href="/user_uploads/14278/cp57NPW01qnCVWGEmvgV0ZPk/piampcnohlhgobcd.png">piampcnohlhgobcd.png</a><br>
<a href="/user_uploads/14278/CQPxomoLGODCstKPVfqy7tzR/kcoipckjdlapompp.png">kcoipckjdlapompp.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/14278/cp57NPW01qnCVWGEmvgV0ZPk/piampcnohlhgobcd.png" title="piampcnohlhgobcd.png"><img src="/user_uploads/14278/cp57NPW01qnCVWGEmvgV0ZPk/piampcnohlhgobcd.png"></a></div><div class="message_inline_image"><a href="/user_uploads/14278/CQPxomoLGODCstKPVfqy7tzR/kcoipckjdlapompp.png" title="kcoipckjdlapompp.png"><img src="/user_uploads/14278/CQPxomoLGODCstKPVfqy7tzR/kcoipckjdlapompp.png"></a></div>



<a name="223829520"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-RC2%3A%20improved%20HTML%20presentation/near/223829520" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-RC2.3A.20improved.20HTML.20presentation.html#223829520">(Jan 24 2021 at 19:06)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On 18/01/2021 17:14, Pedro Sánchez Terraf wrote:</p>
<blockquote>
<p>While testing an AFP entry, I noticed some odd behavior in the rendering of<br>
sub/superscripts in HTML output. It looks that &lt;sub&gt; and &lt;sup&gt; tags get mixed<br>
with surrounding &lt;span&gt; tags.</p>
</blockquote>
<p>This should work better in Isabelle2021-RC3. The relevant change is<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/rev/624c2b98860a">https://isabelle.sketis.net/repos/isabelle-release/rev/624c2b98860a</a> based on<br>
earlier workarounds for pretty-printed output with markup.</p>
<blockquote>
<p>By the way, I'm still curious about the decision about (not) having<br>
multicharacter sub/supercript rendering support at jEdit.</p>
</blockquote>
<p>You mean Isabelle/jEdit: plain jEdit cannot even render single-symbol<br>
controls. Likewise other editors, like VSCode: I don't want to depend too much<br>
on the peculiar rendering model of Isabelle/jEdit.</p>
<p>In the HTML breakdown we see that there is a conceptual mismatch: the<br>
block-control symbols pretend to be markup, but should not do this.</p>
<p>I will nonetheless reconsider the whole affair eventually, maybe as<br>
single-control symbol for a cartouche.</p>
<p>Makarius</p>



<a name="223957995"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2021-RC2%3A%20improved%20HTML%20presentation/near/223957995" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2021-RC2.3A.20improved.20HTML.20presentation.html#223957995">(Jan 25 2021 at 20:50)</a>:</h4>
<p>From: Pedro Sánchez Terraf &lt;<a href="mailto:sterraf@famaf.unc.edu.ar">sterraf@famaf.unc.edu.ar</a>&gt;<br>
El 24/1/21 a las 16:06, Makarius escribió:</p>
<blockquote>
<p>On 18/01/2021 17:14, Pedro Sánchez Terraf wrote:</p>
<blockquote>
<p>While testing an AFP entry, I noticed some odd behavior in the rendering of<br>
sub/superscripts in HTML output. It looks that &lt;sub&gt; and &lt;sup&gt; tags get mixed<br>
with surrounding &lt;span&gt; tags.<br>
This should work better in Isabelle2021-RC3. The relevant change is<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/rev/624c2b98860a">https://isabelle.sketis.net/repos/isabelle-release/rev/624c2b98860a</a> based on<br>
earlier workarounds for pretty-printed output with markup.</p>
</blockquote>
</blockquote>
<p>Thanks for your work.</p>
<blockquote>
<blockquote>
<p>By the way, I'm still curious about the decision about (not) having<br>
multicharacter sub/supercript rendering support at jEdit.<br>
I will nonetheless reconsider the whole affair eventually, maybe as<br>
single-control symbol for a cartouche.<br>
This is great.</p>
</blockquote>
</blockquote>



<hr><p>Last updated: Jul 15 2022 at 23:21 UTC</p>
</html>