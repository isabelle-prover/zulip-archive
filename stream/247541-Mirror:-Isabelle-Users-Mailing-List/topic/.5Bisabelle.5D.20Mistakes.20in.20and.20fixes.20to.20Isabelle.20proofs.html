<html>
<head><meta charset="utf-8"><title>[isabelle] Mistakes in and fixes to Isabelle proofs · Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/index.html">Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html">[isabelle] Mistakes in and fixes to Isabelle proofs</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="285968663"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Mistakes%20in%20and%20fixes%20to%20Isabelle%20proofs/near/285968663" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html#285968663">(Jun 13 2022 at 18:14)</a>:</h4>
<p>From: Talia Ringer &lt;<a href="mailto:tringer@cs.washington.edu">tringer@cs.washington.edu</a>&gt;<br>
Hi all, hope you're doing well! I'm looking to evaluate a machine learning<br>
tool on a task related to proof repair for Isabelle. I'm curious if anyone<br>
has anything that might help us with benchmarks for this, like:</p>
<ol>
<li>examples of real mistakes in Isabelle proofs,</li>
<li>examples of real fixes to broken Isabelle proofs,</li>
<li>anecdotes about common ways they mess up when writing proofs,</li>
<li>anecdotes about concrete ways they've messed up on particular proofs in<br>
the past, even if not documented in version control history.</li>
</ol>
<p>I'm also curious to what degree the kinds of changes seen in the Coq change<br>
data in REPLICA &lt;<a href="https://dependenttyp.es/pdf/analytics.pdf">https://dependenttyp.es/pdf/analytics.pdf</a>&gt; are similar to<br>
those people make in Isabelle, and where and how they differ, though that<br>
may be a complex question that is not easy to address in an email.</p>
<p>I super welcome any pointers any of you have!</p>
<p>Talia</p>



<a name="285973642"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Mistakes%20in%20and%20fixes%20to%20Isabelle%20proofs/near/285973642" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html#285973642">(Jun 13 2022 at 18:57)</a>:</h4>
<p>From: Manuel Eberl &lt;<a href="mailto:manuel@pruvisto.org">manuel@pruvisto.org</a>&gt;<br>
Hello,</p>
<p>I don't understand what you mean by "mistakes in proofs". The whole <br>
point of having a proof assistant is that you cannot make mistakes in <br>
your proofs, is it not?</p>
<p>Or do you mean mistakes in definitions/theorem statements? Or perhaps <br>
"mistakes" in the sense of "bad style"? Or "mistakes" as in "existing <br>
proof breaks due to some changes elsewhere in the library/in the system"?</p>
<p>Cheers,</p>
<p>Manuel</p>



<a name="285976207"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Mistakes%20in%20and%20fixes%20to%20Isabelle%20proofs/near/285976207" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html#285976207">(Jun 13 2022 at 19:16)</a>:</h4>
<p>From: Talia Ringer &lt;<a href="mailto:tringer@cs.washington.edu">tringer@cs.washington.edu</a>&gt;<br>
I know very well how proof assistants work :). Mistakes in proofs happen<br>
when you are attempting to prove something, and you try a particular<br>
approach to your proof, but it doesn't work, so you need to go back and<br>
revisit. See, for example, the linked paper.</p>
<p>Talia</p>



<a name="285991381"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Mistakes%20in%20and%20fixes%20to%20Isabelle%20proofs/near/285991381" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html#285991381">(Jun 13 2022 at 21:22)</a>:</h4>
<p>From: Manuel Eberl &lt;<a href="mailto:manuel@pruvisto.org">manuel@pruvisto.org</a>&gt;<br>
I did not mean to suggest that you don't (my apologies if it sounded that way), but I for one could not see what you meant, and I deemed it likely that others also might not.</p>
<p>It might have become clear from reading the paper, but I think you are likely to get more responses from people if they don't have to read a paper before understanding what you mean.</p>
<p>As for your question, here are a few fairly low-level things off the top of my head:</p>
<ul>
<li>
<p>You try to prove something but the type is too polymorphic. You have to add a type constraint (e.g. 0 :: nat) somewhere or a more specific type class constraint and then it works. This is particularly tricky because you can have two terms that look exactly the same when printed but aren't.</p>
</li>
<li>
<p>coercions got inserted in the wrong place; the fix is to add them manually in the right place.</p>
</li>
<li>
<p>You forgot to declare some variable or term as "arbitrary" in an induction.</p>
</li>
<li>
<p>You have to manually instantiate a fact that you use to help the automation along.</p>
</li>
<li>
<p>Looping simplifier (but that tends to be less obvious to fix)</p>
</li>
<li>
<p>A rule doesn't quite apply because of some minor discrepancy (e.g. a + b instead of b + a, different bracketing)</p>
</li>
<li>
<p>very technical: "using A B by (rule foo) some_method" does not work because "rule" tries to match the chained facts A and B against the premises of "foo". Need to do e.g. "by (rule foo) (use A B in some_method)" instead.</p>
</li>
<li>
<p>the simplifier does not rewrite underneath "if" by default; need to add if_cong as a congruence rule manually.</p>
</li>
<li>
<p>very generally: auto/simp get stuck somewhere, but with a few extra "simp" rules the proof goes through.</p>
</li>
<li>
<p>you added too many facts (and/or facts that are too general) to your goal state, which causes the automation to get lost and not terminate. Fix is to break the proof up into smaller Isar steps or remove unnecessary facts/instantiate them by hand to narrow down the search space.</p>
</li>
</ul>
<p>Most of these are things that you tend to learn very early as an Isabelle user, but especially the polymorphism and the coercions happen even to experienced users and often take a minute or so to figure out.</p>
<p>For a more high-level thing, reindexing arguments for sums are often fairly easy with "sum.reindex_bij_witness". If you don't know that trick, they can be fairly tedious.</p>
<p>Let me know if you want be to explain any of these more. I'll let you know if I think of anything else.</p>
<p>Cheers</p>
<p>Manuel</p>



<a name="285993899"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Mistakes%20in%20and%20fixes%20to%20Isabelle%20proofs/near/285993899" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html#285993899">(Jun 13 2022 at 21:45)</a>:</h4>
<p>From: Tjark Weber &lt;<a href="mailto:tjark.weber@it.uu.se">tjark.weber@it.uu.se</a>&gt;<br>
Talia,</p>



<a name="286045715"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Mistakes%20in%20and%20fixes%20to%20Isabelle%20proofs/near/286045715" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html#286045715">(Jun 14 2022 at 09:43)</a>:</h4>
<p>From: Peter Lammich &lt;<a href="mailto:lammich@in.tum.de">lammich@in.tum.de</a>&gt;<br>
I second Manuel's points. Here are a few additions:</p>
<p>On 13/06/2022 22:21, Manuel Eberl wrote:</p>
<blockquote>
<ul>
<li>You try to prove something but the type is too polymorphic. You have <br>
to add a type constraint (e.g. 0 :: nat) somewhere or a more specific <br>
type class constraint and then it works. This is particularly tricky <br>
because you can have two terms that look exactly the same when printed <br>
but aren't.</li>
</ul>
</blockquote>
<p>This comes in a few varieties. One is forgetting type annotations in <br>
lemmas, as Manuel mentions. Related to that, you sometimes define too <br>
generic constants for your concepts. For example, you might want to <br>
define a shallowly embedded semantics on some memory type mem. For <br>
operations that do not modify memory, it's tempting to do something <br>
like: definition "add r1 r2 m = (r1+r2,m)". If you forget a type <br>
constraint, the constant is too generic, and might require type <br>
annotations later on ... though here, the "correct" way would be to add <br>
a type constraint to the definition.</p>
<ul>
<li>Another Isabelle pitfall is the typing of free variables in a lemma. <br>
For example, the following lemma is perfectly provable (but does not <br>
mean what you expect):</li>
</ul>
<p>definition "assert p ≡ if p then Some () else None"</p>
<p>lemma<br>
         monad_laws: "a⤜Some = a" "Some x⤜f = f x"<br>
     and assert_bind: "assert p⤜f = (if p then f () else None)"<br>
     and garbage: "x=y"</p>
<p>note: x and y have type unit in all four statements!</p>
<blockquote>
<ul>
<li>
<p>coercions got inserted in the wrong place; the fix is to add them <br>
manually in the right place.<br>
(this was (and still is) my main critique point on coercions. They can <br>
alter the meaning of your (main) theorem without noticing. )</p>
</li>
<li>
<p>Looping simplifier (but that tends to be less obvious to fix)</p>
</li>
</ul>
</blockquote>
<p>The simplifier (and classical set) is one of Isabelle's aspects that <br>
require a lot of experience, and there are only rough informal rules how <br>
a good simpset should look like.</p>
<ul>
<li>not simplified LHS of simp lemmas:</li>
</ul>
<p>lemma [simp]: "f (1::nat) = (2::nat)" will never be applied by the <br>
simplifier, as the simplifier will first rewrite 1 = Suc 0</p>
<ul>
<li>
<p>adding a new simplification rule invalidates existing ones. Similar, a <br>
rule like "1=Suc 0" could be added later, unwittingly making existing <br>
simplifier setup unusable.</p>
</li>
<li>
<p>simp-rules interfere with locale interpretations:</p>
</li>
</ul>
<p>interpretation my_locale "(1::nat)"</p>
<p>all lemmas and abbreviations will use 1::nat, and break the first time <br>
the simplifier is run. Automatically declaring cong-rules would help <br>
here, but I don't remember why that isn't done by default.</p>



<a name="286053025"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Mistakes%20in%20and%20fixes%20to%20Isabelle%20proofs/near/286053025" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html#286053025">(Jun 14 2022 at 10:55)</a>:</h4>
<p>From: Manuel Eberl &lt;<a href="mailto:manuel@pruvisto.org">manuel@pruvisto.org</a>&gt;<br>
Regarding the "proofs break due to development further up in the theory <br>
hierarchy" thing, I think there are mainly two things that happen:</p>
<ol>
<li>
<p>the name of some definition/theorem changes</p>
</li>
<li>
<p>the content of some definition (including the type) or theorem changes</p>
</li>
</ol>
<p>Typically such changes make things more general (e.g. a definition with <br>
a more general type, or a theorem with fewer/weaker premises), but the <br>
other direction also happens.</p>
<p>Things becoming less general is of course more likely to cause a <br>
problem, but even things becoming more general can become a problem, <br>
e.g. if an Isar proof explicitly proves something that doesn't have to <br>
be proved anymore.</p>
<p>Changes of names of course also leads to problems. A definition name <br>
changing can break a lot of things and is thus rarely done (it can <br>
happen accidentally when import order changes, e.g. with <br>
<a href="http://MPoly_Type.degree">MPoly_Type.degree</a> and <a href="http://Polynomial.degree">Polynomial.degree</a>). Fact names changing happens <br>
more often and also breaks proofs that explicitly mention these facts by <br>
names. The most fragile ones here are sledgehammer-generated proofs <br>
using metis/smt. But these can typically be fixed easily by just running <br>
sledgehammer again.</p>
<p>Occasionally, things also break in much more obscure ways, e.g. the <br>
automation failing or looping on something it could previously do. <br>
Repairing this then typically involves again breaking the goal down into <br>
smaller/more explicit steps. This happens particularly in proofs that <br>
are written in "bad style" (in my opinion).</p>
<p>Manuel</p>



<a name="286056687"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Mistakes%20in%20and%20fixes%20to%20Isabelle%20proofs/near/286056687" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html#286056687">(Jun 14 2022 at 11:30)</a>:</h4>
<p>From: Lawrence Paulson &lt;<a href="mailto:lp15@cam.ac.uk">lp15@cam.ac.uk</a>&gt;<br>
There's a whole class of such errors that fall under the general heading of "omitting something obvious". Other people have already mentioned instances of this, in particular omitting type constraints or type class constraints, which makes the claim too general. Also under this heading: omitting assertions that are too obvious (e.g. that any mentioned divisors are nonzero, or for a theorem about an integral, forgetting to assume that the given function has an integral).</p>
<p>Another class of errors comes under "setting up induction wrong". This might mean using the wrong induction rule, trying to prove something that is insufficiently general, or incorrectly incorporating site conditions into the induction. This latter error is Isabelle specific and has to do with supplying (e.g. via "using") side conditions into the induction method and being sure to specify any variables in them as "arbitrary".</p>
<p>Larry</p>



<a name="286155210"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Mistakes%20in%20and%20fixes%20to%20Isabelle%20proofs/near/286155210" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Mistakes.20in.20and.20fixes.20to.20Isabelle.20proofs.html#286155210">(Jun 15 2022 at 01:51)</a>:</h4>
<p>From: Talia Ringer &lt;<a href="mailto:tringer@cs.washington.edu">tringer@cs.washington.edu</a>&gt;<br>
Thanks, all, these are super helpful!</p>



<hr><p>Last updated: Jul 15 2022 at 23:21 UTC</p>
</html>