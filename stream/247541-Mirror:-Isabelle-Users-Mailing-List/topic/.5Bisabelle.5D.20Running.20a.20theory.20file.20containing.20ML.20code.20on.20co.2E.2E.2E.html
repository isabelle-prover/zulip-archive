<html>
<head><meta charset="utf-8"><title>[isabelle] Running a theory file containing ML code on co... · Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/index.html">Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Running.20a.20theory.20file.20containing.20ML.20code.20on.20co.2E.2E.2E.html">[isabelle] Running a theory file containing ML code on co...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="267181367"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Running%20a%20theory%20file%20containing%20ML%20code%20on%20co.../near/267181367" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Running.20a.20theory.20file.20containing.20ML.20code.20on.20co.2E.2E.2E.html#267181367">(Jan 07 2022 at 12:04)</a>:</h4>
<p>From: Mac Goodwin &lt;<a href="mailto:mgoodwin4@sheffield.ac.uk">mgoodwin4@sheffield.ac.uk</a>&gt;<br>
Hi,</p>
<p>I am trying to run an Isabelle theory file from the command line that<br>
contains a short ML script that should write some exported code to disk.</p>
<p>Using the command <code>isabelle process -T Calculator</code> I receive the following<br>
error:</p>
<p>*** Malformed command syntax<br>
*** At command "&lt;malformed&gt;" (line 137 of<br>
"/cygdrive/d/OneDrive/Documents/IsabelleDSL/Calculator.thy")<br>
Exception- TOPLEVEL_ERROR raised</p>
<p>Line 137 is where the ML script begins. Is this the correct way to run an<br>
isabelle file from the command line that contains an ML script? I have also<br>
tried <code>isabelle build -D .</code> with a ROOT file (attached) which produces the<br>
same error.</p>
<p>Thanks!</p>
<p>Mac<br>
<a href="/user_uploads/14278/Vxt9WN7DYVhikMPP--L-dEX9/ROOT">ROOT</a><br>
<a href="/user_uploads/14278/Kj-_iV-aeRmkbYZ4rJUgNOIY/Calculator.thy">Calculator.thy</a></p>



<a name="267252923"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Running%20a%20theory%20file%20containing%20ML%20code%20on%20co.../near/267252923" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Running.20a.20theory.20file.20containing.20ML.20code.20on.20co.2E.2E.2E.html#267252923">(Jan 07 2022 at 22:46)</a>:</h4>
<p>From: Mac Goodwin &lt;<a href="mailto:mgoodwin4@sheffield.ac.uk">mgoodwin4@sheffield.ac.uk</a>&gt;<br>
Hi Dominique,</p>
<p>Thank you very much for this - replacing the odd characters with &lt; and &gt;<br>
gave a different but similar error ("ML source expected, but keyword &lt; was<br>
found") but your comment got me thinking along the lines of checking the ML<br>
syntax was correct, and I found that wrapping the ML code inside {* and *}<br>
fixed the issue!</p>
<p>Thanks very much for your help,</p>
<p>Mac</p>



<a name="273564383"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Running%20a%20theory%20file%20containing%20ML%20code%20on%20co.../near/273564383" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Running.20a.20theory.20file.20containing.20ML.20code.20on.20co.2E.2E.2E.html#273564383">(Feb 28 2022 at 22:35)</a>:</h4>
<p>From: Mac Goodwin &lt;<a href="mailto:mgoodwin4@sheffield.ac.uk">mgoodwin4@sheffield.ac.uk</a>&gt;<br>
Hi again,</p>
<p>Thanks for this advice, I've restructured my project as above and it works<br>
a lot better this way. However, I am still unsure how to go from an export<br>
inside the session, and Isabelle's file-system, to my disk. If I understand<br>
correctly, the 'export artifacts' you described above are not saved to disk</p>
<ul>
<li>however, I don't want to use the export artifacts within Isabelle, I'd<br>
like to save them for later use by another program, so saving to disk would<br>
be ideal.</li>
</ul>
<p>Is this possible using the build options as described? I can successfully<br>
run and export my 'code' with <code>isabelle build -e -D .</code>, but as far as I can<br>
tell this doesn't allow further processing of the Haskell files that<br>
export_code within Isabelle has produced.</p>
<p>As for the cartouche syntax - I have replaced my incorrect syntax with the<br>
cartouche as suggested, but still see this error when attempting to build:</p>
<blockquote>
<p>$ isabelle build -e -D .<br>
Running Calculator ...<br>
Calculator FAILED<br>
(see also<br>
C:\Users\theco\.isabelle\Isabelle2021\heaps\polyml-5.8.2_x86_64_32-windows\log\Calculator)<br>
*** Malformed command syntax<br>
*** At command "&lt;malformed&gt;" (line 137 of<br>
"/cygdrive/d/OneDrive/Documents/IsabelleDSL/Calculator.thy")</p>
</blockquote>
<p>Line 137 here is the beginning of the ML script I originally used to export<br>
code to disk. The script works with the old style syntax, but I'd love to<br>
change it to make it work better within Isabelle best practices.</p>
<p>Best wishes,</p>
<p>Mac</p>
<p>On Sat, 22 Jan 2022 at 14:27, Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt; wrote:</p>
<blockquote>
<p>On 06/01/2022 14:55, Mac Goodwin wrote:</p>
<blockquote>
<p>Using the command <code>isabelle process -T Calculator</code> I receive the<br>
following error:</p>
<p>Is this the correct way to run an<br>
isabelle file from the command line that contains an ML script? I have<br>
also<br>
tried <code>isabelle build -D .</code> with a ROOT file (attached) which produces<br>
the<br>
same error.</p>
</blockquote>
<p>Note that "isabelle process" is a very low-level way to experiment with an<br>
ML<br>
process that lacks a proper session context. Many things just don't work<br>
here;<br>
you should avoid it in "production use".</p>
<p>A proper "isabelle build" with ROOT is much better.</p>
<p>Instead of writing out things to the physical file-system, you should work<br>
with the export artifacts for the session. In Isabelle/ML this is done via<br>
Export.export (and derivatives), in Isabelle/Scala there are operations to<br>
retrieve results from the corresponding session build database: it is like<br>
a<br>
formal file-system for the session (and not a "disk").</p>
<p>There is also "isabelle export" to access exports from the command-line,<br>
e.g.<br>
"isabelle export -l My_Session". Moreover the "system" manual explains<br>
'export_files' within session ROOT specifications in chapter 2 "Isabelle<br>
sessions and build management".</p>
<p>Makarius<br>
</p>
</blockquote>



<a name="278317899"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Running%20a%20theory%20file%20containing%20ML%20code%20on%20co.../near/278317899" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Running.20a.20theory.20file.20containing.20ML.20code.20on.20co.2E.2E.2E.html#278317899">(Apr 08 2022 at 15:08)</a>:</h4>
<p>From: Mac Goodwin &lt;<a href="mailto:cl-isabelle-users@lists.cam.ac.uk">cl-isabelle-users@lists.cam.ac.uk</a>&gt;<br>
For anyone with a similar use case/issue, I eventually got this working<br>
with the following setup:</p>
<p>In the ROOT file for the project, add an export_files statement as per<br>
system manual: export_files (in ".") "<em>:</em>*.hs"</p>
<p>This outputs exports *to *the current directory (indicated by ".") and<br>
filters for haskell files ("<em>:</em>*.hs").</p>
<p>Given an export_code command in your theory file (such as "export_code<br>
function in Haskell module_name Calculator file_prefix calculator") it is<br>
then possible to retrieve the exported code from Isabelle's virtual file<br>
system using the following command to build, and then export, the files:</p>
<p>isabelle export -d . -x "<em>:</em>*.hs" [SESSION_NAME]</p>
<p>Where SESSION_NAME is the session name specified in your ROOT file. This<br>
command should be run from the same directory as the ROOT file and theory<br>
file.</p>
<p>This setup then eliminates the need for ML code. For some quick feedback -<br>
I think the system manual could do with a few more worked examples of how<br>
to chain these commands together! As a beginner Isabelle user, I personally<br>
found it a bit confusing. I did find the Code Generation paper useful when<br>
figuring this out: <a href="https://isabelle.in.tum.de/doc/codegen.pdf">https://isabelle.in.tum.de/doc/codegen.pdf</a></p>
<p>Thanks,</p>
<p>Mac</p>



<hr><p>Last updated: Jul 15 2022 at 23:21 UTC</p>
</html>