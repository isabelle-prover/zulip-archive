<html>
<head><meta charset="utf-8"><title>[isabelle] The instructions in AFP&#x27;s &quot;Using Entries&quot; do n... · Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/index.html">Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20The.20instructions.20in.20AFP&#x27;s.20.22Using.20Entries.22.20do.20n.2E.2E.2E.html">[isabelle] The instructions in AFP&#x27;s &quot;Using Entries&quot; do n...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="240336710"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20The%20instructions%20in%20AFP%27s%20%22Using%20Entries%22%20do%20n.../near/240336710" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20The.20instructions.20in.20AFP&#x27;s.20.22Using.20Entries.22.20do.20n.2E.2E.2E.html#240336710">(May 26 2021 at 14:51)</a>:</h4>
<p>From: Jakub Kądziołka &lt;<a href="mailto:kuba@kadziolka.net">kuba@kadziolka.net</a>&gt;<br>
Hello,</p>
<p>at the Isabelle Zulip, we have just successfully troubleshot an issue<br>
with getting Isabelle to recognize AFP component. As it turns out, the<br>
path that should be included in $ISABELLE_HOME_USER/etc/components<br>
(which is, by the way, incorrectly referred to by <code>isabelle components --help</code><br>
as $ISABELLE_HOME_USER/components, without the /etc/ path component),<br>
is .../afp-2021-05-14/thys, and not just .../afp-2021-05-14.<br>
Moreover, <code>isabelle components -u</code> will only accept the former,<br>
rejecting the latter with</p>
<p>*** Bad component directory: "/home/kuba/formal/afp-2021-05-14/thys"</p>
<p>Manually editing $ISABELLE_HOME_USER/etc/components to include the path<br>
to .../thys makes things work.</p>
<p>Regards,<br>
Jakub Kądziołka</p>



<a name="240404509"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20The%20instructions%20in%20AFP%27s%20%22Using%20Entries%22%20do%20n.../near/240404509" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20The.20instructions.20in.20AFP&#x27;s.20.22Using.20Entries.22.20do.20n.2E.2E.2E.html#240404509">(May 26 2021 at 23:28)</a>:</h4>
<p>From: Gerwin Klein &lt;<a href="mailto:kleing@unsw.edu.au">kleing@unsw.edu.au</a>&gt;<br>
Hi Jakub,</p>
<p>Thanks for helping out with that, I just looked at the Tulip discussion.</p>
<p>It seems like the component registration does work, but the AFP component does not make the AFP thys directory globally available.</p>
<p>After the instructions as they are, <code>isabelle afp_build Example-Submission</code> should work, but <code>isabelle jedit</code> alone will not pick them up.</p>
<p>IIRC we removed the global ROOTS from the component at some point, because including a ROOTS file twice led to problems. That is no longer the case, so including ROOTS again is probably the simplest solution.</p>
<p>The other lesson from the zulip discussion is that we should not assume that Isabelle is installed in the path. I remember now that I specifically avoided that in the old version of the instructions, but that had its own problems.</p>
<p>Cheers,<br>
Gerwin</p>



<a name="241652245"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20The%20instructions%20in%20AFP%27s%20%22Using%20Entries%22%20do%20n.../near/241652245" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20The.20instructions.20in.20AFP&#x27;s.20.22Using.20Entries.22.20do.20n.2E.2E.2E.html#241652245">(Jun 05 2021 at 19:18)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
As a "proof" for the formal record, here is the public archive of the Zulip<br>
thread in question:<br>
<a href="https://isabelle.systems/zulip-archive/238552BeginnerQuestions/77272afp.html">https://isabelle.systems/zulip-archive/238552BeginnerQuestions/77272afp.html</a></p>
<p>Already in 1990, I have resolved to ignore the real-time chat culture, so it<br>
is indeed important to copy topics that might be relevant over to the official<br>
mailing list.</p>
<p>First some minor notes, especially on the idealized situation for the next<br>
release:</p>
<ul>
<li>
<p>The official way to get usage help for Isabelle tools is via the non-option<br>
"-?": the isabelle executable says that.</p>
</li>
<li>
<p>I have already updated the usage message here:<br>
<a href="https://isabelle.sketis.net/repos/isabelle/rev/f73c691bd679">https://isabelle.sketis.net/repos/isabelle/rev/f73c691bd679</a></p>
</li>
<li>
<p>"isabelle components -u" is indeed a bit rough in Isabelle2021: I introduced<br>
it for something marginal elsewhere, before it got more attention in the last<br>
moment in simplifying AFP setup.</p>
</li>
<li>
<p>The check for etc/settings or etc/components is actually too strict: both<br>
are optional and a meaningful component directory can have just ROOT and/or<br>
ROOTS as we see in AFP/thys. See also<br>
<a href="https://isabelle.sketis.net/repos/isabelle/rev/c8b4a4f69068">https://isabelle.sketis.net/repos/isabelle/rev/c8b4a4f69068</a></p>
</li>
</ul>
<p>I will answer Gerwin's answer separately, especially for Isabelle2021 without<br>
any of these changes.</p>
<p>Makarius</p>



<a name="241653854"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20The%20instructions%20in%20AFP%27s%20%22Using%20Entries%22%20do%20n.../near/241653854" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20The.20instructions.20in.20AFP&#x27;s.20.22Using.20Entries.22.20do.20n.2E.2E.2E.html#241653854">(Jun 05 2021 at 20:00)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
We can be glad that the Isabelle + AFP repositories don't have Orwellian<br>
manipulation of history<br>
<a href="https://www.sparknotes.com/lit/1984/quotes/theme/manipulation-of-history">https://www.sparknotes.com/lit/1984/quotes/theme/manipulation-of-history</a> ---<br>
so it is easy to look up things formally when memory becomes unsure.</p>
<p>The initial AFP/etc/settings go back to Florian Haftmann in Aug-2011, where he<br>
introduced $AFP_BASE for the main AFP directory and $AFP for AFP/thys. See also:</p>
<p><a href="https://isabelle-dev.sketis.net/source/afp-devel/history/default/etc/settings">https://isabelle-dev.sketis.net/source/afp-devel/history/default/etc/settings</a></p>
<p>changeset:   2357:5b970f669325<br>
user:        haftmann<br>
date:        Tue Aug 30 23:36:37 2011 +0200<br>
files:       etc/settings tools/testafp<br>
description:<br>
rudimentary support for AFP as Isabelle component</p>
<p>The isabelle build setup with ROOT / ROOTS is by myself and Gerwin in<br>
Aug/Sep-2012, when "isabelle build" emerged:</p>
<p>changeset:   2994:3fa9ca7f4a5e<br>
user:        wenzelm<br>
date:        Sun Aug 05 22:01:12 2012 +0200<br>
files:       thys/ROOT thys/ROOTS tools/afp_mkroot<br>
description:<br>
more formal ROOTS catalog file;</p>
<p>changeset:   3043:c2985e24d5f7<br>
user:        Gerwin Klein &lt;<a href="mailto:gerwin.klein@nicta.com.au">gerwin.klein@nicta.com.au</a>&gt;<br>
date:        Sun Sep 02 15:15:04 2012 +1000<br>
files:       admin/regression<br>
description:<br>
include ROOTS file to actually build something</p>
<p>changeset:   11860:6d986a7dc22b<br>
user:        Gerwin Klein &lt;<a href="mailto:kleing@unsw.edu.au">kleing@unsw.edu.au</a>&gt;<br>
date:        Thu May 27 10:07:17 2021 +1000<br>
files:       ROOTS<br>
description:<br>
make AFP ROOTS globally available for component</p>
<p>My initial change 3fa9ca7f4a5e is where the thys/ROOTS file appears first. We<br>
never had a ROOTS in the main AFP directory, not by accident but by design.<br>
This was due to my re-interpretation of Florian's $AFP_BASE and $AFP settings<br>
as follows:</p>
<p>* $AFP_BASE is the administrative base directory of AFP, providing settings,<br>
isabelle command-line tools etc.</p>
<p>* $AFP is a symbolic handle on the actual session directories, with ROOTS as<br>
overall catalog, and subdirectories with individual ROOT files.</p>
<p>By initializing only $AFP_BASE as component, but not yet $AFP, it is possible<br>
to refer to AFP sessions symbolically on demand: the session name space<br>
remains clear of AFP entries by default.</p>
<p>This is important for build management of Isabelle and AFP separately:</p>
<p>isabelle build -a  # build all of Isabelle, without AFP</p>
<p>isabelle build -a -d '$AFP'  # build all of Isabelle + AFP</p>
<p>isabelle build -D '$AFP'  # build all of AFP, but only those images of<br>
Isabelle that are required for it</p>
<p>The option -d '$AFP' has later become idiomatic for many other Isabelle tools,<br>
to add the "AFP aspect" with minimal complexity. For example for the Prover IDE:</p>
<p>isabelle jedit -d '$AFP'</p>
<p>or relatives of "isabelle build" that require formal sessions, like "isabelle<br>
export", "isabelle document" etc.</p>
<p>This well-understood and important behaviour of $AFP_BASE vs. $AFP has been<br>
lost by the following "quick-fix" that has emerged from this thread:</p>
<p>changeset:   11677:6d986a7dc22b<br>
user:        Gerwin Klein &lt;<a href="mailto:kleing@unsw.edu.au">kleing@unsw.edu.au</a>&gt;<br>
date:        Thu May 27 10:07:17 2021 +1000<br>
files:       ROOTS<br>
description:<br>
make AFP ROOTS globally available for component</p>
<p>Note that I have already improved my "isabelle components -u" for the next<br>
Isabelle release, to avoid such confusion in the future.</p>
<p>For Isabelle2021 + AFP, there are at least two possibilities, without the<br>
deadly $AFP_BASE/ROOTS catalog:</p>
<p>(1) Just create AFP/thys/etc/settings as a dummy, to make it look like a<br>
component directory for Isabelle2021/bin/isabelle components -u.</p>
<p>(2) Be more ambitious in having the AFP/thys/etc/settings initialize<br>
$AFP_BASE if not yet done by the user. Thus users get two choices for AFP as<br>
component:</p>
<p>(a) use component AFP, but not AFP/thys; thus the important "isabelle<br>
build -a" versus "isabelle build -a -d '$AFP'" works properly</p>
<p>(b) use component AFP/thys and let its etc/settings init AFP if required<br>
(otherwise users would have to init both AFP and AFP/thys manually).</p>
<p>This is a long explanation for a small change, see the attachment for afp-2021<br>
(and merge into afp-devel).</p>
<p>It would be better to have fewer choices and less complexity: ultimately no<br>
Isabelle/AFP user should be asked to tinker with component configuration: the<br>
Prover IDE should just do it in a prospective "AFP" panel.</p>
<p>This will emerge eventually, but not in the next release (end of 2021).</p>
<p>Makarius<br>
<a href="/user_uploads/14278/9_5x2i-GnqT6RAFhvJon20EC/ch">ch</a></p>



<a name="241663568"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20The%20instructions%20in%20AFP%27s%20%22Using%20Entries%22%20do%20n.../near/241663568" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20The.20instructions.20in.20AFP&#x27;s.20.22Using.20Entries.22.20do.20n.2E.2E.2E.html#241663568">(Jun 06 2021 at 00:36)</a>:</h4>
<p>From: Gerwin Klein &lt;<a href="mailto:kleing@unsw.edu.au">kleing@unsw.edu.au</a>&gt;</p>
<blockquote>
<p>On 6 Jun 2021, at 06:00, Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt; wrote:</p>
<p>The initial AFP/etc/settings go back to Florian Haftmann in Aug-2011, where he<br>
introduced $AFP_BASE for the main AFP directory and $AFP for AFP/thys. See also:<br>
[..]</p>
</blockquote>
<p>I agree with all of this.</p>
<blockquote>
<p>This is important for build management of Isabelle and AFP separately:</p>
<p>isabelle build -a  # build all of Isabelle, without AFP</p>
</blockquote>
<p>True, I had not anticipated that <code>isabelle build -a</code> is called in contexts where the AFP is registered as component. You'd now have to explicitly exclude the afp group, and that is not very nice.</p>
<blockquote>
<p>The option -d '$AFP' has later become idiomatic for many other Isabelle tools,<br>
to add the "AFP aspect" with minimal complexity. For example for the Prover IDE:</p>
<p>isabelle jedit -d '$AFP'</p>
</blockquote>
<p>Agree, that was the canonical way, but that was part of the problem. It doesn't work for users who don't use the command line.</p>
<p>We had discussions amongst the editors before about having AFP ROOTS available by default -- this what I was referring to about the ROOTS file. You can't find them in the history, because it didn't work when we discussed it, so it was never committed.</p>
<p>[..]</p>
<blockquote>
<p>For Isabelle2021 + AFP, there are at least two possibilities, without the<br>
deadly $AFP_BASE/ROOTS catalog:<br>
[..]<br>
 (2) Be more ambitious in having the AFP/thys/etc/settings initialize<br>
$AFP_BASE if not yet done by the user. Thus users get two choices for AFP as<br>
component:</p>
<p>(a) use component AFP, but not AFP/thys; thus the important "isabelle<br>
build -a" versus "isabelle build -a -d '$AFP'" works properly</p>
<p>(b) use component AFP/thys and let its etc/settings init AFP if required<br>
(otherwise users would have to init both AFP and AFP/thys manually).</p>
</blockquote>
<p>This is much better than my solution, and I'd be very happy with it.</p>
<blockquote>
<p>This is a long explanation for a small change, see the attachment for afp-2021<br>
(and merge into afp-devel).</p>
</blockquote>
<p>Thanks for that, I'll include it and update the instruction (again ;-))</p>
<p>Cheers,<br>
Gerwin</p>



<a name="241684558"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20The%20instructions%20in%20AFP%27s%20%22Using%20Entries%22%20do%20n.../near/241684558" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20The.20instructions.20in.20AFP&#x27;s.20.22Using.20Entries.22.20do.20n.2E.2E.2E.html#241684558">(Jun 06 2021 at 10:19)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Yes, I am aware of that extra assumption. It is part of the process to rethink<br>
AFP within the Prover IDE.</p>
<p>There is another ongoing process of rethinking: how to allow Isabelle/Scala<br>
modules within sessions and/or components.</p>
<p>Maybe I eventually get the right idea, when revisiting this more seriously.</p>
<p>Makarius</p>



<a name="241684721"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20The%20instructions%20in%20AFP%27s%20%22Using%20Entries%22%20do%20n.../near/241684721" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20The.20instructions.20in.20AFP&#x27;s.20.22Using.20Entries.22.20do.20n.2E.2E.2E.html#241684721">(Jun 06 2021 at 10:23)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Great.</p>
<p>I now see change 3a9c2004b599 both on afp-2021 and afp-devel.</p>
<p>Makarius</p>



<a name="241749575"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247541-Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20The%20instructions%20in%20AFP%27s%20%22Using%20Entries%22%20do%20n.../near/241749575" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247541-Mirror:-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20The.20instructions.20in.20AFP&#x27;s.20.22Using.20Entries.22.20do.20n.2E.2E.2E.html#241749575">(Jun 07 2021 at 09:24)</a>:</h4>
<p>From: Gerwin Klein &lt;<a href="mailto:kleing@unsw.edu.au">kleing@unsw.edu.au</a>&gt;<br>
Integrating the AFP more will probably be the better way long-term, yes.</p>
<p>Cheers,<br>
Gerwin</p>



<hr><p>Last updated: Jul 15 2022 at 23:21 UTC</p>
</html>