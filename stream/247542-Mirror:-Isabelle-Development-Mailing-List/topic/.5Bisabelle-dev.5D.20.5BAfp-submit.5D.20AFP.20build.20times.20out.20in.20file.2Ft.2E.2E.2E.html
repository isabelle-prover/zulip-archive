<html>
<head><meta charset="utf-8"><title>[isabelle-dev] [Afp-submit] AFP build times out in file/t... · Mirror: Isabelle Development Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/index.html">Mirror: Isabelle Development Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html">[isabelle-dev] [Afp-submit] AFP build times out in file/t...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="261608150"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261608150" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261608150">(Nov 16 2021 at 08:02)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
Oops, hadn't noticed that. The hard timing facts: The presentation part, which <br>
used to take 35-40 mins is now taking 90 minutes at least, and we don't have an <br>
upper bound (because of the timeout). Of course we could try to increase the <br>
timeout and see what happens. The problem is largely due to the fact that theory <br>
presentation used to be incremental (quite some time ago) but these days, even <br>
if only 1 AFP entry has changed, the presentation for the entire AFP is built.</p>
<p>Tobias<br>
<a href="/user_uploads/14278/uruquCUWfTxvyorGFFGvwHdK/smime.p7s">smime.p7s</a></p>



<a name="261608429"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261608429" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261608429">(Nov 16 2021 at 08:06)</a>:</h4>
<p>From: Gerwin Klein &lt;<a href="mailto:kleing@unsw.edu.au">kleing@unsw.edu.au</a>&gt;<br>
I'm not sure it's that, although it might be related. The log looks like the presentation part went on for almost the full 4h, which sure isn't how long it is supposed to take.</p>
<p>Cheers,<br>
Gerwin<br>
<a href="/user_uploads/14278/vRG1pRv1FfUYIZ31TpFFvbPY/signature.asc">signature.asc</a></p>



<a name="261609027"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261609027" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261609027">(Nov 16 2021 at 08:17)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
We are both right: in the log I looked at, the proofs only left 90 minutes for <br>
the presentation until timeout (hence no upper bound), but as you point out, if <br>
the proofs are shorter, the presentation part will happily use the rest of the 4 <br>
hours.</p>
<p>Tobias<br>
<a href="/user_uploads/14278/1oC27sAjVaeqYc15ntv-knfe/smime.p7s">smime.p7s</a></p>



<a name="261610533"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261610533" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261610533">(Nov 16 2021 at 08:35)</a>:</h4>
<p>From: Fabian Huch &lt;<a href="mailto:huch@in.tum.de">huch@in.tum.de</a>&gt;<br>
There seems to be a performance degradation in the presentation <br>
somewhere between Isabelle/adb10e840b71 and Isabelle/2b212c8138a. I <br>
notified Makarius about that but didn't spot the error yet (there were <br>
lots of changes in the signature).</p>
<p>I think the jenkins build should be configured to send out notification <br>
emails in situations like that. Either by marking builds that time out <br>
as "failed" rather than "aborted" (which I'm in favour of) or by <br>
explicitly sending out emails on aborted builds (though it seems like it <br>
would send an email at every aborted built, not just the first one).</p>
<p>Fabian</p>



<a name="261611803"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261611803" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261611803">(Nov 16 2021 at 08:50)</a>:</h4>
<p>From: Gerwin Klein &lt;<a href="mailto:kleing@unsw.edu.au">kleing@unsw.edu.au</a>&gt;<br>
Right, that explains the 90 min vs 4h, and it looks like Fabian has already identified a range of change sets that might be the cause.</p>
<p>So apart from the fork, nothing specific needs to happen on the AFP side at the moment.</p>
<p>Cheers,<br>
Gerwin</p>
<hr>
<p>isabelle-dev mailing list<br>
<a href="mailto:isabelle-dev@in.tum.de">isabelle-dev@in.tum.de</a><br>
<a href="https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev">https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev</a></p>



<a name="261611960"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261611960" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261611960">(Nov 16 2021 at 08:53)</a>:</h4>
<p>From: Gerwin Klein &lt;<a href="mailto:kleing@unsw.edu.au">kleing@unsw.edu.au</a>&gt;<br>
+1 to that a timed-out build should be a failed build.</p>
<p>Cheers,<br>
Gerwin</p>



<a name="261630802"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261630802" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261630802">(Nov 16 2021 at 12:01)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
That interval is shortly before Isabelle2021-RC3 (12-Nov-2021). From the<br>
changesets, nothing special has happened: I will investigate more closely later.</p>
<p>I did encounter various problems, shortly before and after that date:</p>
<p>* lxcisa0, which is a virtual slice of the AFP test machine, could not<br>
finish a plain "isabelle build -b HOL" within finite time. Maybe there was a<br>
lot of disk thrashing on the other slice --- yes, it still has a physical<br>
harddisk. (I ignored the problem and continued the RC3 rollout by other means.)</p>
<p>* Building the HTML presentation<br>
<a href="https://isabelle.sketis.net/website-Isabelle2021-1-RC3/documentation.html">https://isabelle.sketis.net/website-Isabelle2021-1-RC3/documentation.html</a><br>
required 6.5h only for the Isabelle distribution, using a relatively weak VM<br>
node under my own control. For RC1 and RC2 this did not work at all for other<br>
reasons. For RC3 it somehow "got stuck" after HOL-Analysis and then proceeded<br>
very slowly, but terminated hours later. My guess is that the Java heap was<br>
getting very full -- too much string and XML material etc. My plan was to<br>
ensure that the JVM for such builds has at least 8-16 GB (but maybe it<br>
requires some other tuning elsewhere).</p>
<p>* As already for Isabelle2021, HTML presentation on current hardware with<br>
old-fashioned HDD is significantly slower than current  SSD / NVME. In recent<br>
months, I was often wondering, if testing against old iron is actually a good<br>
thing or bad thing, or if the idea of supporting HDDs should be discontinued.</p>
<p>Many newer platforms do assume that your "disk" is not a disk at all, but<br>
random-access persistent memory. Especially macOS: My old MacMini was unusable<br>
with Big Sur until some months ago, when I ordered an obscure adapter for 8<br>
EUR from an obscure manufacture of spare parts in Hong Kong. After 10 weeks of<br>
shipping over the oceans, I could replace the HDD by a regular NVME, and now<br>
this old 2 CPU core + 8 GB machine is great again for testing Isabelle.</p>
<p>So the practical question is: Could the AFP test machine be upgraded to SSD /<br>
NVME?</p>
<p>Makarius</p>
<hr>
<p>isabelle-dev mailing list<br>
<a href="mailto:isabelle-dev@in.tum.de">isabelle-dev@in.tum.de</a><br>
<a href="https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev">https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev</a></p>



<a name="261685444"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261685444" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261685444">(Nov 16 2021 at 18:30)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
I'll check if that can be done right away and then we can see.</p>
<p>What I never understood is why incremental generation of presentations is no <br>
longer possible.</p>
<p>Tobias<br>
<a href="/user_uploads/14278/HEWYFV2df_1YmzERlR-dQ4nZ/smime.p7s">smime.p7s</a></p>



<a name="261699667"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261699667" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261699667">(Nov 16 2021 at 20:08)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
The situation is getting more and more complex.</p>
<p>Nonetheless, there is a plain and simple mistake somewhere in<br>
Isabelle2021-RC3: afterwards it will be more incremental, but not maximally<br>
incremental.</p>
<p>Makarius</p>
<hr>
<p>isabelle-dev mailing list<br>
<a href="mailto:isabelle-dev@in.tum.de">isabelle-dev@in.tum.de</a><br>
<a href="https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev">https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev</a></p>



<a name="261707078"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261707078" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261707078">(Nov 16 2021 at 21:08)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
This particular new problem was introduced here:<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/rev/32c2587cda4f#l2.7">https://isabelle.sketis.net/repos/isabelle-release/rev/32c2587cda4f#l2.7</a></p>
<p>In that version, the HTML.Context has mutable content (originally from the<br>
version by Fabian, that I shuffled around a lot without eliminating it yet).<br>
For the moment, I have done it slightly differently here:<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/rev/507f50dbeb79">https://isabelle.sketis.net/repos/isabelle-release/rev/507f50dbeb79</a></p>
<p>Moreover, this change will save a lot of Java heap:<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/rev/5eac4b13d1f1">https://isabelle.sketis.net/repos/isabelle-release/rev/5eac4b13d1f1</a></p>
<p>Thus we should be back to a half-decent situation.</p>
<p>I will investigate further fine points, to see if remaining conceptual can be<br>
resolved, notably a mismatch of sessions_structure.build_topological_order vs.<br>
sessions_structure.imports_topological_order that is only relevant for<br>
presentation.</p>
<p>Makarius</p>
<hr>
<p>isabelle-dev mailing list<br>
<a href="mailto:isabelle-dev@in.tum.de">isabelle-dev@in.tum.de</a><br>
<a href="https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev">https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev</a></p>



<a name="261724365"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261724365" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261724365">(Nov 16 2021 at 23:41)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Half-decent in that version means 2h for presentation.</p>
<p>(I will make one more round to see if the session dependency situation can be<br>
further clarified. This will allow better persistance of results, e.g. for<br>
incremental presentation.)</p>
<p>Makarius</p>
<hr>
<p>isabelle-dev mailing list<br>
<a href="mailto:isabelle-dev@in.tum.de">isabelle-dev@in.tum.de</a><br>
<a href="https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev">https://mailman46.in.tum.de/mailman/listinfo/isabelle-dev</a></p>



<a name="261747825"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/247542-Mirror%3A%20Isabelle%20Development%20Mailing%20List/topic/%5Bisabelle-dev%5D%20%5BAfp-submit%5D%20AFP%20build%20times%20out%20in%20file/t.../near/261747825" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/247542-Mirror:-Isabelle-Development-Mailing-List/topic/.5Bisabelle-dev.5D.20.5BAfp-submit.5D.20AFP.20build.20times.20out.20in.20file.2Ft.2E.2E.2E.html#261747825">(Nov 17 2021 at 06:23)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
On 17/11/2021 00:41, Makarius wrote:</p>
<blockquote>
<p>On 16/11/2021 22:08, Makarius wrote:</p>
<blockquote>
<p>Moreover, this change will save a lot of Java heap:<br>
<a href="https://isabelle.sketis.net/repos/isabelle-release/rev/5eac4b13d1f1">https://isabelle.sketis.net/repos/isabelle-release/rev/5eac4b13d1f1</a></p>
<p>Thus we should be back to a half-decent situation.</p>
</blockquote>
<p>Half-decent in that version means 2h for presentation.</p>
</blockquote>
<p>For the AFP test hardware we seem to be back more or less to where we were, i.e. <br>
about 40 mins for presentation.</p>
<p>Thanks a lot for that!!</p>
<p>Tobias</p>
<blockquote>
<p>(I will make one more round to see if the session dependency situation can be<br>
further clarified. This will allow better persistance of results, e.g. for<br>
incremental presentation.)</p>
<p>Makarius</p>
<hr>
<p>Afp-submit mailing list<br>
<a href="mailto:Afp-submit@mailman46.in.tum.de">Afp-submit@mailman46.in.tum.de</a><br>
<a href="https://mailman46.in.tum.de/mailman/listinfo/afp-submit">https://mailman46.in.tum.de/mailman/listinfo/afp-submit</a></p>
<p><a href="/user_uploads/14278/SBALpdCAiEMX3NwFFZxgZwWG/smime.p7s">smime.p7s</a></p>
</blockquote>



<hr><p>Last updated: Jul 15 2022 at 23:21 UTC</p>
</html>