<html>
<head><meta charset="utf-8"><title>[isabelle] [EXTERNAL] Non-idempotence of datatype constru... · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20.5BEXTERNAL.5D.20Non-idempotence.20of.20datatype.20constru.2E.2E.2E.html">[isabelle] [EXTERNAL] Non-idempotence of datatype constru...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294827752"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20%5BEXTERNAL%5D%20Non-idempotence%20of%20datatype%20constru.../near/294827752" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20.5BEXTERNAL.5D.20Non-idempotence.20of.20datatype.20constru.2E.2E.2E.html#294827752">(Aug 23 2022 at 09:00)</a>:</h4>
<p>From: Miguel Pagano &lt;<a href="mailto:miguel.pagano@gmail.com">miguel.pagano@gmail.com</a>&gt;<br>
On Fri, 1 May 2020 at 17:59, Miguel Pagano &lt;<a href="mailto:miguel.pagano@gmail.com">miguel.pagano@gmail.com</a>&gt; wrote:</p>
<blockquote>
<p>On Fri, 1 May 2020 at 17:58, Richard Waldinger &lt;<a href="mailto:waldinger@ai.sri.com">waldinger@ai.sri.com</a>&gt;<br>
wrote:</p>
<blockquote>
<p>isn’t the “size” theorem true for any function, not just size?  or am i<br>
missing something?</p>
<p>It shouldn't be true for non-injective functions.</p>
</blockquote>
<p>I'm embarrased, please discard my stupid answer.</p>
</blockquote>
<blockquote>
<blockquote>
<p>On May 1, 2020, at 1:51 PM, Manuel Eberl &lt;<a href="mailto:eberlm@in.tum.de">eberlm@in.tum.de</a>&gt; wrote:</p>
<blockquote>
<blockquote>
<p>Firstly, I don't think these theorem is especially useful. You might<br>
have planned to add this to the simplifier, but its term net doesn't do<br>
any magic here. It will end up checking every term that matches "Cons x<br>
xs = ys" for whether "xs" can match "ys". I'm not sure if that matching<br>
is equality, alpha-equivalent or unifiable.</p>
</blockquote>
<p>I honestly never think /that/ much about the performance implications of<br>
simp rules (as long as they're unconditional). At least for lists, by<br>
the way, this is already a simp rule by default though, and lists are<br>
probably by far the most prevalent data type in the Isabelle universe.</p>
<p>But you're certainly right that it would make sense to keep a look at<br>
this performance impact if one wanted to add these to the simp set for<br>
all datatypes by default, and I agree that the rules are probably not<br>
helpful /that/ often. Still, it might be nice to have them available<br>
nonetheless.</p>
<blockquote>
<p>Secondly, you can prove these theorems by using this handy trivial<br>
theorem : "size x ~= size y ==&gt; x ~= y". Apparently that theorem has<br>
the<br>
name  Sledgehammer.size_ne_size_imp_ne - presumably the sledgehammer<br>
uses it to prove such inequalities.</p>
</blockquote>
<p>It's even easier to prove it by induction. Plus, in fact, the "size"<br>
thing only works if the data type even has a sensible size function.<br>
That is not always the case, e.g. when you nest the datatype through a<br>
function.</p>
<p>My main point however is that when you have a datatype with a dozen<br>
binary constructors, there's quite a bit of copying &amp; pasting involved<br>
before you've proven all those theorems. Since it can (probably) be<br>
automated very easily, why not do that? Whether or not these should be<br>
simp lemmas by default is another question.</p>
<p>Manuel</p>
</blockquote>
</blockquote>
</blockquote>



<a name="294828837"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20%5BEXTERNAL%5D%20Non-idempotence%20of%20datatype%20constru.../near/294828837" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20.5BEXTERNAL.5D.20Non-idempotence.20of.20datatype.20constru.2E.2E.2E.html#294828837">(Aug 23 2022 at 09:07)</a>:</h4>
<p>From: Richard Waldinger &lt;<a href="mailto:waldinger@AI.SRI.COM">waldinger@AI.SRI.COM</a>&gt;<br>
isn’t the “size” theorem true for any function, not just size?  or am i missing something?</p>



<a name="294829004"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20%5BEXTERNAL%5D%20Non-idempotence%20of%20datatype%20constru.../near/294829004" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20.5BEXTERNAL.5D.20Non-idempotence.20of.20datatype.20constru.2E.2E.2E.html#294829004">(Aug 23 2022 at 09:08)</a>:</h4>
<p>From: Manuel Eberl &lt;<a href="mailto:eberlm@in.tum.de">eberlm@in.tum.de</a>&gt;<br>
Yes, it is true for any function (even if it isn't injective, although<br>
then it's not an "if-and-only-if").</p>
<p>The point is that if you actually want it to use this to prove that two<br>
lists (or data type values in general) are not equal, you need to plug<br>
in a concrete function f. And "size" happens to be one that is good for<br>
this particular case.</p>
<p>Sometimes less general theorems can achieve more because they guide the<br>
automation more (and us humans, too!). That is particularly true for<br>
induction rules.</p>
<p>Manuel</p>



<a name="294829133"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20%5BEXTERNAL%5D%20Non-idempotence%20of%20datatype%20constru.../near/294829133" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20.5BEXTERNAL.5D.20Non-idempotence.20of.20datatype.20constru.2E.2E.2E.html#294829133">(Aug 23 2022 at 09:09)</a>:</h4>
<p>From: Manuel Eberl &lt;<a href="mailto:eberlm@in.tum.de">eberlm@in.tum.de</a>&gt;<br>
Hey, don't worry about it. I had to think for a few seconds to be sure<br>
myself.</p>
<p>A colleague of mine who shall not be named once spent an embarrassingly<br>
long time trying to prove that the "fst" function is injective. ;)</p>
<p>Happens to all of us!</p>
<p>Manuel</p>



<a name="294829415"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20%5BEXTERNAL%5D%20Non-idempotence%20of%20datatype%20constru.../near/294829415" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20.5BEXTERNAL.5D.20Non-idempotence.20of.20datatype.20constru.2E.2E.2E.html#294829415">(Aug 23 2022 at 09:12)</a>:</h4>
<p>From: Miguel Pagano &lt;<a href="mailto:miguel.pagano@gmail.com">miguel.pagano@gmail.com</a>&gt;<br>
On Fri, 1 May 2020 at 17:58, Richard Waldinger &lt;<a href="mailto:waldinger@ai.sri.com">waldinger@ai.sri.com</a>&gt; wrote:</p>
<blockquote>
<p>isn’t the “size” theorem true for any function, not just size?  or am i<br>
missing something?</p>
<p>It shouldn't be true for non-injective functions.</p>
</blockquote>
<blockquote>
<p>On May 1, 2020, at 1:51 PM, Manuel Eberl &lt;<a href="mailto:eberlm@in.tum.de">eberlm@in.tum.de</a>&gt; wrote:</p>
<blockquote>
<blockquote>
<p>Firstly, I don't think these theorem is especially useful. You might<br>
have planned to add this to the simplifier, but its term net doesn't do<br>
any magic here. It will end up checking every term that matches "Cons x<br>
xs = ys" for whether "xs" can match "ys". I'm not sure if that matching<br>
is equality, alpha-equivalent or unifiable.</p>
</blockquote>
<p>I honestly never think /that/ much about the performance implications of<br>
simp rules (as long as they're unconditional). At least for lists, by<br>
the way, this is already a simp rule by default though, and lists are<br>
probably by far the most prevalent data type in the Isabelle universe.</p>
<p>But you're certainly right that it would make sense to keep a look at<br>
this performance impact if one wanted to add these to the simp set for<br>
all datatypes by default, and I agree that the rules are probably not<br>
helpful /that/ often. Still, it might be nice to have them available<br>
nonetheless.</p>
<blockquote>
<p>Secondly, you can prove these theorems by using this handy trivial<br>
theorem : "size x ~= size y ==&gt; x ~= y". Apparently that theorem has the<br>
name  Sledgehammer.size_ne_size_imp_ne - presumably the sledgehammer<br>
uses it to prove such inequalities.</p>
</blockquote>
<p>It's even easier to prove it by induction. Plus, in fact, the "size"<br>
thing only works if the data type even has a sensible size function.<br>
That is not always the case, e.g. when you nest the datatype through a<br>
function.</p>
<p>My main point however is that when you have a datatype with a dozen<br>
binary constructors, there's quite a bit of copying &amp; pasting involved<br>
before you've proven all those theorems. Since it can (probably) be<br>
automated very easily, why not do that? Whether or not these should be<br>
simp lemmas by default is another question.</p>
<p>Manuel</p>
</blockquote>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 20:30 UTC</p>
</html>