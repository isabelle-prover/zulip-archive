<html>
<head><meta charset="utf-8"><title>[isabelle] Bug report: Generated Scala code on case-insen... · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html">[isabelle] Bug report: Generated Scala code on case-insen...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294723633"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294723633" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294723633">(Aug 22 2022 at 16:28)</a>:</h4>
<p>From: Brandon Bohrer &lt;<a href="mailto:bbohrer@cs.cmu.edu">bbohrer@cs.cmu.edu</a>&gt;<br>
Hi All (and probably Andreas in particular),</p>
<p>I've got a bug to report when code-generating to Scala.<br>
One quirk of Scala compilation is that on case-insensitive filesystems<br>
(some Macs, probably Windows), classes (including case classes for datatype<br>
constructors) must never differ only by case, else compilation fails when<br>
the compiler writes multiple .class files with conflicting names.</p>
<p>Some of the classes generated by Isabelle violate this convention.<br>
While it would be optimal to maintain the convention even when the user<br>
introduces potential conflicts (see attached UserError.{thy,scala}), it's<br>
more important to fix "built-in" code, which also has this bug.<br>
See BugReport.scala lines 12 and 14: "class char" and "case class Char" of<br>
"object String" conflict.<br>
The other case I saw was "class seq" and "case class Seq" in "object<br>
Predicate" when using the predicate compiler, see<br>
BugReportPred.{thy,scala}.</p>
<p>The first solutions that come to mind are:</p>
<p>1) Automatically change class/case class names to avoid conflict, even if<br>
the user gave constructors+types unfortunate names. From reading generated<br>
code I'm under the impression that similar functionality already exists?<br>
e.g. I see classes like "Lista" to avoid conflict with "List".</p>
<p>2) Go through relevant files in the standard library and rename<br>
appropriately at the source level, but that sounds awfully invasive and<br>
less robust.</p>
<p>We have worked around it for now by renaming manually after the code is<br>
generated, which is suboptimal for obvious reasons.</p>
<p>Any fix would be greatly appreciated!<br>
-Brandon<br>
<a href="/user_uploads/14278/TOPNgO4A9DWwSmWw5Q-xyZJ5/BugReport.scala">BugReport.scala</a><br>
<a href="/user_uploads/14278/ho9F1Rp4rkDtdF0X2oJUVi11/BugReport.thy">BugReport.thy</a><br>
<a href="/user_uploads/14278/gFsRssS9hjEZoO2-jwYfTMFX/BugReportPred.scala">BugReportPred.scala</a><br>
<a href="/user_uploads/14278/GRGBPuuop-5kSbi01zpz2ZlX/BugReportPred.thy">BugReportPred.thy</a><br>
<a href="/user_uploads/14278/F6xMbq4Y_zSlNV4ndGAOVFE_/UserError.scala">UserError.scala</a><br>
<a href="/user_uploads/14278/tZ7h0vc32drHgt3b-hTf6ncS/UserError.thy">UserError.thy</a></p>



<a name="294723645"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294723645" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294723645">(Aug 22 2022 at 16:28)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;<br>
Dear Brandon,</p>
<p>some three years ago, Florian has introduced a configuration option for<br>
that:</p>
<p>declare [[scala_case_insensitive]]</p>
<p>It doesn't appear to be documented, though.</p>
<p>Cheers<br>
Lars</p>



<a name="294723665"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294723665" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294723665">(Aug 22 2022 at 16:28)</a>:</h4>
<p>From: Brandon Bohrer &lt;<a href="mailto:bbohrer@cs.cmu.edu">bbohrer@cs.cmu.edu</a>&gt;<br>
Dear Lars,</p>
<p>That's great to hear, and thanks for the quick response!<br>
In my experience since there are so many features that it would likely be<br>
quite difficult to find even if it were documented.<br>
Is there any chance of printing a warning when export_code runs saying "you<br>
probably want to declare this option"?</p>



<a name="294723683"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294723683" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294723683">(Aug 22 2022 at 16:28)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;</p>
<blockquote>
<p>Is there any chance of printing a warning when export_code runs saying "you<br>
probably want to declare this option"?</p>
</blockquote>
<p>That remains unclear.</p>
<p>On the one hand, I maintain that case-insensitive file systems are<br>
fundamentally broken and we shouldn't cater for them by default. On the<br>
other hand, likely the majority of Isabelle users are affected by this.</p>
<p>So maybe the pragmatic approach would be to remove the option and do<br>
mangling by default.</p>
<p>Cheers<br>
Lars</p>



<a name="294723702"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294723702" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294723702">(Aug 22 2022 at 16:28)</a>:</h4>
<p>From: Jasmin Blanchette &lt;<a href="mailto:jasmin.blanchette@inria.fr">jasmin.blanchette@inria.fr</a>&gt;<br>
Lars wrote:</p>
<blockquote>
<p>So maybe the pragmatic approach would be to remove the option and do<br>
mangling by default.</p>
</blockquote>
<p>We could also keep the option but change its default value.</p>
<p>Jasmin</p>



<a name="294723755"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294723755" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294723755">(Aug 22 2022 at 16:28)</a>:</h4>
<p>From: Brandon Bohrer &lt;<a href="mailto:bbohrer@cs.cmu.edu">bbohrer@cs.cmu.edu</a>&gt;<br>
I agree that just making it the default seems a lot easier than having a<br>
message, documentaton, etc. about it.<br>
If there's a concern that the mangling could break anything else or affect<br>
readability, one could always replace the "scala_case_insensitive"<br>
with a "scala_case_sensitive"<br>
option that manually disables the mangling if someone really needs it.</p>
<p>-Brandon</p>



<a name="294723840"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294723840" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294723840">(Aug 22 2022 at 16:29)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
I wonder if scalac could directly output into a jar file, without the<br>
dangers of the physical file-system. Maybe by invoking the Scala<br>
compiler within Scala under program control?</p>
<p>On Windows and Mac OS X there is loss of information due to<br>
case-insensibility. On Linux there are occasional problems with<br>
file-name lengths on encrypted file-systems.</p>
<p>Makarius<br>
<a href="/user_uploads/14278/-rYiKAioxBRaQJfa9w4VJyQT/signature.asc">signature.asc</a></p>



<a name="294723855"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294723855" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294723855">(Aug 22 2022 at 16:29)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;<br>
A brief look at the sources of the Scala compiler yielded this:</p>
<p>/** A list pairing source directories with their output directory.</p>
<p>*  This option is not available on the command line, but can be set <br>
by</p>
<p>*  other tools (IDEs especially). The command line specifies a single<br>
    *  output directory that is used for all source files, denoted by a<br>
    *  '*' in this list.<br>
    */<br>
   lazy val outputDirs = new OutputDirs</p>
<p>Additionally, there is an ad-hoc implementation of an in-memory <br>
directory present.</p>
<p>I haven't checked whether all necessary operations are supported, but it <br>
looks doable.</p>



<a name="294724087"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724087" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724087">(Aug 22 2022 at 16:30)</a>:</h4>
<p>From: Florian Haftmann &lt;<a href="mailto:florian.haftmann@informatik.tu-muenchen.de">florian.haftmann@informatik.tu-muenchen.de</a>&gt;<br>
Sounds like an interesting idea, but also more involved.  I think I'll<br>
first start with my pragmatic proposal and then gather more expertise in<br>
that area.</p>
<p>Florian<br>
<a href="/user_uploads/14278/ioxYfx4u9cAOpNzLNE75_sK-/signature.asc">signature.asc</a></p>



<a name="294724119"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724119" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724119">(Aug 22 2022 at 16:31)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;<br>
On a tangential note, it would be very helpful if Isabelle itself would<br>
support virtual file systems. PIDE could easily do it by switching to<br>
NIO paths from IO files, but the problem remains for I/O operations<br>
performed by the prover.</p>
<p>(Use cases I'm thinking of are performing cross-platform in-memory<br>
builds, or not having to check out the AFP for including a single<br>
session with dependencies.)</p>



<a name="294724139"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724139" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724139">(Aug 22 2022 at 16:31)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On 15/12/17 11:51, Lars Hupel wrote:</p>
<blockquote>
<p>On a tangential note, it would be very helpful if Isabelle itself would<br>
support virtual file systems. PIDE could easily do it by switching to<br>
NIO paths from IO files, but the problem remains for I/O operations<br>
performed by the prover.</p>
</blockquote>
<p>There is already some support for that: the PIDE module resources.scala<br>
and its derivatives for the jEdit and VSCode front-end provide some<br>
abstractions over the file-system. Thus Isabelle/PIDE/jEdit can work<br>
over http to some extent. E.g. try this with current Isabelle/b8f30228a55b:</p>
<p>isabelle jedit -l HOL-Analysis<br>
<a href="https://bitbucket.org/isa-afp/afp-devel/raw/6e2a1bb82505/thys/Bernoulli/Bernoulli_Zeta.thy">https://bitbucket.org/isa-afp/afp-devel/raw/6e2a1bb82505/thys/Bernoulli/Bernoulli_Zeta.thy</a></p>
<p>There are various fine points of uniform URL support still missing: in<br>
jEdit, in Java standard libraries, in Isabelle/Scala etc.</p>
<p>Moreover, Isabelle/Scala provides some competing abstractions of local<br>
vs. remote SSH.System operations (file access and process execution). At<br>
the bottom it is based on jsch. jEdit has its own virtual file-system<br>
for ssh/sftp on top of jsch. Here are also some attempts to combine jsch<br>
with Java NIO: <a href="https://github.com/lucastheisen/jsch-nio">https://github.com/lucastheisen/jsch-nio</a></p>
<p>Overall, I am not so convinced of the Java platform: things are<br>
generally unfinished and not well thought out. In the past 12 months, I<br>
have even started to think of retargeting Isabelle/Scala onto Node.js as<br>
an alternative to the JVM, by using ScalaJs. It means the abstractions<br>
probably need to be more abstract than standard Java interfaces.</p>
<blockquote>
<p>Use cases I'm thinking of are performing cross-platform in-memory<br>
builds</p>
</blockquote>
<p>Sorry, I do not understand this idea.</p>
<blockquote>
<p>or not having to check out the AFP for including a single<br>
session with dependencies.)</p>
</blockquote>
<p>In principle this could work with a slight refinement of the existing<br>
http support, such that the session directory specifications (option -d)<br>
can be URLs as well. Various fine points are preventing this: e.g. users<br>
still write out generated files occasionally, even though I have tried<br>
to work towards strictly read-only Isabelle session sources in the past<br>
20 years.</p>
<p>On the other hand, a full AFP source tree has only 140 MB + 100 MB for<br>
the hg history. That is relatively little compared to the full Isabelle<br>
installation, and the resulting heap images will easily outweigh the<br>
sources.</p>
<p>So an alternative could be just a fancy download tool for AFP subtrees<br>
within the Prover IDE or on the command-line.</p>
<p>Makarius</p>



<a name="294724160"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724160" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724160">(Aug 22 2022 at 16:31)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;</p>
<blockquote>
<p>There is already some support for that: the PIDE module resources.scala<br>
and its derivatives for the jEdit and VSCode front-end provide some<br>
abstractions over the file-system. Thus Isabelle/PIDE/jEdit can work<br>
over http to some extent. E.g. try this with current Isabelle/b8f30228a55b:</p>
<p>isabelle jedit -l HOL-Analysis<br>
<a href="https://bitbucket.org/isa-afp/afp-devel/raw/6e2a1bb82505/thys/Bernoulli/Bernoulli_Zeta.thy">https://bitbucket.org/isa-afp/afp-devel/raw/6e2a1bb82505/thys/Bernoulli/Bernoulli_Zeta.thy</a></p>
<p>There are various fine points of uniform URL support still missing: in<br>
jEdit, in Java standard libraries, in Isabelle/Scala etc.</p>
</blockquote>
<p>Uniform URL support in Java is already there: Look at NIO2. There are<br>
many different filesystem providers out there (as you are undoubtedly<br>
aware). Unfortunately the knowledge of JSR 203 is still "fresh" in the<br>
community (despite being released in 2011). For HTTP, this one surfaced<br>
after a quick search: &lt;<a href="https://github.com/magicDGS/jsr203-http">https://github.com/magicDGS/jsr203-http</a>&gt;</p>
<blockquote>
<p>Overall, I am not so convinced of the Java platform: things are<br>
generally unfinished and not well thought out.</p>
</blockquote>
<p>A curious thing to say about a battle-tested platform that's been used<br>
in production for a very long time. What precisely is not "well thought<br>
out"? Because NIO definitely is.</p>
<blockquote>
<p>In the past 12 months, I<br>
have even started to think of retargeting Isabelle/Scala onto Node.js as<br>
an alternative to the JVM, by using ScalaJs. It means the abstractions<br>
probably need to be more abstract than standard Java interfaces.</p>
</blockquote>
<p>Scala.js is certainly a possibility. But rest assured that JavaScript as<br>
a platform comes with its own sets of warts and trade-offs. The idea of<br>
running the same code in the browser and on the server is harder to<br>
achieve than how it's advertised.</p>
<blockquote>
<blockquote>
<p>Use cases I'm thinking of are performing cross-platform in-memory<br>
builds</p>
</blockquote>
<p>Sorry, I do not understand this idea.</p>
</blockquote>
<p>On Linux one can just mount a tmpfs and let Isabelle emit heap images<br>
(or whatever it needs) there, but this is not cross-platform.</p>
<blockquote>
<p>So an alternative could be just a fancy download tool for AFP subtrees<br>
within the Prover IDE or on the command-line.</p>
</blockquote>
<p>This already exists. isabellectl has a flag --afp that will<br>
automatically download the AFP (without history), register it in ROOTS,<br>
and starts a jEdit instance. This utilizes the Maven Central<br>
infrastructure. But it still requires unpacking the archive on disk,<br>
which I'd like to avoid for various reasons.</p>



<a name="294724180"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724180" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724180">(Aug 22 2022 at 16:31)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On 15/12/17 17:11, Lars Hupel wrote:</p>
<blockquote>
<p>Uniform URL support in Java is already there: Look at NIO2. There are<br>
many different filesystem providers out there (as you are undoubtedly<br>
aware). Unfortunately the knowledge of JSR 203 is still "fresh" in the<br>
community (despite being released in 2011). For HTTP, this one surfaced<br>
after a quick search: &lt;<a href="https://github.com/magicDGS/jsr203-http">https://github.com/magicDGS/jsr203-http</a>&gt;</p>
</blockquote>
<p>I will take a look at this eventually.</p>
<blockquote>
<blockquote>
<p>Overall, I am not so convinced of the Java platform: things are<br>
generally unfinished and not well thought out.</p>
</blockquote>
<p>A curious thing to say about a battle-tested platform that's been used<br>
in production for a very long time. What precisely is not "well thought<br>
out"? Because NIO definitely is.</p>
</blockquote>
<p>The "Java is great" propaganda has been with us since Java 1.0. After<br>
struggling myself with the platform for 10 years, I don't believe it<br>
anymore. It usually requires hard work and strange tricks to make<br>
existing Java libraries work properly. (That might be also a business<br>
model of that community, but the mainstream is already moving elsewhere.)</p>
<blockquote>
<blockquote>
<p>In the past 12 months, I<br>
have even started to think of retargeting Isabelle/Scala onto Node.js as<br>
an alternative to the JVM, by using ScalaJs. It means the abstractions<br>
probably need to be more abstract than standard Java interfaces.</p>
</blockquote>
<p>Scala.js is certainly a possibility. But rest assured that JavaScript as<br>
a platform comes with its own sets of warts and trade-offs. The idea of<br>
running the same code in the browser and on the server is harder to<br>
achieve than how it's advertised.</p>
</blockquote>
<p>JavaScript and Node.js are definitely crap. As usual the idea is to work<br>
on the intersection of the various platforms, and build a separate<br>
Isabelle edifice on top of the rubble.</p>
<p>Presently this is merely a speculative projection of Isabelle/VSCode<br>
into the future. Isabelle/jEdit and Isabelle/Scala/JVM are not going to<br>
disappear, but the exclusive dependency on the Java universe might come<br>
to an end.</p>
<blockquote>
<p>This already exists. isabellectl has a flag --afp that will<br>
automatically download the AFP (without history), register it in ROOTS,<br>
and starts a jEdit instance. This utilizes the Maven Central<br>
infrastructure. But it still requires unpacking the archive on disk,<br>
which I'd like to avoid for various reasons.</p>
</blockquote>
<p>I was thinking of direct access to <a href="https://bitbucket.org/isa-afp">https://bitbucket.org/isa-afp</a> without<br>
Java artifact stores.</p>
<p>What are the various reasons? Isabelle session builds still require<br>
local file-system storage.</p>
<p>Makarius</p>



<a name="294724232"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724232" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724232">(Aug 22 2022 at 16:31)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;</p>
<blockquote>
<p>I was thinking of direct access to <a href="https://bitbucket.org/isa-afp">https://bitbucket.org/isa-afp</a> without<br>
Java artifact stores.</p>
</blockquote>
<p>That (almost) works, too.</p>
<blockquote>
<p>What are the various reasons? Isabelle session builds still require<br>
local file-system storage.</p>
</blockquote>
<p>This is the reason why I was suggesting earlier on this thread that it<br>
would be convenient if it didn't require the local file system. Mostly<br>
the problem is that supporting platforms like Windows, where symlinking<br>
is hard without administrative privileges, requires a lot of copying<br>
things around.</p>



<a name="294724246"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724246" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724246">(Aug 22 2022 at 16:31)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
At the bottom of all this are Poly/ML heap images. They do require a<br>
regular file-system, and I don't know how to do it differently.</p>
<p>I have occasionally pondered the question if the heap could be a blob<br>
within SQLite or PostgreSQL (without Java getting in between), but David<br>
Matthews is the only one who can possibly do anything here.</p>
<p>Makarius</p>



<a name="294724276"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724276" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724276">(Aug 22 2022 at 16:31)</a>:</h4>
<p>From: David Matthews &lt;<a href="mailto:dm@prolingua.co.uk">dm@prolingua.co.uk</a>&gt;<br>
When a heap image is exported all the ML code is stopped.  That means <br>
that it can't invoke any ML functions to process the bytes.  It might be <br>
able to turn the heap image into a byte vector and return that so that <br>
ML code could process it later.  The problem I can see there is that <br>
this would require more memory and we've already encountered problems <br>
with shortage of memory during heap exports.  Could you not export the <br>
heap to a temporary file, import that into your database and then delete <br>
the temporary file?  Loading a heap image would be the reverse.</p>
<p>David</p>



<a name="294724290"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724290" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724290">(Aug 22 2022 at 16:32)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Yes, if/when I really need the database of heaps. But there are<br>
presently other priorities and no need to change this aspect of Poly/ML.</p>
<p>Makarius</p>



<a name="294724295"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724295" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724295">(Aug 22 2022 at 16:32)</a>:</h4>
<p>From: David Matthews &lt;<a href="mailto:dm@prolingua.co.uk">dm@prolingua.co.uk</a>&gt;<br>
It doesn't require any change to Poly/ML; you can do it now.  The only <br>
complication is with hierarchies of heaps i.e. dependencies such as HOL <br>
on Pure.  In order to load a child you will have to export all its <br>
parents into temporary files and then use PolyML.SaveState.loadHierarchy.</p>
<p>David</p>



<a name="294724385"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724385" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724385">(Aug 22 2022 at 16:32)</a>:</h4>
<p>From: Florian Haftmann &lt;<a href="mailto:florian.haftmann@informatik.tu-muenchen.de">florian.haftmann@informatik.tu-muenchen.de</a>&gt;<br>
See now <a href="http://isabelle.in.tum.de/repos/isabelle/rev/ad538f6c5d2f">http://isabelle.in.tum.de/repos/isabelle/rev/ad538f6c5d2f</a></p>
<p>Cheers,<br>
    Florian<br>
<a href="/user_uploads/14278/jzJAHyTkewzMPnwc-jKbw6UC/signature.asc">signature.asc</a></p>



<a name="294724616"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Bug%20report%3A%20Generated%20Scala%20code%20on%20case-insen.../near/294724616" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Bug.20report.3A.20Generated.20Scala.20code.20on.20case-insen.2E.2E.2E.html#294724616">(Aug 22 2022 at 16:33)</a>:</h4>
<p>From: Florian Haftmann &lt;<a href="mailto:florian.haftmann@informatik.tu-muenchen.de">florian.haftmann@informatik.tu-muenchen.de</a>&gt;<br>
Hi all,</p>
<p>the option »scala_case_sensitive« has indeed been introduced quite<br>
ad-hoc three years ago.</p>
<p>After some thinking about I came to the conclusion that it would be far<br>
better to turn it into an explicit argument to the Scala serializer and<br>
document it accordingly.</p>
<p>I am sceptic about making it the default since case distinction is used<br>
prominently in HOL (e.g. gcd / Gcd) and it would diminish readability<br>
significantly.</p>
<p>Cheers,<br>
    Florian<br>
<a href="/user_uploads/14278/9NBVePA0vD6imvinOAvNqd_0/signature.asc">signature.asc</a></p>



<hr><p>Last updated: Feb 22 2026 at 20:30 UTC</p>
</html>