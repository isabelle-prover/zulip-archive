<html>
<head><meta charset="utf-8"><title>[isabelle] Clone detection for Isabelle theories · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Clone.20detection.20for.20Isabelle.20theories.html">[isabelle] Clone detection for Isabelle theories</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294679123"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Clone%20detection%20for%20Isabelle%20theories/near/294679123" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Clone.20detection.20for.20Isabelle.20theories.html#294679123">(Aug 22 2022 at 13:47)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;<br>
Dear list,</p>
<p>I'd like to announce the availability of a technology preview of code<br>
clone detection for Isabelle theories.</p>
<p>This is the result of a Master's Thesis carried out by Dominik Vinan<br>
under my supervision, with the help of Benjamin Hummel. Benjamin's<br>
company is the vendor of ConQAT, an open-source software quality<br>
assurance toolkit, for which the student has implemented an Isabelle<br>
frontend.</p>
<p>The purpose of code clone detection is simple: to find duplicated<br>
specification or proof fragments in Isabelle theories.</p>
<p>I will present the tool and its accompanying paper at the Isabelle<br>
Workshop in Nancy, but it is already possible to download and use it:</p>
<p>Paper<br>
  &lt;<a href="http://www.in.tum.de/~nipkow/Isabelle2016/Isabelle2016_9.pdf">http://www.in.tum.de/~nipkow/Isabelle2016/Isabelle2016_9.pdf</a>&gt;</p>
<p>ConQAT+Isabelle bundle</p>
<p>&lt;<a href="https://www21.in.tum.de/~hupel/downloads/isabelle-clones/isabelle-clones-preview.zip">https://www21.in.tum.de/~hupel/downloads/isabelle-clones/isabelle-clones-preview.zip</a>&gt;</p>
<p>The bundle should contain all instructions for feeding theories into<br>
ConQAT. It should work on macOS and Linux (no guarantees for Windows).<br>
The result is an HTML report of detected clones which can be viewed in<br>
the browser.</p>
<p>If you try it out, please report any problems (or that you didn't have<br>
problems) to me via mail so that the student and me can iron out bugs<br>
before ITP.</p>
<p>Cheers<br>
Lars</p>



<a name="294679177"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Clone%20detection%20for%20Isabelle%20theories/near/294679177" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Clone.20detection.20for.20Isabelle.20theories.html#294679177">(Aug 22 2022 at 13:47)</a>:</h4>
<p>From: Johannes Waldmann &lt;<a href="mailto:johannes.waldmann@htwk-leipzig.de">johannes.waldmann@htwk-leipzig.de</a>&gt;<br>
Interesting.</p>
<p>As far as I understood from the paper,<br>
you are parsing source code with libisabelle,<br>
which in turn requires a full Isabelle installation.<br>
(Then - is parsing safe? Or is there danger of<br>
code injection?)</p>
<p>I'd hope there is something like Language.Isabelle,<br>
(just AST data type and parser - no semantics). cf.<br>
<a href="https://hackage.haskell.org/package/haskell-src-exts">https://hackage.haskell.org/package/haskell-src-exts</a><br>
<a href="https://hackage.haskell.org/package/language-javascript">https://hackage.haskell.org/package/language-javascript</a></p>
<p>very hypothetically - is there a formal Isabelle(Isar) grammar<br>
from which AST representation and parser/printer (in Haskell)<br>
could be generated (mostly) automatically?</p>
<p>Best regards, J. Waldmann.</p>



<a name="294679193"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Clone%20detection%20for%20Isabelle%20theories/near/294679193" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Clone.20detection.20for.20Isabelle.20theories.html#294679193">(Aug 22 2022 at 13:48)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;<br>
Hi Johannes,</p>
<blockquote>
<p>As far as I understood from the paper,<br>
you are parsing source code with libisabelle,<br>
which in turn requires a full Isabelle installation.<br>
(Then - is parsing safe? Or is there danger of<br>
code injection?)</p>
</blockquote>
<p>no, it is unsafe; yes, there is danger of code injection. Loading<br>
Isabelle theories with libisabelle is equivalent to loading them into<br>
Isabelle/jEdit.</p>
<blockquote>
<p>very hypothetically - is there a formal Isabelle(Isar) grammar<br>
from which AST representation and parser/printer (in Haskell)<br>
could be generated (mostly) automatically?</p>
</blockquote>
<p>To quote the paper:</p>
<p>"Isabelle/Isar is the surface syntax for Isabelle theories. Because it<br>
is user-extensible, it is impossible to parse statically."</p>
<p>Due to the presence of arbitrarily complicated parse translations (inner<br>
syntax) and syntax parsers (outer syntax) written in ML the syntactic<br>
analysis of Isar is equivalent to the halting problem. In that sense<br>
Isar is very much like Perl.</p>
<p>Cheers<br>
Lars</p>



<a name="294679245"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Clone%20detection%20for%20Isabelle%20theories/near/294679245" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Clone.20detection.20for.20Isabelle.20theories.html#294679245">(Aug 22 2022 at 13:48)</a>:</h4>
<p>From: Johannes Waldmann &lt;<a href="mailto:johannes.waldmann@htwk-leipzig.de">johannes.waldmann@htwk-leipzig.de</a>&gt;<br>
Hi.</p>
<p>Quoting out of context, on purpose:</p>
<blockquote>
<p>... Isar is very much like Perl.</p>
</blockquote>
<p>Great! Use this for advertising.<br>
Should open up a whole new population of users ...</p>
<p>User-defined syntax is perhaps<br>
more a matter of readability<br>
(I guess it's mostly about operator precedences,<br>
and a few special forms - unless you actively abuse it).<br>
But code injection really scares me.</p>
<p>Mind you, Haskell is scary too, because I can do</p>
<p>{-# language TemplateHaskell #-}<br>
import Language.Haskell.TH<br>
$(runIO (print 42) &gt;&gt; return [])<br>
main = return ()</p>
<p>which will do IO during compilation.</p>
<p>But that needs the language pragma to be present<br>
(at the start of the file)<br>
and I can call ghc (the compiler) with "-XSafe"<br>
and it will reject such code outright.</p>
<p>This "safe Haskell" is a recent addition<br>
to the language (well, to GHC actually).<br>
<a href="https://ghc.haskell.org/trac/ghc/wiki/SafeHaskell">https://ghc.haskell.org/trac/ghc/wiki/SafeHaskell</a></p>
<p>I wonder why Isabelle plans to abandon<br>
its "safe" flag (as Lars mentioned in<br>
<a href="https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2016-July/msg00034.html">https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2016-July/msg00034.html</a><br>
)</p>
<p>Best regards, Johannes.</p>



<a name="294679268"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Clone%20detection%20for%20Isabelle%20theories/near/294679268" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Clone.20detection.20for.20Isabelle.20theories.html#294679268">(Aug 22 2022 at 13:48)</a>:</h4>
<p>From: Manuel Eberl &lt;<a href="mailto:eberlm@in.tum.de">eberlm@in.tum.de</a>&gt;</p>
<blockquote>
<p>But that needs the language pragma to be present<br>
(at the start of the file)<br>
and I can call ghc (the compiler) with "-XSafe"<br>
and it will reject such code outright.</p>
</blockquote>
<p>From the Haskell documentation:</p>
<blockquote>
<p>‘Safe Haskell, however, does not offer compilation safety. During <br>
compilation time it is possible for arbitrary processes to be <br>
launched, using for example the custom pre-processor flag. This can be <br>
manipulated to either compromise a users system at compilation time, <br>
or to modify the source code just before compilation to try to alter <br>
set Safe Haskell flags.’</p>
</blockquote>
<p>Also, I don't recall the details, but I think there were some problems <br>
with Safe Haskell in the past. If you want to be (more) sure, you <br>
probably still have to sandbox compilation and execution on the OS level.</p>
<blockquote>
<p>I wonder why Isabelle plans to abandon<br>
its "safe" flag (as Lars mentioned in<br>
<a href="https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2016-July/msg00034.html">https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2016-July/msg00034.html</a><br>
)<br>
First of all, the ability to write custom tactics in ML is an integral <br>
part of Isabelle. Preventing people from doing that is too immense a <br>
restriction for it to be a useful feature in pretty much any context <br>
except course homework (where writing tactics is usually not done – <br>
although I did in fact do that for one of my homework submissions to <br>
make my life easier).</p>
</blockquote>
<p>Secondly, if I recall, Isabelle's ‘safe’ mode isn't actually very safe. <br>
I don't know what it prevents and what it does not prevent, but even <br>
without the ability to embed arbitrary ML code, you can do all kinds of <br>
nasty things with code generation and the ‘value’ command. Isabelle is a <br>
huge system and as far as I am aware, none of it was ever designed with <br>
a ‘malicious’ user in mind.</p>
<p>I guess if one were to go over the entire code base of Isabelle with the <br>
express intent of finding possible security problems and then ensuring <br>
that all of these are disallowed in the safe mode could result in a <br>
version of Isabelle that provides a reasonable amount of confidence in <br>
its safety, but that would be a big endeavour and the only real use case <br>
would be automatic homework processing.</p>
<p>Considering that you can do the same thing with considerably less <br>
effort, no restrictions imposed on the expressivity of Isabelle, and <br>
with much better confidence in the safety of the approach by using <br>
sandboxes/containers, I don't think there is any reason to invest time <br>
and energy into a ‘safe mode’.</p>
<p>Cheers,</p>
<p>Manuel</p>



<a name="294679278"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Clone%20detection%20for%20Isabelle%20theories/near/294679278" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Clone.20detection.20for.20Isabelle.20theories.html#294679278">(Aug 22 2022 at 13:48)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;</p>
<blockquote>
<blockquote>
<p>... Isar is very much like Perl.</p>
</blockquote>
<p>Great! Use this for advertising.<br>
Should open up a whole new population of users ...</p>
</blockquote>
<p>This was on purpose ;-)</p>
<blockquote>
<p>User-defined syntax is perhaps<br>
more a matter of readability<br>
(I guess it's mostly about operator precedences,<br>
and a few special forms - unless you actively abuse it).<br>
But code injection really scares me.</p>
</blockquote>
<p>I think your mental model of Isabelle is slightly off. There's no point<br>
in discussing the design decisions made decades ago when we're really<br>
discussing how clone detection works with the system we have right now.</p>
<p>To rephrase: Isabelle has arbitrary user-extensible syntax and it has<br>
arbitrary executable ML code. If you want to do realistic syntax<br>
analysis today you have to accept that.</p>
<p>I'm not saying that in the future there couldn't be some other<br>
mechanism. But it is what it is right now.</p>
<blockquote>
<p>I wonder why Isabelle plans to abandon<br>
its "safe" flag (as Lars mentioned in<br>
<a href="https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2016-July/msg00034.html">https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2016-July/msg00034.html</a><br>
)</p>
</blockquote>
<p>There are no plans to abandon it. It has already been abandoned.</p>
<p>But the reasoning goes as follows: Many people understand many different<br>
things about what "secure mode" is supposed to mean. The fact that it<br>
won't run custom ML code means neither that</p>
<p>a) malicious users are prevented from tricking the system into accepting<br>
theorems which are not actually proven (e.g. by using axiomatization)</p>
<p>b) malicious users are prevented from affecting the operating system or<br>
the machine running Isabelle</p>
<p>But it means that many legitimate things (e.g. custom tactics, loading<br>
AFP libraries which contain ML code) are impossible.</p>
<p>Because of that it wasn't really useful to begin with. Having a "secure"<br>
flag which doesn't actually protect anything is worse than having no<br>
flag at all.</p>
<p>Again, in the future, there could be different mechanisms. But before<br>
doing so we actually need to come up with a solid threat model and a<br>
specification on what "secure" should mean.</p>
<p>Cheers<br>
Lars</p>



<a name="294679292"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Clone%20detection%20for%20Isabelle%20theories/near/294679292" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Clone.20detection.20for.20Isabelle.20theories.html#294679292">(Aug 22 2022 at 13:48)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;<br>
Sorry, that probably came off harsher than intended. I was trying to say<br>
that Isabelle supports all these things today and there is no reliable<br>
way to turn them off.</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>