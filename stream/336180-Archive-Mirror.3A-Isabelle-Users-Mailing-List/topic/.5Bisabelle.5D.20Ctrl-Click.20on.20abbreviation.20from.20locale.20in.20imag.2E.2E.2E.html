<html>
<head><meta charset="utf-8"><title>[isabelle] Ctrl-Click on abbreviation from locale in imag... · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Ctrl-Click.20on.20abbreviation.20from.20locale.20in.20imag.2E.2E.2E.html">[isabelle] Ctrl-Click on abbreviation from locale in imag...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294262142"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Ctrl-Click%20on%20abbreviation%20from%20locale%20in%20imag.../near/294262142" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Ctrl-Click.20on.20abbreviation.20from.20locale.20in.20imag.2E.2E.2E.html#294262142">(Aug 19 2022 at 13:12)</a>:</h4>
<p>From: Andreas Lochbihler &lt;<a href="mailto:andreas.lochbihler@inf.ethz.ch">andreas.lochbihler@inf.ethz.ch</a>&gt;<br>
Dear Makarius,</p>
<p>I noticed that when I open a locale that has been defined in the image of the session and <br>
Ctrl-Click on an identifer which refers to an abbreviation in that locale, then <br>
Isabelle/jEdit jumps to the begin of the context block. I would have expected that it <br>
jumps to the declaration of the abbreviation as it does for definitions. Here's a MWE for <br>
Isabelle2013-1:</p>
<p>theory Scratch imports Main begin<br>
(<em>1</em>)context partial_function_definitions begin<br>
term "fixp_fun"<br>
end<br>
end</p>
<p>Ctrl-Click on fixp_fun jumps to (<em>1</em>), but I would prefer line 130 of Partial_Function.thy.</p>
<p>Andreas</p>



<a name="294262153"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Ctrl-Click%20on%20abbreviation%20from%20locale%20in%20imag.../near/294262153" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Ctrl-Click.20on.20abbreviation.20from.20locale.20in.20imag.2E.2E.2E.html#294262153">(Aug 19 2022 at 13:12)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
This is a general shortcoming due to the way how formal entities and their <br>
positions are managed internally.  I have been aware of it when I <br>
introduced the concept some years ago, even before a usable Prover IDE <br>
front-end was available. Similar inconveniences happen when declarations <br>
and attributed fact expressions are processed in various situations of <br>
local context.</p>
<p>Further refinement of this area needs to be postponed until more serious <br>
problems are solved.</p>
<p>You are mentioning Isabelle2013-1 above.  Can you also give quick try to <br>
<a href="http://isabelle.in.tum.de/website-Isabelle2013-2-RC3/">http://isabelle.in.tum.de/website-Isabelle2013-2-RC3/</a> ?  There are at <br>
least 24h more time, before I consider making the final snapshot for <br>
Isabelle2013-2.</p>
<p>Isabelle2013-1 did not work out so well, due to too few people putting <br>
hard measures of testing on it.  You are the expert on getting to the <br>
limits of what is possible and what not ...</p>
<p>Makarius</p>



<a name="294262253"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Ctrl-Click%20on%20abbreviation%20from%20locale%20in%20imag.../near/294262253" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Ctrl-Click.20on.20abbreviation.20from.20locale.20in.20imag.2E.2E.2E.html#294262253">(Aug 19 2022 at 13:13)</a>:</h4>
<p>From: Andreas Lochbihler &lt;<a href="mailto:andreas.lochbihler@inf.ethz.ch">andreas.lochbihler@inf.ethz.ch</a>&gt;<br>
Dear Makarius,</p>
<blockquote>
<p>You are mentioning Isabelle2013-1 above.  Can you also give quick try to<br>
<a href="http://isabelle.in.tum.de/website-Isabelle2013-2-RC3/">http://isabelle.in.tum.de/website-Isabelle2013-2-RC3/</a> ?  There are at least 24h more time,<br>
before I consider making the final snapshot for Isabelle2013-2.<br>
At the moment, I am hooked on the repository version, I have simply checked that the same <br>
behaviour also occurs with Isabelle2013-1. But I'll see whether I find some time tomorrow <br>
to give it a try.</p>
</blockquote>
<blockquote>
<p>Isabelle2013-1 did not work out so well, due to too few people putting hard measures of<br>
testing on it.<br>
Well, I did test Isabelle2013-1-RC* over several weeks, but mostly ProofGeneral.</p>
</blockquote>
<blockquote>
<p>You are the expert on getting to the limits of what is possible and what not ...<br>
Well, but I only hit the limits during my normal work; a quick check usually does not take <br>
me there.</p>
</blockquote>
<p>Andreas</p>



<a name="294262271"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Ctrl-Click%20on%20abbreviation%20from%20locale%20in%20imag.../near/294262271" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Ctrl-Click.20on.20abbreviation.20from.20locale.20in.20imag.2E.2E.2E.html#294262271">(Aug 19 2022 at 13:13)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
There were various changes for Isabelle2013-2 that affect interaction and <br>
process management in general: TTY, Proof General, PIDE document editing. <br>
So it is important to see if it still works for you.</p>
<p>Makarius</p>



<a name="294262425"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Ctrl-Click%20on%20abbreviation%20from%20locale%20in%20imag.../near/294262425" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Ctrl-Click.20on.20abbreviation.20from.20locale.20in.20imag.2E.2E.2E.html#294262425">(Aug 19 2022 at 13:14)</a>:</h4>
<p>From: Andreas Lochbihler &lt;<a href="mailto:andreas.lochbihler@inf.ethz.ch">andreas.lochbihler@inf.ethz.ch</a>&gt;<br>
Dear Makarius,</p>
<p>I quickly testes Isabelle2013-2-RC3 with XEmacs and ProofGeneral 3.7.1.1 and in terms of <br>
UI, everything seems to work as good as it did before (I am already used to the problem <br>
that interruptions sometimes get PG out of sync with Isabelle and I have to retract the <br>
theory or restart Isabelle, but this does not seem to happen more often than with <br>
Isabelle2013).</p>
<p>However, something else no longer works in Isabelle2013-2-RC3 although it worked in <br>
Isabelle2013-1. I have written a small script that compiles generated code and executes it <br>
to test whether my code generator setup works. So far, I used the following:</p>
<p>ML {*<br>
fun using_master_directory thy p =<br>
   p<br>
   |&gt; Path.explode<br>
   |&gt; Path.append (Thy_Load.master_directory thy)<br>
   |&gt; Path.append (File.pwd ())<br>
   |&gt; Path.implode</p>
<p>fun compile thy script_name params =<br>
   let<br>
     val script = using_master_directory thy script_name;<br>
     val (output, exit) = Isabelle_System.bash_output (script ^ " " ^ params)<br>
   in<br>
     if exit = 0 then () else<br>
       error ("Compile test failed for " ^ script_name ^ " and " ^ params ^<br>
              ".\nreturn code: " ^ Int.toString exit ^ "\noutput:\n" ^ output)<br>
   end</p>
<p>fun run thy program expected =<br>
   let<br>
     val prog = "cd " ^ using_master_directory thy "." ^ "; " ^ program<br>
     val (output, exit) = Isabelle_System.bash_output prog<br>
   in<br>
     if exit = 0 andalso output = expected then () else<br>
       error ("Execution failed for " ^ program ^ "\nreturn code: " ^ Int.toString exit ^<br>
              "\nexpected output:\n" ^ expected ^ "\nactual output:\n" ^ output)<br>
   end<br>
*}</p>
<p>export_code run_hello_world same in SML file "SML/hello_world.ML"<br>
ML {*<br>
   compile @{theory} "SML/build.sh" "SML/hello_world StdIO_Ex.run_hello_world";<br>
   run @{theory} "SML/hello_world" "Hello world!\n";<br>
*}</p>
<p>where the script SML/build.sh looks as follows (it creates a test driver for the exported <br>
code, compiles it with polyml and cc to produce a stand-alone executable, such that the <br>
run function can then execute it.</p>
<p>#! /bin/bash<br>
POLYHOME=~/.isabelle/contrib/polyml-5.5.0-3/x86_64-linux/<br>
POLYLIB=${POLYHOME}</p>
<p>BUILD=$1_build.ML<br>
cp $1.ML $BUILD<br>
echo "PolyML.export (\"$1\", $2);" &gt;&gt; $BUILD<br>
cat $BUILD | $POLYHOME/polyml<br>
ret_code=$?<br>
if [ ${ret_code} == 0 ]; then<br>
   LD_RUN_PATH=${POLYLIB}:${LD_RUN_PATH} cc -ggdb -o $1 -L${POLYLIB} -lpolymain -lpolyml $1.o<br>
   ret_code=$?<br>
fi<br>
rm $BUILD $1.o<br>
exit ${ret_code}</p>
<p>In Isabelle2013-1, this worked fine, but in Isabelle2013-2-RC3, I always get a return code <br>
of 1 (instead of 0) form <a href="http://build.sh">build.sh</a> even though it returns 0 when I execute it from my <br>
command line shell. Do you know what goes wrong here and what I have to adapt?</p>
<p>Andreas</p>



<a name="294262443"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Ctrl-Click%20on%20abbreviation%20from%20locale%20in%20imag.../near/294262443" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Ctrl-Click.20on.20abbreviation.20from.20locale.20in.20imag.2E.2E.2E.html#294262443">(Aug 19 2022 at 13:14)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On Thu, 5 Dec 2013, Andreas Lochbihler wrote:</p>
<blockquote>
<p>However, something else no longer works in Isabelle2013-2-RC3 although it <br>
worked in Isabelle2013-1. I have written a small script that compiles <br>
generated code and executes it to test whether my code generator setup works. <br>
So far, I used the following:</p>
<p>ML {*<br>
fun using_master_directory thy p =<br>
 p<br>
 |&gt; Path.explode<br>
 |&gt; Path.append (Thy_Load.master_directory thy)<br>
 |&gt; Path.append (File.pwd ())<br>
 |&gt; Path.implode</p>
<p>fun compile thy script_name params =<br>
 let<br>
   val script = using_master_directory thy script_name;<br>
   val (output, exit) = Isabelle_System.bash_output (script ^ " " ^ params)<br>
 in<br>
   if exit = 0 then () else<br>
     error ("Compile test failed for " ^ script_name ^ " and " ^ params ^<br>
            ".\nreturn code: " ^ Int.toString exit ^ "\noutput:\n" ^ output)<br>
 end</p>
<p>fun run thy program expected =<br>
 let<br>
   val prog = "cd " ^ using_master_directory thy "." ^ "; " ^ program<br>
   val (output, exit) = Isabelle_System.bash_output prog<br>
 in<br>
   if exit = 0 andalso output = expected then () else<br>
     error ("Execution failed for " ^ program ^ "\nreturn code: " ^ <br>
Int.toString exit ^<br>
            "\nexpected output:\n" ^ expected ^ "\nactual output:\n" ^ <br>
output)<br>
 end<br>
*}</p>
<p>export_code run_hello_world same in SML file "SML/hello_world.ML"<br>
ML {*<br>
 compile @{theory} "SML/build.sh" "SML/hello_world <br>
StdIO_Ex.run_hello_world";<br>
 run @{theory} "SML/hello_world" "Hello world!\n";<br>
*}</p>
</blockquote>
<p>There seem to be some parts missing to run the example, e.g. <br>
run_hello_world.  Do I need this?</p>
<blockquote>
<p>where the script SML/build.sh looks as follows (it creates a test driver for <br>
the exported code, compiles it with polyml and cc to produce a stand-alone <br>
executable, such that the run function can then execute it.</p>
<p>#! /bin/bash<br>
POLYHOME=~/.isabelle/contrib/polyml-5.5.0-3/x86_64-linux/<br>
POLYLIB=${POLYHOME}</p>
<p>BUILD=$1_build.ML<br>
cp $1.ML $BUILD<br>
echo "PolyML.export (\"$1\", $2);" &gt;&gt; $BUILD<br>
cat $BUILD | $POLYHOME/polyml<br>
ret_code=$?<br>
if [ ${ret_code} == 0 ]; then<br>
 LD_RUN_PATH=${POLYLIB}:${LD_RUN_PATH} cc -ggdb -o $1 -L${POLYLIB} <br>
-lpolymain -lpolyml $1.o<br>
 ret_code=$?<br>
fi<br>
rm $BUILD $1.o<br>
exit ${ret_code}</p>
<p>In Isabelle2013-1, this worked fine, but in Isabelle2013-2-RC3, I always <br>
get a return code of 1 (instead of 0) form <a href="http://build.sh">build.sh</a> even though it <br>
returns 0 when I execute it from my command line shell. Do you know what <br>
goes wrong here and what I have to adapt?</p>
</blockquote>
<p>The script makes many assumptions about the particular operating system <br>
environment.  I did not manage to run it myself yet.</p>
<p>Maybe there is just some confusion about LD_RUN_PATH vs. LD_LIBRARY_PATH, <br>
which is changed when the Isabelle process is run. With "set -x" in the <br>
script you should see in the output what actually fails.</p>
<p>Depending on $ISABELLE_HOME_USER/etc/settings you may get different <br>
Poly/ML versions, also x86 vs. x86_64, that might cause a conflict with <br>
the one used above for batch compilation.  Note that official releases <br>
have disjoint $ISABELLE_HOME_USER directories, so there could be some of <br>
your settings missing.</p>
<p>Looking also at the history diff of Isabelle2013-1 vs. Isabelle2013-2-RC3, <br>
the only change is related to shell command invocation is this: <br>
<a href="https://bitbucket.org/isabelle_project/isabelle-release/commits/d71e7908eec3">https://bitbucket.org/isabelle_project/isabelle-release/commits/d71e7908eec3</a> <br>
It should only affect the signalling, though, not any return codes.</p>
<p>Makarius</p>



<a name="294262454"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Ctrl-Click%20on%20abbreviation%20from%20locale%20in%20imag.../near/294262454" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Ctrl-Click.20on.20abbreviation.20from.20locale.20in.20imag.2E.2E.2E.html#294262454">(Aug 19 2022 at 13:14)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
After some more tinkering with the script, it somehow works for me with <br>
polyml-5.5.0-3, using the following in $ISABELLE_HOME_USER/etc/settings:</p>
<p>ML_PLATFORM=x86_64-linux<br>
ML_HOME="$HOME/.isabelle/contrib/polyml-5.5.0-3/$ML_PLATFORM"<br>
ML_SYSTEM=polyml-5.5.0<br>
ML_OPTIONS="-H 1000 --gcthreads 4"<br>
ML_SOURCES="$ML_HOME/../src"</p>
<p>I've run the <a href="http://build.sh">build.sh</a> either via "isabelle env ..." in the shell or via<br>
ML {* Isabelle_System.bash ...*}, which should provide the same process <br>
environment in both situations.</p>
<p>Note that David Matthews changed the ways of Poly/ML batch compilation in <br>
Poly/ML 5.5.1, which is bundled with Isabelle2013-1 and Isabelle2013-2 <br>
(uniformly for all release candidates).  The new polyc script might <br>
actually help to make this more robust.</p>
<p>For now, I merely need a confirmation that the issues is just one of local <br>
settings, not due to any change in the long chain of release candidates.</p>
<p>Makarius<br>
<a href="/user_uploads/14278/CEYz03-vuRvx8v6BxsZu6jeu/build.sh">build.sh</a></p>



<a name="294262464"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Ctrl-Click%20on%20abbreviation%20from%20locale%20in%20imag.../near/294262464" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Ctrl-Click.20on.20abbreviation.20from.20locale.20in.20imag.2E.2E.2E.html#294262464">(Aug 19 2022 at 13:14)</a>:</h4>
<p>From: Andreas Lochbihler &lt;<a href="mailto:andreas.lochbihler@inf.ethz.ch">andreas.lochbihler@inf.ethz.ch</a>&gt;<br>
Hi Makarius,</p>
<blockquote>
<p>There seem to be some parts missing to run the example, e.g. run_hello_world.  Do I need<br>
this?<br>
No, I just sent you the (partial) source code to see whether you have a quick idea what <br>
might be going wrong. A fully working example would have been a rather large attachment.</p>
</blockquote>
<blockquote>
<p>The script makes many assumptions about the particular operating system environment.  I<br>
did not manage to run it myself yet.<br>
I know that it is just a crude hack, but I have not yet had the time to develop an <br>
interoperable, proper solution. It would be great if Isabelle had some support to actually <br>
compile and execute generated code. "export_code ... checking SML Haskell Scala OCaml" is <br>
already great, but it checks only syntactic correctness of the generated code.</p>
</blockquote>
<p>I will keep on refining my attempt until some day it is maybe mature enough to be usable <br>
by others, too.</p>
<blockquote>
<p>Maybe there is just some confusion about LD_RUN_PATH vs. LD_LIBRARY_PATH, which is changed<br>
when the Isabelle process is run. With "set -x" in the script you should see in the output<br>
what actually fails.<br>
Thanks for the hint with "set -x". That made me realise that the build script expects to <br>
be run in the directory of the theory, but the function compile did not ensure this. <br>
Apparently, I had started the Isabelle sessions from different directories and that caused <br>
the difference between Isabelle2013-1 and Isabelle2013-2-RC3.</p>
</blockquote>
<p>Andreas</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>