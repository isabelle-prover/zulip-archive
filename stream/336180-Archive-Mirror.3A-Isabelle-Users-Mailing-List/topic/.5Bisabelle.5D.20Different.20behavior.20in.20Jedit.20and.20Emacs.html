<html>
<head><meta charset="utf-8"><title>[isabelle] Different behavior in Jedit and Emacs · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Different.20behavior.20in.20Jedit.20and.20Emacs.html">[isabelle] Different behavior in Jedit and Emacs</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294150346"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Different%20behavior%20in%20Jedit%20and%20Emacs/near/294150346" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Different.20behavior.20in.20Jedit.20and.20Emacs.html#294150346">(Aug 18 2022 at 18:58)</a>:</h4>
<p>From: Björn Bartels &lt;<a href="mailto:bbartels@cs.tu-berlin.de">bbartels@cs.tu-berlin.de</a>&gt;<br>
Hi all,<br>
we just came across  the following problem when using the datatype command. The following datatype definition works when using Jedit but does not work when using Emacs as interface. In the previous distribution the example used to work with Emacs as well.</p>
<p>theory test<br>
imports Main<br>
begin</p>
<p>datatype 'a tree =<br>
           leaf "'a"<br>
         | node "nat \&lt;Rightarrow&gt; 'a tree"        </p>
<p>datatype 'a dtype  = constr "'a tree"</p>
<p>end</p>
<p>When using Emacs, we get the following error message:</p>
<p>*** Proof failed.<br>
*** dtype_size fa (constr tree) = 0<br>
***  1. Suc 0 = 0<br>
*** 1 unsolved goal(s)!<br>
*** The error(s) above occurred for the goal statement:<br>
*** dtype_size fa (constr tree) = 0</p>
<p>Thanks for any suggestions!</p>



<a name="294150375"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Different%20behavior%20in%20Jedit%20and%20Emacs/near/294150375" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Different.20behavior.20in.20Jedit.20and.20Emacs.html#294150375">(Aug 18 2022 at 18:58)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
Just as another data point: I tried the development version with emacs<br>
and it works.</p>
<p>Tobias</p>



<a name="294150403"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Different%20behavior%20in%20Jedit%20and%20Emacs/near/294150403" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Different.20behavior.20in.20Jedit.20and.20Emacs.html#294150403">(Aug 18 2022 at 18:58)</a>:</h4>
<p>From: Lukas Bulwahn &lt;<a href="mailto:bulwahn@in.tum.de">bulwahn@in.tum.de</a>&gt;<br>
I tried it myself as well on the development version (changeset <br>
693d8d7bc3cd - the current tip):<br>
It works if you switch on quick_and_dirty, but it fails if you switch it <br>
off.</p>
<p>This succeeds:</p>
<p>ML {* quick_and_dirty := true *}<br>
datatype 'a dtype  = constr "'a tree"</p>
<p>But this fails:</p>
<p>ML {* quick_and_dirty := false *}<br>
datatype 'a dtype  = constr "'a tree"</p>
<p>Just a short explanation, why this differs:<br>
In quick-and-dirty mode, we actually skip proofs, which are <br>
automatically generated by packages, and just provide the theorems<br>
without proof.<br>
Switching it off, the package will actually perform the proof, but in <br>
the case mentioned here, this proof method fails.</p>
<p>It seems that your default settings actually differ on the two <br>
interfaces, JEdit and Emacs.</p>
<p>We will have to investigate why the proof method actually breaks down in <br>
this case.</p>
<p>Lukas</p>



<a name="294150416"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Different%20behavior%20in%20Jedit%20and%20Emacs/near/294150416" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Different.20behavior.20in.20Jedit.20and.20Emacs.html#294150416">(Aug 18 2022 at 18:58)</a>:</h4>
<p>From: Brian Huffman &lt;<a href="mailto:huffman@in.tum.de">huffman@in.tum.de</a>&gt;<br>
Congratulations Björn, you've found a soundness bug in the datatype<br>
package! At least in quick and dirty mode, the datatype package<br>
generates some unproven "theorems" that are contradictory. Here's a<br>
proof of False that works if you are in quick and dirty mode:</p>
<p>datatype 'a tree = leaf "'a" | node "nat =&gt; 'a tree"<br>
datatype 'a dtype  = constr "'a tree"</p>
<p>lemma "False"<br>
proof -<br>
  have "dtype_size fa (constr tree) = Suc 0"<br>
    unfolding dtype_size_def by simp<br>
  also have "dtype_size fa (constr tree) = 0"<br>
    by (rule dtype.size(1))<br>
  finally show "False"<br>
    by simp<br>
qed</p>
<p>This is a good reminder why quick and dirty mode is a bad idea. We<br>
should definitely make sure that the default is set to "off" in all<br>
future releases, for both ProofGeneral and jEdit.</p>
<ul>
<li>Brian</li>
</ul>



<a name="294150439"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Different%20behavior%20in%20Jedit%20and%20Emacs/near/294150439" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Different.20behavior.20in.20Jedit.20and.20Emacs.html#294150439">(Aug 18 2022 at 18:58)</a>:</h4>
<p>From: Lukas Bulwahn &lt;<a href="mailto:bulwahn@in.tum.de">bulwahn@in.tum.de</a>&gt;<br>
On changeset 693d8d7bc3cd, the issue is somehow hidden in the different <br>
conditions (if null ts ...) of these two source code positions below.</p>
<p>Maybe, one of two authors of this file could take a closer look at this <br>
point.</p>
<p>Lukas</p>
<p>diff -r 693d8d7bc3cd src/HOL/Tools/Function/size.ML<br>
--- a/src/HOL/Tools/Function/size.ML    Fri Jan 20 09:28:54 2012 +0100<br>
+++ b/src/HOL/Tools/Function/size.ML    Fri Jan 20 17:47:23 2012 +0100<br>
@@ -105,7 +105,7 @@<br>
               else us, i, j + 1))<br>
                (cargs <del> cargs' </del> Ts) ([], 0, k);<br>
          val t =</p>
<ul>
<li>
<p>if null ts andalso (not b orelse not (exists (is_poly thy) <br>
cargs'))</p>
</li>
<li>
<p>if null ts andalso (not b orelse not (exists (is_poly thy) <br>
cargs'))<br>
            then <a href="http://HOLogic.zero">HOLogic.zero</a><br>
            else foldl1 plus (ts @ [HOLogic.Suc_zero])<br>
        in<br>
@@ -182,7 +182,7 @@<br>
          HOLogic.mk_Trueprop (HOLogic.mk_eq<br>
            (size_const $ list_comb (Const (cname, Ts ---&gt; T),<br>
               map2 (curry Free) tnames Ts),</p>
</li>
<li>
<p>if null ts then <a href="http://HOLogic.zero">HOLogic.zero</a></p>
</li>
<li>if null ts then <a href="http://HOLogic.zero">HOLogic.zero</a><br>
             else foldl1 plus (ts @ [HOLogic.Suc_zero])))<br>
        end;</li>
</ul>



<a name="294150440"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Different%20behavior%20in%20Jedit%20and%20Emacs/near/294150440" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Different.20behavior.20in.20Jedit.20and.20Emacs.html#294150440">(Aug 18 2022 at 18:58)</a>:</h4>
<p>From: Peter Gammie &lt;<a href="mailto:peteg42@gmail.com">peteg42@gmail.com</a>&gt;<br>
"sorry" only works if quick and dirty is switched on. I use that a lot when developing a proof interactively, as I expect everyone does.</p>
<p>cheers<br>
peter</p>



<a name="294150465"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Different%20behavior%20in%20Jedit%20and%20Emacs/near/294150465" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Different.20behavior.20in.20Jedit.20and.20Emacs.html#294150465">(Aug 18 2022 at 18:58)</a>:</h4>
<p>From: Brian Huffman &lt;<a href="mailto:huffman@in.tum.de">huffman@in.tum.de</a>&gt;<br>
Actually, you can use "sorry" in ProofGeneral even with<br>
quick-and-dirty mode switched off, if you manually step through the<br>
file(s) containing "sorry".</p>
<p>You only get the "Cheating requires quick_and_dirty mode!" error if an<br>
import statement causes Isabelle to load a theory file containing<br>
"sorry". The workaround is to pre-load any offending files<br>
individually.</p>
<p>Of course, if you have a large collection of interconnected theories,<br>
and you use "sorry" in many different files, this might be a pain. But<br>
in that case, you are always free to turn quick-and-dirty mode back<br>
on, at your own risk!</p>
<ul>
<li>Brian</li>
</ul>



<a name="294150501"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Different%20behavior%20in%20Jedit%20and%20Emacs/near/294150501" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Different.20behavior.20in.20Jedit.20and.20Emacs.html#294150501">(Aug 18 2022 at 18:59)</a>:</h4>
<p>From: Stefan Berghofer &lt;<a href="mailto:berghofe@in.tum.de">berghofe@in.tum.de</a>&gt;<br>
Björn Bartels wrote:</p>
<blockquote>
<p>Hi all,<br>
we just came across  the following problem when using the datatype command. The following datatype definition works when using Jedit but does not work when using Emacs as interface. In the previous distribution the example used to work with Emacs as well.</p>
</blockquote>
<p>Hi Björn,</p>
<p>thanks for reporting this. The problem has now been fixed in the current<br>
repository version of Isabelle, see</p>
<p><a href="http://isabelle.in.tum.de/repos/isabelle/rev/fd21bbcbe61b">http://isabelle.in.tum.de/repos/isabelle/rev/fd21bbcbe61b</a></p>
<p>Greetings,<br>
Stefan</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>