<html>
<head><meta charset="utf-8"><title>[isabelle] Isabelle2016-RC0 - does not exit on Linux · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2016-RC0.20-.20does.20not.20exit.20on.20Linux.html">[isabelle] Isabelle2016-RC0 - does not exit on Linux</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294663382"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2016-RC0%20-%20does%20not%20exit%20on%20Linux/near/294663382" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2016-RC0.20-.20does.20not.20exit.20on.20Linux.html#294663382">(Aug 22 2022 at 12:19)</a>:</h4>
<p>From: "C. Diekmann" &lt;<a href="mailto:diekmann@in.tum.de">diekmann@in.tum.de</a>&gt;<br>
Hi,</p>
<p>I'm testing Isabelle2016-RC0_app.tar.gz on Ubuntu 14.04.3 LTS, Unity,<br>
Linux 4.2.0-22-generic x86_64.</p>
<p>I started it in the shell with<br>
  ./Isabelle2016-RC0/bin/isabelle jedit</p>
<p>After I exited jEdit (clicking the x in the window), the process was<br>
not gone and it was still active in my shell. The prompt did not<br>
return.</p>
<p><code>ps aux</code> shows the following processes</p>
<p>diekmann  2412  0.0  0.0  18316  3572 pts/16   S+   18:05   0:00 bash<br>
/home/diekmann/Downloads/Isabelle2016-RC0/lib/Tools/java<br>
-Duser.language=en -Dawt.useSystemAAFontSettings=on<br>
-Dswing.aatext=true -Dapple.laf.useScreenMenuBar=true<br>
-Dapple.awt.application.name=Isabelle -Xms512m -Xmx2560m -Xss8m<br>
-XX:MetaspaceSize=256m isabelle.Main<br>
diekmann  2442  4.0 21.0 6546964 1701868 pts/16 Sl+ 18:05   9:40<br>
/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jdk/x86_64-linux/jre/bin/java<br>
-server -XX:MinHeapFreeRatio=30 -XX:MaxHeapFreeRatio=60<br>
-XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled<br>
-Dfile.encoding=UTF-8 -Disabelle.threads=0 -classpath<br>
/home/diekmann/Downloads/Isabelle2016-RC0/lib/classes/Pure.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jfreechart-1.0.14-1/lib/iText-2.1.5.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jfreechart-1.0.14-1/lib/jcommon-1.0.18.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jfreechart-1.0.14-1/lib/jfreechart-1.0.14.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jortho-1.0-2/jortho.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/akka-actor_2.11-2.3.10.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/config-1.2.1.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/jline-2.12.1.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-actors-2.11.0.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-actors-migration_2.11-1.1.0.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-compiler.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-continuations-library_2.11-1.0.2.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-continuations-plugin_2.11.7-1.0.2.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-library.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scalap-2.11.7.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-parser-combinators_2.11-1.0.4.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-reflect.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-swing_2.11-1.0.2.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-xml_2.11-1.0.4.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/xz-java-1.2-1/lib/xz.jar:/home/diekmann/Downloads/Isabelle2016-RC0/src/Tools/jEdit/dist/jedit.jar<br>
-Duser.language=en -Dawt.useSystemAAFontSettings=on<br>
-Dswing.aatext=true -Dapple.laf.useScreenMenuBar=true<br>
-Dapple.awt.application.name=Isabelle -Xms512m -Xmx2560m -Xss8m<br>
-XX:MetaspaceSize=256m isabelle.Main</p>
<p>Checking with <code>-H</code>, it seems that 2412 has started 2442.</p>
<p>ctrl+c in the shell kills the isabelle processes.</p>
<p>Steps to reproduce:<br>
1) Load a large theory with many dependencies, let jEdit open the<br>
theories the theory depends on.<br>
2) On my system, the theories had errors (not yet ported for 2016).<br>
3) Change a file on disc, e.g., <code>mv Scratch.thy Scratch.thy2</code><br>
4) click away the "deleted on disc" info.<br>
5) While Isabelle is still checking proofs (and finding more errors), close it.</p>
<p>Best Regards,<br>
  Cornelius</p>



<a name="294664242"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2016-RC0%20-%20does%20not%20exit%20on%20Linux/near/294664242" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2016-RC0.20-.20does.20not.20exit.20on.20Linux.html#294664242">(Aug 22 2022 at 12:25)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
This sounds like the JVM/AWT shutdown problem, that I've now addressed in <br>
<a href="http://isabelle.in.tum.de/repos/isabelle/rev/8bcbf1c93119">http://isabelle.in.tum.de/repos/isabelle/rev/8bcbf1c93119</a></p>
<p>I spent more than half of the day experimenting with variations on the <br>
theme.  Hopefully this change is sufficient.</p>
<p>Makarius</p>



<a name="294664268"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2016-RC0%20-%20does%20not%20exit%20on%20Linux/near/294664268" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2016-RC0.20-.20does.20not.20exit.20on.20Linux.html#294664268">(Aug 22 2022 at 12:25)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;</p>
<blockquote>
<p>This sounds like the JVM/AWT shutdown problem, that I've now addressed<br>
in <a href="http://isabelle.in.tum.de/repos/isabelle/rev/8bcbf1c93119">http://isabelle.in.tum.de/repos/isabelle/rev/8bcbf1c93119</a></p>
</blockquote>
<p>For the records, I've also experienced shutdown problems in libisabelle.<br>
The main reason is that the threads created by the thread pool are not<br>
flagged to be daemon, although I don't know whether this is intentional<br>
or not. I solve it by setting the daemon flag:</p>
<p>&lt;<a href="https://github.com/larsrh/libisabelle/blob/v0.2.2/pide/2015/src/main/scala/impl/Environment.scala#L20-L26">https://github.com/larsrh/libisabelle/blob/v0.2.2/pide/2015/src/main/scala/impl/Environment.scala#L20-L26</a>&gt;</p>
<p>Cheers<br>
Lars</p>



<a name="294664282"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2016-RC0%20-%20does%20not%20exit%20on%20Linux/near/294664282" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2016-RC0.20-.20does.20not.20exit.20on.20Linux.html#294664282">(Aug 22 2022 at 12:25)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
The situation is even more entangled.</p>
<p>Quite long ago I started making various threads daemons, in order to <br>
increase chances that the JVM terminates, while these threads are still <br>
hanging around.</p>
<p>But this later caused the problem introduced in Isabelle/3ad2b2055ffc <br>
(05-Oct-2015): the daemon thread was sending something to the AWT thread <br>
and waiting for the result; the AWT thread was already terminated, because <br>
it only waits for non-daemon threads before shutting itself down; so the <br>
wait of the daemon ended up as deadlock.</p>
<p>Today I first tried to make the daemon thread a non-daemon, but got <br>
entangled elesewhere, for unknown reasons.</p>
<p>Then I just gave up the ambition to be ultra-smart in the inter-thread <br>
ping-pong.  So in 8bcbf1c93119 we are back to a situation where a daemon <br>
thread sends asynchronously a task on the queue of the AWT thread, without <br>
waiting for a result.  It means that the whole task stays on the AWT <br>
thread, when it actually happens -- causing several milliseconds of <br>
potential GUI lock-up.</p>
<p>Makarius</p>



<a name="294664358"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Isabelle2016-RC0%20-%20does%20not%20exit%20on%20Linux/near/294664358" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Isabelle2016-RC0.20-.20does.20not.20exit.20on.20Linux.html#294664358">(Aug 22 2022 at 12:26)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
I've picked up this change as well: <br>
<a href="http://isabelle.in.tum.de/repos/isabelle/rev/6dbeafce6318">http://isabelle.in.tum.de/repos/isabelle/rev/6dbeafce6318</a></p>
<p>This means the trend to have service threads as daemons is increased.  It <br>
also means that synchronous context switch into the AWT thread needs even <br>
more care as usual.  I will double-check all remaining uses of <br>
<a href="http://GUI_Thread.now">GUI_Thread.now</a>.</p>
<p>Makarius</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>