<html>
<head><meta charset="utf-8"><title>[isabelle] Parallel proofs issue, potentially in subst me... · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html">[isabelle] Parallel proofs issue, potentially in subst me...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294222514"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222514" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222514">(Aug 19 2022 at 08:37)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On Fri, 14 Sep 2012, David Greenaway wrote:</p>
<blockquote>
<p>On 14/09/12 08:58, Rafal Kolanski wrote:<br>
[...]</p>
<blockquote>
<p>I really wish that there was some way to get exception traces again when<br>
working interactively in Isabelle.<br>
[...]</p>
</blockquote>
<p>I too had previously thought that the exception traces in Isabelle had <br>
disappeared somewhere around the Isabelle2011-1 time-frame,</p>
</blockquote>
<p>Both of you seem to have taken software decay for granted, and did not <br>
tell anybody here or on isabelle-dev.  Isabelle has traditionally very <br>
high ethical standards for software quality, so things are usually put <br>
into shape again quickly, once the problem is known.</p>
<p>I have come across the issue myself last fall just after the <br>
Isabelle2011-1 release, so in Isabelle2012 it works again.  See the <br>
typical changelog prose of mine that explains everything in one line, <br>
quoting even the relevant Poly/ML change:</p>
<p>changeset:   45486:600682331b79<br>
user:        wenzelm<br>
date:        Mon Nov 14 16:16:49 2011 +0100<br>
files:       src/Pure/Isar/runtime.ML<br>
description:<br>
more detailed exception_trace: in Poly/ML 5.4.x intermediate handlers reset the trace (cf. Poly/ML SVN 1110);</p>
<blockquote>
<p>(Interestingly, there are actually two traces printed: the first is<br>
the one listed above, the second seems less useful.)</p>
</blockquote>
<p>That is the "more detailed" aspect above.  By filtering out some less <br>
relevant exceptions, the full trace was lost by accident.  So it is now <br>
redundant, but informative again.</p>
<blockquote>
<p>So I am not sure if/when the stack traces disappeared, or if/when they <br>
came back, but happily they seem to be working now. The key points are <br>
to enable "Toplevel.debug", disable inlining for the code you are trying <br>
to debug, and make sure you look in "<em>isabelle</em>" trace window for the <br>
trace.</p>
</blockquote>
<p>In Isabelle/jEdit this is the raw output panel, to show physical stdout <br>
messages that are produced by the Poly/ML runtime system for the exception <br>
trace.  This is unmanaged output, and the window needs to be active when <br>
it happens, otherwise it is lost.</p>
<blockquote>
<p>On a marginally related note, PolyML also has stepping/tracing<br>
facilities, as described in:</p>
<p><a href="http://www.polyml.org/docs/Debugging.html">http://www.polyml.org/docs/Debugging.html</a></p>
<p>which you can theoretically use by typing commands in the "<em>isabelle</em>"<br>
window. I have personally found that the combination of Isabelle and<br>
ProofGeneral and PolyML debugging tends to be a little unstable, so<br>
I don't ever use these. I would be curious to know if others have had<br>
more success, however.</p>
</blockquote>
<p>In Isabelle/jEdit the support for Isabelle/ML support (including tracing <br>
and debugging) is already better in Isabelle/jEdit of Isabelle2012 than <br>
ever before in the history of Isabelle Proof General.</p>
<p>There is also clear separation of physical stdin from the protocol <br>
channel.  So in principle one could negotiate with the raw Poly/ML <br>
toplevel loop (and its debugger) while Isabelle is running at full speed. <br>
There is no console window for that in the Prover IDE, though.</p>
<p>In practice, I usually use plain writeln and PolyML.print to see what is <br>
happening in some ML code (after recompiling), not the debugger.</p>
<p>Makarius</p>



<a name="294222516"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222516" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222516">(Aug 19 2022 at 08:37)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
What you "throw" and "catch" on the Java Virtual Machine is slightly <br>
different from what you "raise" and "handle" in ML.  A JVM Exception <br>
object is much more heavy than in ML.  Nonetheless, you can use the <br>
"reraise" function in Isabelle/ML to pass some of the original information <br>
through an exception handler, most importantly the source position.</p>
<p>Searching through the Isabelle sources for "reraise" reveals some examples <br>
-- typically some administrative operation.</p>
<p>The implementation manual section 0.5 <br>
<a href="http://isabelle.in.tum.de/dist/Isabelle2012/doc/implementation.pdf">http://isabelle.in.tum.de/dist/Isabelle2012/doc/implementation.pdf</a> has <br>
some further overview of the overall picture of exceptions, interrupts <br>
etc.  In particular, the infamous "handle _ =&gt; " from the SML/NJ library <br>
book must never be used.</p>
<p>Makarius</p>



<a name="294222530"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222530" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222530">(Aug 19 2022 at 08:37)</a>:</h4>
<p>From: Rafal Kolanski &lt;<a href="mailto:xs@xaph.net">xs@xaph.net</a>&gt;<br>
On 17/09/12 04:54, Makarius wrote:</p>
<blockquote>
<p>Both of you seem to have taken software decay for granted, and did not<br>
tell anybody here or on isabelle-dev.  Isabelle has traditionally very<br>
high ethical standards for software quality, so things are usually put<br>
into shape again quickly, once the problem is known.</p>
</blockquote>
<p>This is not really "decay" as such. It is an implementation decision we<br>
were not aware of, and I merely wonder if there isn't some way to get<br>
detailed traces back while maintaining performance. David Matthews<br>
explained the situation to me and said he will think about if and how it<br>
is possible. This is all I wanted, and he has been very helpful throughout.</p>
<blockquote>
<p>changeset:   45486:600682331b79<br>
user:        wenzelm<br>
date:        Mon Nov 14 16:16:49 2011 +0100<br>
files:       src/Pure/Isar/runtime.ML<br>
description:<br>
more detailed exception_trace: in Poly/ML 5.4.x intermediate handlers<br>
reset the trace (cf. Poly/ML SVN 1110);</p>
</blockquote>
<p>Please be aware there are very important trade-offs both in life an<br>
work. There is a reason you are a (the?) Isabelle guru. It has to do<br>
with the exposure of time and investment of effort in keeping Isabelle<br>
running, preventing aforementioned code decay while still improving the<br>
feature set. For this reason, you were aware of this situation and tried<br>
to do something about it already.</p>
<p>This is highly relevant work, and work for which we are grateful, but it<br>
is not necessarily <em>our</em> work. Our work takes us further out than<br>
Isabelle itself and into the realm of building larger projects with it.<br>
When we identify situations where we need to automate or customise<br>
because of project maintenance, that's when we get to dive back into the<br>
Isabelle internals.</p>
<p>So we have this periodic dance:</p>
<p>On the one hand, we need to be periodically reminded that Isabelle can't<br>
just have features shoved in because we want them, that they need to be<br>
considered within the broader scope of the Isabelle system, and that<br>
there is an "Isabelle way" of doing things. We count on that for you.<br>
Sometimes we get a bit frustrated, but that's an acceptable price to pay.</p>
<p>On the other hand, I think you need to be periodically reminded that<br>
Isabelle has users at various levels of competency/experience, whose<br>
primary work focus is not Isabelle itself. In other words, there is more<br>
to Isabelle than using Isabelle for the sake of Isabelle by means of<br>
Isabelle (similarly Scala and Scala).</p>
<p>Such users have need of interfaces which reflect at least slightly<br>
realistic work that they need to be doing.</p>
<p>Concrete example.  During my visit to Munich this year, I wanted to find<br>
out which theorems were used by fastforce to prove a lemma, because my<br>
tactic wouldn't solve it, but fastforce did. Typical<br>
tactical-implementation problem. So, there isn't a feature in Isabelle<br>
called "thms_used_to_prove my_theorem". I look at the ML level, and<br>
realise there isn't one either, there's only a generalised fold over the<br>
proof term structure. It turns out that if you perform a partial<br>
traversal of the proof term (first two levels), you get the required<br>
functionality. But now I've spent the better part of an hour<br>
understanding proof terms to make sure I got it right and bothered Lukas<br>
(who is awesome, BTW) as a result.<br>
So finally, I have my shiny ML function which answers the very useful<br>
question of "which theorems were used to prove this theorem directly,<br>
rather than the entire tree back to Pure". Lukas likes it, Tobias thinks<br>
it is useful.<br>
After further discussion though, Lukas and I conclude that we'll never<br>
get it past you, because we can't substantiate a serious enough<br>
Isabelle-reason for modifying the proof term API to provide this<br>
commonly thought of and convenient functionality. So we put it in the<br>
Isabelle Cookbook. After I left, Lars had the exact same problem, but<br>
now could just look up the solution.</p>
<p>That is how things work for Isabelle non-gurus.</p>
<p>All I ask for is a bit of respect. Just because I don't understand the<br>
entire system and its multi-year vision in-depth does not necessarily<br>
mean that all my ideas are stupid. In fact, some of the ideas might be<br>
good, but are in need of a guru suggesting a better implementation,<br>
which is why I mention them anyway.</p>
<p>There are real issues with introspection of proofs in larger projects,<br>
e.g. being able to reliably tag images (you are looking at the most<br>
recent successful build of an image via the wwwfind interface... quick,<br>
please tell me which revision that is, and if the correct image is in<br>
fact loaded without reading through the entire theory dropdown first). I<br>
have also tried discussing this at length, but no one cares except for<br>
our team, so we use custom patches and I gave up. The next big project<br>
will have the exact same problems, and these hacky solutions will get<br>
hacked in again and again, wasting people's time, while every time we<br>
bring them up here we'll get told they are not relevant, because the<br>
Isabelle project itself doesn't need it, and why would you want multiple<br>
instances of an image on the same machine anyway?</p>
<blockquote>
<p>In Isabelle/jEdit the support for Isabelle/ML support (including tracing<br>
and debugging) is already better in Isabelle/jEdit of Isabelle2012 than<br>
ever before in the history of Isabelle Proof General.</p>
<p>There is also clear separation of physical stdin from the protocol<br>
channel.  So in principle one could negotiate with the raw Poly/ML<br>
toplevel loop (and its debugger) while Isabelle is running at full<br>
speed. There is no console window for that in the Prover IDE, though.</p>
</blockquote>
<p>Great, so at some point in the future when I change the theorem prover<br>
interface I use, the functionality I'm looking for might be available.<br>
This will be quite an improvement, to be able to run the interactive<br>
debugger at the same time as Isabelle, and when it happens will render<br>
my observations about exception traces mostly irrelevant (still would be<br>
nice if David figured out a magical way to do it).</p>
<blockquote>
<p>In practice, I usually use plain writeln and PolyML.print to see what is<br>
happening in some ML code (after recompiling), not the debugger.</p>
</blockquote>
<p>Yes, I do this too, in my own code. I can't just rewrite some other<br>
person's code and rebuild, because that may take hours. Thanks to David<br>
Matthews and the latest PolyML 5.5 though, we can now build everything<br>
in under 3 hours (down from 8h with -q 0, and 4h with -q 1) on some<br>
machines and then do something which you really dislike: copy the image<br>
from the much faster machine to the much slower one. I recall on this<br>
list someone (you?) telling me that one shouldn't copy binary images<br>
around, and why would anyone want to do that anyway?</p>
<p>So in summary, I may not be the smartest person on this planet, but if<br>
I'm not aware of the intricacies of what exactly happened in Isabelle in<br>
every single commit, it's not because I don't care or take software<br>
decay for granted or something. In fact, if you ask people at Munich who<br>
have talked to me, it's almost the opposite. I have an inherent and<br>
sometimes not-quite-sane instinct to streamline things and make them<br>
more intuitive.</p>
<p>I just have four other projects to work on, and don't really feel<br>
encouraged to try contribute when the answer is nearly always the same:<br>
"your idea sucks || is pointless || we don't have this problem la la la<br>
|| your implementation is not canonical || that isn't a good enough<br>
reason to modify the interface || ...). Look what happened now: I raised<br>
a bug report when I found one, and in the resulting discussion I get<br>
told that I take "software decay for granted".</p>
<p>While your contributions are truly impressive, I would venture a<br>
suggestion to at least try pretend to be a bit more open-minded. You<br>
know, Bill Clinton style. He won't do what you asked for in all<br>
probability anyway, but at least you'll walk away from the discussion<br>
feeling like your idea was given due consideration. I don't know how<br>
else to explain this, other than that the Isabelle users list is great,<br>
helpful and proving stuff is fun and easy to release, working at the ML<br>
level is a depressing experience, and trying to share the results of<br>
one's work doubly so.</p>
<p>Sincerely,</p>
<p>Rafal Kolanski.</p>



<a name="294222581"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222581" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222581">(Aug 19 2022 at 08:38)</a>:</h4>
<p>From: Lukas Bulwahn &lt;<a href="mailto:bulwahn@in.tum.de">bulwahn@in.tum.de</a>&gt;<br>
Just to clarify my intentions in this example of a feature request here:<br>
Certain features, as the one mentioned above, can be implemented <br>
perfectly in Isabelle's "user space". For the implementing developer, <br>
many functions then appear to be important for a decent library and we <br>
would like to add them to "kernel" modules to make our contribution more <br>
visible. However, Isabelle's slogan "fight features" (p.3 of the <br>
Isabelle implementation manual) just as the often cited LCF approach <br>
forbid to modify and extend kernel modules, just because of a temporal <br>
state of mind. Coincidently, Makarius is the person, who enforces these <br>
matters in our system and repository---Hence, the statement "We can't <br>
get it past Makarius", really means we do not have any substantial <br>
reason to modify the kernel.</p>
<p>Nonetheless, the story of some feature usually does not end here. If <br>
developers are quite proud of their functionality, they try to advertise <br>
it, as we did. One such way is certainly the Isabelle developer <br>
tutorial, another is to find others that need the functionality. This <br>
usually ends up in temporal clones here und there till the pressure is <br>
large enough for one of the developers to take another round of <br>
iteration of some subject.</p>
<p>Unlike some other developers, I was in the fortunate position to learn <br>
this way of system development from Makarius and many others in the <br>
group in Munich.</p>
<p>But again, this thread (as many other threads before) is getting largely <br>
off-topic.</p>
<p>Lukas</p>



<a name="294222593"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222593" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222593">(Aug 19 2022 at 08:38)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Before continuing the meta-discussion, which requires more time to study <br>
to make sense in the response, just back to the technical question:</p>
<p>Which aspect of ML expection trace is no longer working, camparing <br>
Isabelle2012 to some more distant past?</p>
<p>David Matthews improved something on his side in SVN 1110, I followed in <br>
my side in 600682331b79, so it should be all back.  What is the remaining <br>
problem that was not spelled out explicitly so far?</p>
<p>Makarius</p>



<a name="294222617"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222617" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222617">(Aug 19 2022 at 08:38)</a>:</h4>
<p>From: David Matthews &lt;<a href="mailto:dm@prolingua.co.uk">dm@prolingua.co.uk</a>&gt;<br>
With PolyML 5.3 and earlier, if you had a handler that caught only <br>
exception foo but you had raised bar then exception_trace would show the <br>
whole stack trace from the point where you raised bar.  With 5.4 and <br>
later an exception handler of the form<br>
handle foo =&gt; ... is rewritten as though it were<br>
handle x =&gt; (case x of foo =&gt; ... | x =&gt; reraise x)<br>
So exception_trace only shows the stack from the point where bar was <br>
reraised.  That may well not be as helpful.</p>
<p>I understand the problem; it's just that making this change greatly <br>
simplified the exception mechanism and speeded it up.</p>
<p>David</p>



<a name="294222627"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222627" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222627">(Aug 19 2022 at 08:38)</a>:</h4>
<p>From: Rafal Kolanski &lt;<a href="mailto:xs@xaph.net">xs@xaph.net</a>&gt;<br>
Consider this code:</p>
<p>exception TFX;<br>
  exception IRR;</p>
<p>fun f1 x = raise TFX;<br>
  fun f2 x = f1 x + 1;<br>
  fun f3 x = f2 x + 1;<br>
  fun f4 x = f3 x + 1;<br>
  fun f5 x = (f4 x + 1) handle IRR =&gt; raise IRR;<br>
  fun f6 x = f5 x + 1;<br>
  fun f7 x = f6 x + 1;<br>
  fun f8 x = f7 x + 1;<br>
  fun f9 x = f8 x + 1;</p>
<p>Output of "f9 1" in PolyML 5.3:</p>
<p>f1(1)<br>
f2(1)<br>
f3(1)<br>
f4(1)<br>
f5(1)<br>
f5(1)<br>
f6(1)<br>
f7(1)<br>
f8(1)<br>
f9(1)<br>
&lt;top level&gt;<br>
CODETREE().genCode(2)(1)<br>
COMPILER_BODY().baseCompiler(4)executeCode(1)<br>
End of trace</p>
<p>Output in PolyML 5.4+:</p>
<p>f6(1)<br>
f7(1)<br>
f8(1)<br>
f9(1)<br>
&lt;top level&gt;<br>
CODETREE().genCode(2)(1)<br>
COMPILER_BODY().baseCompiler(4)executeCode(1)<br>
End of trace</p>
<p>TFX has not been handled at any point, but in newer releases its origin<br>
is obscured by the handler for IRR, and will be obscured by any handler.</p>
<p>David Matthews has kindly explained the design decision to me and said<br>
he will think on whether it is possible the old behaviour back without<br>
taking a non-trivial penalty. That's really all I hoped for in raising<br>
the backtrace issue originally. I also considered that maybe I'm not the<br>
first ML-level Isabelle user to run into this, and so someone might have<br>
a (hacky) workaround.</p>
<p>I'll honestly say that I don't at present understand what issue your<br>
changeset 600682331b79 addresses and do not possess the free time to<br>
find out, but it appears to not be the one I am describing.</p>
<p>Sincerely,</p>
<p>Rafal Kolanski.</p>



<a name="294222630"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222630" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222630">(Aug 19 2022 at 08:38)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On Mon, 17 Sep 2012, Rafal Kolanski wrote:</p>
<blockquote>
<blockquote>
<p>David Matthews improved something on his side in SVN 1110, I followed in<br>
my side in 600682331b79, so it should be all back.  What is the<br>
remaining problem that was not spelled out explicitly so far?</p>
</blockquote>
<p>Consider this code:</p>
<p>exception TFX;<br>
 exception IRR;</p>
<p>fun f1 x = raise TFX;<br>
 fun f2 x = f1 x + 1;<br>
 fun f3 x = f2 x + 1;<br>
 fun f4 x = f3 x + 1;<br>
 fun f5 x = (f4 x + 1) handle IRR =&gt; raise IRR;<br>
 fun f6 x = f5 x + 1;<br>
 fun f7 x = f6 x + 1;<br>
 fun f8 x = f7 x + 1;<br>
 fun f9 x = f8 x + 1;</p>
<p>Output of "f9 1" in PolyML 5.3:</p>
<p>f1(1)<br>
f2(1)<br>
f3(1)<br>
f4(1)<br>
f5(1)<br>
f5(1)<br>
f6(1)<br>
f7(1)<br>
f8(1)<br>
f9(1)<br>
&lt;top level&gt;<br>
CODETREE().genCode(2)(1)<br>
COMPILER_BODY().baseCompiler(4)executeCode(1)<br>
End of trace</p>
<p>Output in PolyML 5.4+:</p>
<p>f6(1)<br>
f7(1)<br>
f8(1)<br>
f9(1)<br>
&lt;top level&gt;<br>
CODETREE().genCode(2)(1)<br>
COMPILER_BODY().baseCompiler(4)executeCode(1)<br>
End of trace</p>
<p>TFX has not been handled at any point, but in newer releases its origin<br>
is obscured by the handler for IRR, and will be obscured by any handler.</p>
</blockquote>
<p>OK, this is a reasonable report on the situation after all.</p>
<blockquote>
<p>I'll honestly say that I don't at present understand what issue your <br>
changeset 600682331b79 addresses and do not possess the free time to <br>
find out, but it appears to not be the one I am describing.</p>
</blockquote>
<p>It addresses exactly that for the Isar toplevel, but it cannot change the <br>
situation for user-code, of course.</p>
<p>Makarius</p>



<a name="294222637"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222637" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222637">(Aug 19 2022 at 08:38)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
First of all, a citation is just a citation, not a literal statement. <br>
The ones on the front-part of the Isabelle/Isar manual do have some <br>
correlation with the received Isabelle development process and its <br>
challenges, which is why I've put them there, but eveybody needs to start <br>
his own thinking process to see behind the surface and the actual things<br>
in the background.</p>
<p>I've recently come across a very interesting lecture by Alan Kay on <br>
"Programming and Scaling" <a href="http://tele-task.de/archive/video/flash/14029/">http://tele-task.de/archive/video/flash/14029/</a> <br>
which might lead to more citations from him ending up in that spot of the <br>
implementation manual.  I particularly like one of his explanations <br>
(probably from another talk) about the fundamental importance of <br>
architecture: instead of turning many bricks naively into an amorphic pile <br>
of bricks, to make a sophisticated building you need to follow certain <br>
structuring principles that you need to learn first.  And the main focus <br>
of that talk is then about learning and education, especially in the US, <br>
especially science and math education.</p>
<p>Alan Kay is an interesting person in many respects.  He has now grown old <br>
and wise, and can go beyond the follies from his youth, most notably the <br>
"object-oriented" movement that he started.  (He is the inventor of the <br>
term "OO", so its fun to see him bashing that a lot now.)</p>
<p>Makarius</p>



<a name="294222900"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222900" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222900">(Aug 19 2022 at 08:41)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
This thread is already getting old, but the above paragraph sounds very <br>
odd to me.  Myself and several other people I know use routinely a lot of <br>
different Isabelle versions and work with images from them.  You have the <br>
regular settings that can be modified locally, and tools like "isabelle <br>
version -i" to get more specific identification of repository snapshots. <br>
This should give sufficient flexibility to organize images in many ways. <br>
In the next release that will be perfected even further, thanks to the new <br>
build system.</p>
<p>I don't think any of your local "hacks" are actually needed.  IIRC, this <br>
was also what I hinted at when the discussion was coming up some years <br>
ago, but it was not taken to the end, just cancelled in frustration <br>
probably.</p>
<p>Makarius</p>



<a name="294222907"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222907" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222907">(Aug 19 2022 at 08:41)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
This has already become a running gag: someone, maybe even Gerwin, decided <br>
at some point that Isabelle has an "Isar level for users" and an "ML level <br>
for developers".  But I've myself never introduced anything like that.</p>
<p>The very first Isar command I implemented in the distant past was 'ML'. <br>
And today Isabelle/Isar and Isabelle/ML are neatly intertwined such that <br>
you can go back and forth between the languages as you need in your tool <br>
implementations.  The Prover IDE is also a fairly good IDE for ML inside <br>
regular Isar source.</p>
<p>So you have Isabelle/Pure/HOL/ML/Isar/Scala etc but it is difficult to <br>
assign "levels" to them.  In practice you work with several of these <br>
Isabelle aspects at the same time. The delicate bootstrapping process in <br>
the Isabelle/Pure implementation is a different story -- the machine room <br>
down there is definitely not user-space.</p>
<p>Makarius</p>



<a name="294222918"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222918" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222918">(Aug 19 2022 at 08:41)</a>:</h4>
<p>From: Rafal Kolanski &lt;<a href="mailto:xs@xaph.net">xs@xaph.net</a>&gt;<br>
You are entirely missing my point here. You keep referring to Isabelle <br>
versions as if they are the only versions anyone might care about. We <br>
run a project <em>using</em> Isabelle. The project has its own revision control <br>
versions, and Isabelle is just one subrepo.</p>
<p>What you are describing is the isabelle version used to build a <br>
particular image. We know which version this is. What we don't know is <br>
which repository version of the <em>project</em> built the image we are <br>
presenting to the user.</p>
<p>Trivially: on port 8193 we have the wwwfind server presenting an <br>
interface to users wishing to search through the latest CREFINE image <br>
the regression test server was able to build with the current version of <br>
Isabelle. Question: given that you know which Isabelle version and <br>
PolyML version built it (obvious from the image path and from Isabelle <br>
being a subrepo), which repository version are you looking at? Sometimes <br>
an image can be broken for a few days, and people need to tell they are <br>
not looking at the latest source version, but at the latest successfully <br>
built version.</p>
<p>I really can't get the point across any more clearly. I have repeatedly <br>
tried to explain that Isabelle is a tool upon which we run a project, <br>
and it is not the only project in existence. It should be evident that <br>
simply knowing the revision of Isabelle used to build something is not <br>
the only revision one should know, as Isabelle was used to build <br>
<em>something</em> and the version of that <em>something</em> is in fact more <br>
important, henceforth "isabelle version -i" really does nothing here.</p>
<p>Sincerely,</p>
<p>Rafal Kolanski.</p>



<a name="294222942"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294222942" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294222942">(Aug 19 2022 at 08:41)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
This is getting a bit far off the Isabelle track.</p>
<p>I claimed that Isabelle has sufficiently many ways to identify itself <br>
precisely, and reconfigure locations for images and other resources. <br>
Building other projects on top should work.  People have done that without <br>
patching Isabelle.</p>
<p>BTW, when you say "the latest source version" my semantic spell-checker <br>
marks it read, because that is not a well-defined notion.  The changeset <br>
id is how you identify things unambigously, or a collection of ids -- for <br>
each repository.</p>
<p>Makarius</p>



<a name="294223591"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294223591" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294223591">(Aug 19 2022 at 08:46)</a>:</h4>
<p>From: Rafal Kolanski &lt;<a href="mailto:xs@xaph.net">xs@xaph.net</a>&gt;<br>
Dear Isabelle Users and Developers,</p>
<p>I have recently come across an issue when trying to improve the runtimes <br>
of our regression test server. When I ran it with -q 1, the times <br>
improved drastically, which was nice. When I ran it with -q 2 though, it <br>
didn't build at all. Those of you who know me will not be surprised to <br>
find it was in a theory I wrote :)</p>
<p>The issue affects building an image in non-interactive mode under <br>
Isabelle 2012 and a very recent development version (2267901ae911), in <br>
both 32-bit and 64-bit builds of PolyML versions 5.4.0, 5.4.1 and <br>
5.4.2-dev. Breakage confirmed on three different physical machines.</p>
<p>Settings were:<br>
ISABELLE_USEDIR_OPTIONS="-M 2 -p 0 -q 2 -v true"<br>
but also confirmed to break with -M max and -p 1.</p>
<p>Please find attached the ROOT.ML, IsaMakefile and Loading.thy which <br>
replicates the issue in a distilled form building on HOL only. Run with:<br>
isabelle make MAPPED_SEP</p>
<p>The error should be on the line attempting the subst:<br>
*** exception THM 0 raised (line 758 of "thm.ML"):<br>
*** forall_intr: variable "bs" free in assumptions<br>
*** [| length bs = sz; P (Suc p) sz bs; p # Z = Z |]<br>
*** ==&gt; p # load_list_basic sz (Suc p) = Z<br>
***   [!!]<br>
*** At command "apply" (line 30 of "/home/rafalk/t/isa_bug/Loading.thy")</p>
<p>The issue is definitely due to some shadowing/renaming of the variable <br>
bs, but what else is going on is well beyond my current grasp of <br>
comprehension.</p>
<p>Sincerely,</p>
<p>Rafal Kolanski.<br>
<a href="/user_uploads/14278/kqeMjRkz8xliak3AvZYEYc48/IsaMakefile">IsaMakefile</a><br>
<a href="/user_uploads/14278/AslIWWJMyvjz8UfxfUnDs5H8/Loading.thy">Loading.thy</a><br>
<a href="/user_uploads/14278/IZF0aqTZNoeZEP3gxqIa4-pU/ROOT.ML">ROOT.ML</a></p>



<a name="294223870"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294223870" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294223870">(Aug 19 2022 at 08:48)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On Mon, 10 Sep 2012, Rafal Kolanski wrote:</p>
<blockquote>
<p>I have recently come across an issue when trying to improve the runtimes <br>
of our regression test server. When I ran it with -q 1, the times <br>
improved drastically, which was nice. When I ran it with -q 2 though, it <br>
didn't build at all.</p>
</blockquote>
<p>Now the world knows that the top-secret proofs of L4.verified are still <br>
checked sequentially :-)</p>
<blockquote>
<p>The error should be on the line attempting the subst:<br>
*** exception THM 0 raised (line 758 of "thm.ML"):<br>
*** forall_intr: variable "bs" free in assumptions<br>
*** [| length bs = sz; P (Suc p) sz bs; p # Z = Z |]<br>
*** ==&gt; p # load_list_basic sz (Suc p) = Z<br>
***   [!!]<br>
*** At command "apply" (line 30 of "/home/rafalk/t/isa_bug/Loading.thy")</p>
<p>The issue is definitely due to some shadowing/renaming of the variable <br>
bs, but what else is going on is well beyond my current grasp of <br>
comprehension.</p>
</blockquote>
<p>I've had a quick look at the "subst" method, but it looks very bad.  That <br>
code has not been maintained in many years. It simply ignores the <br>
all-important Proof.context when inventing free variables that are <br>
expected to be fresh, but aren't.  There is not just one place, but many. <br>
One could probably make a small changeset to get your example working, but <br>
it will then crash in another situation.</p>
<p>The following comment in isand.ML, which is one part of the problem here <br>
is quite representative:</p>
<p>THINK: are we really ok with our varify name w.r.t the prop - do<br>
   we also need to avoid names in the hidden hyps? What about<br>
   unification contraints in flex-flex pairs - might they also have<br>
   extra free vars?</p>
<p>The answer: hyps are necessary, but still not sufficient.  One needs to <br>
take the full Proof.context into account.</p>
<p>A quick fix is to do the renaming yourself in the proof, i.e. avoid <br>
accidental overlap of blue / brown / green variables with the same name on <br>
the surface.  Then "subst" can continue its work with its archaic context <br>
model a little longer.</p>
<p>Makarius</p>



<a name="294224022"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224022" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224022">(Aug 19 2022 at 08:50)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
See <a href="http://isabelle.in.tum.de/repos/isabelle/rev/d1fcb4de8349">http://isabelle.in.tum.de/repos/isabelle/rev/d1fcb4de8349</a> and <br>
<a href="http://isabelle.in.tum.de/repos/isabelle/rev/25fc6e0da459">http://isabelle.in.tum.de/repos/isabelle/rev/25fc6e0da459</a> for what I've <br>
made in the meantime.  You have to see yourself how to apply this to <br>
Isabelle2012 (via "hg import" etc).  Isabelle has only a single official <br>
release branch, and it will take a few months until the next one is <br>
published.</p>
<p>I think the main problem with your example was in RWInst.mk_renamings, as <br>
changed in 25fc6e0da459 to get rid of usednames_of_thm in particular.</p>
<p>There are many more situations where "subst" produces free variables on <br>
the spot.  They still don't look 100% canonical to me, even after the <br>
change, but for this round of refurbishing tools from the Isabelle library <br>
it should be sufficient.</p>
<p>Makarius</p>



<a name="294224036"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224036" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224036">(Aug 19 2022 at 08:50)</a>:</h4>
<p>From: Rafal Kolanski &lt;<a href="mailto:xs@xaph.net">xs@xaph.net</a>&gt;<br>
On 13/09/12 04:16, Makarius wrote:</p>
<blockquote>
<p>On Mon, 10 Sep 2012, Rafal Kolanski wrote:</p>
<blockquote>
<p>I have recently come across an issue when trying to improve the<br>
runtimes of our regression test server. When I ran it with -q 1, the<br>
times improved drastically, which was nice. When I ran it with -q 2<br>
though, it didn't build at all.</p>
</blockquote>
<p>Now the world knows that the top-secret proofs of L4.verified are still<br>
checked sequentially :-)</p>
</blockquote>
<p>We generally try to run with the highest amount of parallelism that does<br>
not make the machine thrash or PolyML segfault. Previously that was -q<br>
0, now it's -q 1. We're tracking the svn version of the upcoming PolyML<br>
5.5 to see if at some point we can switch to -q 2.</p>
<blockquote>
<blockquote>
<p>The issue is definitely due to some shadowing/renaming of the variable<br>
bs, but what else is going on is well beyond my current grasp of<br>
comprehension.</p>
</blockquote>
<p>I've had a quick look at the "subst" method, but it looks very bad. <br>
That code has not been maintained in many years. It simply ignores the<br>
all-important Proof.context when inventing free variables that are<br>
expected to be fresh, but aren't.  There is not just one place, but<br>
many. One could probably make a small changeset to get your example<br>
working, but it will then crash in another situation.</p>
</blockquote>
<p>I made a bad joke about how I should title my post to the list "On the<br>
improper use of context in the subst method", but then we weren't sure<br>
if that was exactly the case. Context is really hard to get right, and<br>
old code does accumulate these leaks.</p>
<blockquote>
<p>A quick fix is to do the renaming yourself in the proof, i.e. avoid<br>
accidental overlap of blue / brown / green variables with the same name<br>
on the surface.  Then "subst" can continue its work with its archaic<br>
context model a little longer.</p>
</blockquote>
<p>Yes, we ended up doing that, and now we're back to PolyML segfaulting<br>
with -q 2. David seems to be applying quite a few fixes to the GC<br>
though, so we have high hopes of getting it working soon.</p>
<p>I would also like to say thank you in general for the movement towards<br>
local context and parallelism over the years. We went down from a full<br>
test run of almost 8 hours down to 4 when switching to -q 1.</p>
<p>Thanks for patching it in the repository. Hopefully it will save someone<br>
a major head-scratching in future!</p>
<p>Sincerely,</p>
<p>Rafal Kolanski</p>



<a name="294224045"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224045" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224045">(Aug 19 2022 at 08:50)</a>:</h4>
<p>From: Lars Noschinski &lt;<a href="mailto:noschinl@in.tum.de">noschinl@in.tum.de</a>&gt;<br>
That is good to know. I have a student project planned (but no student <br>
yet) to implement a subst-like tactic with the hole-selection of <br>
ssreflects' rewrite tactic. I will keep in mind that subst's code is to <br>
be taken with a grain of salt.</p>
<p>-- Lars</p>



<a name="294224053"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224053" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224053">(Aug 19 2022 at 08:50)</a>:</h4>
<p>From: David Matthews &lt;<a href="mailto:dm@prolingua.co.uk">dm@prolingua.co.uk</a>&gt;<br>
I have fixed all the segfaults I am aware of with the GC and I'm on the <br>
point of releasing SVN 1594 as Poly/ML 5.5.  If you have an example that <br>
consistently fails I will investigate.  However, I need as much detail <br>
as possible and if at all possible a script that I can run to reproduce <br>
it.  Bear in mind that I know absolutely nothing about using Isabelle so <br>
it needs to be foolproof.</p>
<p>David</p>



<a name="294224061"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224061" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224061">(Aug 19 2022 at 08:50)</a>:</h4>
<p>From: Gerwin Klein &lt;<a href="mailto:gerwin.klein@nicta.com.au">gerwin.klein@nicta.com.au</a>&gt;<br>
Imagine the pain we've been in all that time ;-)</p>
<p>We can now do this, because we have a regression test server with 128GB RAM.</p>
<p>My desktop machine still needs to run sessions sequentially to get things through, although poly 5.5.0 has made the situation dramatically better.</p>
<p>Cheers,<br>
Gerwin</p>



<a name="294224070"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224070" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224070">(Aug 19 2022 at 08:50)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
It is also a natural consequence of disclosed sources, but you know this <br>
already.</p>
<p>Makarius</p>



<a name="294224077"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224077" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224077">(Aug 19 2022 at 08:50)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
This should read as "closed", or "nondisclosed" to make the Newspeak come <br>
out properly.</p>
<p>Makarius</p>



<a name="294224127"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224127" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224127">(Aug 19 2022 at 08:51)</a>:</h4>
<p>From: Rafal Kolanski &lt;<a href="mailto:xs@xaph.net">xs@xaph.net</a>&gt;<br>
I will be testing that as my third task for today, so fingers crossed. <br>
It's unlikely if anything goes wrong I'll be able to give you a <br>
reproducible script though. The errors I've seen so far are always of <br>
the kind "PolyML segfaults sometimes when building large images" :/</p>
<p>I really wish that there was some way to get exception traces again when <br>
working interactively in Isabelle. You have already said you don't know <br>
much about using Isabelle, but perhaps someone here knows a trick? There <br>
already is a nice debugging interface built into PolyML, I just don't <br>
know how to use it while working with a theorem prover.</p>
<p>Sincerely,</p>
<p>Rafal Kolanski.</p>



<a name="294224147"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224147" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224147">(Aug 19 2022 at 08:51)</a>:</h4>
<p>From: David Greenaway &lt;<a href="mailto:david.greenaway@nicta.com.au">david.greenaway@nicta.com.au</a>&gt;<br>
Hi Raf,</p>



<a name="294224174"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Parallel%20proofs%20issue%2C%20potentially%20in%20subst%20me.../near/294224174" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Parallel.20proofs.20issue.2C.20potentially.20in.20subst.20me.2E.2E.2E.html#294224174">(Aug 19 2022 at 08:51)</a>:</h4>
<p>From: Rafal Kolanski &lt;<a href="mailto:xs@xaph.net">xs@xaph.net</a>&gt;<br>
Hi David,</p>
<p>As I demonstrated in person, the exception traces only get you as far as <br>
the first exception handler you encounter. So for example if anywhere in <br>
the chain there was a handle BAR, then even though you threw a FOO you <br>
still wouldn't get a trace past that handler.</p>
<p>I think we decided that behaviour appeared in 5.4? Dave Matthews told me <br>
it was a design decision which improved performance and simplified code, <br>
but I am still rather sad it is gone. I wish there was a way to enable <br>
it again for our interactive sessions, even if we have to suffer a speed <br>
penalty. For batch sessions with parallelism, the existing behaviour in <br>
exchange for performance is definitely the right idea.</p>
<p>I guess if the problem is really massively painful, we can always <br>
rebuild with 5.3 and trace with that while head-scratching in parallel :/</p>
<p>Sincerely,</p>
<p>Rafal Kolanski.</p>



<hr><p>Last updated: Feb 22 2026 at 20:30 UTC</p>
</html>