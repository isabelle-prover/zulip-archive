<html>
<head><meta charset="utf-8"><title>[isabelle] Potential problems with socket I/O after Ubunt... · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html">[isabelle] Potential problems with socket I/O after Ubunt...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294745303"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294745303" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294745303">(Aug 22 2022 at 18:33)</a>:</h4>
<p>From: Jose Divasón &lt;<a href="mailto:jose.divasonm@unirioja.es">jose.divasonm@unirioja.es</a>&gt;<br>
I can confirm the problem with linux-image-4.15.0-36-generic in two<br>
different computers. With linux-image-4.15.0-34-generic everything works<br>
well.</p>
<p>In my case, the problem started two days ago (3rd October 2018). I was<br>
working with a file that requires (from AFP)</p>
<p>Perron_Frobenius.HMA_Connect<br>
Rank_Nullity_Theorem.Mod_Type</p>
<p>and Isabelle/jEdit was unable to load the required files and the<br>
corresponding dependences, even waiting for a couple of hours.</p>
<p>Cheers,<br>
Jose</p>



<a name="294745319"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294745319" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294745319">(Aug 22 2022 at 18:33)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Here is a test release of Isabelle2018 + a single changeset to avoid<br>
these problems with TCP_NODELAY:</p>
<p><a href="http://isabelle.in.tum.de/Isabelle_05-Oct-2018">http://isabelle.in.tum.de/Isabelle_05-Oct-2018</a></p>
<p>The same change is on the ongoing Isabelle development repository:</p>
<p><a href="http://isabelle.in.tum.de/repos/isabelle/rev/6ededdc829bb">http://isabelle.in.tum.de/repos/isabelle/rev/6ededdc829bb</a></p>
<p>Thus Isabelle users on Ubuntu should be able to continue undisturbed.</p>
<p>Next week we will see if Canonical regrets the quite substantial changes<br>
to net/ipv4 of the Linux Kernel, or if that is here to stay. It would be<br>
quite bad indeed: I would have to respin a full Isabelle2018-1 release,<br>
and older releases from the past 5 years would remain unusable.</p>
<p>In the meantime I am still interested to hear about further experience<br>
reports. There is also some chance that Debian has the same problem, or<br>
that it actually originates from Debian.</p>
<p>Makarius</p>



<a name="294745361"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294745361" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294745361">(Aug 22 2022 at 18:33)</a>:</h4>
<p>From: Lars Hupel &lt;<a href="mailto:hupel@in.tum.de">hupel@in.tum.de</a>&gt;<br>
Am I right in assuming that this does not affect "isabelle build"?</p>



<a name="294745374"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294745374" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294745374">(Aug 22 2022 at 18:33)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Yes, it only affects PIDE sessions, e.g. Isabelle/jEdit, or newer tools<br>
like "isabelle server", "isabelle dump".</p>
<p>Makarius</p>



<a name="294745907"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294745907" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294745907">(Aug 22 2022 at 18:37)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
After returning from travel and updating my Ubuntu 18.04 LTS<br>
workstation, I still see the same problem with linux-image-4.15.0-34-generic</p>
<p>Ubuntu 18.10 beta appears to work fine. The final release is scheduled<br>
for 18-Oct-2018.</p>
<p>Right now I am inclined to wait for that release, and see if its kernel<br>
also prevents Isabelle/PIDE from working as in the past 5 years.</p>
<p>Are there other Linuxes that are affected to really slow processing of<br>
big sessions in Isabelle/jEdit?</p>
<p>Makarius</p>



<a name="294746171"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294746171" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294746171">(Aug 22 2022 at 18:38)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On 13/10/2018 14:30, Makarius wrote:</p>
<blockquote>
<blockquote>
<blockquote>
<p><a href="http://isabelle.in.tum.de/repos/isabelle/rev/6ededdc829bb">http://isabelle.in.tum.de/repos/isabelle/rev/6ededdc829bb</a></p>
</blockquote>
<p>Next week we will see if Canonical regrets the quite substantial changes<br>
to net/ipv4 of the Linux Kernel, or if that is here to stay. It would be<br>
quite bad indeed: I would have to respin a full Isabelle2018-1 release,<br>
and older releases from the past 5 years would remain unusable.</p>
</blockquote>
<p>After returning from travel and updating my Ubuntu 18.04 LTS<br>
workstation, I still see the same problem with linux-image-4.15.0-34-generic</p>
</blockquote>
<p>Ubuntu 18.10 has been released yesterday, and so far the kernel looks<br>
fine for Isabelle2018.</p>
<p>Ubuntu 18.04.1 LTS is still unchanged: Isabelle/PIDE is unusably slow.</p>
<blockquote>
<p>Are there other Linuxes that are affected to really slow processing of<br>
big sessions in Isabelle/jEdit?</p>
</blockquote>
<p>Nobody has reported problems for other Linux systems. Only two people<br>
have confirmed the problem for Ubuntu 18.04.1.</p>
<p>For now I am assuming that zero reports really means zero problems on<br>
other Linux systems.</p>
<p>Until the situation becomes worse, e.g. Ubuntu 18.10 other Linux<br>
distributions with non-working kernel, I will not venture on producing<br>
another Isabelle release just to workaround problems on Ubuntu 18.04.1.</p>
<p>Makarius</p>



<a name="294746289"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294746289" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294746289">(Aug 22 2022 at 18:39)</a>:</h4>
<p>From: Peter Lammich &lt;<a href="mailto:lammich@in.tum.de">lammich@in.tum.de</a>&gt;<br>
I'm using the LTS versions of Ubuntu ... this thread on the mailing<br>
list has prevented me from upgradig so far, in order to avoid getting<br>
an unusable Isabelle.</p>
<p>So what to do after upgrading, if I need a usable Isabelle2018?</p>



<a name="294746305"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294746305" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294746305">(Aug 22 2022 at 18:40)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Dear Isabelle users,</p>
<p>I have the impression that a recent update within the existing Ubuntu<br>
18.04 line causes significant slowdown of socket I/O in Java. This<br>
effect may be seen in the Isabelle Prover IDE when openining a big<br>
session with many sources: it becomes unusably slow.</p>
<p>For now I recommend not to update Ubuntu -- maybe the problem disappears<br>
after a few days by further updates from Canonical.</p>
<p>In the meantime, I continue my experiments to understand the cause for<br>
this problem. I am also grateful to any TCP experts providing helpful<br>
hints, see also<br>
<a href="http://isabelle.in.tum.de/repos/isabelle/file/Isabelle2018/src/Pure/System/system_channel.scala">http://isabelle.in.tum.de/repos/isabelle/file/Isabelle2018/src/Pure/System/system_channel.scala</a><br>
(the socket is later used with read() calls of given lengths).</p>
<p>Makarius</p>



<a name="294746356"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294746356" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294746356">(Aug 22 2022 at 18:40)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Or the Isabelle website:</p>
<p>"""<br>
Warning: potential problem with Ubuntu Linux 18.04</p>
<p>The kernel update linux-image-4.15.0-36-generic (Oct-2018) introduces a<br>
timing problem with socket communication in the Isabelle Prover IDE,<br>
notably Isabelle/jEdit. Thus loading big sessions becomes very slow<br>
(e.g. theory HOL-Library.Library or HOL-Analysis.Analysis). This can be<br>
avoided by downgrading to linux-image-4.15.0-34-generic or by using the<br>
following temporary workaround for Isabelle2018.<br>
<a href="https://isabelle.in.tum.de/Isabelle_05-Oct-2018/Isabelle_05-Oct-2018_app.tar.gz">https://isabelle.in.tum.de/Isabelle_05-Oct-2018/Isabelle_05-Oct-2018_app.tar.gz</a><br>
"""</p>
<p>Makarius</p>



<a name="294746426"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294746426" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294746426">(Aug 22 2022 at 18:40)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Canonical has just published another kernel update for Ubuntu 18.04 LTS:<br>
linux-generic-4.15.0.38.40, and our recent Isabelle versions work again!</p>
<p>So they did regret the deadly change after almost 3 weeks. This probably<br>
also indicates that Ubuntu 18.10 will not acquire the same problem.</p>
<p>Makarius</p>



<a name="294746486"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294746486" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294746486">(Aug 22 2022 at 18:41)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
The included changeset ch-tcp_delay is a potential workaround for this<br>
potential problem:</p>
<p>changeset:   69119:9380c63aa8cf<br>
tag:         tip<br>
parent:      68743:91162dd89571<br>
user:        wenzelm<br>
date:        Thu Oct 04 16:40:03 2018 +0200<br>
files:       src/Pure/General/socket_io.ML<br>
src/Pure/System/system_channel.scala<br>
description:<br>
avoid TCP_NODELAY (in contrast to 18c621069bf8): might cause problems<br>
with some versions of Ubuntu 18.04;</p>
<p>It works for Isabelle2018, but requires a repository clone of that,<br>
instead of a bundled release. This means one needs to follow<br>
<a href="http://isabelle.in.tum.de/repos/isabelle/file/Isabelle2018/README_REPOSITORY">http://isabelle.in.tum.de/repos/isabelle/file/Isabelle2018/README_REPOSITORY</a><br>
and use "hg up -r Isabelle2018" after cloning the repository and before<br>
building anything.</p>
<p>Isabelle users who don't experience any problems with Isabelle/jEdit<br>
performance should not do anything.</p>
<p>I am still unsure what change of Ubuntu 18.04 causes this odd effect: I<br>
have seen it on two machines independently after update. Maybe it is<br>
some bad interaction of defaults for TCP_NODELAY and TCP_QUICKACK. I am<br>
including my own "sysctl -a" diffs for anybody who can read these tea<br>
leaves.</p>
<p>Just by coincidence there will be a Linux TCP code reading session at<br>
Curry Club Augsburg today: <a href="https://curry-club-augsburg.de">https://curry-club-augsburg.de</a> -- maybe I<br>
understand this better afterwards.</p>
<p>Makarius<br>
<a href="/user_uploads/14278/3yA0kADv1PQbbXbmOeVwsqos/ch-tcp_delay">ch-tcp_delay</a><br>
<a href="/user_uploads/14278/34amvzKJmGHO95o3-0VxH5T0/sysctl.diff">sysctl.diff</a></p>



<a name="294746650"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Potential%20problems%20with%20socket%20I/O%20after%20Ubunt.../near/294746650" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Potential.20problems.20with.20socket.20I.2FO.20after.20Ubunt.2E.2E.2E.html#294746650">(Aug 22 2022 at 18:42)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
The critical package is: linux-image-4.15.0-36-generic</p>
<p>The previous version still works: linux-image-4.15.0-34-generic</p>
<p>Is there anybody who can confirm the problem with Ubuntu Linux Kernel<br>
4.15.0-36? And that it works again after downgrading the package?</p>
<p>The effect is that Isabelle/jEdit socket communication between<br>
Isabelle/ML and Isabelle/Scala is painfully slow, e.g. when opening<br>
$ISABELLE_HOME/src/HOL/Library/Library.thy or<br>
$ISABELLE_HOME/src/HOL/Analysis/Analysis.thy</p>
<p>It can also be avoided by removing the following line in Isabelle/Scala:<br>
<a href="http://isabelle.in.tum.de/repos/isabelle/file/Isabelle2018/src/Pure/System/system_channel.scala#l29">http://isabelle.in.tum.de/repos/isabelle/file/Isabelle2018/src/Pure/System/system_channel.scala#l29</a><br>
(but that requires a repository clone of Isabelle2018 to rebuild it<br>
afterwards).</p>
<p>Makarius</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>