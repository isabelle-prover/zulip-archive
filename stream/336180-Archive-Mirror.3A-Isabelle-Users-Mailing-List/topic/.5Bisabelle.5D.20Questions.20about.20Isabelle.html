<html>
<head><meta charset="utf-8"><title>[isabelle] Questions about Isabelle · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Questions.20about.20Isabelle.html">[isabelle] Questions about Isabelle</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294112364"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Questions%20about%20Isabelle/near/294112364" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Questions.20about.20Isabelle.html#294112364">(Aug 18 2022 at 15:40)</a>:</h4>
<p>From: Tambet &lt;<a href="mailto:qtvali@gmail.com">qtvali@gmail.com</a>&gt;<br>
Sorry for reposting, but I had a few errors (whole day played with Isabelle,<br>
now a bit blurry). This is the same message with errors fixed (hope that<br>
moderator catches the previous one).</p>
<p>Hello!</p>
<p>I would like to ask a few questions about Isabelle, because in a day of<br>
reading manuals and testing things, I have some questions needed to do<br>
anything at all left unanswered.</p>
<p>I did, in previous few days, study about Coq, but found out that Isabelle<br>
language use is much more intuitive to me and it has some tools built-in,<br>
which Coq lacks.</p>
<p>However, now I have a number of problems:</p>
<p>- Loading built-in libraries is extremely slow. Is there any kind of<br>
   caching, compilation or preloading technique to make it faster?</p>
<p>- Built-in heuristics tool does not solve things and I think that this is<br>
   related to some bias in my understanding of semantics, because things are<br>
   really trivial.</p>
<p>- Search of patterns is extremely slow - is Isabelle meant only for<br>
   supercomputers and clusters?</p>
<p>Next thing that I quite much do not understand the Class semantics. I am<br>
used to programming languages, mostly imperative, but with many plays with<br>
others, but it's a first try I try to use prover. I am actually completely<br>
lost with that.</p>
<p>I give concrete examples about what I want to do to get on track:</p>
<p>I want to prove several things about Collatz sequences. For that, I tried<br>
(taking fibonaccy series and primes theories as examples) to just formulate<br>
a class, which contains all positive naturals. I did write fixes clause with<br>
'a =&gt; bool and definition that it's over zero. After that I tried to prove<br>
with heuristics, that even integers of that class are bigger than one - this<br>
failed. I tried to unfold the definition from class, but wasn't able to do<br>
that. Now I think that maybe this class does not provide me that check at<br>
all? It's basically copy of similar class from primes with definitions for<br>
naturals removed as I thought that maybe it does not have enough rules for<br>
naturals.</p>
<p>Also, as I'm not even conscious about what exactly to ask, is this possible<br>
to just give me random important hints about good strategies and common<br>
biases related to proving similar things:</p>
<p>I would like to define the following properties to numbers:</p>
<p>Collatz itself, is this OK:</p>
<p>fun<br>
  collatzNext :: "int \&lt;Rightarrow&gt; int"<br>
where<br>
  "collatzNext n =<br>
   (if (n \&lt;in&gt; even) then (n div (2::int)) else<br>
   (if (n \&lt;in&gt; odd) then ((3::int) * n) + (1::int) else<br>
   1))"</p>
<p>I am somewhat worried about this last else clause - it should not be "1",<br>
but undefined. Such output is not possible as I'm considering only the<br>
typical version of Collatz with naturals. I would like to do in one step:<br>
create class that collatz(i) or smth. is positive natural so that I could<br>
use it in definitions (instead of writing everywhere the clause &gt;0) and<br>
prove that thus, it's output is also positive natural (I imagine that this<br>
proof will be automatically asked from me when defining such function?) I<br>
wasn't able to prove this trivial thing - actually I wasn't able to even<br>
prove that things belonging to my class of positive naturals are always<br>
bigger than zero. Thus, maybe the class was totally wrong? I haven't done<br>
classes with Haskell, I am only tried Haskell for a few days as my<br>
girlfriend learns it (sometimes) and I do not want to take the fun away by<br>
knowing better. Anyway, I am now stuck with Isabelle classes - or do I need<br>
a class at all?</p>
<p>Second, I would like to define such things:<br>
"follows a b" for a comes after b in series.<br>
"nextto a b" for b is right after a.<br>
I would better like to use something like a \&lt;before&gt; b and a \&lt;rightbefore&gt;<br>
b.</p>
<p>I would like to have everything after a available as sequence for this class<br>
of rules:<br>
head (collatzSequence a) \&lt;in&gt; even.<br>
first (collatzSequence a) \&lt;in&gt; even. - how to argument about concrete<br>
position, for example that third element is first even element and thus,<br>
second element is last odd element in this series?</p>
<p>I would also like to (check and) prove the following lemmas:</p>
<p>I am playing with Coq and Isabelle now :) Formalizing the following:</p>
<p>fun p(a) = if (p(a) % 2 = 0) then (p(a div 2)) else (a).<br>
The greatest divisor of a, which is power of two = p(a).</p>
<p>I want to show that the number of multiplication-addition series always<br>
equals p(a+1) and gives odd result for odd, even result for even and follows<br>
the formula (((3/2)*<em>(p(a+1)))</em>a+1)-1.<br>
This should be trivial by binary analysis - how to use that and mix with<br>
other parts?</p>
<p>I want to show that because of this even-odd differentiation, 3n+1 series is<br>
never called more than twice in a row. This follows from upper.</p>
<p>I want to show that for any even number, all following even numbers will<br>
have p(n) &gt;= a(n) and that when looked from the position of n/2, that will<br>
come back to even if n/2 it started with was odd and vice versa, because<br>
div2 can't possibly change oddity of any upper level.</p>
<p>Thus, starting from even it leads to odd (next number) and starting from odd<br>
it leads to even (smaller number). Modulus is built in such way that p(n)<br>
for each even number is p(n)+1 related to it's division by two and this p(n)<br>
is how many times it will be divided by two, thus p(n) for any following<br>
even is big enough to lead to smaller number (n/2+1 for next one, as numbers<br>
grow, also this p(n) grows and thus, even leads to following(n)&lt;=n+1).</p>
<p>I want, thus, to show that the sequence always eventually leads to smaller<br>
number than it started from or 1.</p>
<p>Which classes and other stuff I should use for all that?</p>
<p>Tambet</p>
<p>Brute-force (python) check for those lemmas follows:</p>
<h1>-<em>- coding: utf-8 -</em>-</h1>
<p>def iterCollatz(number, included=False):<br>
  if number == 0:<br>
    return<br>
  if included:<br>
    yield number<br>
  while number != 4:<br>
    while number % 2 == 0:<br>
      number /= 2<br>
      yield number<br>
    number *= 3<br>
    number += 1<br>
    if number != 4:<br>
      yield number<br>
    else:<br>
      return</p>
<p>def pow(number, p):<br>
  # For integers<br>
  if p == 0:<br>
    return 1<br>
  r = 1<br>
  for a in range(0,p):<br>
    r *= number<br>
  return r</p>
<p>def maxp2(number):<br>
  # Count the zeros at end of number<br>
  a = number<br>
  p = 0<br>
  while a % 2 == 0 and a &gt; 1:<br>
    a /= 2<br>
    p += 1<br>
  return p</p>
<p>def nextp2(number):<br>
  b = 1<br>
  while b &lt; number:<br>
    b *= 2<br>
  return b</p>
<p>def simulate(number):<br>
  times = maxp2(number+1)<br>
  result = pow(3, times) * (number + 1) / pow(2, times) - 1<br>
  # print "Guess: " + str(result)<br>
  for b in iterCollatz(number):<br>
    if b == result:<br>
      # print "Guess correct"<br>
      return<br>
  print "Guess wrong"</p>
<p>def pattern(start, length, highlight=-1):<br>
  s = ""<br>
  for a in range(start, start+length):<br>
    if a &lt; 0:<br>
      n = "-"<br>
    elif maxp2(a) == 0:<br>
      n = "o"<br>
    elif maxp2(a) &gt; 9:<br>
      n = "+"<br>
    else:<br>
      n = "%1d" % maxp2(a)<br>
    if a == highlight:<br>
      n = "*%s" % n<br>
    elif highlight != -1:<br>
      n = " %s" % n<br>
    s += n<br>
  return s</p>
<p>def patternDiff(start, start2, length, highlight=-1):<br>
  s = ""<br>
  for a in range(0, length):<br>
    d = maxp2(a+start) - maxp2(a+start2)<br>
    if a+start &lt; 0 or a+start2 &lt; 0:<br>
      n = "-"<br>
    if d == 0:<br>
      n = "o"<br>
    if d == -1:<br>
      n = "A"<br>
    if d == -2:<br>
      n = "B"<br>
    if d == -3:<br>
      n = "C"<br>
    elif d &lt; 0:<br>
      n = "!"<br>
    elif d &gt; 9:<br>
      n = "+"<br>
    else:<br>
      n = "%1d" % (maxp2(a+start) - maxp2(a+start2))<br>
    if a+start == highlight:<br>
      n = "*%s" % n<br>
    elif highlight != -1:<br>
      n = " %s" % n<br>
    s += n<br>
  return s</p>
<p>def patternShiftSeq(start, length, count):<br>
  print "Init: %8d %s" % (start, pattern(start, length))<br>
  for i in range(0, count):<br>
    print "Diff: %8d %s %d" % (start + length*i, patternDiff(start +<br>
length*i, start, length), start)<br>
    print "Self: %8d %s" % (start + length<em>i, pattern(start + length</em>i,<br>
length))</p>
<p>def patternMulSeq(number, length, count):<br>
  print "Init: %8d %s" % (number, pattern(number, length))<br>
  for i in range(0, count):<br>
    print "Diff: %8d %s %d" % (number * pow(2, i), patternDiff(number *
pow(2, i), number, length), number)<br>
    print "Self: %8d %s" % (number * pow(2, i), pattern(number * pow(2, i),<br>
length))</p>
<p>def patternMul3Seq(start, length, count, shift, difp=-1):<br>
  if shift % 2 == 0:<br>
    print "Error: there is no 3n for even value"<br>
  for i in range(1 + shift, count * length + shift, length):<br>
    print "Diff: %8d %s %d" % (((start + i)*3+1)/2, patternDiff(((start +<br>
i)*3+1)/2, start + i, length), start + i)<br>
    print "Prev: %8d %s" % (start + i, pattern(start, length))<br>
    if difp != -1:<br>
      print "Dif+: %8d %s %d" % (((start + i)*3+1)/2, patternDiff(((start +<br>
i)*3+1)/2, start + difp, length), start + difp)<br>
      print "Pre+: %8d %s" % (start + difp, pattern(start + difp, length))<br>
    print "Next: %8d %s" % (((start + i)*3+1)/2, pattern(((start +<br>
i)*3+1)/2, length))</p>
<p>def collatzPattern(number):<br>
  for b in iterCollatz(number):<br>
    print "%4d %s" % (b, pattern(b-25, 25, b))</p>
<p>def Series(a):<br>
  s = ""<br>
  d = []<br>
  while a != 1:<br>
    a = a + 1<br>
    p = 0<br>
    while a % 2 == 0:<br>
      #s += " "<br>
      d += [1]<br>
      a = a / 2<br>
      p += 1<br>
    s += str(p)<br>
  return s</p>
<p>def Collatz1(a):<br>
  t = 0<br>
  b = a / pow(2, maxp2(a))<br>
  c = a / pow(2, maxp2(a))<br>
  for a in iterCollatz(a):<br>
    if a % 2 == 1:<br>
      if t == 0:<br>
        c = a<br>
      if t &gt; 1 and b % 2 == 0:<br>
        print "Error"<br>
      if t &gt; 1 and c+1 &lt; a == 0:<br>
        c = a<br>
      if t &gt; 1 and b &lt; a:<br>
        print "Error"<br>
      #print t, b &gt; a<br>
      #print "%10d %30s" % (a, Series(a)), b<br>
      t = 0<br>
      b = a<br>
    else:<br>
      t += 1</p>
<p>for a in range(1, 100000):<br>
  Collatz1(a)</p>



<a name="294112390"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Questions%20about%20Isabelle/near/294112390" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Questions.20about.20Isabelle.html#294112390">(Aug 18 2022 at 15:40)</a>:</h4>
<p>From: Lawrence Paulson &lt;<a href="mailto:lp15@cam.ac.uk">lp15@cam.ac.uk</a>&gt;<br>
I took a quick look at your problem and attach a small theory file, in which I define your collatzNext function and prove a trivial property of it. To undertake the project you describe, you just have to do one step at a time, and your first step should be to read the tutorial: <a href="http://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/Isabelle/doc/tutorial.pdf">http://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/Isabelle/doc/tutorial.pdf</a></p>
<p>It will take a while before you can become proficient enough to do a challenging project.<br>
Larry Paulson</p>
<p>theory Collatz<br>
imports Parity<br>
begin</p>
<p>definition<br>
 collatzNext :: "nat \&lt;Rightarrow&gt; nat"<br>
where<br>
 "collatzNext n = (if even n then (n div 2) else 3*n + 1)"</p>
<p>lemma "0&lt;n \&lt;Longrightarrow&gt; 0 &lt; collatzNext n"<br>
apply (auto simp add: collatzNext_def)<br>
apply (metis Suc_n_div_2_gt_zero lemma_even_div2)<br>
done</p>



<a name="294112407"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Questions%20about%20Isabelle/near/294112407" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Questions.20about.20Isabelle.html#294112407">(Aug 18 2022 at 15:40)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
If you do not need negative numbers, I suggest to use nat instead of int.</p>
<p>Tobias</p>
<p>Tambet schrieb:</p>



<hr><p>Last updated: Feb 22 2026 at 20:30 UTC</p>
</html>