<html>
<head><meta charset="utf-8"><title>[isabelle] Scala code generator: how to write code genera... · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Scala.20code.20generator.3A.20how.20to.20write.20code.20genera.2E.2E.2E.html">[isabelle] Scala code generator: how to write code genera...</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294244781"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Scala%20code%20generator%3A%20how%20to%20write%20code%20genera.../near/294244781" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Scala.20code.20generator.3A.20how.20to.20write.20code.20genera.2E.2E.2E.html#294244781">(Aug 19 2022 at 11:27)</a>:</h4>
<p>From: Christoph LANGE &lt;<a href="mailto:math.semantic.web@gmail.com">math.semantic.web@gmail.com</a>&gt;<br>
Dear all,</p>
<p>in writing Scala wrappers around code generated by the Isabelle Scala<br>
generator I'm realising that things start becoming hard to maintain.</p>
<p>For now I'm mainly generating code for a few functions in one Isabelle<br>
theory, but soon I will generate code from multiple Isabelle theories;<br>
let's call them A.thy and B.thy.</p>
<p>Both Isabelle theories have shared dependencies in the Isabelle library.<br>
 This gives me redundant copies of such code, e.g. I end up having an<br>
"object Set" defined both in A.scala and B.scala.  Thus another thing I<br>
want to do becomes infeasible:</p>
<p>I would like to implement user interfaces around A.scala and B.scala,<br>
let me call them A_UI.scala and B_UI.scala, and these user interfaces<br>
will need functions such as a pretty-printer that turns Set(List(1, 2))<br>
into "{1, 2}".  This pretty-printer I would like to implement once,<br>
centrally, in a shared Scala module Shared.scala.  However, this would<br>
require me to be able to instruct the code generator to:</p>
<ul>
<li>write "object Set" into another module, say, Set.scala</li>
<li>and to let A.scala and B.scala import Set.scala instead of having<br>
their own copies of "object Set".</li>
</ul>
<p>I did notice section "6.4 Intimate connection between logic and system<br>
runtime" in the codegen manual, but I'm not sure whether this is of<br>
general interest (and whether it's relevant to my problem), or whether<br>
it only applies to ML code generation.</p>
<p>Assuming that what I want is not currently possible, is there at least a<br>
workaround?  What do other code generator users do?</p>
<p>I understand that once more it makes the generated code less trustable,<br>
as now we'd also have to trust the module system of the target language.<br>
 But still I'd like to be able to maintain software that uses generated<br>
code.</p>
<p>Cheers, and thanks in advance for any help,</p>
<p>Christoph</p>



<a name="294244871"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Scala%20code%20generator%3A%20how%20to%20write%20code%20genera.../near/294244871" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Scala.20code.20generator.3A.20how.20to.20write.20code.20genera.2E.2E.2E.html#294244871">(Aug 19 2022 at 11:28)</a>:</h4>
<p>From: Andreas Lochbihler &lt;<a href="mailto:andreas.lochbihler@inf.ethz.ch">andreas.lochbihler@inf.ethz.ch</a>&gt;<br>
Dear Christoph,</p>
<p>The code generator always outputs all code for what is needed to implement the specified <br>
constants. From a modularity point of view, this is a bit unsatisfactory. I usually use <br>
one of two workarounds:</p>
<p>a) Do not use module_name when exporting code. Then, the code generator puts every theory <br>
into a separate module (you can configure this to some extent with code_modulename). <br>
Unless you have naming conflicts between your theories, this should give you the same <br>
object Set for A.thy and B.thy (if both use the same operations on sets). This works <br>
particularly well for Haskell because the code generator already puts every module into a <br>
separate file. So if you set the same output directory for A and B, you just get the <br>
module once. For SML and Scala, all modules are in a single file for A and once more in a <br>
single file for B. But you can just split the files at the module boundaries with a simple <br>
script.</p>
<p>Note that without module_name in the export_code statement, you face the notorious <br>
"dependency cycle" problem. This occurs particularly if you heavily employ the refinement <br>
features of the code generator. Then, you have to manually adjust the module assignment <br>
with code_modulename.</p>
<p>b) Define a shared theory AB.thy that imports A and B and export all functions of A and B <br>
in one export_code statement. Then, you only have one file and one instance of every <br>
module. Your user interfaces then simply ignore the code that do not belong to A or B, resp.</p>
<p>To go this way, you must be able to merge theories A and B. In particular, they must not <br>
have each a theory of the same name, and they must not instantiate the same type class for <br>
the same type. You can avoid the former by renaming theories. And if the latter occurs, <br>
sharing gets you in trouble anyway. For example, suppose that A uses the prefix order on <br>
lists and B the lexicographic order from the appropriate HOL/Library theories.<br>
If you shared the List module between A and B, your code would probably become incorrect, <br>
because the List module also contains the instantiations for the type classes, i.e., you <br>
would either run A with the lexicographic order or B with the prefix order.</p>
<p>Best,<br>
Andreas</p>



<a name="294245599"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Scala%20code%20generator%3A%20how%20to%20write%20code%20genera.../near/294245599" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Scala.20code.20generator.3A.20how.20to.20write.20code.20genera.2E.2E.2E.html#294245599">(Aug 19 2022 at 11:32)</a>:</h4>
<p>From: Florian Haftmann &lt;<a href="mailto:florian.haftmann@informatik.tu-muenchen.de">florian.haftmann@informatik.tu-muenchen.de</a>&gt;<br>
Hi Christoph,</p>
<p>beyond what Andreas has mentioned, future Isabelle releases will bring<br>
options for fine-grained control over the module name space of generated<br>
code.  This could also give a (partial) answer to your issues.</p>
<p>Cheers,<br>
    Florian<br>
<a href="/user_uploads/14278/TCd4YrI_se2oGtW4WYW2Bwm9/signature.asc">signature.asc</a></p>



<a name="294246239"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20Scala%20code%20generator%3A%20how%20to%20write%20code%20genera.../near/294246239" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20Scala.20code.20generator.3A.20how.20to.20write.20code.20genera.2E.2E.2E.html#294246239">(Aug 19 2022 at 11:37)</a>:</h4>
<p>From: Christoph LANGE &lt;<a href="mailto:math.semantic.web@gmail.com">math.semantic.web@gmail.com</a>&gt;<br>
Hi Andreas,</p>
<p>thanks for your help, and sorry for replying so late.  I was at a<br>
conference and on holiday and only resumed working with generated code<br>
today.</p>
<p>2013-07-08 08:44 Andreas Lochbihler:<br>
This is what I will try for now.</p>
<p>I wrote the following script; feel free to reuse it.</p>
<p><a href="https://codex.cs.bham.ac.uk/svn/langec/formare/code/auction/isabelle/Auction/code/split-scala-modules.pl">https://codex.cs.bham.ac.uk/svn/langec/formare/code/auction/isabelle/Auction/code/split-scala-modules.pl</a><br>
(user: guest, password: guest)</p>
<p>For now please bear with the access control, but we are planning to move<br>
to Github.</p>
<p>I will also make the script available in a nicer way at<br>
<a href="http://www.cs.bham.ac.uk/research/projects/formare/code/auction-theory/isabelle">http://www.cs.bham.ac.uk/research/projects/formare/code/auction-theory/isabelle</a>.</p>
<p>Cheers,</p>
<p>Christoph</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>