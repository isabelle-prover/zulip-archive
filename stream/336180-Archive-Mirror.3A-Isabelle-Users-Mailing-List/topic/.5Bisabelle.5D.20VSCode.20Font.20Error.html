<html>
<head><meta charset="utf-8"><title>[isabelle] VSCode Font Error · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html">[isabelle] VSCode Font Error</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294763064"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20VSCode%20Font%20Error/near/294763064" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html#294763064">(Aug 22 2022 at 20:36)</a>:</h4>
<p>From: Kevin Kappelmann &lt;<a href="mailto:kevin.kappelmann@tum.de">kevin.kappelmann@tum.de</a>&gt;<br>
I wanted to use Isabelle2019 with VSCode. However, I cannot open the<br>
state panel as the following error is thrown:</p>
<p>*** Consumer thread failure: "Session.dispatcher"<br>
*** Consumer failed: "isabelle.vscode.State_Panel"<br>
*** java.util.NoSuchElementException: key not found: <a href="http://IsabelleDejaVuSans.tt">IsabelleDejaVuSans.tt</a></p>
<p>I did install the font on my system (Ubuntu 18.04). In particular, I can<br>
use it in VSCode. Anyone any ideas or similar experiences?</p>
<p>For people using Zulip, here is the corresponding discussion:<br>
<a href="#narrow/stream/202961-general/topic/VS.20Code">https://isabelle.zulipchat.com/#narrow/stream/202961-general/topic/VS.20Code</a><br>
(screenshot appended for non-zulip users).</p>
<p>Best wishes,</p>
<p>Kevin.<br>
<a href="/user_uploads/14278/7f8qeyb7D52stbtwbV2bPAHx/zulip_vs_code.png">zulip_vs_code.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/14278/7f8qeyb7D52stbtwbV2bPAHx/zulip_vs_code.png" title="zulip_vs_code.png"><img src="/user_uploads/14278/7f8qeyb7D52stbtwbV2bPAHx/zulip_vs_code.png"></a></div>



<a name="294763094"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20VSCode%20Font%20Error/near/294763094" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html#294763094">(Aug 22 2022 at 20:36)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On 20/09/2019 11:28, Kevin Kappelmann wrote:</p>
<blockquote>
<p>I wanted to use Isabelle2019 with VSCode. However, I cannot open the<br>
state panel as the following error is thrown:</p>
<p>*** Consumer thread failure: "Session.dispatcher"<br>
*** Consumer failed: "isabelle.vscode.State_Panel"<br>
*** java.util.NoSuchElementException: key not found: <a href="http://IsabelleDejaVuSans.tt">IsabelleDejaVuSans.tt</a></p>
<p>I did install the font on my system (Ubuntu 18.04). In particular, I can<br>
use it in VSCode. Anyone any ideas or similar experiences?</p>
</blockquote>
<p>Just a guess from a distance:</p>
<p>apt-get install -y libfontconfig1</p>
<p>See also <a href="https://hub.docker.com/r/makarius/isabelle">https://hub.docker.com/r/makarius/isabelle</a> for Linux<br>
requirements formalized via Docker.</p>
<p>Note that one thing is the VSCode editor front-end, another thing the<br>
Isabelle/Scala backend. A Java exception means that the backend cannot<br>
open the font, but that is configured automatically via Isabelle system<br>
settings.</p>
<blockquote>
<p>For people using Zulip, here is the corresponding discussion:<br>
<a href="#narrow/stream/202961-general/topic/VS.20Code">https://isabelle.zulipchat.com/#narrow/stream/202961-general/topic/VS.20Code</a><br>
(screenshot appended for non-zulip users).</p>
</blockquote>
<p>A discussion over many information exchange platforms is difficult. I<br>
don't have the time to follow yet another cool new thing.</p>
<p>Makarius</p>



<a name="294763101"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20VSCode%20Font%20Error/near/294763101" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html#294763101">(Aug 22 2022 at 20:36)</a>:</h4>
<p>From: Kevin Kappelmann &lt;<a href="mailto:kevin.kappelmann@tum.de">kevin.kappelmann@tum.de</a>&gt;<br>
Thanks for the hint, but sadly, libfontconfig1 is already installed on<br>
my machine. I started debugging the extension in VSCode. Here is the<br>
stack trace I get when trying to open the preview panel:</p>
<p>[Error - 15:27:42] java.util.NoSuchElementException: key not found:<br>
IsabelleDejaVuSans.ttf<br>
Exception in thread "event_timer" java.util.NoSuchElementException: key<br>
not found: IsabelleDejaVuSans.ttf<br>
    at scala.collection.MapLike.default(MapLike.scala:231)<br>
    at scala.collection.MapLike.default$(MapLike.scala:230)<br>
    at scala.collection.AbstractMap.default(Map.scala:59)<br>
    at scala.collection.MapLike.apply(MapLike.scala:140)<br>
    at scala.collection.MapLike.apply$(MapLike.scala:139)<br>
    at scala.collection.AbstractMap.apply(Map.scala:59)<br>
    at isabelle.HTML$.font_face$1(html.scala:366)<br>
    at isabelle.HTML$.$anonfun$fonts_css$1(html.scala:371)<br>
    at scala.collection.immutable.List.map(List.scala:282)<br>
    at isabelle.HTML$.fonts_css(html.scala:371)<br>
    at isabelle.Present$.output_document$1(present.scala:120)<br>
    at isabelle.Present$.preview(present.scala:138)<br>
    at isabelle.vscode.Preview_Panel.$anonfun$flush$2(preview_panel.scala:33)<br>
    at<br>
scala.collection.TraversableOnce.$anonfun$foldLeft$1(TraversableOnce.scala:156)<br>
    at<br>
scala.collection.TraversableOnce.$anonfun$foldLeft$1$adapted(TraversableOnce.scala:156)<br>
    at scala.collection.Iterator.foreach(Iterator.scala:937)<br>
    at scala.collection.Iterator.foreach$(Iterator.scala:937)<br>
    at scala.collection.AbstractIterator.foreach(Iterator.scala:1425)<br>
    at scala.collection.TraversableOnce.foldLeft(TraversableOnce.scala:156)<br>
    at scala.collection.TraversableOnce.foldLeft$(TraversableOnce.scala:154)<br>
    at scala.collection.AbstractIterator.foldLeft(Iterator.scala:1425)<br>
    at scala.collection.TraversableOnce.$div$colon(TraversableOnce.scala:150)<br>
    at scala.collection.TraversableOnce.$div$colon$(TraversableOnce.scala:150)<br>
    at scala.collection.AbstractIterator.$div$colon(Iterator.scala:1425)<br>
    at isabelle.vscode.Preview_Panel.$anonfun$flush$1(preview_panel.scala:27)<br>
    at isabelle.Synchronized.change_result(synchronized.scala:73)<br>
    at isabelle.vscode.Preview_Panel.flush(preview_panel.scala:24)<br>
    at isabelle.vscode.Server.$anonfun$delay_preview$2(server.scala:210)<br>
    at isabelle.Standard_Thread$Delay.run(standard_thread.scala:64)<br>
    at<br>
isabelle.Standard_Thread$Delay.$anonfun$invoke$1(standard_thread.scala:77)<br>
    at isabelle.Event_Timer$$anon$1.run(event_timer.scala:27)<br>
    at java.base/java.util.TimerThread.mainLoop(Timer.java:556)<br>
    at java.base/java.util.TimerThread.run(Timer.java:506)</p>
<p>What source is isabelle.HTML$.font_face using to load fonts? Is it<br>
looking in a specific folder or asking the system via some API for the<br>
fonts?</p>



<a name="294763112"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20VSCode%20Font%20Error/near/294763112" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html#294763112">(Aug 22 2022 at 20:36)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
The relevant Isabelle/Scala source is here:</p>
<p><a href="https://isabelle.in.tum.de/repos/isabelle/file/Isabelle2019/src/Pure/Thy/html.scala#l359">https://isabelle.in.tum.de/repos/isabelle/file/Isabelle2019/src/Pure/Thy/html.scala#l359</a></p>
<p>You can try to core operation like this:</p>
<p>$ isabelle scala<br>
  scala&gt; import isabelle._<br>
  scala&gt; Isabelle_Fonts.fonts(hidden = true)</p>
<p>See also<br>
<a href="https://isabelle.in.tum.de/repos/isabelle/file/Isabelle2019/src/Pure/System/isabelle_fonts.scala#l57">https://isabelle.in.tum.de/repos/isabelle/file/Isabelle2019/src/Pure/System/isabelle_fonts.scala#l57</a></p>
<p>Makarius</p>



<a name="294763118"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20VSCode%20Font%20Error/near/294763118" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html#294763118">(Aug 22 2022 at 20:36)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Actually, there is something wrong in Isabelle/VSCode of Isabelle2019: I<br>
get a similar exception trace.</p>
<p>Since this thread originated on Zulip Chat, I've somehow fallen into<br>
"chat mode" on this mailing list, too, and thus produced quick answers<br>
instead of good ones. I will now take time to figure out what the<br>
situation really is ...</p>
<p>Makarius</p>



<a name="294763130"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20VSCode%20Font%20Error/near/294763130" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html#294763130">(Aug 22 2022 at 20:36)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
See now the following change (for the next release after Isabelle2019):<br>
<a href="https://isabelle.in.tum.de/repos/isabelle/rev/342b0a1fc86d">https://isabelle.in.tum.de/repos/isabelle/rev/342b0a1fc86d</a></p>
<p>changeset:   70743:342b0a1fc86d<br>
tag:         tip<br>
user:        wenzelm<br>
date:        Sun Sep 22 19:04:11 2019 +0200<br>
summary:     proper file name instead of font name (amending dc9a39c3f75d);</p>
<p>This does not help much: VSCode has changed too much recently -- I get a<br>
lot of JavaScript/TypeScript exceptions when starting up the Isabelle<br>
extension. (When I tried it for the Isabelle2019 release, the situation<br>
was not as bad.)</p>
<p>Due to the highly dynamic nature of VSCode such total failures of<br>
existence are to be expected: When I published Isabelle/VSCode for the<br>
first time with Isabelle2017 (October 2017), it was already clear that a<br>
proper release would have to bundle a particular version of VSCode, like<br>
Isabelle already bundles Java, Scala, jEdit and many other things. This<br>
would annoy anybody who thinks that "latest" means "best" version, but<br>
it is inevitable for a stable application.</p>
<p>Makarius</p>



<a name="294763198"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20VSCode%20Font%20Error/near/294763198" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html#294763198">(Aug 22 2022 at 20:37)</a>:</h4>
<p>From: Kevin Kappelmann &lt;<a href="mailto:kevin.kappelmann@tum.de">kevin.kappelmann@tum.de</a>&gt;<br>
Thanks for the patch.</p>



<a name="294763223"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20VSCode%20Font%20Error/near/294763223" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html#294763223">(Aug 22 2022 at 20:37)</a>:</h4>
<p>From: Kevin Kappelmann &lt;<a href="mailto:kevin.kappelmann@tum.de">kevin.kappelmann@tum.de</a>&gt;<br>
(Pressed sent by accident at previous e-mail, sorry)</p>
<p>Thanks for the patch.<br>
The reason the state panel will not open now is that previewHtml was<br>
deprecated in November 2019 and removed earlier this year:<br>
<a href="https://github.com/microsoft/vscode/issues/62630">https://github.com/microsoft/vscode/issues/62630</a><br>
The fix is to use the Webview API instead:<br>
<a href="https://code.visualstudio.com/api/extension-guides/webview">https://code.visualstudio.com/api/extension-guides/webview</a><br>
I think this sadly cannot be done by just replacing one function call<br>
since it seems that the current extension was using content providers<br>
for TextDocuments, which I think cannot be used for Webviews.</p>
<p>I think making the Webview API work with the extension would be quite<br>
beneficial since we can then add more visual/interactive plugins to<br>
Isabelle, e.g. diagrams for category theory.</p>
<p>Kevin.</p>



<a name="294763531"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20VSCode%20Font%20Error/near/294763531" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20VSCode.20Font.20Error.html#294763531">(Aug 22 2022 at 20:39)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On 23/09/2019 17:37, Kevin Kappelmann wrote:</p>
<blockquote>
<p>The reason the state panel will not open now is that previewHtml was<br>
deprecated in November 2019 and removed earlier this year:<br>
<a href="https://github.com/microsoft/vscode/issues/62630">https://github.com/microsoft/vscode/issues/62630</a><br>
The fix is to use the Webview API instead:<br>
<a href="https://code.visualstudio.com/api/extension-guides/webview">https://code.visualstudio.com/api/extension-guides/webview</a><br>
I think this sadly cannot be done by just replacing one function call<br>
since it seems that the current extension was using content providers<br>
for TextDocuments, which I think cannot be used for Webviews.</p>
</blockquote>
<p><a href="https://code.visualstudio.com/api/extension-guides/webview">https://code.visualstudio.com/api/extension-guides/webview</a> is<br>
indeed the missing link that I was looking for. I have somehow lost<br>
track of the many ongoing changes in VSCode, but this looks like a<br>
long-awaited reform for custom HTML content.</p>
<blockquote>
<p>I think making the Webview API work with the extension would be quite<br>
beneficial since we can then add more visual/interactive plugins to<br>
Isabelle, e.g. diagrams for category theory.</p>
</blockquote>
<p>Yes, I have recently started to look at high-end graph editors like<br>
<a href="https://github.com/jgraph/mxgraph">https://github.com/jgraph/mxgraph</a></p>
<p>The HTML container of VSCode might help to make this accessible in the<br>
Isabelle Prover IDE, but Isabelle/VSCode is a very poor PIDE front-end<br>
at the moment.</p>
<p>It might be easier to upgrade the Java/Swing GUI environment of<br>
Isabelle/jEdit by Java Chromium Embedded<br>
<a href="https://bitbucket.org/chromiumembedded/java-cef">https://bitbucket.org/chromiumembedded/java-cef</a> and thus have the<br>
existing editor augmented by browser technology.</p>
<p>Makarius</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>