<html>
<head><meta charset="utf-8"><title>[isabelle] op =simp=&gt; in congruence rules · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html">[isabelle] op =simp=&gt; in congruence rules</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294287942"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20op%20%3Dsimp%3D%3E%20in%20congruence%20rules/near/294287942" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html#294287942">(Aug 19 2022 at 15:21)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
Dear Andres,</p>
<p>It is what it is mostly for historical reasons, but I also seem to recall that<br>
=simp=&gt; lead to nontermination in same cases (unsurprisingly) and that therefore<br>
we restricted its usage. You could try to replace map_cong by your map_cong' and<br>
see if anything breaks. If not, that would be a strong indication that the<br>
map-congruence rules generated by datatype should always use =simp=&gt;.</p>
<p>Tobias</p>



<a name="294288136"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20op%20%3Dsimp%3D%3E%20in%20congruence%20rules/near/294288136" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html#294288136">(Aug 19 2022 at 15:22)</a>:</h4>
<p>From: Andreas Lochbihler &lt;<a href="mailto:andreas.lochbihler@inf.ethz.ch">andreas.lochbihler@inf.ethz.ch</a>&gt;<br>
Dear Tobias,</p>
<p>Thanks for the background infos. I pushed the replacement of ==&gt; with =simp=&gt; to testboard <br>
(see <a href="http://isabelle.in.tum.de/testboard/Isabelle/rev/1cbcd78f8d3c">http://isabelle.in.tum.de/testboard/Isabelle/rev/1cbcd78f8d3c</a>). I expect a few proofs <br>
in the AFP to break, because they use apply(rule map_cong), but let's see.</p>
<p>Even if that is the only problem, I doubt that this will be a strong indication either <br>
way. A grep over the sources revealed just a few places where map_cong is used (map_cong <br>
is not a default congruence rule); probably because the [simp] rule map_eq_conv takes <br>
already care of map equalities.</p>
<p>Andreas</p>



<a name="294288359"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20op%20%3Dsimp%3D%3E%20in%20congruence%20rules/near/294288359" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html#294288359">(Aug 19 2022 at 15:23)</a>:</h4>
<p>From: Andreas Lochbihler &lt;<a href="mailto:andreas.lochbihler@inf.ethz.ch">andreas.lochbihler@inf.ethz.ch</a>&gt;<br>
Hi Tobias,</p>
<p>Here is the summary of =simp=&gt; vs. ==&gt; in the congruence rule for map. I replaced map_cong <br>
by map_cong' in List.thy and ran all of the Isabelle distribution (isabelle makeall) and <br>
the AFP, thereby fixing what was broken.</p>
<ol>
<li>
<p>Whenenver map_cong was used as a congruence rule, map_cong' also works, without looping.</p>
</li>
<li>
<p>I found three occurrences where map_cong was not used as [cong] that fail with map_cong'.</p>
</li>
</ol>
<p>a) In HOL/Word/Word.thy, it is used with rule. Using it as a congruence rule causes the <br>
simplifier to loop, but this is independent of whether ==&gt; or =simp=&gt; is used.</p>
<p>b) In the AFP entry Affine_Arithmetic is used with subst followed by auto.<br>
   (simp cong: map_cong') does not solve the goal, either.</p>
<p>c) In the AFP entry Matrix, there is an instance of the pattern<br>
   by(rule map_cong)(auto ...)<br>
Both (simp cong: map_cong) and (simp cong: map_cong') solve the goal, too.</p>
<p>In conclusion, =simp=&gt; does not break anything in the tested theories when map_cong is <br>
used as a congruence rule. Since [fundef_cong] does not handle =simp=&gt; and map_cong seems <br>
to be useful in some cases (2a,b), we should keep the version with ==&gt;. Possibly, BNF <br>
could also generate the congruence rule list.strong_map_cong with =simp=&gt;. The name follow <br>
the existing naming convention for ball, bex, SUP, INF, ... (Although I would prefer <br>
map_cong_strong because the main operator does not hide somewhere in the middle of the <br>
theorem name.)</p>
<p>Andreas</p>



<a name="294288384"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20op%20%3Dsimp%3D%3E%20in%20congruence%20rules/near/294288384" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html#294288384">(Aug 19 2022 at 15:23)</a>:</h4>
<p>From: Jasmin Christian Blanchette &lt;<a href="mailto:jasmin.blanchette@gmail.com">jasmin.blanchette@gmail.com</a>&gt;<br>
Hi Andreas,</p>
<p>Thanks for your thorough investigation.</p>
<blockquote>
<p>In conclusion, =simp=&gt; does not break anything in the tested theories when map_cong is used as a congruence rule. Since [fundef_cong] does not handle =simp=&gt; and map_cong seems to be useful in some cases (2a,b), we should keep the version with ==&gt;. Possibly, BNF could also generate the congruence rule list.strong_map_cong with =simp=&gt;. The name follow the existing naming convention for ball, bex, SUP, INF, ... (Although I would prefer map_cong_strong because the main operator does not hide somewhere in the middle of the theorem name.)</p>
</blockquote>
<p>Good idea. I would also prefer "_strong" as a suffix, for consistency with other "_strong"ly-suffixed properties in BNF. We'll add it to our list. If nobody objects, I could also rename "strong_ball_cong" etc. to "ball_cong_strong" etc. (once Isabelle2014 is out).</p>
<p>Cheers,</p>
<p>Jasmin</p>



<a name="294288397"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20op%20%3Dsimp%3D%3E%20in%20congruence%20rules/near/294288397" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html#294288397">(Aug 19 2022 at 15:23)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
Hi Andreas,</p>
<p>Thanks for that. For me it sounds pretty conclusive that we should follow your<br>
recommendation: let BNF generate both map_cong and map_cong_strong.</p>
<p>Thanks!<br>
Tobias</p>



<a name="294288414"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20op%20%3Dsimp%3D%3E%20in%20congruence%20rules/near/294288414" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html#294288414">(Aug 19 2022 at 15:23)</a>:</h4>
<p>From: Tobias Nipkow &lt;<a href="mailto:nipkow@in.tum.de">nipkow@in.tum.de</a>&gt;<br>
It would improve uniformity.</p>
<p>Tobias</p>



<a name="294288432"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20op%20%3Dsimp%3D%3E%20in%20congruence%20rules/near/294288432" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html#294288432">(Aug 19 2022 at 15:23)</a>:</h4>
<p>From: Dmitriy Traytel &lt;<a href="mailto:traytel@in.tum.de">traytel@in.tum.de</a>&gt;<br>
I would even argue that there is nothing "strong" about those rules <br>
(since op =simp=&gt; = op ==&gt;). So if renaming anyway, maybe ball_cong_simp <br>
or even ball_cong_simp_implies is a better name?</p>
<p>Dmitriy</p>



<a name="294288564"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20op%20%3Dsimp%3D%3E%20in%20congruence%20rules/near/294288564" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html#294288564">(Aug 19 2022 at 15:24)</a>:</h4>
<p>From: Florian Haftmann &lt;<a href="mailto:florian.haftmann@informatik.tu-muenchen.de">florian.haftmann@informatik.tu-muenchen.de</a>&gt;<br>
I have no strong opinion about the naming schema itself, but it should<br>
be uniform afterwards.</p>
<p>Also note that the situation with sum and prod and sets is a little<br>
delicate and demands a suffix pattern due to interpretation, e.g.<br>
foo.strong_cong.</p>
<p>Cheers,<br>
    Florian<br>
<a href="/user_uploads/14278/d_OdIplOejXU1MSdYSJJLgzj/signature.asc">signature.asc</a></p>



<a name="294294036"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20op%20%3Dsimp%3D%3E%20in%20congruence%20rules/near/294294036" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20op.20.3Dsimp.3D.3E.20in.20congruence.20rules.html#294294036">(Aug 19 2022 at 15:46)</a>:</h4>
<p>From: Andreas Lochbihler &lt;<a href="mailto:andreas.lochbihler@inf.ethz.ch">andreas.lochbihler@inf.ethz.ch</a>&gt;<br>
I wondered why the congruence rule for map does not enable the simplifier to solve <br>
statements such as the following. Such statements occur naturally with the induction rules <br>
from the new datatype package when recursion goes through a list.</p>
<p>lemma "(⋀x. x ∈ set xs ⟹ f x = g x) ⟹ h (map f (rev xs)) = h (map g (rev xs))"<br>
   apply(simp cong: list.map_cong)</p>
<p>Then, I found he following comment on op =simp=&gt; in HOL.thy:</p>
<p>text {*<br>
     The following copy of the implication operator is useful for<br>
     fine-tuning congruence rules.  It instructs the simplifier to simplify<br>
     its premise.<br>
   *}</p>
<p>definition simp_implies :: "[prop, prop] =&gt; prop"  (infixr "=simp=&gt;" 1) where<br>
     "simp_implies ≡ op ==&gt;"</p>
<p>A look at the usages of op =simp=&gt; showed that it is only used in congruence rules for the <br>
big operators and bounded quantification. In particular, all of them use it in the form</p>
<p>!!x. x : ?B =simp=&gt; ?f x = ?g x</p>
<p>and the same form shows up in list.map_cong. And indeed, if list.map_cong were</p>
<p>lemma map_cong': "⟦xs = ys; ⋀x. x ∈ set ys =simp=&gt; f x = g x⟧ ⟹ map f xs = map g ys"<br>
   unfolding simp_implies_def by(rule list.map_cong)</p>
<p>then simp would be able to solve the above goal:</p>
<p>by(simp cong: map_cong')</p>
<p>My question now is: What is the advantage of op ==&gt; over op =simp=&gt; in congruence rules, <br>
i.e., list.map_cong over map_cong'? Since the BNF package generates congruence rules with <br>
the structure</p>
<p>!!x. x : set_type ?A ==&gt; f x = g x</p>
<p>would it be sensible to use =simp=&gt; there?</p>
<p>By the way, I noticed that [fundef_cong] cannot deal with =simp=&gt;. But that should not be <br>
the only reason for having the weaker cong rule.</p>
<p>Best,<br>
Andreas</p>



<hr><p>Last updated: Feb 22 2026 at 20:30 UTC</p>
</html>