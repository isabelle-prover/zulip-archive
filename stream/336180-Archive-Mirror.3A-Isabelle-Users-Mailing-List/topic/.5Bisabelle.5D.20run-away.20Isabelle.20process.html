<html>
<head><meta charset="utf-8"><title>[isabelle] run-away Isabelle process · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html">[isabelle] run-away Isabelle process</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294639741"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294639741" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294639741">(Aug 22 2022 at 09:46)</a>:</h4>
<p>From: "Elsa L. Gunter" &lt;<a href="mailto:egunter@illinois.edu">egunter@illinois.edu</a>&gt;<br>
Dear Isabelle Community,<br>
   I am having grave problems with the execution of Isabelle-2014, and I <br>
have not found a thread on this mailing list that seems to address my <br>
problem.  Isabelle is taking arbitrarily long in between steps of proof, <br>
and other things, where arbitrarily long is minutes to hours to <br>
overnight without completing.  And while I suspect that I may be <br>
contributing to the problem by there being a rewrite that I have added <br>
that has led to a non-confluent system, the system tight now has taken <br>
more then an hour to try to do a thin_tac, which should never be <br>
non-terminating.  And despite the length of time I have waited, it <br>
almost surely will come back, eventually (in the temporal logic sense of <br>
unbounded eventually). But this is making it really painful to try to <br>
make any progress.<br>
   Some background for anybody who might have an idea how to help me.  <br>
First, my system is a mac running Mac OX X 10.9.5 (maverick, with <br>
patches); processor is a 2.8 GHz Intel Core 17 with 4 cores (1 <br>
processor), 16 GB 1600 MHz DDR3 Memory.  I am running Isabelle 2014 with <br>
a fairly recent version of the Archive of Formal Proofs.  My preferences <br>
file is quite minimal, and makes no mention of threads.   My code <br>
depends on the List-Infinite and JinjaThreads.  I have a collection of <br>
twelve locally developed theories upon which I also depend.   The local <br>
theories accumulate to something more than 10000 loc. I have previously <br>
built a heap containing the AFP theories, and I start form that heap.  I <br>
thought I might reduce the problem by building a heap containing the all <br>
the local theories upon which I depend, but that build never terminated <br>
(I let it run overnight, ~10 hours).  I found that strange, since it <br>
takes about 10 minutes for it to build the local theories upon which I <br>
am depending when I am interactively loading the desired theory from a <br>
base containing just the AFP stuff I need.  I've tried it twice, but it <br>
is a time-consuming, unproductive exercise.<br>
   When Isabelle is semi-non-responsive, it usually colors all of the <br>
text grey (not purple).  I haven't been able to tell which of the greys <br>
it is.   Just now, while writing this message, the thin_tac I requested <br>
can back (correctly), and then I deleted the line after it, causing the <br>
cursor to be again immediately after the thin_tac.  The text was greyed <br>
out again, and then after a couple of minutes it became clear with the <br>
thin_tac line yellow, but it is failing to display the output.  I <br>
presume it will in a little while.   I have had problems along these <br>
lines, but less severe ever since switching to jEdit from Proof General, <br>
with the problem seeming to grow some since the beginning of the <br>
semester (January), but with it getting an order of magnitude worse in <br>
the last week.  The problem's getting worse seemed to be temporally <br>
correlated with my doing a proof that involved a term that was about 40 <br>
lines long (the term, that is).  Other than that, I'm not using metis or <br>
smt, and rarely auto or force or blast.  simp and clarsimp get used a <br>
fair amount, so nonterminating rewrites might have something to do with <br>
my problem, except I would expect it to just always fail to come back, <br>
which is not its behavior.  There are a few bits of orange (warnings) in <br>
some of the files upon which I depend, but I have removed them all from <br>
the current file.  I have observed that ambiguous parses, where only one <br>
is type correct, slow Isabelle down very considerably.  My proofs ar a <br>
mix of Isar style and old apply style, with most of the recent additions <br>
being in the old apply style.    I do have a fairly large number of <br>
locales I'm working with, and doing a print_locale! is just out of the <br>
question.   Each time the evaluation has to go through the creation of a <br>
new layer of locale by combining specialized versions of previous one, <br>
together with additions, that is always a choke point in the <br>
computation.  I can't  think of any other observations I have made that <br>
might be relevant.<br>
   This matter is rather urgent to me. I am teaching a course this <br>
semester based on the use of Isabelle, with students working on a large <br>
combined project, each with his or her own part.  I need to be helping <br>
them fairly regularly, in part by giving them extra lemmas about the <br>
core infrastructure that groups of them need to overcome various hurdles <br>
they face in their subprojects.  I have told them lemma statements to <br>
add to their code with a sorry, and they are proceeding with these, but <br>
the course ends next week, and it would be a great pity not to be able <br>
to provide them with a sense of closure from having all theorems really <br>
and truly proved.  Also, so far the students do not seem to be <br>
struggling with Isabelle delays to the extent I am, but if they suddenly <br>
start having the same problems, I can not feasibly ask them to continue <br>
their work, with would definitely leave them with a lack of closure.  I <br>
would appreciate any help anyone can give to improve this situation.<br>
---Elsa</p>



<a name="294639869"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294639869" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294639869">(Aug 22 2022 at 09:47)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On Sun, 3 May 2015, Elsa L. Gunter wrote:</p>
<blockquote>
<p>I am having grave problems with the execution of Isabelle-2014, and I <br>
have not found a thread on this mailing list that seems to address my <br>
problem.</p>
</blockquote>
<p>It generally sounds like a situation close to the proverbial "concrete <br>
wall" of system resource limits.  Only black holes and national debts can <br>
grow indefinitely, and for black holes it is not yet sure.</p>
<p>Below are some hints how to stretch resource paramaters a bit, and thus <br>
postpone the imminent meltdown.</p>
<blockquote>
<p>Isabelle is taking arbitrarily long in between steps of proof, and other <br>
things, where arbitrarily long is minutes to hours to overnight without <br>
completing.</p>
</blockquote>
<p>In such situations it is important to get an idea which part of Isabelle <br>
is busy.  There are two sides: Isabelle/ML and Isabelle/Scala, <br>
corresponding to two run-time system processes: poly and java.  With "top <br>
-o cpu" on the command-line of Mac OS X it should be possible to see a bit <br>
more.</p>
<p>Moreover, a Java process can be analyzed by jconsole, to get an idea about <br>
heap size, threads etc.  This tool is part of the bundled JDK of Isabelle <br>
in $JAVA_HOME/bin -- you can find that out as follows inside Isabelle:</p>
<p>ML {* getenv "JAVA_HOME" *}</p>
<blockquote>
<p>And while I suspect that I may be contributing to the problem by there <br>
being a rewrite that I have added that has led to a non-confluent <br>
system, the system tight now has taken more then an hour to try to do a <br>
thin_tac, which should never be non-terminating.</p>
</blockquote>
<p>Non-termination alone should not be a problem: you get deep-purple <br>
feedback in the Prover IDE, and should be able to delete the material to <br>
recover.  Serious problems are usually caused by:</p>
<p>(a) Massive amounts of "potentially useful tracing information" that<br>
       tool implementors sometimes leave in by default (which is very bad<br>
       programming style).  That is the easyiest way to bomb the front-end.</p>
<p>(b) Really huge intermediate goal states that are printed, either<br>
       accidentally or on purpose, e.g. via print_tac. It occasionally<br>
       helps to reduce output size like this:</p>
<p>declare [[goals_limit = 1, show_markup = false]]</p>
<blockquote>
<p>My code depends on the List-Infinite and JinjaThreads.  I have a <br>
collection of twelve locally developed theories upon which I also <br>
depend.  The local theories accumulate to something more than 10000 loc.</p>
</blockquote>
<p>This is already quite substantial material.  JinjaThreads is always at <br>
120% of system resources, no matter how much are available.</p>
<blockquote>
<p>I have previously built a heap containing the AFP theories, and I start <br>
form that heap.  I thought I might reduce the problem by building a heap <br>
containing the all the local theories upon which I depend, but that <br>
build never terminated (I let it run overnight, ~10 hours).  I found <br>
that strange, since it takes about 10 minutes for it to build the local <br>
theories upon which I am depending when I am interactively loading the <br>
desired theory from a base containing just the AFP stuff I need.</p>
</blockquote>
<p>Here I suspect that the JVM default heap is too small for this amount of <br>
sources.  Try something like this in $ISABELLE_HOME_USER/etc/settings:</p>
<p>ISABELLE_BUILD_JAVA_OPTIONS="-Djava.awt.headless=true -Xms1024m -Xmx4096m -Xss4m"</p>
<p>Using a suitable base image can significantly reduce the resource <br>
requirements of the Prover IDE.  Note that the build of the selected base <br>
session of the Prover IDE actually uses the JVM parameters of <br>
Isabelle/jEdit.  The above only applies to "isabelle build" on the <br>
command-line.</p>
<blockquote>
<p>When Isabelle is semi-non-responsive, it usually colors all of the text <br>
grey (not purple).  I haven't been able to tell which of the greys it <br>
is.</p>
</blockquote>
<p>That could be outdated_color.  You can change the color value in Plugin <br>
Options / Isabelle / Rendering to check this hypothesis.</p>
<blockquote>
<p>Just now, while writing this message, the thin_tac I requested can back <br>
(correctly), and then I deleted the line after it, causing the cursor to <br>
be again immediately after the thin_tac.  The text was greyed out again, <br>
and then after a couple of minutes it became clear with the thin_tac <br>
line yellow, but it is failing to display the output.  I presume it will <br>
in a little while.</p>
</blockquote>
<p>Here it is again important to know if poly or java is busy, or both. For <br>
example, it could be a rather long garbage collection of Poly/ML, which is <br>
normal with JinjaThreads in the back.  To amend this, you should use <br>
Poly/ML in 64bit mode like this in $ISABELLE_HOME_USER/etc/settings:</p>
<p>ML_PLATFORM="$ISABELLE_PLATFORM64"<br>
   ML_HOME="$ML_HOME/../$ML_PLATFORM"</p>
<p>Another possibility is JVM heap space.  You can enlarge that for the <br>
Prover IDE in the .app bundle Info.plist in its &lt;key&gt;JVMOptions&lt;/key&gt; <br>
entry.  For the command-line version of "isabelle jedit" the same <br>
information is in $ISABELLE_HOME_USER/etc/settings e.g.:</p>
<p>JEDIT_JAVA_OPTIONS="-Xms1024m -Xmx4096m -Xss4m"</p>
<p>In both situations, you need to "reboot" the application.</p>
<blockquote>
<p>The problem's getting worse seemed to be temporally correlated with my <br>
doing a proof that involved a term that was about 40 lines long (the <br>
term, that is).</p>
</blockquote>
<blockquote>
<p>I have observed that ambiguous parses, where only one is type correct, <br>
slow Isabelle down very considerably.</p>
</blockquote>
<p>Ambiguous grammars or input can cause exponential blowup of parse trees. <br>
With rather large terms, this can be a real problem.</p>
<blockquote>
<p>I do have a fairly large number of locales I'm working with, and doing a <br>
print_locale! is just out of the question.  Each time the evaluation has <br>
to go through the creation of a new layer of locale by combining <br>
specialized versions of previous one, together with additions, that is <br>
always a choke point in the computation.</p>
</blockquote>
<p>JinjaThreads is already stretching locales and locale interpretation <br>
beyond feasibilty.  If you build on top of some very big locales of that <br>
session, it is likely to cause problems.</p>
<p>Makarius</p>



<a name="294640211"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294640211" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294640211">(Aug 22 2022 at 09:49)</a>:</h4>
<p>From: "Elsa L. Gunter" &lt;<a href="mailto:egunter@illinois.edu">egunter@illinois.edu</a>&gt;<br>
On 5/3/15 2:22 PM, Makarius wrote:</p>
<blockquote>
<p>On Sun, 3 May 2015, Elsa L. Gunter wrote:</p>
<blockquote>
<p>I am having grave problems with the execution of Isabelle-2014, and I <br>
have not found a thread on this mailing list that seems to address my <br>
problem.</p>
</blockquote>
<p>It generally sounds like a situation close to the proverbial "concrete <br>
wall" of system resource limits.  Only black holes and national debts <br>
can grow indefinitely, and for black holes it is not yet sure.</p>
<p>Below are some hints how to stretch resource paramaters a bit, and <br>
thus postpone the imminent meltdown.</p>
<blockquote>
<p>Isabelle is taking arbitrarily long in between steps of proof, and <br>
other things, where arbitrarily long is minutes to hours to overnight <br>
without completing.</p>
</blockquote>
<p>In such situations it is important to get an idea which part of <br>
Isabelle is busy.  There are two sides: Isabelle/ML and <br>
Isabelle/Scala, corresponding to two run-time system processes: poly <br>
and java.  With "top -o cpu" on the command-line of Mac OS X it should <br>
be possible to see a bit more.<br>
Using the Activity monitor, it is primarily poly that is primary <br>
resource hog.  It is running at ~ 400% - 450~ cpu.  If I run top -o cpu  <br>
for a second or two and redirect the output to a file, poly will always <br>
exactly occur once near the top:</p>
</blockquote>
<p>[11d659   poly[11;20H403.8 81:49:39 14/4 0    28    12133  12G+ 12G-   0B</p>
<p>and JavaAppLaunc occurs repeatedly, lower down:</p>
<p>[19d623   JavaAppLaunc 0.1   19:47.99 65   7    333   2179   280M+ <br>
307M+  0B</p>
<blockquote>
<p>Moreover, a Java process can be analyzed by jconsole, to get an idea <br>
about heap size, threads etc.  This tool is part of the bundled JDK of <br>
Isabelle in $JAVA_HOME/bin -- you can find that out as follows inside <br>
Isabelle:</p>
<p>ML {* getenv "JAVA_HOME" *}</p>
<p>I can't do that right now (unless I kill my Isabelle process and <br>
restart) because Isabelle isn't paying any attention to me right now, <br>
for the last half hour.</p>
<blockquote>
<p>And while I suspect that I may be contributing to the problem by <br>
there being a rewrite that I have added that has led to a <br>
non-confluent system, the system tight now has taken more then an <br>
hour to try to do a thin_tac, which should never be non-terminating.</p>
</blockquote>
<p>Non-termination alone should not be a problem: you get deep-purple <br>
feedback in the Prover IDE, and should be able to delete the material <br>
to recover.  Serious problems are usually caused by:</p>
<p>(a) Massive amounts of "potentially useful tracing information" that<br>
      tool implementors sometimes leave in by default (which is very bad<br>
      programming style).  That is the easyiest way to bomb the <br>
front-end.<br>
show_types is off, and I'm not tracing anything (although I would like <br>
to if I dared).</p>
<p>(b) Really huge intermediate goal states that are printed, either<br>
      accidentally or on purpose, e.g. via print_tac. It occasionally<br>
      helps to reduce output size like this:</p>
<p>declare [[goals_limit = 1, show_markup = false]]<br>
I can do that, although mostly the size of each step is not that big.  <br>
The thing it is currently stuck on is only one goal that is 20 lines <br>
long with 6 short assumptions that are only one line a piece.</p>
<blockquote>
<p>My code depends on the List-Infinite and JinjaThreads.  I have a <br>
collection of twelve locally developed theories upon which I also <br>
depend.  The local theories accumulate to something more than 10000 loc.</p>
</blockquote>
<p>This is already quite substantial material.  JinjaThreads is always at <br>
120% of system resources, no matter how much are available.</p>
<p>I'm not actually taking all of JinjaThreads, but cherry picking the <br>
concurrency parts, since I'm not actually doing anything with Jinja/Java <br>
in this project (although I am in another).</p>
<blockquote>
<p>I have previously built a heap containing the AFP theories, and I <br>
start form that heap.  I thought I might reduce the problem by <br>
building a heap containing the all the local theories upon which I <br>
depend, but that build never terminated (I let it run overnight, ~10 <br>
hours).  I found that strange, since it takes about 10 minutes for it <br>
to build the local theories upon which I am depending when I am <br>
interactively loading the desired theory from a base containing just <br>
the AFP stuff I need.</p>
</blockquote>
<p>Here I suspect that the JVM default heap is too small for this amount <br>
of sources.  Try something like this in $ISABELLE_HOME_USER/etc/settings:</p>
<p>ISABELLE_BUILD_JAVA_OPTIONS="-Djava.awt.headless=true -Xms1024m <br>
-Xmx4096m -Xss4m"<br>
I will try adding this to my settings.</p>
<p>Using a suitable base image can significantly reduce the resource <br>
requirements of the Prover IDE.  Note that the build of the selected <br>
base session of the Prover IDE actually uses the JVM parameters of <br>
Isabelle/jEdit.  The above only applies to "isabelle build" on the <br>
command-line.</p>
<p>I've been building my heaps via isabelle jEdit -d &lt;&lt;path to ROOT, <br>
typically .&gt;&gt; -l &lt;&lt;heap name&gt;&gt; instead of using isabelle build, because <br>
I was having trouble with isabelle build and I thought you said you <br>
always went through a command-line call to isabelle jEdit.</p>
<blockquote>
<p>When Isabelle is semi-non-responsive, it usually colors all of the <br>
text grey (not purple).  I haven't been able to tell which of the <br>
greys it is.</p>
</blockquote>
<p>That could be outdated_color.  You can change the color value in <br>
Plugin Options / Isabelle / Rendering to check this hypothesis.</p>
<p>Which field should I change?  There are several greys, and my eyes <br>
aren't good enough to tell them apart.</p>
<blockquote>
<p>Just now, while writing this message, the thin_tac I requested can <br>
back (correctly), and then I deleted the line after it, causing the <br>
cursor to be again immediately after the thin_tac.  The text was <br>
greyed out again, and then after a couple of minutes it became clear <br>
with the thin_tac line yellow, but it is failing to display the <br>
output.  I presume it will in a little while.</p>
</blockquote>
<p>Here it is again important to know if poly or java is busy, or both. <br>
For example, it could be a rather long garbage collection of Poly/ML, <br>
which is normal with JinjaThreads in the back.  To amend this, you <br>
should use Poly/ML in 64bit mode like this in <br>
$ISABELLE_HOME_USER/etc/settings:</p>
<p>ML_PLATFORM="$ISABELLE_PLATFORM64"<br>
  ML_HOME="$ML_HOME/../$ML_PLATFORM"<br>
I am using Isabelle is 64 bit mode, as per an earlier suggestion you <br>
made to me.  My setting file contains extactly:</p>
</blockquote>
<p>ML_PLATFORM="$ISABELLE_PLATFORM64"<br>
ML_HOME="$POLYML_HOME/$ML_PLATFORM"<br>
ML_OPTIONS="--minheap 2000 --maxheap 12000"</p>
<blockquote>
<p>Another possibility is JVM heap space.  You can enlarge that for the <br>
Prover IDE in the .app bundle Info.plist in its &lt;key&gt;JVMOptions&lt;/key&gt; <br>
entry.  For the command-line version of "isabelle jedit" the same <br>
information is in $ISABELLE_HOME_USER/etc/settings e.g.:</p>
<p>JEDIT_JAVA_OPTIONS="-Xms1024m -Xmx4096m -Xss4m"<br>
I will add this too, and try rebooting the application.  And I will run <br>
it from the command-line, at least unitl that proves not to work as well.</p>
<p>In both situations, you need to "reboot" the application.</p>
<blockquote>
<p>The problem's getting worse seemed to be temporally correlated with <br>
my doing a proof that involved a term that was about 40 lines long <br>
(the term, that is).</p>
</blockquote>
<blockquote>
<p>I have observed that ambiguous parses, where only one is type <br>
correct, slow Isabelle down very considerably.</p>
</blockquote>
<p>Ambiguous grammars or input can cause exponential blowup of parse <br>
trees. With rather large terms, this can be a real problem.</p>
<p>The term was not ambiguous, and because I have observed the grief <br>
ambiguous terms cause, I have removed most mixfix syntax from my input <br>
code.  I would be useful if I could shut off the pretty printing for <br>
mixfix as well so that isabelle could parse what it prints.  I have shut <br>
off abbreviations, but i have not found a flag for the mixfix.</p>
<blockquote>
<p>I do have a fairly large number of locales I'm working with, and <br>
doing a print_locale! is just out of the question.  Each time the <br>
evaluation has to go through the creation of a new layer of locale by <br>
combining specialized versions of previous one, together with <br>
additions, that is always a choke point in the computation.</p>
</blockquote>
<p>JinjaThreads is already stretching locales and locale interpretation <br>
beyond feasibilty.  If you build on top of some very big locales of <br>
that session, it is likely to cause problems.</p>
<p>We are only borrowing the theory of bisimulation from JinjaThreads, not <br>
the whole Jinja concurrent semantics.  bisimulation alone is big, but I <br>
thought it was less than a quarter of all of JinjaThreads.  I could be <br>
wrong, but I think the total code I'm adding on top of bisimulation is <br>
less than the amount I have left out of JinjaThreads.</p>
<p>Makarius<br>
Thank you for your attempt to help me.  If the changes to the settings <br>
helps, I will let you know.<br>
---Elsa</p>
</blockquote>



<a name="294640619"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294640619" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294640619">(Aug 22 2022 at 09:52)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On Sun, 3 May 2015, Elsa L. Gunter wrote:</p>
<blockquote>
<p>Using the Activity monitor, it is primarily poly that is primary resource <br>
hog.  It is running at ~ 400% - 450~ cpu.  If I run top -o cpu  for a second <br>
or two and redirect the output to a file, poly will always exactly occur once <br>
near the top:</p>
<p>[11d659   poly[11;20H403.8 81:49:39 14/4 0    28    12133  12G+ 12G-   0B</p>
</blockquote>
<p>Here we see 12G already, which means Poly/ML is practically at the maximum <br>
of your 16GB machine.</p>
<blockquote>
<p>and JavaAppLaunc occurs repeatedly, lower down:</p>
<p>[19d623   JavaAppLaunc 0.1   19:47.99 65   7    333   2179   280M+ 307M+ <br>
0B</p>
</blockquote>
<p>I can't say on the spot if this is the actual JVM run-time system.  It <br>
might be just the launcher, and a second big "java" process is elsewhere. <br>
Normally the Prover IDE requires a few GB for such big things.</p>
<blockquote>
<p>I'm not actually taking all of JinjaThreads, but cherry picking the <br>
concurrency parts, since I'm not actually doing anything with Jinja/Java in <br>
this project (although I am in another).</p>
</blockquote>
<p>OK.  Do you have all that base material in the base heap image?  Or is it <br>
loaded into the Prover IDE interactively?</p>
<blockquote>
<blockquote>
<blockquote>
<p>When Isabelle is semi-non-responsive, it usually colors all of the text <br>
 grey (not purple).  I haven't been able to tell which of the greys it <br>
 is.</p>
</blockquote>
<p>That could be outdated_color.  You can change the color value in Plugin<br>
 Options / Isabelle / Rendering to check this hypothesis.</p>
<p>Which field should I change?  There are several greys, and my eyes aren't <br>
good enough to tell them apart.</p>
</blockquote>
</blockquote>
<p>The left column has all colors in alphabetical order.  There should be an <br>
entry "Outdated color" with some pinkish grey.</p>
<blockquote>
<p>I would be useful if I could shut off the pretty printing for mixfix as <br>
well so that isabelle could parse what it prints.  I have shut off <br>
abbreviations, but i have not found a flag for the mixfix.</p>
</blockquote>
<p>If it is your own mixfix syntax, you could specify an explicit print mode <br>
and turn that on/off on demand.  But I don't think that is needed: doing <br>
mixfix syntax right, without ambiguities, it should parse and print <br>
nicely.</p>
<blockquote>
<p>We are only borrowing the theory of bisimulation from JinjaThreads, not <br>
the whole Jinja concurrent semantics.  bisimulation alone is big, but I <br>
thought it was less than a quarter of all of JinjaThreads.  I could be <br>
wrong, but I think the total code I'm adding on top of bisimulation is <br>
less than the amount I have left out of JinjaThreads.</p>
</blockquote>
<p>This sounds quite reasonable.  JinjaThreads contains many interesting <br>
things, well-hidden to potentially interested parties.</p>
<p>If you want, you can send me your development privately, so that I can <br>
experiment with it a bit on my modest 12 core, 32 GB machine.</p>
<p>Makarius</p>



<a name="294641796"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294641796" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294641796">(Aug 22 2022 at 10:00)</a>:</h4>
<p>From: "Elsa L. Gunter" &lt;<a href="mailto:egunter@illinois.edu">egunter@illinois.edu</a>&gt;<br>
Dear Makarius,<br>
   Your previous message got me enough wiggle room to get the immediate <br>
theorm I was working on to go through.</p>
<p>On 5/3/15 3:48 PM, Makarius wrote:</p>
<blockquote>
<p>On Sun, 3 May 2015, Elsa L. Gunter wrote:</p>
<blockquote>
<p>Using the Activity monitor, it is primarily poly that is primary <br>
resource hog.  It is running at ~ 400% - 450~ cpu.  If I run top -o <br>
cpu  for a second or two and redirect the output to a file, poly will <br>
always exactly occur once near the top:</p>
<p>[11d659   poly[11;20H403.8 81:49:39 14/4 0    28    12133 12G+ <br>
12G-   0B</p>
</blockquote>
<p>Here we see 12G already, which means Poly/ML is practically at the <br>
maximum of your 16GB machine.</p>
<blockquote>
<p>and JavaAppLaunc occurs repeatedly, lower down:</p>
<p>[19d623   JavaAppLaunc 0.1   19:47.99 65   7    333   2179 280M+ <br>
307M+ 0B</p>
</blockquote>
<p>I can't say on the spot if this is the actual JVM run-time system.  It <br>
might be just the launcher, and a second big "java" process is <br>
elsewhere. Normally the Prover IDE requires a few GB for such big things.<br>
I don't see java itself showing up.  I think polyml is the hog.</p>
<blockquote>
<p>I'm not actually taking all of JinjaThreads, but cherry picking the <br>
concurrency parts, since I'm not actually doing anything with <br>
Jinja/Java in this project (although I am in another).</p>
</blockquote>
<p>OK.  Do you have all that base material in the base heap image? Or is <br>
it loaded into the Prover IDE interactively?<br>
Almost.  There is a in List-Inifinite that needs to be included because <br>
of some reorganizing of the AFP entry.  Everything I need from <br>
JinjaThreads is in my precompiled heap.</p>
<blockquote>
<blockquote>
<blockquote>
<p>When Isabelle is semi-non-responsive, it usually colors all of <br>
the text &gt; grey (not purple).  I haven't been able to tell which of <br>
the greys it &gt;  is.</p>
</blockquote>
<p>That could be outdated_color.  You can change the color value in <br>
Plugin<br>
 Options / Isabelle / Rendering to check this hypothesis.</p>
<p>Which field should I change?  There are several greys, and my eyes <br>
aren't good enough to tell them apart.</p>
</blockquote>
</blockquote>
<p>The left column has all colors in alphabetical order.  There should be <br>
an entry "Outdated color" with some pinkish grey.</p>
<p>OK.  I have changed it to a kind of light lime green that I think I will <br>
not confuse with anything else.  Since it isn't choking yet (although it <br>
still runs at 200% CPU with over 8 GB of memory when I have not <br>
requested it to do anything), I cn't tell it tha tis the color of a choke.</p>
</blockquote>
<p>Just what is Isabelle (polyml) doing when the cursor is sitting at the <br>
end of a fully successfully completed proof?  I would have expected it <br>
to be waiting for user input before doing anything else, but it keeps <br>
running something. The energy impact of Isabelle is over ten times more <br>
than everything else on my system combined, and I'm lazy about leaving <br>
stuff around.</p>
<blockquote>
<blockquote>
<p>It would be useful if I could shut off the pretty printing for mixfix <br>
as well so that isabelle could parse what it prints.  I have shut off <br>
abbreviations, but i have not found a flag for the mixfix.</p>
</blockquote>
<p>If it is your own mixfix syntax, you could specify an explicit print <br>
mode and turn that on/off on demand.  But I don't think that is <br>
needed: doing mixfix syntax right, without ambiguities, it should <br>
parse and print nicely.<br>
I have not found all the sources of the ambiguities, but loading two <br>
different theories that sue syntax that is unambiguous in itself can <br>
lead to ambiguous syntax.  Since there are no checks the mixfix syntax <br>
has been done right, it would be nice to have a way of pretty printing <br>
that was guaranteed to parse.  Shutting off mixfix I believe would do that.</p>
</blockquote>
<blockquote>
<blockquote>
<p>We are only borrowing the theory of bisimulation from JinjaThreads, <br>
not the whole Jinja concurrent semantics.  bisimulation alone is big, <br>
but I thought it was less than a quarter of all of JinjaThreads.  I <br>
could be wrong, but I think the total code I'm adding on top of <br>
bisimulation is less than the amount I have left out of JinjaThreads.</p>
</blockquote>
<p>This sounds quite reasonable.  JinjaThreads contains many interesting <br>
things, well-hidden to potentially interested parties.</p>
<p>If you want, you can send me your development privately, so that I can <br>
experiment with it a bit on my modest 12 core, 32 GB machine.</p>
</blockquote>
<blockquote>
<p>Makarius</p>
<p>Thank you for your help and your offer for more.  I hope/think I can now <br>
limp through the next week.  However, this has caused me to wonder how I <br>
can continue to use Isabelle for the project on which I am embarked.  I <br>
am only at the beginning and if I am running out of resources now, I'm <br>
not sure how I could hope to carry my project to completion.<br>
---Elsa</p>
</blockquote>



<a name="294642127"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294642127" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294642127">(Aug 22 2022 at 10:02)</a>:</h4>
<p>From: Thomas Sewell &lt;<a href="mailto:thomas.sewell@nicta.com.au">thomas.sewell@nicta.com.au</a>&gt;<br>
Hello Elsa.</p>
<p>I'm not completely sure about this, but I have taken the following<br>
actions a couple of times and I <em>think</em> they might have reduced polyML's<br>
memory footprint.</p>
<p>1) Restart Isabelle if polyML is getting too big. I am anecdotally<br>
convinced that sometimes polyML's heap size drifts upwards over time,<br>
and that a restart can reset this.</p>
<p>2) Try enabling "skip-proofs" during the reset while rebuilding up to<br>
where you were before. You can find an option for skipping proofs in<br>
Isabelle's options panel: jEdit menu Plugins-&gt;Plugin Options, pick<br>
Isabelle-&gt;General, find the skip proofs setting. This will not only save<br>
time, it will cause polyML to build less proof-related objects<br>
internally, which may save memory.</p>
<p>Caveat emptor ; all of the above may simply be a superstitious ritual I<br>
go through as a result of confirmation bias.</p>
<p>Good luck,<br>
     Thomas.</p>
<hr>
<p>The information in this e-mail may be confidential and subject to legal professional privilege and/or copyright. National ICT Australia Limited accepts no liability for any damage caused by this email or its attachments.</p>



<a name="294642266"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294642266" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294642266">(Aug 22 2022 at 10:03)</a>:</h4>
<p>From: "Elsa L. Gunter" &lt;<a href="mailto:egunter@illinois.edu">egunter@illinois.edu</a>&gt;<br>
Thank you, Thomas.  I will add these to my set of options.<br>
---Elsa</p>



<a name="294642293"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294642293" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294642293">(Aug 22 2022 at 10:03)</a>:</h4>
<p>From: Matthew Fernandez &lt;<a href="mailto:matthew.fernandez@nicta.com.au">matthew.fernandez@nicta.com.au</a>&gt;<br>
Another strategy I find useful is processing the following line when you're running very low on<br>
available memory, which I believe forces a garbage collection.</p>
<p>ML {* PolyML.fullGC () *}</p>
<p>Forcing a garbage collection in a managed language seems rather silly, but I have found it is<br>
sometimes the only way to regain a responsive system.</p>
<hr>
<p>The information in this e-mail may be confidential and subject to legal professional privilege and/or copyright. National ICT Australia Limited accepts no liability for any damage caused by this email or its attachments.</p>



<a name="294642468"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294642468" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294642468">(Aug 22 2022 at 10:04)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
On Sun, 3 May 2015, Elsa L. Gunter wrote:</p>
<blockquote>
<p>Since it isn't choking yet (although it still runs at 200% CPU with over <br>
8 GB of memory when I have not requested it to do anything), I cn't tell <br>
it tha tis the color of a choke.</p>
<p>Just what is Isabelle (polyml) doing when the cursor is sitting at the <br>
end of a fully successfully completed proof?  I would have expected it <br>
to be waiting for user input before doing anything else, but it keeps <br>
running something. The energy impact of Isabelle is over ten times more <br>
than everything else on my system combined, and I'm lazy about leaving <br>
stuff around.</p>
</blockquote>
<p>Isabelle/PIDE is no longer based on a TTY loop, so it is not really <br>
waiting for the next user input.  Rather the editor is continously <br>
streaming edits towards the prover, and the prover continously streaming <br>
results towards the editor.  In practice, this eventually converges, and <br>
both sides can become mostly idle, except for a few percent of CPU time.</p>
<p>If you see 200% CPU usage of poly, despite nothing really going on, it is <br>
something to be investigated.  E.g. there could be a bit too much garbage <br>
collection due to excessive use of heap space.  Or there could be "auto <br>
tools" that did not terminate and could not be canceled properly, or even <br>
just long-running tasks to print proof states after scrolling in the <br>
editor.</p>
<p>Isabelle/jEdit also has a Monitor panel to inspect certain aspects of the <br>
ML run-time system.</p>
<blockquote>
<p>I hope/think I can now limp through the next week.  However, this has <br>
caused me to wonder how I can continue to use Isabelle for the project <br>
on which I am embarked.  I am only at the beginning and if I am running <br>
out of resources now, I'm not sure how I could hope to carry my project <br>
to completion.</p>
</blockquote>
<p>Looking in just the right corners of big projects usually helps to get a <br>
factor 2 improvement concerning resource usage.</p>
<p>Moreover, I have already some ideas to reduce the ML heap space <br>
requirements once again, but not for this release of Isabelle2015. The <br>
question is how long we can hold out in 32bit address space, without <br>
having to move to 64bit and thus practically into the cloud, e.g. see the <br>
sketches on my blog <br>
<a href="http://sketis.net/2015/proposal-remote-prover-connectivity-for-isabellepide">http://sketis.net/2015/proposal-remote-prover-connectivity-for-isabellepide</a></p>
<p>Makarius</p>



<a name="294642870"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294642870" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294642870">(Aug 22 2022 at 10:07)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
Here is a rather drastic way to reclaim a lot of heap space by maximal <br>
sharing of equal data structures:</p>
<p>ML "ML_System.share_common_data ()"</p>
<p>It can take minutes, but can shrink the heap by a factor of 2-3, or more. <br>
This is normally used when dumping heap images.</p>
<p>A limited form of that is also used in normal operation of the Poly/ML <br>
runtime-system.  It is the reason why most applications still work within <br>
the tiny 32bit address space.</p>
<p>David Matthews can say more about the various GC phases of Poly/ML.</p>
<p>The "Monitor" dockable in Isabelle/jEdit also has a heap section, which <br>
helps to get some idea about resource usage, and the effect of the above <br>
operations.  Note that while the run-time system is busy doing such jobs, <br>
there is no update of the statistics, because the ML user space is <br>
inactive.</p>
<p>Makarius</p>



<a name="294643013"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20run-away%20Isabelle%20process/near/294643013" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20run-away.20Isabelle.20process.html#294643013">(Aug 22 2022 at 10:08)</a>:</h4>
<p>From: David Matthews &lt;<a href="mailto:dm@prolingua.co.uk">dm@prolingua.co.uk</a>&gt;<br>
The garbage collector isn't just a simple case of: run out of heap; <br>
perform GC; resume.  Or at least it hasn't been for a very long time. <br>
The GC code has to decide whether to run a cheap, but incomplete minor <br>
collection; a full but more expensive major collection; increase or <br>
sometimes decrease the size of the heap or run the very expensive data <br>
sharing pass that Makarius mentions.  There's no easy answer to this <br>
because it depends on the pattern of allocations and the kind of data <br>
structures being built.  Indeed the best choice would really depend on <br>
what happens AFTER the collection; the application may be just on the <br>
point of completing when the GC decides to start an expensive operation.</p>
<p>The GC has heuristics to help decide what to do and uses the results of <br>
previous choices to guide the next choice.  For example, if a sharing <br>
pass was run and found lots of sharing it may be worth running it sooner <br>
rather than later.  Much of the tuning was done by looking at large <br>
Isabelle problems and JinjaThreads was the archetypal example.</p>
<p>I'm very happy to look at this and see whether the tuning can be <br>
improved or indeed if garbage collection is the issue or not.  It may be <br>
that there needs to be some extra hints to the GC that can be given as <br>
command line arguments in situations where a user is approaching the <br>
limits on their machine.  One suggestion I'd make is to increase the <br>
value of --maxheap closer to the memory available on your machine (e.g. <br>
--maxheap 14000).  It's not a good idea to increase it above the <br>
physical memory size since that can introduce thrashing but if you're <br>
close to the limit it could be better to tolerate a bit of it.</p>
<p>David</p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>