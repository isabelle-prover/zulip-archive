<html>
<head><meta charset="utf-8"><title>[isabelle] word wrapping in jEdit output panel · Archive Mirror: Isabelle Users Mailing List · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/index.html">Archive Mirror: Isabelle Users Mailing List</a></h2>
<h3>Topic: <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20word.20wrapping.20in.20jEdit.20output.20panel.html">[isabelle] word wrapping in jEdit output panel</a></h3>

<hr>

<base href="https://isabelle.zulipchat.com/">

<head><link href="http://isabelle.systems/zulip-archive/style.css" rel="stylesheet"></head>

<a name="294236883"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20word%20wrapping%20in%20jEdit%20output%20panel/near/294236883" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20word.20wrapping.20in.20jEdit.20output.20panel.html#294236883">(Aug 19 2022 at 10:32)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
I've learned a few more fine points about that in the past few days, so <br>
the heuristics will approximate an actual solution eventually.  That is <br>
all for the next release though, and it is a bit early to speculate how it <br>
will be there.  (There are still many Java/Swing issues on various <br>
platforms, some of them hard drop-outs due to Oracle.)</p>
<p>Makarius</p>



<a name="294238532"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20word%20wrapping%20in%20jEdit%20output%20panel/near/294238532" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20word.20wrapping.20in.20jEdit.20output.20panel.html#294238532">(Aug 19 2022 at 10:45)</a>:</h4>
<p>From: John Wickerson &lt;<a href="mailto:jpw48@cam.ac.uk">jpw48@cam.ac.uk</a>&gt;<br>
Minor bug report (not sure if this is Isabelle's fault or jEdit's, but here goes)...</p>
<p>The word wrapping in the Output window of Isabelle/jEdit is a little bit off. That is, each line of text breaks about 1cm beyond the right-hand edge of the Output window (and that's independent of how I resize the window). Of course it's only a minor quibble because I can always scroll horizontally a little bit to see the rest of the output. It doesn't help to turn on/off the gutter.</p>
<p>john</p>



<a name="294238536"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20word%20wrapping%20in%20jEdit%20output%20panel/near/294238536" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20word.20wrapping.20in.20jEdit.20output.20panel.html#294238536">(Aug 19 2022 at 10:45)</a>:</h4>
<p>From: Makarius &lt;<a href="mailto:makarius@sketis.net">makarius@sketis.net</a>&gt;<br>
I think you mean the breaking of pretty-printed formal output. <br>
(Word-wrap in the source is a different issue: there is also a snag here, <br>
because Isabelle tokenization for {* ... *} is in conflict with jEdit <br>
tokenization for words.)</p>
<p>The font metrics and window size parameters for pretty printed output are <br>
only precise once the inner GUI component geometry is known.  It does not <br>
quite work with extra decoration (scrollbars, window borders): before the <br>
window is mapped these sizes are unknown, or I did not know how to get <br>
them in Java/AWT/Swing.</p>
<p>So Isabelle2013 has some funny heuristics here that work for the most <br>
common platforms, GUI look-and-feels, fonts, and font-sizes.  What do you <br>
have in this respect?</p>
<p>Makarius</p>



<a name="294238582"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20word%20wrapping%20in%20jEdit%20output%20panel/near/294238582" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20word.20wrapping.20in.20jEdit.20output.20panel.html#294238582">(Aug 19 2022 at 10:45)</a>:</h4>
<p>From: John Wickerson &lt;<a href="mailto:jpw48@cam.ac.uk">jpw48@cam.ac.uk</a>&gt;<br>
On 13 Mar 2013, at 14:52, Makarius wrote:</p>
<blockquote>
<p>On Wed, 13 Mar 2013, John Wickerson wrote:</p>
<blockquote>
<p>The word wrapping in the Output window of Isabelle/jEdit is a little bit off. That is, each line of text breaks about 1cm beyond the right-hand edge of the Output window (and that's independent of how I resize the window). Of course it's only a minor quibble because I can always scroll horizontally a little bit to see the rest of the output. It doesn't help to turn on/off the gutter.</p>
</blockquote>
<p>I think you mean the breaking of pretty-printed formal output. (Word-wrap in the source is a different issue: there is also a snag here, because Isabelle tokenization for {* ... *} is in conflict with jEdit tokenization for words.)</p>
</blockquote>
<p>Yes, that's what I mean.</p>
<blockquote>
<p>The font metrics and window size parameters for pretty printed output are only precise once the inner GUI component geometry is known.  It does not quite work with extra decoration (scrollbars, window borders): before the window is mapped these sizes are unknown, or I did not know how to get them in Java/AWT/Swing.</p>
<p>So Isabelle2013 has some funny heuristics here that work for the most common platforms, GUI look-and-feels, fonts, and font-sizes.  What do you have in this respect?</p>
</blockquote>
<p>I'm on Mac OS 10.7.5, with "Swing look &amp; feel" set to "Metal", font "IsabelleText 14 Plain". I've tried fiddling with each of these settings (well, except the OS) and the break points remain consistently about 1cm off the right edge of the window.</p>



<a name="294238631"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20word%20wrapping%20in%20jEdit%20output%20panel/near/294238631" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20word.20wrapping.20in.20jEdit.20output.20panel.html#294238631">(Aug 19 2022 at 10:46)</a>:</h4>
<p>From: David Greenaway &lt;<a href="mailto:david.greenaway@nicta.com.au">david.greenaway@nicta.com.au</a>&gt;<br>
On 14/03/13 00:52, Makarius wrote:</p>
<blockquote>
<p>On Wed, 13 Mar 2013, John Wickerson wrote:</p>
<blockquote>
<p>The word wrapping in the Output window of Isabelle/jEdit is a little<br>
bit off. That is, each line of text breaks about 1cm beyond the<br>
right-hand edge of the Output window (and that's independent of how<br>
I resize the window). Of course it's only a minor quibble because<br>
I can always scroll horizontally a little bit to see the rest of the<br>
output. It doesn't help to turn on/off the gutter.</p>
</blockquote>
</blockquote>
<p>I also hit this problem, and had a go at fixing, with only minor<br>
success.</p>
<blockquote>
<p>I think you mean the breaking of pretty-printed formal output.<br>
(Word-wrap in the source is a different issue: there is also a snag<br>
here, because Isabelle tokenization for {* ... *} is in conflict with<br>
jEdit tokenization for words.)</p>
<p>The font metrics and window size parameters for pretty printed output<br>
are only precise once the inner GUI component geometry is known.  It<br>
does not quite work with extra decoration (scrollbars, window<br>
borders): before the window is mapped these sizes are unknown, or<br>
I did not know how to get them in Java/AWT/Swing.</p>
</blockquote>
<p>I found that "getPainter.getWidth" gave a better indication of a window<br>
size as opposed to getting the control's width and attempting to<br>
subtract off the size of scrollbars, etc.</p>
<p>Another snag I hit is that "metrics.stringWidth" doesn't take into<br>
account anti-aliasing, which after 80 characters of rendering really<br>
starts to add up.</p>
<p>Attached is a patch that may be a starting point to address some of the<br>
problems, but is by no means complete. I still get overflows when<br>
Isabelle renders many wide characters on a line.</p>
<p>I suspect a "proper" solution is to give the line-breaking algorithm<br>
a better understanding of how wide each character is, but I haven't had<br>
a chance to sit down and work out how hard this would be to implement.</p>
<p>Cheers,<br>
David</p>
<hr>
<p>The information in this e-mail may be confidential and subject to legal professional privilege and/or copyright. National ICT Australia Limited accepts no liability for any damage caused by this email or its attachments.<br>
<a href="/user_uploads/14278/8uP5TAmCFNi8Cz6Tl8uFrEH9/jedit_proof.patch">jedit_proof.patch</a></p>



<a name="294238678"></a>
<h4><a href="https://isabelle.zulipchat.com/#narrow/stream/336180-Archive%20Mirror%3A%20Isabelle%20Users%20Mailing%20List/topic/%5Bisabelle%5D%20word%20wrapping%20in%20jEdit%20output%20panel/near/294238678" class="zl"><img src="http://isabelle.systems/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="http://isabelle.systems/zulip-archive/stream/336180-Archive-Mirror.3A-Isabelle-Users-Mailing-List/topic/.5Bisabelle.5D.20word.20wrapping.20in.20jEdit.20output.20panel.html#294238678">(Aug 19 2022 at 10:46)</a>:</h4>
<p>From: David Greenaway &lt;<a href="mailto:david.greenaway@nicta.com.au">david.greenaway@nicta.com.au</a>&gt;<br>
On 14/03/13 10:00, David Greenaway wrote:</p>
<blockquote>
<p>I also hit this problem, and had a go at fixing, with only minor<br>
success.<br>
[...]<br>
Attached is a patch that may be a starting point to address some of<br>
the problems, but is by no means complete. I still get overflows when<br>
Isabelle renders many wide characters on a line.</p>
<p>I suspect a "proper" solution is to give the line-breaking algorithm<br>
a better understanding of how wide each character is, but I haven't<br>
had a chance to sit down and work out how hard this would be to<br>
implement.</p>
</blockquote>
<p>I decided to sit down and actually see if I could come up with a better<br>
solution for this problem. Attached is what I came up with (replacing<br>
my previously posted patch completely).</p>
<p>In particular, "Pretty" internally uses "number of spaces" as its<br>
measuring units. This patch attempts modifies "PrettyTextArea" to more<br>
accurately measure strings and feed these widths into "Pretty" in the<br>
correct units.</p>
<p>This seems to give good results on Linux, with all combinations of<br>
hinted/non-hinted aliased/anti-aliased fixed-width/non-fixed-width fonts<br>
I tried.</p>
<p>A one-space margin remains on the right-hand-side because non-hinted</p>
<ul>
<li>anti-aliased fonts still sometimes overflows by a few pixels, and<br>
I couldn't determine why.</li>
</ul>
<p>The patch doesn't attempt to fix SideKick or tool-tips; if the Isabelle<br>
maintainers are happy with the approach in this patch, I would be happy<br>
to extend it.</p>
<p>Cheers,<br>
David</p>
<hr>
<p>The information in this e-mail may be confidential and subject to legal professional privilege and/or copyright. National ICT Australia Limited accepts no liability for any damage caused by this email or its attachments.<br>
<a href="/user_uploads/14278/WcWro2xDwduQ5ULUe9drJB6Z/jedit_rendering.patch">jedit_rendering.patch</a></p>



<hr><p>Last updated: Nov 01 2025 at 16:22 UTC</p>
</html>