[
    {
        "content": "<p>I am to define a function in a locale that uses a fixed function parameter of the locale:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">theory</span><span class=\"w\"> </span><span class=\"n\">LocaleFunction</span>\n\n<span class=\"kp\">imports</span><span class=\"w\"> </span><span class=\"n\">Main</span>\n\n<span class=\"k\">begin</span>\n\n<span class=\"k\">datatype</span><span class=\"w\"> </span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n n-Type\">'a</span>\n\n<span class=\"k\">locale</span><span class=\"w\"> </span><span class=\"n\">simple</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">  </span><span class=\"kp\">fixes</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'a\"</span>\n<span class=\"kp\">and</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'a ⇒ nat\"</span>\n<span class=\"k\">begin</span>\n\n<span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'a bar ⇒ nat\"</span>\n<span class=\"w\">  </span><span class=\"kp\">where</span>\n<span class=\"w\">  </span><span class=\"s\">\"foobar x = (case x of Baz ⇒ 0 | (Bar a) ⇒ foo a)\"</span>\n\n<span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">barfoo</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'a bar ⇒ nat\"</span>\n<span class=\"w\">  </span><span class=\"kp\">where</span>\n<span class=\"w\">  </span><span class=\"s\">\"barfoo Baz = 0\"</span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"s\">\"barfoo (Bar a) = foo a\"</span>\n</code></pre></div>\n<p>Now, <code>foobar</code> goes well, with a case expression, but <code>barfoo</code> with a pattern matching does not go through, it gives this error message:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">Malformed</span><span class=\"w\"> </span><span class=\"k\">definition</span><span class=\"o\">:</span>\n<span class=\"n\">Non</span><span class=\"o\">-</span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">allowed</span><span class=\"w\"> </span><span class=\"kp\">in</span><span class=\"w\"> </span><span class=\"n\">sequential</span><span class=\"w\"> </span><span class=\"n\">mode.</span>\n<span class=\"n\">barfoo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>I wonder about this, as <code>(Bar a)</code> seems to be a constructor pattern for me.</p>\n<p>What does cause this problem?</p>",
        "id": 501077613,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1740135507
    },
    {
        "content": "<p>the name <code>a</code> in the pattern clashes with the <code>a</code> fixed in the locale (and it's not a pattern if it contains an existing constant — you also can't use <code>Bar foobar</code> as a pattern). If you rename it, this works</p>",
        "id": 501078517,
        "sender_full_name": "terru",
        "timestamp": 1740135787
    }
]