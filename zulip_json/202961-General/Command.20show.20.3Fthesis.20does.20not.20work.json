[
    {
        "content": "<p>I have a goal in the middle of a large proof (sorry I cannot copy it here or come up with a minimal non-working example). When I copy the goal into a show statement, I get</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">pending</span><span class=\"w\"> </span><span class=\"n\">goal</span>\n<span class=\"n\">Local</span><span class=\"w\"> </span><span class=\"n\">statement</span><span class=\"w\"> </span><span class=\"n\">fails</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">pending</span><span class=\"w\"> </span><span class=\"n\">goal</span>\n<span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">attempt</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">solve</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exported</span><span class=\"w\"> </span><span class=\"n\">rule</span><span class=\"o\">:</span>\n</code></pre></div>\n<p>I get the same when I use </p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span>\n</code></pre></div>\n<p>What can cause this? I have a fix and an assume statement in the beginning of the proof, and the original goal starts with </p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">∀b∈</span><span class=\"ow\">{</span><span class=\"n\">xs.</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"n\">⊆</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">∧</span><span class=\"w\"> </span><span class=\"n\">distinct</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"ow\">}</span><span class=\"w\"> </span><span class=\"ow\">.</span>\n</code></pre></div>",
        "id": 572162379,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1770301494
    },
    {
        "content": "<p>what is your <code>assume</code>? If you assume things which are not in the goal (&amp; I don't see your original goal having any assumptions), then Isabelle will accept the assumption (it will even accept <code>assume False</code>), but then give you this error when trying to use <code>show</code>, as what you are showing is not a refinement of the goal you actually wanted to prove (but instead <code>&lt;your assumption&gt; ==&gt; &lt;your actual goal&gt;</code>)</p>",
        "id": 572164549,
        "sender_full_name": "terru",
        "timestamp": 1770301988
    },
    {
        "content": "<p>I changed it to </p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ba</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"s\">\"(∀b. b∈{xs. set xs ⊆ B ∧ distinct xs} ⟶ conclusion        \"</span>\n<span class=\"w\">        </span><span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">          </span><span class=\"k\">fix</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">          </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"n\">b_assumption</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"b ∈ {xs. set xs ⊆ B ∧ distinct xs}\"</span>\n</code></pre></div>\n<p>but I still get the same error message</p>",
        "id": 572165488,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1770302212
    },
    {
        "content": "<p>This happens also when I have </p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">∀b∈</span><span class=\"ow\">{</span><span class=\"n\">xs.</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"n\">⊆</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">∧</span><span class=\"w\"> </span><span class=\"n\">distinct</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"ow\">}</span><span class=\"w\"> </span><span class=\"ow\">.</span><span class=\"w\"> </span><span class=\"n\">conclusion</span>\n</code></pre></div>",
        "id": 572166060,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1770302336
    },
    {
        "content": "<p>the <code>proof -</code> will not change anything (the <code>-</code> means \"do not do anything to the goal\"). If you delete the <code>-</code>, a default proof method will be applied; for your second case that should transform <code>∀b∈{xs. set xs ⊆ B ∧ distinct xs} . conclusion</code> to <code>⋀b. b∈{xs. set xs ⊆ B ∧ distinct xs}  ⟹ conclusion</code>, at which point you can use <code>assume</code></p>\n<p>(note that <code>assume</code> only works with the meta-level <code>⟹</code>, not the object-level <code>⟶</code>, so sometimes you first have to convert one to the other)</p>",
        "id": 572168773,
        "sender_full_name": "terru",
        "timestamp": 1770302914
    },
    {
        "content": "<p>OK I go down to the simplest example I can come up:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"s\">\"⋀a. P a ⟹ Q a\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">fix</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"s\">\"P a\"</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span>\n</code></pre></div>\n<p>where I get</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">Type</span><span class=\"w\"> </span><span class=\"n\">unification</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Clash</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"s\">\"_ ⇒ _\"</span><span class=\"w\"> </span><span class=\"kp\">and</span><span class=\"w\"> </span><span class=\"s\">\"bool\"</span>\n\n<span class=\"n\">Type</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"kp\">in</span><span class=\"w\"> </span><span class=\"n\">application</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">incompatible</span><span class=\"w\"> </span><span class=\"n\">operand</span><span class=\"w\"> </span><span class=\"n\">type</span>\n\n<span class=\"n\">Operator</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"n\">Trueprop</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"n\">bool</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"kt\">prop</span>\n<span class=\"n\">Operand</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"o\">?</span><span class=\"n\">thesis</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"n\">bool</span>\n</code></pre></div>\n<p>Why I get this?</p>",
        "id": 572174369,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1770304086
    },
    {
        "content": "<p>While do not know how exactly <code>?thesis</code> is constructed in general, you can inspect it using <code>term ?thesis</code> in the proof and you will obtain the result <code>\"Q\" :: \"'a ⇒ bool\"</code>.<br>\nSo when you write <code>show ?thesis</code> you are trying to initiate a \"proof of a function\", but Isabelle expects a proof of a proposition.</p>",
        "id": 572223801,
        "sender_full_name": "Maximilian Schäffeler",
        "timestamp": 1770316769
    },
    {
        "content": "<p>I'm also not a 100% sure how <code>?thesis</code> gets constructed, but here different ways of how your example works:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"s\">\"⋀a. P a ⟹ Q a\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">fix</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"s\">\"P a\"</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"s\">\"?thesis a\"</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"k\">qed</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"s\">\"⋀a. P a ⟹ Q a\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">fix</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"s\">\"P a\"</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"s\">\"Q a\"</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"k\">qed</span>\n\n<span class=\"kn\">lemma</span>\n<span class=\"w\">  </span><span class=\"kp\">assumes</span><span class=\"w\"> </span><span class=\"s\">\"P a\"</span>\n<span class=\"w\">  </span><span class=\"kp\">shows</span><span class=\"w\"> </span><span class=\"s\">\"Q a\"</span>\n<span class=\"w\">  </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">assms</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">fix</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"s\">\"P a\"</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"k\">qed</span>\n\n<span class=\"kn\">lemma</span>\n<span class=\"w\">  </span><span class=\"kp\">assumes</span><span class=\"w\"> </span><span class=\"s\">\"P a\"</span>\n<span class=\"w\">  </span><span class=\"kp\">shows</span><span class=\"w\"> </span><span class=\"s\">\"Q a\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">fix</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span>\n<span class=\"w\">    </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">assms</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"k\">qed</span>\n</code></pre></div>",
        "id": 572256944,
        "sender_full_name": "Balazs Toth",
        "timestamp": 1770329141
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"433149\">Maximilian Schäffeler</span> <a href=\"#narrow/channel/202961-General/topic/Command.20show.20.3Fthesis.20does.20not.20work/near/572223801\">said</a>:</p>\n<blockquote>\n<p>While do not know how exactly <code>?thesis</code> is constructed in general, you can inspect it using <code>term ?thesis</code> in the proof and you will obtain the result <code>\"Q\" :: \"'a ⇒ bool\"</code>.<br>\nSo when you write <code>show ?thesis</code> you are trying to initiate a \"proof of a function\", but Isabelle expects a proof of a proposition.</p>\n</blockquote>\n<p>I have found the official statement about this in section 6.2.2 of the Isar Reference Manual:</p>\n<blockquote>\n<p>For any open goal, thesis refers to its object-level statement, abstracted over any<br>\nmeta-level parameters (if present).</p>\n</blockquote>",
        "id": 572761260,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1770639724
    },
    {
        "content": "<p>If I recall correctly, <code>?thesis</code> is the last explicitly stated goal in either the lemma statement or a surrounding <code>show</code> command. When there is more than one (i.e. a lemma or <code>show</code> command that proves several things at once), there is no <code>?thesis</code>. If you modified the goal by writing something like <code>proof (rule …)</code> or <code>proof safe</code> or <code>proof (induction …)</code> etc., there is a <code>?thesis</code> but it will not match your actual goal, so it's not useful. For proof methods that don't change the goal such as <code>proof (cases …)</code>, it's fine.</p>",
        "id": 573760120,
        "sender_full_name": "Manuel Eberl",
        "timestamp": 1770994166
    },
    {
        "content": "<p>I do have to say though I have no idea what's going on in your particular case. I'm not sure if that's intended behaviour; perhaps one ought to ask Makarius on the mailing list.</p>\n<p>In any case, the problem doesn't happen if you omit the (unnecessary) meta-universal quantifier in the lemma statement, and I would encourage you to do so.</p>",
        "id": 573760774,
        "sender_full_name": "Manuel Eberl",
        "timestamp": 1770994348
    }
]