[
    {
        "content": "<p>Consider the following minimal example:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">codatatype</span><span class=\"w\"> </span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">  </span><span class=\"n\">OptionCons</span><span class=\"w\"> </span><span class=\"s\">‹'a option›</span><span class=\"w\"> </span><span class=\"s\">‹'a option_stream›</span>\n\n<span class=\"n\">corec</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"unit option_stream\"</span><span class=\"w\"> </span><span class=\"kp\">where</span>\n<span class=\"w\">  </span><span class=\"s\">\"example = OptionCons (Some ()) example\"</span>\n</code></pre></div>\n<p>This is rejected by the coinduction package with the following error message:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">Proof</span><span class=\"w\"> </span><span class=\"n\">failed.</span>\n<span class=\"w\"> </span><span class=\"n\">1.</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"n\">y2</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">rel_option</span><span class=\"w\"> </span><span class=\"o\">(=)</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x1</span>\n<span class=\"w\"> </span><span class=\"n\">2.</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">y1</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"n\">y2</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"n\">y2</span>\n<span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">above</span><span class=\"w\"> </span><span class=\"n\">occurred</span><span class=\"w\"> </span><span class=\"kp\">for</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"n\">statement⌂</span><span class=\"o\">:</span>\n<span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">y1</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"n\">y2</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OptionCons</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OptionCons</span><span class=\"w\"> </span><span class=\"n\">y1</span><span class=\"w\"> </span><span class=\"n\">y2</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>When choosing the <code>show_types</code> option, it becomes clear that the proof is to be conducted in a polymorphic setting, because the error message becomes the following one:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">Proof</span><span class=\"w\"> </span><span class=\"n\">failed.</span>\n<span class=\"w\"> </span><span class=\"n\">1.</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">(?</span><span class=\"n\">R</span><span class=\"o\">::?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"n\">bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"n\">y2</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">rel_option</span><span class=\"w\"> </span><span class=\"o\">(=)</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x1</span>\n<span class=\"w\"> </span><span class=\"n\">2.</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">y1</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">(?</span><span class=\"n\">R</span><span class=\"o\">::?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"n\">bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"n\">y2</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"n\">y2</span>\n<span class=\"n\">variables</span><span class=\"o\">:</span>\n<span class=\"n\">x1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y1</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option</span>\n<span class=\"n\">x2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y2</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span>\n<span class=\"o\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"n\">bool</span>\n<span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">above</span><span class=\"w\"> </span><span class=\"n\">occurred</span><span class=\"w\"> </span><span class=\"kp\">for</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"n\">statement⌂</span><span class=\"o\">:</span>\n<span class=\"o\">(</span><span class=\"n\">x1</span><span class=\"o\">::?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y1</span><span class=\"o\">::?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">(?</span><span class=\"n\">R</span><span class=\"o\">::?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"w\"> </span><span class=\"n\">⇒</span><span class=\"w\"> </span><span class=\"n\">bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x2</span><span class=\"o\">::?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y2</span><span class=\"o\">::?</span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">option_stream</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">⟹</span><span class=\"w\"> </span><span class=\"n\">option_stream.congclp</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OptionCons</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OptionCons</span><span class=\"w\"> </span><span class=\"n\">y1</span><span class=\"w\"> </span><span class=\"n\">y2</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Now consider the following non-polymorphic version of the above code:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">codatatype</span><span class=\"w\"> </span><span class=\"n\">unit_option_stream</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">  </span><span class=\"n\">UnitOptionCons</span><span class=\"w\"> </span><span class=\"s\">‹unit option›</span><span class=\"w\"> </span><span class=\"s\">‹unit_option_stream›</span>\n\n<span class=\"n\">corec</span><span class=\"w\"> </span><span class=\"n\">example'</span><span class=\"w\"> </span><span class=\"kp\">where</span>\n<span class=\"w\">  </span><span class=\"s\">\"example' = UnitOptionCons (Some ()) example'\"</span>\n</code></pre></div>\n<p>This one succeeds.</p>\n<p>What is wrong here? Am I missing something important, or is this a bug in action?</p>\n<p>By the way, also the polymorphic example <em>does</em> succeed when using <code>primcorec</code>, but in my actual use case I need <code>corec</code>, because I need to introduce several layers of data constructors in each round.</p>",
        "id": 380743968,
        "sender_full_name": "Wolfgang Jeltsch",
        "timestamp": 1690903505
    },
    {
        "content": "<p>I should add that even using <code>corecursive</code> is not an option: it shows me the same error message and fails before even presenting me a proof goal.</p>",
        "id": 380767654,
        "sender_full_name": "Wolfgang Jeltsch",
        "timestamp": 1690907279
    },
    {
        "content": "<p>I would ask on the mailing list (<span class=\"user-mention\" data-user-id=\"361271\">@Dmitriy Traytel</span>  might be around but he is more active on the mailing list)</p>",
        "id": 380768331,
        "sender_full_name": "Mathias Fleury",
        "timestamp": 1690907417
    },
    {
        "content": "<p>I assume that unit is used internally as a sentinel value somewhere in a definition</p>",
        "id": 380768480,
        "sender_full_name": "Mathias Fleury",
        "timestamp": 1690907438
    },
    {
        "content": "<p>but the specialists are on the mailing list, not here…</p>",
        "id": 380768546,
        "sender_full_name": "Mathias Fleury",
        "timestamp": 1690907450
    },
    {
        "content": "<p>I have a question, what does \"hd []\" evaluate to? Actaully I am trying to prove something like \"x ∉ (hd ([]))\"</p>",
        "id": 380778953,
        "sender_full_name": "Gokul",
        "timestamp": 1690909359
    },
    {
        "content": "<p>You should start a new thread for this question.</p>",
        "id": 380779806,
        "sender_full_name": "Wolfgang Jeltsch",
        "timestamp": 1690909516
    },
    {
        "content": "<p>Sorry, sure will do the same</p>",
        "id": 380779908,
        "sender_full_name": "Gokul",
        "timestamp": 1690909535
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"233198\">Mathias Fleury</span> <a href=\"#narrow/stream/202961-General/topic/Polymorphic.20corecursive.20definition.20not.20accepted/near/380768480\">said</a>:</p>\n<blockquote>\n<p>I assume that unit is used internally as a sentinel value somewhere in a definition</p>\n</blockquote>\n<p>It rather seems that the use of <code>option</code> causes the problems. If you drop <code>option</code> from the type definition and then use it in the concrete type parameter of the example value (replacing <code>unit</code> by <code>unit option</code>), it works. That said, I think it should also work with <code>option</code> being part of the type.</p>",
        "id": 380780412,
        "sender_full_name": "Wolfgang Jeltsch",
        "timestamp": 1690909623
    },
    {
        "content": "<p>I am reading along here, but am currently on vacation without a device capable of running Isabelle. I‘ll reply properly when I’m back next week. From distance, I can say that we have had problems when some native types (sums, products) showed up explicitly in codatatypes, where they were confusing some of corec‘s tactics. Some of these are documented in the corec tutorial. Maybe this is a similar problem with the option type indeed. Also there is a way of helping corec‘s tactics by providing some additional simp rules via an attribute (forgot the name, corec_simps or the like; this is hopefully also mentioned in the tutorial). Maybe adding option.rel_eq as a simp rule would help here.</p>",
        "id": 380823771,
        "sender_full_name": "Dmitriy Traytel",
        "timestamp": 1690920024
    },
    {
        "content": "<blockquote>\n<p>Also there is a way of helping corec‘s tactics by providing some additional simp rules via an attribute (forgot the name, corec_simps or the like; this is hopefully also mentioned in the tutorial). Maybe adding option.rel_eq as a simp rule would help here.</p>\n</blockquote>\n<p>The tutorial mentions the <code>friend_of_corec_simps</code> attribute. Assigning it to <code>option.rel_eq</code> doesn’t help, but this doesn’t seem surprising to me, since <code>friend_of_corec_simps</code> is only about friendship, while my problem seems to have nothing to do with friendship.</p>\n<blockquote>\n<p>I‘ll reply properly when I’m back next week.</p>\n</blockquote>\n<p>I’m very much looking forward to this reply. <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 380840046,
        "sender_full_name": "Wolfgang Jeltsch",
        "timestamp": 1690924797
    },
    {
        "content": "<p>By the way, this problem also occurs with a user-defined datatype isomorphic to <code>option</code>. In fact, this is where I discovered it first (I have a special-purpose datatype that is isomorphic to <code>option</code>), and the above code is only the “minimal example”.</p>",
        "id": 380840319,
        "sender_full_name": "Wolfgang Jeltsch",
        "timestamp": 1690924906
    },
    {
        "content": "<p>I figured out that the same problem occurs when using <code>list</code> instead of <code>option</code>. I have the impression that there is a general problem with using type constructors around occurrences of a type parameter. Note that this is not about having bounded natural functors around occurrences of the corecursive type but rather just around a type parameter. Interestingly, this situation does not occur in any of the examples of the <code>corec</code> tutorial.</p>",
        "id": 381476902,
        "sender_full_name": "Wolfgang Jeltsch",
        "timestamp": 1691068078
    },
    {
        "content": "<p>I have replied on the mailing list.</p>",
        "id": 382824701,
        "sender_full_name": "Dmitriy Traytel",
        "timestamp": 1691472774
    }
]