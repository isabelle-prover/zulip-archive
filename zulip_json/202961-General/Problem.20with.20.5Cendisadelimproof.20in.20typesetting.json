[
    {
        "content": "<p>I use <a href=\"https://astahfrom.github.io/cartouches/\">Isabelle Snippets</a> to generate snippets of Isabelle into LaTeX.</p>\n<p>When I use the packages </p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">\\usepackage</span><span class=\"ow\">{</span><span class=\"kp\">output</span><span class=\"n\">/document/isabelle</span><span class=\"ow\">}</span>\n<span class=\"n\">\\usepackage</span><span class=\"ow\">{</span><span class=\"kp\">output</span><span class=\"n\">/document/isabellesym</span><span class=\"ow\">}</span>\n</code></pre></div>\n<p>I get the error</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">Undefined</span><span class=\"w\"> </span><span class=\"n\">control</span><span class=\"w\"> </span><span class=\"n\">sequence.</span>\n<span class=\"n\">\\snippet</span><span class=\"o\">--</span><span class=\"kn\">lemma</span><span class=\"o\">:</span><span class=\"n\">mylemma</span><span class=\"w\"> </span><span class=\"ow\">...</span><span class=\"k\">proof</span>\n<span class=\"w\">                                                  </span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\endisadelimproof</span><span class=\"w\"> </span><span class=\"n\">\\isa...</span>\n</code></pre></div>\n<p>so it seems that \\endisadelimproof is not defined. When I add</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">\\usepackage</span><span class=\"ow\">{</span><span class=\"kp\">output</span><span class=\"n\">/document/isabelletags</span><span class=\"ow\">}</span>\n</code></pre></div>\n<p>I get this error message:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">Missing</span><span class=\"w\"> </span><span class=\"ow\">}</span><span class=\"w\"> </span><span class=\"n\">inserted.</span>\n<span class=\"n\">&lt;inserted</span><span class=\"w\"> </span><span class=\"k\">text</span><span class=\"n\">&gt;</span>\n<span class=\"w\">                </span><span class=\"ow\">}</span>\n<span class=\"n\">l.192</span><span class=\"w\"> </span><span class=\"n\">\\Snippet</span><span class=\"ow\">{</span><span class=\"kn\">lemma</span><span class=\"o\">:</span><span class=\"n\">mylemma</span><span class=\"ow\">}</span>\n</code></pre></div>\n<p>which is spurious as I do not see an unpaired left curly brace { in the LaTeX file at line 192.</p>\n<p>Do you have an advice how to look deeper into this?</p>",
        "id": 406083160,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1701790125
    },
    {
        "content": "<p>Digging deep into LaTeX Hell, I have found the following generated snippets causing the trouble:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">\\SNIP</span><span class=\"ow\">{</span><span class=\"kn\">lemma</span><span class=\"o\">:</span><span class=\"n\">copairing</span><span class=\"o\">-</span><span class=\"n\">unique</span><span class=\"o\">-</span><span class=\"n\">4</span><span class=\"ow\">}{</span><span class=\"n\">%</span>\n<span class=\"n\">%\\isadelimproof</span>\n<span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">%</span>\n<span class=\"n\">%\\endisadelimproof</span>\n<span class=\"n\">\\isatagproof</span>\n<span class=\"n\">\\isacommand</span><span class=\"ow\">{</span><span class=\"k\">unfolding</span><span class=\"ow\">}</span><span class=\"n\">\\isamarkupfalse%</span>\n<span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">copairing</span><span class=\"ow\">{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"k\">def</span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\isanewline%</span>\n<span class=\"ow\">}</span><span class=\"n\">%</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">\\SNIP</span><span class=\"ow\">{</span><span class=\"kn\">lemma</span><span class=\"o\">:</span><span class=\"n\">coproduct</span><span class=\"o\">-</span><span class=\"n\">commute</span><span class=\"o\">-</span><span class=\"n\">right</span><span class=\"o\">-</span><span class=\"n\">1</span><span class=\"ow\">}{</span><span class=\"n\">%</span>\n<span class=\"n\">%\\isadelimproof</span>\n<span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">%</span>\n<span class=\"n\">%\\endisadelimproof</span>\n<span class=\"n\">\\isatagproof</span>\n<span class=\"n\">\\isacommand</span><span class=\"ow\">{</span><span class=\"k\">unfolding</span><span class=\"ow\">}</span><span class=\"n\">\\isamarkupfalse%</span>\n<span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">copairing</span><span class=\"ow\">{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"k\">def</span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"kp\">in</span><span class=\"ow\">{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}{</span><span class=\"n\">\\isadigit</span><span class=\"ow\">{</span><span class=\"n\">1</span><span class=\"ow\">}}{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"n\">Aplus</span><span class=\"ow\">{</span><span class=\"n\">\\isadigit</span><span class=\"ow\">{</span><span class=\"n\">1</span><span class=\"ow\">}}{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"k\">def</span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">comp</span><span class=\"ow\">{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"k\">def</span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\isacommand</span><span class=\"ow\">{</span><span class=\"k\">by</span><span class=\"ow\">}</span><span class=\"n\">\\isamarkupfalse%</span>\n<span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">simp%</span>\n<span class=\"n\">\\endisatagproof</span>\n<span class=\"ow\">{</span><span class=\"n\">\\isafoldproof</span><span class=\"ow\">}</span><span class=\"n\">%</span>\n<span class=\"n\">\\isadelimproof%</span>\n<span class=\"ow\">}</span><span class=\"n\">%</span>\n<span class=\"ow\">}</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">\\SNIP</span><span class=\"ow\">{</span><span class=\"kn\">lemma</span><span class=\"o\">:</span><span class=\"n\">coproduct</span><span class=\"o\">-</span><span class=\"n\">commute</span><span class=\"o\">-</span><span class=\"n\">left</span><span class=\"o\">-</span><span class=\"n\">1</span><span class=\"ow\">}{</span>\n\n<span class=\"n\">\\isadelimproof</span>\n<span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">%</span>\n<span class=\"n\">\\endisadelimproof</span>\n<span class=\"n\">\\isatagproof</span>\n<span class=\"n\">\\isacommand</span><span class=\"ow\">{</span><span class=\"k\">unfolding</span><span class=\"ow\">}</span><span class=\"n\">\\isamarkupfalse%</span>\n<span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">copairing</span><span class=\"ow\">{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"k\">def</span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">comp</span><span class=\"ow\">{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"k\">def</span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"kp\">in</span><span class=\"ow\">{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"n\">A</span><span class=\"ow\">{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"n\">Aplus</span><span class=\"ow\">{</span><span class=\"n\">\\isadigit</span><span class=\"ow\">{</span><span class=\"n\">1</span><span class=\"ow\">}}{</span><span class=\"n\">\\isacharunderscore</span><span class=\"ow\">}{</span><span class=\"n\">\\kern0pt</span><span class=\"ow\">}</span><span class=\"k\">def</span><span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">\\isacommand</span><span class=\"ow\">{</span><span class=\"k\">by</span><span class=\"ow\">}</span><span class=\"n\">\\isamarkupfalse%</span>\n<span class=\"n\">\\</span><span class=\"w\"> </span><span class=\"n\">simp%</span>\n<span class=\"n\">\\endisatagproof</span>\n<span class=\"ow\">{</span><span class=\"n\">\\isafoldproof</span><span class=\"ow\">}</span><span class=\"n\">%</span>\n<span class=\"n\">\\isadelimproof%</span>\n<span class=\"ow\">}</span><span class=\"n\">%</span>\n<span class=\"ow\">}</span>\n</code></pre></div>\n<p>where \\SNIP is</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">\\newcommand</span><span class=\"ow\">{</span><span class=\"n\">\\SNIP</span><span class=\"ow\">}</span><span class=\"o\">[</span><span class=\"n\">2</span><span class=\"o\">]</span><span class=\"ow\">{</span><span class=\"n\">\\expandafter\\newcommand\\csname</span><span class=\"w\"> </span><span class=\"n\">snippet</span><span class=\"o\">--</span><span class=\"n\">#1\\endcsname</span><span class=\"ow\">{</span><span class=\"n\">#2</span><span class=\"ow\">}}</span>\n</code></pre></div>\n<p>and \\Snippet is</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">\\newcommand</span><span class=\"ow\">{</span><span class=\"n\">\\Snippet</span><span class=\"ow\">}</span><span class=\"o\">[</span><span class=\"n\">1</span><span class=\"o\">]</span><span class=\"ow\">{{</span><span class=\"n\">%</span>\n<span class=\"w\">  </span><span class=\"n\">\\newcount\\i</span>\n<span class=\"w\">  </span><span class=\"n\">\\i</span><span class=\"o\">=</span><span class=\"n\">0</span>\n<span class=\"w\">  </span><span class=\"n\">\\loop</span>\n<span class=\"w\">    </span><span class=\"n\">\\GetSnip</span><span class=\"ow\">{</span><span class=\"n\">#1</span><span class=\"o\">-</span><span class=\"n\">\\the\\i</span><span class=\"ow\">}</span><span class=\"n\">%</span>\n<span class=\"w\">    </span><span class=\"n\">\\advance</span><span class=\"w\"> </span><span class=\"n\">\\i</span><span class=\"w\"> </span><span class=\"n\">1</span>\n<span class=\"w\">  </span><span class=\"n\">\\ifcsname</span><span class=\"w\"> </span><span class=\"n\">snippet</span><span class=\"o\">--</span><span class=\"n\">#1</span><span class=\"o\">-</span><span class=\"n\">\\the\\i\\endcsname</span>\n<span class=\"w\">  </span><span class=\"n\">\\repeat</span>\n<span class=\"ow\">}}</span>\n</code></pre></div>\n<p>Do you have an idea what could go wrong?</p>",
        "id": 406315728,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1701872376
    },
    {
        "content": "<p>I didn't learn what was going wrong but the <a href=\"https://astahfrom.github.io/cartouches/\">project page</a> had a solution:</p>\n<blockquote>\n<p>In some cases</p>\n</blockquote>\n<blockquote>\n<p>The following code can be necessary to make the snippets work with some document classes. </p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">\\def\\isadelimtheory</span><span class=\"ow\">{}</span><span class=\"n\">\\def\\endisadelimtheory</span><span class=\"ow\">{}</span>\n<span class=\"n\">\\def\\isatagtheory</span><span class=\"ow\">{}</span><span class=\"n\">\\def\\endisatagtheory</span><span class=\"ow\">{}</span>\n<span class=\"n\">\\def\\isadelimML</span><span class=\"ow\">{}</span><span class=\"n\">\\def\\endisadelimML</span><span class=\"ow\">{}</span>\n<span class=\"n\">\\def\\isadelimdocument</span><span class=\"ow\">{}</span><span class=\"n\">\\def\\endisadelimdocument</span><span class=\"ow\">{}</span>\n<span class=\"n\">\\def\\isatagML</span><span class=\"ow\">{}</span><span class=\"n\">\\def\\endisatagML</span><span class=\"ow\">{}</span>\n<span class=\"n\">\\def\\isatagdocument</span><span class=\"ow\">{}</span><span class=\"n\">\\def\\endisatagdocument</span><span class=\"ow\">{}</span>\n<span class=\"n\">\\def\\isafoldML</span><span class=\"ow\">{}</span>\n<span class=\"n\">\\def\\isadelimproof</span><span class=\"ow\">{}</span><span class=\"n\">\\def\\endisadelimproof</span><span class=\"ow\">{}</span>\n<span class=\"n\">\\def\\isatagproof</span><span class=\"ow\">{}</span><span class=\"n\">\\def\\endisatagproof</span><span class=\"ow\">{}</span>\n<span class=\"n\">\\def\\isafoldproof</span><span class=\"ow\">{}</span>\n</code></pre></div>",
        "id": 406317263,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1701872817
    },
    {
        "content": "<p>As I see this deletes the definitions of various Isabelle LaTeX macros</p>",
        "id": 406319701,
        "sender_full_name": "Gergely Buday",
        "timestamp": 1701873571
    }
]