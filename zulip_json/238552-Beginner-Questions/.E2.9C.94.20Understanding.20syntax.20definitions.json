[
    {
        "content": "<p>So I'm looking into a file called <code>AExp.thy</code> (link here: <a href=\"https://github.com/seL4/isabelle/blob/master/src/HOL/IMP/AExp.thy\">https://github.com/seL4/isabelle/blob/master/src/HOL/IMP/AExp.thy</a>) and I'm trying to understand the syntax and translations from line 30.</p>\n<div class=\"codehilite\"><pre><span></span><code>definition null_state (&quot;&lt;&gt;&quot;) where\n  &quot;null_state ≡ λx. 0&quot;\nsyntax\n  &quot;_State&quot; :: &quot;updbinds =&gt; &#39;a&quot; (&quot;&lt;_&gt;&quot;)\ntranslations\n  &quot;_State ms&quot; == &quot;_Update &lt;&gt; ms&quot;\n  &quot;_State (_updbinds b bs)&quot; &lt;= &quot;_Update (_State b) bs&quot;\n</code></pre></div>\n<p>The writer(s) then demonstrate the translation in effect through a lemma</p>\n<div class=\"codehilite\"><pre><span></span><code>lemma &quot;&lt;a := 1, b := 2&gt; = (&lt;&gt; (a := 1)) (b := (2::int))&quot; by (rule refl)\n</code></pre></div>\n<p>Could I please know how Isabelle managed to translate <code>&lt;a := 1, b := 2&gt;</code> into <code>(&lt;&gt; (a := 1)) (b := (2::int))</code>? My initial thought process went as follows but I'm not sure if it's right.</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;a := 1, b := 2&gt; = &lt;b := 2&gt; (a := 1)\n                 = (&lt;&gt; (a := 1)) (b := 2)\n</code></pre></div>\n<p>My teammates would also like to change the definition such that it now uses option types. They would prefer <code>&lt;a := 1, b := 2&gt;</code> to be translated into <code>(&lt;&gt; (a := Some 1)) (b := Some 2)</code> so they proposed</p>\n<div class=\"codehilite\"><pre><span></span><code>definition null_state :: &quot;&#39;a =&gt; &#39;b option&quot; (&quot;&lt;&gt;&quot;) where\n  &quot;null_state ≡ λx. None&quot;\nsyntax\n  &quot;_State&quot; :: &quot;updbinds =&gt; &#39;a&quot; (&quot;&lt;_&gt;&quot;)\ntranslations\n  &quot;_State ms&quot; == &quot;_Update &lt;&gt; (Some ms)&quot;\n  &quot;_State (_updbinds b bs)&quot; &lt;= &quot;_Update (_State b) bs&quot;\n</code></pre></div>\n<p>Unfortunately they got the following error:</p>\n<div class=\"codehilite\"><pre><span></span><code>Error in syntax translation rule: rhs contains extra variables\n(&quot;_State&quot; ms) ↝ (&quot;_Update&quot; &quot;\\&lt;^const&gt;AExp.null_state&quot; (Some ms))\n</code></pre></div>\n<p>We aren't exactly sure why this error pops up. Could we please have some help?</p>\n<p>Thanks in advance!</p>",
        "id": 270492607,
        "sender_full_name": "pdc20",
        "timestamp": 1643855906
    },
    {
        "content": "<p>I'm not an expert in using the <code>syntax</code> and <code>translation</code> commands but I hope that I can still help you. </p>\n<p>First of all, you seem to want to switch from states that are simple functions of type <code>'a ⇒ nat</code> to maps of type <code>'a ⇀ 'b</code>. Thus, you can leverage the map update syntax, e.g. exchange <code>_Update</code> with <code>_MapUpd</code> and <code>updbinds</code> with <code>maplets</code>. This will directly wrap the values that you map to in a <code>Some</code>.  </p>\n<p>Now about the error you get: <code>Some</code> is just an unknown variable on a syntactic level so you can't use it in this way. You can use constant names like <code>Some</code> if you add a <code>CONST</code> in front of them (e.g. <code>m(x := CONST Some y)</code> is the base case of the map update syntax). Another problem with your approach is that you would not wrap the value in a <code>Some</code> in your code but, afaict, the result of the function update, which isn't what you'd want.</p>\n<p>Lastly, let my try to explain how the syntax translation works. <code>&lt;a := 1, b := 2&gt;</code> is on the syntactic level an application of <code>_State</code> to an object of <code>updbinds</code> (which is several <code>:=</code> notations separated by a comma). The second translation rule for <code>_State</code> is just a print rule, so it doesn't matter in this case. The first rule however tells us that <code>&lt;a:=1,b:=2&gt;</code> is the same as <code>&lt;&gt; (a:=1,b:=2)</code> which is just the syntax for function updates and thus the same as <code>fun_upd (fun_upd (λ_. 0) a 1) b 2</code>.</p>",
        "id": 270519874,
        "sender_full_name": "Florian Sextl",
        "timestamp": 1643880259
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"461163\">pdc20</span> has marked this topic as resolved.</p>",
        "id": 270802119,
        "sender_full_name": "Notification Bot",
        "timestamp": 1644032454
    }
]