[
    {
        "content": "<p>I'm feeling particularly daft today. I need to prove a theorem of the form <code>P ==&gt; Q ==&gt; R</code>. I assumed that a way to do this would be to assume <code>P /\\ Q</code> and then <code>show R</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"kp\">shows</span><span class=\"w\"> </span><span class=\"s\">\"P ⟹ Q ⟹ R\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"s\">\"P ∧ Q\"</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>This leads to the dreaded \"Local statement fails to refine any pending goal\". An alternative form:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"kp\">shows</span><span class=\"w\"> </span><span class=\"s\">\"P ⟹ Q ⟹ R\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"s\">\"P\"</span><span class=\"w\"> </span><span class=\"kp\">and</span><span class=\"w\"> </span><span class=\"s\">\" Q\"</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>works fine (once I use \"sorry\" as the proof for <code>R</code>). </p>\n<p>Can someone explain this to me? I'd <em>swear</em> that I've done things like this before, but apparently not.</p>",
        "id": 573810245,
        "sender_full_name": "John  Hughes",
        "timestamp": 1771008770
    },
    {
        "content": "<p>With <code>assume</code> you can get your hands on a premise of a goal. In your example, <code>P</code> and <code>Q</code> are premises of your goal. <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo>∧</mo><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">P \\land Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∧</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span> is not a premise of your goal.</p>\n<p>If you insist on using  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo>∧</mo><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">P \\land Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∧</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span>, you can use <code>presume</code> and later show that  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo>∧</mo><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">P \\land Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∧</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span>  is implied by the premises of your goal. I discharge that obligation implicitly below by using <code>auto</code> after the final <code>qed</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"s\">\"P ⟹ Q ⟹ R\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">presume</span><span class=\"w\"> </span><span class=\"s\">\"P ∧ Q\"</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"k\">qed</span><span class=\"w\"> </span><span class=\"n\">auto</span>\n</code></pre></div>",
        "id": 573812035,
        "sender_full_name": "Kevin Kappelmann",
        "timestamp": 1771009444
    },
    {
        "content": "<p>OK...that makes some sense. I'm not sure what it was that I was remembering, but that clears it up. But it brings up another puzzling thing -- what <code>?thesis</code> refers to. Programming and Proving says this: </p>\n<p>\"The unknown ?thesis is implicitly matched against any goal stated by lemma or show. Here is a typical example: ...\" </p>\n<p>but in the midst of a rather messy proof, I have the following example of something that's confusing me:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"w\">      </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"s\">\"Q ∈ Points ⟹  Q ⊲ chain_begin (x # xs) ⟹ is_chain (x # xs)</span>\n<span class=\"s\">         ⟹ is_chain c ⟹ xs ≠ [] ⟹ realization (x # xs) Q ⊲ chain_end (x # xs)\"</span><span class=\"w\"> </span><span class=\"kp\">for</span><span class=\"w\"> </span><span class=\"n\">Q</span>\n<span class=\"w\">      </span><span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">        </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span>\n</code></pre></div>\n<p>I would have expected <code>?thesis</code> to be the thing written in the <code>show</code> just above, but instead it turns out to be <code>realization (x # xs) Q ⊲ chain_end (x # xs)</code>,  which I cannot prove, because that's only true if the five things before it are all true. </p>\n<p>What is going on here? </p>\n<p>[The actual proof has some steps between the <code>proof</code> and the <code>show ?thesis</code>, but I wanted a minimal example of the phenomenon.]</p>",
        "id": 573815071,
        "sender_full_name": "John  Hughes",
        "timestamp": 1771010847
    },
    {
        "content": "<p><code>?thesis</code> refers to <a href=\"https://isabelle.in.tum.de/doc/isar-ref.pdf#subsection.1.2.1\">\"the main conclusion of the innermost pending claim\"</a></p>",
        "id": 573816321,
        "sender_full_name": "Kevin Kappelmann",
        "timestamp": 1771011417
    },
    {
        "content": "<p>So P&amp;P was oversimplifying, I guess. Is there a way to access the <em>assumptions</em> of the innermost pending claim?  Without that, it seems hard for me to prove anything.</p>",
        "id": 573817075,
        "sender_full_name": "John  Hughes",
        "timestamp": 1771011790
    },
    {
        "content": "<p>You can use meta implication + <code>assume</code>, as you already did above, or you can use a <code>for</code> clause for the premises, which you can then refer to by using <code>that</code>, by giving an explicit name, or by literal quotation:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">notepad</span>\n<span class=\"k\">begin</span>\n<span class=\"w\">  </span><span class=\"k\">fix</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"s\">\"A ⟹ B ⟹ C\"</span>\n<span class=\"w\">  </span><span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">    </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"w\">    </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"k\">qed</span>\n<span class=\"k\">next</span>\n<span class=\"w\">  </span><span class=\"k\">fix</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"kp\">if</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kp\">and</span><span class=\"w\"> </span><span class=\"n\">myprem</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"w\">  </span><span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">    </span><span class=\"kt\">thm</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"c\">(*hover here*)</span>\n<span class=\"w\">    </span><span class=\"kt\">thm</span><span class=\"w\"> </span><span class=\"n\">myprem</span><span class=\"w\"> </span><span class=\"c\">(*hover here*)</span>\n<span class=\"w\">    </span><span class=\"kt\">thm</span><span class=\"w\"> </span><span class=\"s\">‹A›</span><span class=\"w\"> </span><span class=\"c\">(*hover here*)</span>\n<span class=\"w\">    </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"k\">qed</span>\n<span class=\"k\">end</span>\n</code></pre></div>",
        "id": 573818046,
        "sender_full_name": "Kevin Kappelmann",
        "timestamp": 1771012240
    },
    {
        "content": "<p>Ah. I see. In the first half, I could also write <code>then show ?thesis</code> I find, which makes sense now.</p>",
        "id": 573820109,
        "sender_full_name": "John  Hughes",
        "timestamp": 1771013097
    }
]