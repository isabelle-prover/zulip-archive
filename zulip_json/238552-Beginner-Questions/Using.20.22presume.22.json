[
    {
        "content": "<p>Following up on Moritz R's question from a while back, I tried to use \"presume\" in a \"it suffices to prove that...\" kind of way. <br>\nI started with this proof that x^2 + xy + y^2 &gt;= 0 for real x and y: </p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">theory</span><span class=\"w\"> </span><span class=\"n\">Scratch</span>\n<span class=\"w\">  </span><span class=\"kp\">imports</span><span class=\"w\"> </span><span class=\"n\">Main</span><span class=\"w\"> </span><span class=\"n\">Complex_Main</span>\n<span class=\"k\">begin</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">squareNN</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"kp\">fixes</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">::</span><span class=\"n\">real</span>\n<span class=\"w\">  </span><span class=\"kp\">shows</span><span class=\"w\"> </span><span class=\"s\">\"x^2 ≥ 0\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"k\">qed</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">twoSquares</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"kp\">fixes</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">::</span><span class=\"n\">real</span><span class=\"w\"> </span><span class=\"kp\">and</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">::</span><span class=\"n\">real</span>\n<span class=\"w\">  </span><span class=\"kp\">shows</span><span class=\"w\"> </span><span class=\"s\">\"0 ≤ x^2 + y^2\"</span>\n<span class=\"k\">proof</span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">squareNN</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"k\">qed</span>\n\n<span class=\"kn\">lemma</span>\n<span class=\"w\">  </span><span class=\"kp\">fixes</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">::</span><span class=\"n\">real</span><span class=\"w\"> </span><span class=\"kp\">and</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">::</span><span class=\"n\">real</span>\n<span class=\"w\">  </span><span class=\"kp\">shows</span><span class=\"w\"> </span><span class=\"s\">\"x^2 + x*y + y^2 ≥ 0\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"4*x^2 +4* x*y + 4*y^2 = (4*x^2 + 4*x*y + (y^2)) + 3*y^2\"</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"(4*x^2 + 4*x*y + y^2) = (2*x + y)^2\"</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">power2_sum</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">3</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"4*x^2 +4* x*y + 4*y^2 = (2*x + y)^2 + 3*y^2\"</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">1</span><span class=\"w\"> </span><span class=\"n\">2</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"0 ≤ (2*x + y)^2 + 3*y^2\"</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">3</span><span class=\"w\"> </span><span class=\"n\">twoSquares</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"s\">\"(2*x +y)\"</span><span class=\"w\"> </span><span class=\"s\">\"y\"</span><span class=\"w\"> </span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">5</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"0 ≤ 4*x^2 +4* x*y + 4*y^2\"</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">3</span><span class=\"w\"> </span><span class=\"n\">4</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">presburger</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">5</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">auto</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>As you can see, I prove something about 4 times the quantity of interest, and then get to the thesis at the very end. I wanted to invert this to say \"to prove the original, it suffices to show that 0 ≤ 4*x^2 +4* x<em>y + 4</em>y^2, and then go about proving that. So I wrote</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"kn\">lemma</span>\n<span class=\"w\">  </span><span class=\"kp\">fixes</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">::</span><span class=\"n\">real</span><span class=\"w\"> </span><span class=\"kp\">and</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">::</span><span class=\"n\">real</span>\n<span class=\"w\">  </span><span class=\"kp\">shows</span><span class=\"w\"> </span><span class=\"s\">\"x^2 + x*y + y^2 ≥ 0\"</span>\n<span class=\"k\">proof</span><span class=\"w\"> </span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">presume</span><span class=\"w\"> </span><span class=\"n\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"0 ≤ 4*x^2 + 4*x*y + 4*y^2\"</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">0</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">auto</span>\n\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"4*x^2 +4* x*y + 4*y^2 = (4*x^2 + 4*x*y + (y^2)) + 3*y^2\"</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"(4*x^2 + 4*x*y + y^2) = (2*x + y)^2\"</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">power2_sum</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">3</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"4*x^2 +4* x*y + 4*y^2 = (2*x + y)^2 + 3*y^2\"</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">1</span><span class=\"w\"> </span><span class=\"n\">2</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"0 ≤ (2*x + y)^2 + 3*y^2\"</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">3</span><span class=\"w\"> </span><span class=\"n\">twoSquares</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"s\">\"(2*x +y)\"</span><span class=\"w\"> </span><span class=\"s\">\"y\"</span><span class=\"w\"> </span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">5</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"s\">\"0 ≤ 4*x^2 + 4*x*y + 4*y^2\"</span><span class=\"w\">  </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">4</span><span class=\"w\"> </span><span class=\"n\">3</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">presburger</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">5</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">blast</span><span class=\"w\"> </span><span class=\"c\">(* FAILS *)</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>When I got to that \"next to last\" line ,  the proof-state shows that \"this\" and the \"goal\" are identical, but I cannot figure out how to close things out.  The \"show ?thesis\" ends up using the original thesis (x^2 + xy + y^2 &gt;= 0), so that's obviously wrong. Can someone suggest the correct final line to this proof?</p>",
        "id": 496326865,
        "sender_full_name": "John  Hughes",
        "timestamp": 1738068523
    },
    {
        "content": "<p>It's actually the first time that I hear of <code>presume</code>, but I think I figured out how to use it. This should be the typical pattern on how to use it:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"kn\">lemma</span>\n<span class=\"w\">  </span><span class=\"kp\">assumes</span><span class=\"w\"> </span><span class=\"s\">\"A\"</span><span class=\"w\"> </span><span class=\"s\">\"A ⟹ B\"</span>\n<span class=\"w\">  </span><span class=\"kp\">shows</span><span class=\"w\"> </span><span class=\"s\">\"B\"</span>\n<span class=\"k\">proof</span><span class=\"o\">-</span>\n<span class=\"w\">  </span><span class=\"k\">presume</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"A\"</span>\n\n<span class=\"w\">  </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">?</span><span class=\"n\">thesis</span>\n<span class=\"w\">    </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">assms</span><span class=\"o\">(</span><span class=\"n\">2</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"k\">next</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"s\">\"A\"</span>\n<span class=\"w\">    </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">assms</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"k\">qed</span>\n</code></pre></div>",
        "id": 496358471,
        "sender_full_name": "Balazs Toth",
        "timestamp": 1738077032
    },
    {
        "content": "<p>Hmm. It's a little disappointing to have to explicitly restate \"A\" rather than having a name for it (akin to <code>?thesis</code>), but thanks...that gets me past the place where I was stuck.</p>",
        "id": 496373775,
        "sender_full_name": "John  Hughes",
        "timestamp": 1738081286
    }
]