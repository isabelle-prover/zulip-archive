[
    {
        "content": "<p>Hi,<br>\nI am getting an error from <code>dest_Free</code> while interpreting a locale. Any ideas what the problem is?</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Scratch.thy</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">theory</span><span class=\"w\"> </span><span class=\"n\">Scratch</span>\n<span class=\"w\">  </span><span class=\"kp\">imports</span><span class=\"w\"> </span><span class=\"n\">Main</span><span class=\"w\"> </span><span class=\"s\">\"HOL-Statespace.StateSpaceLocale\"</span><span class=\"w\"> </span><span class=\"s\">\"HOL-Statespace.StateSpaceSyntax\"</span>\n<span class=\"w\">    </span><span class=\"s\">\"HOL-Library.FSet\"</span>\n<span class=\"k\">begin</span>\n\n<span class=\"k\">statespace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n n-Type\">'k</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n n-Type\">'m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">set_adt</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">  </span><span class=\"n\">empty</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"n n-Type\">'m</span>\n<span class=\"w\">  </span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'k ⇒ 'm ⇒ 'm\"</span>\n<span class=\"w\">  </span><span class=\"n\">isin</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'k ⇒ 'm ⇒ bool\"</span>\n<span class=\"w\">  </span><span class=\"n\">invar</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'m ⇒ bool\"</span>\n\n<span class=\"k\">statespace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n n-Type\">'k</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n n-Type\">'m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">set_adt_delete</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n n-Type\">'k</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n n-Type\">'m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">set_adt</span><span class=\"w\"> </span><span class=\"o\">+</span>\n<span class=\"w\">  </span><span class=\"n\">delete</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'k ⇒ 'm ⇒ 'm\"</span>\n\n<span class=\"k\">locale</span><span class=\"w\"> </span><span class=\"n\">set_adt_if</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">set_adt</span><span class=\"w\"> </span><span class=\"o\">+</span>\n<span class=\"w\">  </span><span class=\"kp\">fixes</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'n ⇒ 's\"</span>\n<span class=\"w\">  </span><span class=\"kp\">assumes</span><span class=\"w\"> </span><span class=\"n\">Not_isin_empty</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"¬ (s⋅isin) k (s⋅empty)\"</span>\n<span class=\"w\">  </span><span class=\"kp\">assumes</span><span class=\"w\"> </span><span class=\"n\">isin_insert</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"(s⋅invar) m ⟹ (s⋅isin) k ((s⋅insert) k m)\"</span>\n<span class=\"w\">  </span><span class=\"kp\">assumes</span><span class=\"w\"> </span><span class=\"n\">invar_empty</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"(s⋅invar) (s⋅empty)\"</span>\n<span class=\"w\">  </span><span class=\"kp\">assumes</span><span class=\"w\"> </span><span class=\"n\">invar_insert</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"(s⋅invar) m ⟹ (s⋅invar) ((s⋅insert) k m)\"</span>\n<span class=\"k\">begin</span>\n<span class=\"kt\">thm</span><span class=\"w\"> </span><span class=\"n\">isin_insert</span>\n<span class=\"k\">end</span>\n\n\n<span class=\"k\">locale</span><span class=\"w\"> </span><span class=\"n\">set_adt_delete_if</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">set_adt_delete</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">set_adt_if</span><span class=\"w\"> </span><span class=\"kp\">where</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"s\"</span><span class=\"w\"> </span><span class=\"kp\">for</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">\"'n ⇒ 's\"</span><span class=\"w\"> </span><span class=\"o\">+</span>\n<span class=\"w\">  </span><span class=\"kp\">assumes</span><span class=\"w\"> </span><span class=\"n\">Not_isin_delete</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"(s⋅invar) m ⟹ ¬ (s⋅isin) k ((s⋅delete) k m)\"</span>\n<span class=\"w\">  </span><span class=\"kp\">assumes</span><span class=\"w\"> </span><span class=\"n\">invar_delete</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"(s⋅invar) m ⟹ (s⋅invar) ((s⋅delete) k m)\"</span>\n\n<span class=\"k\">datatype</span><span class=\"w\"> </span><span class=\"n\">set_adt_delete_fset_op_kind</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">  </span><span class=\"n\">EmptyO</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">InsertO</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">IsInO</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">InvarO</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">DeleteO</span>\n\n<span class=\"k\">datatype</span><span class=\"w\"> </span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">set_adt_delete_fset_op</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">    </span><span class=\"n\">aF</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">af</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"'a fset\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">a_aF_aF</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a_af_af</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"'a ⇒ 'a fset ⇒ 'a fset\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">a_aF_bool</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a_af_bool</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"'a ⇒ 'a fset ⇒ bool\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">aF_bool</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">af_bool</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"'a fset ⇒ bool\"</span><span class=\"o\">)</span>\n\n<span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">mk_set_adt_delete_fset_op</span><span class=\"w\"> </span><span class=\"kp\">where</span>\n<span class=\"w\">  </span><span class=\"s\">\"mk_set_adt_delete_fset_op EmptyO = aF fempty\"</span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"s\">\"mk_set_adt_delete_fset_op InsertO = a_aF_aF finsert\"</span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"s\">\"mk_set_adt_delete_fset_op IsInO = a_aF_bool fmember\"</span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"s\">\"mk_set_adt_delete_fset_op InvarO = aF_bool (λ_. True)\"</span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"s\">\"mk_set_adt_delete_fset_op DeleteO = a_aF_aF (λx s. s |-| {|x|})\"</span>\n\n<span class=\"kt\">print_locale</span><span class=\"w\"> </span><span class=\"n\">set_adt_delete_if</span>\n\n<span class=\"kn\">interpretation</span><span class=\"w\"> </span><span class=\"n\">set_adt_delete_fset</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">set_adt_delete_if</span>\n<span class=\"w\">    </span><span class=\"n\">EmptyO</span><span class=\"w\"> </span><span class=\"n\">InsertO</span><span class=\"w\"> </span><span class=\"n\">IsInO</span><span class=\"w\"> </span><span class=\"n\">InvarO</span><span class=\"w\"> </span><span class=\"n\">DeleteO</span>\n<span class=\"w\">    </span><span class=\"n\">af</span><span class=\"w\"> </span><span class=\"n\">aF</span>\n<span class=\"w\">    </span><span class=\"n\">a_af_af</span><span class=\"w\"> </span><span class=\"n\">a_aF_aF</span>\n<span class=\"w\">    </span><span class=\"n\">a_af_bool</span><span class=\"w\"> </span><span class=\"n\">a_aF_bool</span>\n<span class=\"w\">    </span><span class=\"n\">af_bool</span><span class=\"w\"> </span><span class=\"n\">aF_bool</span>\n<span class=\"w\">    </span><span class=\"n\">mk_set_adt_delete_fset_op</span>\n<span class=\"w\">  </span><span class=\"kp\">apply</span><span class=\"o\">(</span><span class=\"n\">unfold_locales</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"kp\">apply</span><span class=\"o\">(</span><span class=\"n\">auto</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lookup_def</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">done</span><span class=\"w\"> </span><span class=\"n\">―</span><span class=\"w\"> </span><span class=\"s\">‹‹dest_Free› error here›</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n</div></div>",
        "id": 389870447,
        "sender_full_name": "Lukas Stevens",
        "timestamp": 1694175312
    }
]