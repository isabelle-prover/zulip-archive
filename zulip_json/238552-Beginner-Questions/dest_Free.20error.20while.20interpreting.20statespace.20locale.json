[
    {
        "content": "<p>More minimal example:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Scratch1.thy</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">theory</span><span class=\"w\"> </span><span class=\"n\">Scratch1</span>\n<span class=\"w\">  </span><span class=\"kp\">imports</span><span class=\"w\"> </span><span class=\"n\">Main</span><span class=\"w\"> </span><span class=\"s\">\"HOL-Statespace.StateSpaceLocale\"</span><span class=\"w\">  </span><span class=\"s\">\"HOL-Library.FSet\"</span>\n<span class=\"k\">begin</span>\n\n<span class=\"k\">statespace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n n-Type\">'k</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n n-Type\">'m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">set_adt</span><span class=\"w\"> </span><span class=\"o\">=</span>\n<span class=\"w\">  </span><span class=\"n\">empty</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"n n-Type\">'m</span>\n\n<span class=\"k\">datatype</span><span class=\"w\"> </span><span class=\"n\">set_adt_fset_op_kind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">EmptyO</span>\n\n<span class=\"k\">datatype</span><span class=\"w\"> </span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">set_adt_fset_op</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">aF</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">af</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s\">\"'a fset\"</span><span class=\"o\">)</span>\n\n<span class=\"k\">definition</span><span class=\"w\"> </span><span class=\"s\">\"mk_set_adt_fset_op kind ≡ case kind of EmptyO ⇒ aF fempty\"</span>\n\n<span class=\"kn\">interpretation</span><span class=\"w\"> </span><span class=\"n\">set_adt_fset</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">set_adt</span>\n<span class=\"w\">    </span><span class=\"n\">EmptyO</span>\n<span class=\"w\">    </span><span class=\"n\">af</span><span class=\"w\"> </span><span class=\"n\">aF</span>\n<span class=\"w\">  </span><span class=\"kp\">apply</span><span class=\"o\">(</span><span class=\"n\">unfold_locales</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"kp\">apply</span><span class=\"o\">(</span><span class=\"n\">auto</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lookup_def</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">done</span><span class=\"w\"> </span><span class=\"n\">―</span><span class=\"w\"> </span><span class=\"s\">‹‹dest_Free› error here›</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n</div></div>",
        "id": 389873251,
        "sender_full_name": "Lukas Stevens",
        "timestamp": 1694176413
    },
    {
        "content": "<p>I found the culprit, it is in <code>state_space.ML:100</code></p>",
        "id": 389877234,
        "sender_full_name": "Lukas Stevens",
        "timestamp": 1694177806
    },
    {
        "content": "<p>Replacing</p>\n<div class=\"codehilite\" data-code-language=\"Standard ML\"><pre><span></span><code><span class=\"kr\">fun</span> <span class=\"nf\">comps_of_distinct_thm</span> <span class=\"n\">thm</span> <span class=\"p\">=</span> <span class=\"nn\">Thm</span><span class=\"p\">.</span><span class=\"n\">prop_of</span> <span class=\"n\">thm</span>\n  <span class=\"p\">|</span><span class=\"nf\">&gt;</span> <span class=\"p\">(</span><span class=\"kr\">fn</span> <span class=\"p\">(_</span><span class=\"n\">$</span><span class=\"p\">(_</span><span class=\"n\">$t</span><span class=\"p\">))</span> <span class=\"p\">=&gt;</span> <span class=\"nn\">DistinctTreeProver</span><span class=\"p\">.</span><span class=\"n\">dest_tree</span> <span class=\"n\">t</span><span class=\"p\">)</span> <span class=\"p\">|</span><span class=\"nf\">&gt;</span> <span class=\"n\">map</span> <span class=\"p\">(</span><span class=\"n\">fst</span> <span class=\"n\">o</span> <span class=\"n\">dest_Free</span><span class=\"p\">)</span> <span class=\"p\">|</span><span class=\"nf\">&gt;</span> <span class=\"n\">sort_strings</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>with</p>\n<div class=\"codehilite\" data-code-language=\"Standard ML\"><pre><span></span><code><span class=\"kr\">fun</span> <span class=\"nf\">comps_of_distinct_thm</span> <span class=\"n\">thm</span> <span class=\"p\">=</span> <span class=\"nn\">Thm</span><span class=\"p\">.</span><span class=\"n\">prop_of</span> <span class=\"n\">thm</span>\n  <span class=\"p\">|</span><span class=\"nf\">&gt;</span> <span class=\"p\">(</span><span class=\"kr\">fn</span> <span class=\"p\">(_</span><span class=\"n\">$</span><span class=\"p\">(_</span><span class=\"n\">$t</span><span class=\"p\">))</span> <span class=\"p\">=&gt;</span> <span class=\"nn\">DistinctTreeProver</span><span class=\"p\">.</span><span class=\"n\">dest_tree</span> <span class=\"n\">t</span><span class=\"p\">)</span> <span class=\"p\">|</span><span class=\"nf\">&gt;</span> <span class=\"n\">map</span> <span class=\"nn\">Term</span><span class=\"p\">.</span><span class=\"n\">term_name</span> <span class=\"p\">|</span><span class=\"nf\">&gt;</span> <span class=\"n\">sort_strings</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>in <code>state_space.ML</code> seems to work.</p>",
        "id": 389878985,
        "sender_full_name": "Lukas Stevens",
        "timestamp": 1694178438
    }
]