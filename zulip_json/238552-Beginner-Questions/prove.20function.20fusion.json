[
    {
        "content": "<p>Hello, I just started to learn Isabelle and am trying to prove function fusion of the algorithm design with Haskell book. The theorem I have is as follows,</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">master_fusion</span> <span class=\"o\">:</span> <span class=\"s\">\"h(f x y) = g x (h y) ⟹ h (foldr f xs e) = foldr g xs (h e)\"</span>\n  <span class=\"kp\">apply</span><span class=\"o\">(</span><span class=\"n\">induction</span> <span class=\"n\">xs</span> <span class=\"n\">arbitrary</span><span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span>\n   <span class=\"kp\">apply</span><span class=\"o\">(</span><span class=\"n\">auto</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I got stuck after the second apply.  The goal is as follows,</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"n\">goal</span> <span class=\"o\">(</span><span class=\"n\">1</span> <span class=\"n\">subgoal</span><span class=\"o\">):</span>\n <span class=\"n\">1</span><span class=\"ow\">.</span> <span class=\"err\">⋀</span><span class=\"n\">a</span> <span class=\"n\">xs</span> <span class=\"n\">x</span> <span class=\"n\">y.</span>\n       <span class=\"o\">(</span><span class=\"err\">⋀</span><span class=\"n\">x</span> <span class=\"n\">y.</span> <span class=\"n\">h</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">=</span> <span class=\"n\">g</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"n\">h</span> <span class=\"o\">(</span><span class=\"n\">foldr</span> <span class=\"n\">f</span> <span class=\"n\">xs</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">=</span> <span class=\"n\">foldr</span> <span class=\"n\">g</span> <span class=\"n\">xs</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"n\">e</span><span class=\"o\">))</span> <span class=\"err\">⟹</span>\n       <span class=\"n\">h</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">=</span> <span class=\"n\">g</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"n\">h</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">foldr</span> <span class=\"n\">f</span> <span class=\"n\">xs</span> <span class=\"n\">e</span><span class=\"o\">))</span> <span class=\"o\">=</span> <span class=\"n\">g</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">foldr</span> <span class=\"n\">g</span> <span class=\"n\">xs</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"n\">e</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>I think I'm close to complete the proof: if I can use the premise of one of the implications to rewrite <code>h (f a (foldr f xs e)) = g a (foldr g xs (h e))</code> into <code>g a (h (foldr f xs e))</code> and use the induction assumption in the first implication to rewrite the previous result. I was wondering if you could give me any pointers? Thanks!</p>",
        "id": 279136960,
        "sender_full_name": "Shaobo He",
        "timestamp": 1650068499
    },
    {
        "content": "<p>I do not think your lemma holds in the current form and quickcheck also finds a counterexample. I think you want your assumption to hold for all <code>x</code>,<code>y</code>, but currently it only requires there to be such <code>x</code>,<code>y</code>. </p>\n<p>The  following goes through:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">master_fusion</span><span class=\"o\">:</span>\n  <span class=\"s\">\"(⋀x y . h(f x y) = g x (h y)) ⟹ h (foldr f xs e) = foldr g xs (h e)\"</span>\n  <span class=\"k\">by</span><span class=\"o\">(</span><span class=\"n\">induction</span> <span class=\"n\">xs</span> <span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">auto</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 279143675,
        "sender_full_name": "Simon Roßkopf",
        "timestamp": 1650078247
    }
]