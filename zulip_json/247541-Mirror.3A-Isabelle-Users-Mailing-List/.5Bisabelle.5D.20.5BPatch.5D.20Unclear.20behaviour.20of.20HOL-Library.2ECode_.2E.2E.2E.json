[
    {
        "content": "<p>From: \"Achim D. Brucker\" &lt;<a href=\"mailto:adbrucker@0x5f.org\">adbrucker@0x5f.org</a>&gt;<br>\nDear all,<br>\nI do not fully understand the behaviour of the theory <br>\nHOL-Library.Code_Real_Approx_By_Float. Consider the following <br>\ntwo theories:</p>\n<p>theory ExampleDef imports Complex_Main begin<br>\n    definition f:: \"real =&gt; real\" where \"f x = exp(x) * 2.0\"<br>\n  end </p>\n<p>and </p>\n<p>theory ExampleCode imports <br>\n    \"HOL-Library.Code_Real_Approx_By_Float\" ExampleDef<br>\n  begin<br>\n    definition g:: \"real =&gt; real\" where \"g x =  exp(x) * 2.0\"<br>\n    export_code g checking SML (* only works w/o importing ExampleDef *)<br>\n    export_code f checking SML (* does not work *)<br>\n  end</p>\n<p>The first export_code (of the locally defined constant g) in the <br>\ntheory ExampleCode only works the theory ExampleDef is not <br>\nincluded. The second export_code (of the constant f defined in the <br>\nimported theory ExampleDef) does not work at all. </p>\n<p>I had a closer look at the theory HOL-Library.Code_Real_Approx_By_Float<br>\nand the problem seems to be two-fold:</p>\n<p>1) the type \"unwrapping\" if integers (from <a href=\"http://Arith.int\">Arith.int</a> to <a href=\"http://IntInf.int\">IntInf.int</a>) is<br>\n   missing in the code printing of Realfract<br>\n2) the ML structure Real is overwritten by the generated code</p>\n<p>The following patch seems to solve the problem:</p>\n<p><a href=\"https://hg.logicalhacking.com/isabelle/rev/91cdf474b64d\">https://hg.logicalhacking.com/isabelle/rev/91cdf474b64d</a> </p>\n<p>The patch declares Real as reserved word for the code generator and <br>\nintroduces a \"wrapper\" Realfract' for the actual Realfract, which seems<br>\nsufficient to convince the code generator to generate the necessary type<br>\nconversions. </p>\n<p>Best,<br>\n    Achim </p>\n<p>PS: I am fully aware of the risks of approximating reals by machine floats <br>\n    but having a working code generator (and value) has proven to be <br>\n    a key success factor in introducing Isabelle to students with little to <br>\n    no previous exposure to theory ...</p>",
        "id": 290731086,
        "sender_full_name": "Email Gateway",
        "timestamp": 1658737282
    }
]