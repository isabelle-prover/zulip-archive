[
    {
        "content": "<p>From: <a href=\"mailto:hannobecker@posteo.de\">hannobecker@posteo.de</a><br>\nHi all,</p>\n<p>I'm seeing an error when attempting to use <code>lift_definition (code_dt)</code> <br>\nwith type classes. Here is a minimal example:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">theory</span><span class=\"w\"> </span><span class=\"n\">Scratch</span>\n<span class=\"w\">    </span><span class=\"kp\">imports</span><span class=\"w\"> </span><span class=\"n\">Main</span><span class=\"w\"> </span><span class=\"s\">\"HOL-Library.Datatype_Records\"</span>\n<span class=\"k\">begin</span>\n\n<span class=\"n\">datatype_record</span><span class=\"w\"> </span><span class=\"n n-Type\">'v</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">blub</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"n\">nat</span>\n\n<span class=\"kn\">typedef</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kp\">overloaded</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n n-Type\">'a</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">‹{ m :: 'a foo . True }›</span>\n<span class=\"w\">   </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rule_tac</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"s\">‹make_foo 0›</span><span class=\"w\"> </span><span class=\"kp\">in</span><span class=\"w\"> </span><span class=\"n\">exI</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n<span class=\"k\">setup_lifting</span><span class=\"w\"> </span><span class=\"n\">type_definition_bar</span>\n\n<span class=\"kn\">lift_definition</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">code_dt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">‹'v::{default} bar option›</span><span class=\"w\"> </span><span class=\"kp\">is</span><span class=\"w\"> </span><span class=\"n\">None</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"n\">simp</span>\n<span class=\"kn\">lift_definition</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">code_dt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"s\">‹'v bar option›</span><span class=\"w\"> </span><span class=\"kp\">is</span><span class=\"w\"> </span><span class=\"n\">None</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"c\">(* Lifting failed for the following types:</span>\n<span class=\"c\">Raw type:  'v foo option</span>\n<span class=\"c\">Abstract type:  'v</span>\n<span class=\"c\">x__default_x__x'v_bar_option_x_x_x__default_x__x'v_foo_option</span>\n\n<span class=\"c\">Reason:</span>\n<span class=\"c\">   The quotient type \"'v</span>\n<span class=\"c\">x__default_x__x'v_bar_option_x_x_x__default_x__x'v_foo_option\"</span>\n<span class=\"c\">     and the quotient type pattern \"?'v</span>\n<span class=\"c\">x__default_x__x'v_bar_option_x_x_x__default_x__x'v_foo_option\"</span>\n<span class=\"c\">     don't match. *)</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>Swapping the definitions of x and y 'fixes' things, and so does removing <br>\nthe type class annotation or using the same annotation in both <br>\ndefinitions.</p>\n<p>Can someone help?</p>\n<p>Thanks!<br>\nHanno</p>",
        "id": 422067793,
        "sender_full_name": "Email Gateway",
        "timestamp": 1708233192
    }
]