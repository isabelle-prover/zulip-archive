[
    {
        "content": "<p>From: \"Tan, Chengsong\" &lt;<a href=\"mailto:c.tan@imperial.ac.uk\">c.tan@imperial.ac.uk</a>&gt;<br>\nHi all,</p>\n<p>Are there any existing projects that uses Isabelle/Scala and Isabelle/ML to define custom <code>Scala.Fun</code> functions and also develop custom sledgehammer commands invoking these functions? I want to build an automated tool that copy-pastes sledgehammer proofs for you (details in <a href=\"#narrow/stream/202961-General/topic/tools.20to.20automatically.20adopt.20sledgehammer.20proofs.20into.20theory\">https://isabelle.zulipchat.com/#narrow/stream/202961-General/topic/tools.20to.20automatically.20adopt.20sledgehammer.20proofs.20into.20theory</a>),<br>\nand I have been looking at the system manual (chapter 5), but without an example it is difficult to set up a \"hello world\" prototype to start with.</p>\n<p>Thanks a lot!</p>\n<p>Best wishes,<br>\nChengsong</p>",
        "id": 436901582,
        "sender_full_name": "Email Gateway",
        "timestamp": 1714748292
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nIn Isabelle2024-RC3 there is src/Tools/Demo to show how to make a command-line <br>\ntool in Isabelle/Scala: that directory is registered implicitly as <br>\n\"component\". For your own setup, you need to do this explicitly, e.g. via <br>\n\"isabelle components -u\".</p>\n<p>To register Scala functions instead of command-line tools, the relevant <br>\nservice class is Scala.Functions. If you hyper-search that in all .scala <br>\nsources, you will see examples. You need to make your own instance and <br>\nregister that in etc/build.props in the section \"services\".</p>\n<p>Makarius</p>",
        "id": 437013004,
        "sender_full_name": "Email Gateway",
        "timestamp": 1714820920
    },
    {
        "content": "<p>From: \"Tan, Chengsong\" &lt;<a href=\"mailto:c.tan@imperial.ac.uk\">c.tan@imperial.ac.uk</a>&gt;<br>\nHi Makarius,</p>\n<p>Thanks a lot for the Demo info, I have now created and registered my own command-line tool.<br>\nHow to I call sledgehammer from Isabelle/Scala (or Isabelle ML)? Like, is there some API that allows me to call sledgehammer from a method in “demo_tool.scala”? Can I do something like: \"Here's this thy file. Tell me what's the sledgehammer output at line 100 column 45\"?<br>\nI can see that there are functions like “run_atp” and “one_line_proof_text” in the relevant .ML files in the “HOL/Tools/Sledgehammer” folder, but am not quite sure how to leverage them to achieve the above effect.</p>\n<p>Thanks a lot,<br>\nChengsong</p>",
        "id": 437244367,
        "sender_full_name": "Email Gateway",
        "timestamp": 1714995460
    },
    {
        "content": "<p>From: \"Tan, Chengsong\" &lt;<a href=\"mailto:c.tan@imperial.ac.uk\">c.tan@imperial.ac.uk</a>&gt;</p>\n<blockquote>\n<p>The offset counts Isabelle symbols from the start of the identified text. One<br>\napproach to get line (and column) from it is to turn it into a Text.Offset and<br>\nthen use Line.Node_Position.advance with the substring in question. If you<br>\nsearch the Isabelle/Scala sources for Line.Node_Position, you will see some<br>\nexamples.</p>\n</blockquote>\n<p>How is such id and offset in ML converted to Scala?<br>\nThe hope is that such id and offset information can be used to calculate the text (line &amp; col) position a certain command, when that command is being evaluated in ML, which usually means that information is no longer available.<br>\nML and Scala interface via some protocol, therefore whenever a command generates some output/causes a state change in ML, then that information must be passed back to Scala via the protocol message. My idea is that we can intercept that message (which will contain necessary info to deduce a Scala offset and id (Symbol.offset and Document_ID.Generic)), so that we can log/render that positional information together with that message. For instance, an ML error causes the jedit proof interface to show several red bits in both the main editor window and the proof state panel, with messages like “Failed to finish proof…”, if we would like to intercept that error message while it is being sent from Isabelle/ML to Isabelle/Scala and add a line number to that message, which files should we modify?</p>\n<p>A related question: how are the command_keywords called from the Scala side? These commands are defined in ML, but their calling sites seem not within the ML codebase itself. For instance, sledgehammer’s command keyword is defined with a call to the function “hammer_away”. But who calls hammer_away whenever a sledgehammer is seen in a thy file? Surely in Scala there should be some “handle” that calls hammer_away at sledgehammer?</p>\n<p>In a standalone tool like demo_tool.scala, how to convert a thy file (string) into some Isabelle internal representation of proof state? Is that possible?</p>\n<p>Thanks a lot,<br>\nChengsong</p>\n<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nDate: Monday, 20 May 2024 at 19:37<br>\nTo: Tan, Chengsong &lt;<a href=\"mailto:c.tan@imperial.ac.uk\">c.tan@imperial.ac.uk</a>&gt;, <a href=\"mailto:isabelle-users@cl.cam.ac.uk\">isabelle-users@cl.cam.ac.uk</a> &lt;<a href=\"mailto:isabelle-users@cl.cam.ac.uk\">isabelle-users@cl.cam.ac.uk</a>&gt;<br>\nSubject: Re: [isabelle] Example Projects manipulating Isabelle/Scala, Isabelle/ML &amp; Sledgehammer<br>\nOn 12/05/2024 01:32, Tan, Chengsong wrote:</p>\n<blockquote>\n<p>When the line number is not available in Position.T, how to deduce the line<br>\nnumber/character number via “id” and “offset”?</p>\n</blockquote>\n<p>The id is an abstract handle on the piece of text you are looking at. In the<br>\nProver IDE it is the static or dynamic command-span. In batch-mode it is the<br>\noverall theory.</p>\n<p>The offset counts Isabelle symbols from the start of the identified text. One<br>\napproach to get line (and column) from it is to turn it into a Text.Offset and<br>\nthen use Line.Node_Position.advance with the substring in question. If you<br>\nsearch the Isabelle/Scala sources for Line.Node_Position, you will see some<br>\nexamples.</p>\n<blockquote>\n<p>I can see that the clickable areas are defined via a function called<br>\n“sendback_markup_command” in “active.ML”. So surely with “id” it’s possible to<br>\nlocate where that command is (so that the text is properly inserted back as<br>\ndone in s/h for example).</p>\n</blockquote>\n<p>You should look in the vicinity of snapshot.find_command_position and<br>\nsnapshot.find_command_line to get an idea how this works.</p>\n<blockquote>\n<p>If deducing the specific line from “id”  is not possible, is to<br>\n“automatically” do the click within Isabelle/ML rather than waiting for user<br>\ninput. Can you explain a bit more about those clickable “sendback”s so that I<br>\ncan write such a function?</p>\n</blockquote>\n<p>The sendback markup is produced in Isabelle/ML and interpreted in<br>\nIsabelle/Scala in jedit_rendering.scala and active.scala --- the latter uses<br>\nbuild.props \"services\" of type Active.Handler: that means you could in<br>\nprinciple invent your own markup and provide a specific handler.</p>\n<p>This won't help to \"do the click in Isabelle/ML\", at least not directly. In<br>\nfact, the usual approach is abstain from machine generated edits, but merely<br>\noffer the user a suitable message with markup to be clicked on.</p>\n<p>An example is the document antiquotation for jEdit actions, e.g.</p>\n<p>text ‹☛‹about››</p>\n<blockquote>\n<p>A side question, what’s the meaning of all the variables with the suffix “N”,<br>\nlike sledgehammerN, markup.idN, etc.?</p>\n</blockquote>\n<p>It means \"Name\".</p>\n<p>Makarius</p>",
        "id": 442030792,
        "sender_full_name": "Email Gateway",
        "timestamp": 1717321919
    }
]