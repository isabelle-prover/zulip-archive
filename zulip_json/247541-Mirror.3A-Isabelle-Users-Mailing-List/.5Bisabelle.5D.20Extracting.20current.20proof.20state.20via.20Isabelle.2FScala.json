[
    {
        "content": "<p>From: Milan Tom &lt;<a href=\"mailto:mt904@cam.ac.uk\">mt904@cam.ac.uk</a>&gt;<br>\nDear all,</p>\n<p>If I have a headless session and directly update the document with some edits, how can I retrieve the current proof state of the document using Isabelle/Scala? For context, I am implementing a REPL to interact with Isabelle and this is the sort of function that I want to implement:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"o\">(</span><span class=\"n\">isar_string</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"ow\">{</span>\n<span class=\"w\">   </span><span class=\"n\">println</span><span class=\"o\">(</span><span class=\"n\">session.tmp_dir_name</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">node_name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Document.Node.Name</span><span class=\"o\">(</span><span class=\"s\">\"Test\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">theory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"Test\"</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">edit</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Text.Edit.insert</span><span class=\"o\">(</span><span class=\"n\">insertionPoint</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">isar_string</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">node_edits</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"o\">((</span><span class=\"n\">node_name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Document.Node.Edits</span><span class=\"o\">[</span><span class=\"n\">Text.Edit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Text.Perspective</span><span class=\"o\">](</span><span class=\"n\">List</span><span class=\"o\">(</span><span class=\"n\">edit</span><span class=\"o\">))))</span>\n\n<span class=\"w\">   </span><span class=\"n\">session.update</span><span class=\"o\">(</span><span class=\"n\">Document.Blobs.empty</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">node_edits</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">snapshot</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">session.await_stable_snapshot</span><span class=\"o\">()</span><span class=\"ow\">.</span><span class=\"n\">switch</span><span class=\"o\">(</span><span class=\"n\">node_name</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"n\">snapshot.node.source</span>\n<span class=\"ow\">}</span>\n</code></pre></div>\n<p>This function seems to update the source correctly but I am unsure how to output the current proof state for a given node. I have tried:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">println</span><span class=\"o\">(</span><span class=\"n\">snapshot.messages</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"n\">println</span><span class=\"o\">(</span>\n<span class=\"w\">     </span><span class=\"n\">snapshot.node.commands.foreach</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"n\">&gt;</span>\n<span class=\"w\">       </span><span class=\"n\">println</span><span class=\"o\">(</span><span class=\"n\">snapshot.command_results</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"o\">))</span>\n<span class=\"w\">     </span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"o\">)</span>\n</code></pre></div>\n<p>This is just outputting an empty list of messages and empty results for each command.</p>\n<p>Kindest regards,<br>\nMilan Tom</p>",
        "id": 504650215,
        "sender_full_name": "Email Gateway",
        "timestamp": 1741628392
    }
]