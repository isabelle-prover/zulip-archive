[
    {
        "content": "<p>From: Mark Utting &lt;<a href=\"mailto:m.utting@uq.edu.au\">m.utting@uq.edu.au</a>&gt;<br>\nDear Isabelle users,</p>\n<p>Can anyone suggest how I might debug a Match exception error in a ‘value’ command?<br>\n(We are using code_pred to generate code for some large inductive definitions).<br>\nThe error says:<br>\n    exception Match raised (line 8703 of \"generated code\")</p>\n<p>I’ve tried using export_code to generate the SML code corresponding to the code_pred.<br>\nBut the line numbers in the generated code (only 8393 lines) do not match the above error.</p>\n<p>If I try to run the generated export.ML file directly:<br>\n    $ isabelle process -o ML_exception_debugger=true -o ML_debugger=true -f export.ML<br>\nIt just reports an equally unhelpful error message, with no line number this time:<br>\nException- Match raised<br>\nError trying to use the file: 'export.ML'</p>\n<p>I’ve also tried turning on some debugger flags, but get no extra output:<br>\n   $ isabelle process -o ML_exception_debugger=true -o ML_debugger=true -f export.ML</p>\n<p>Is there any way of tracing the execution?</p>\n<p>Or seeing the actual code that is being executed?</p>\n<p>Or generating a full exception stack trace?</p>\n<p>Thanks<br>\nMark</p>\n<p>PS. A subset of our definitions is:</p>\n<p>inductive object_test :: \"Program ⇒ Signature ⇒ Value list ⇒ (Value ⇒ FieldRefHeap ⇒ bool) =&gt; bool\"<br>\n  where<br>\n  InitStatics:<br>\n  \"⟦Some init = prog '''';<br>\n    config0 = (init, 0, new_map_state, ps);<br>\n    prog ⊢ ([config0, config0], new_heap) | [] ⟶* ((end1 # xs1), heap1) | l1;</p>\n<p>Some g = prog m;<br>\n    config1 = (g, 0, new_map_state, ps);<br>\n    prog ⊢ ([config1, config1], heap1) | [] ⟶* ((end2 # xs2), heap2) | l2;<br>\n    result = get_result end2;<br>\n    checker result heap2 ⟧<br>\n    ⟹ object_test prog m ps checker\" |</p>\n<p>NoStatics:<br>\n  \"⟦'''' ∉ dom prog;<br>\n    Some g = prog m;<br>\n    config1 = (g, 0, new_map_state, ps);<br>\n    prog ⊢ ([config1, config1], new_heap) | [] ⟶* ((end2 # xs2), heap2) | l2;<br>\n    result = get_result end2;<br>\n    checker result heap2 ⟧<br>\n    ⟹ object_test prog m ps checker\"</p>\n<p>code_pred (modes: i ⇒ i ⇒ i ⇒ i ⇒ bool as testObj) object_test .<br>\nthm object_test.equation  (* view the code_pred equations *)</p>\n<p>export_code testObj in SML module_name TestObj</p>\n<p>fun check_result_2 :: \"Value ⇒ FieldRefHeap ⇒ bool\" where<br>\n  \"check_result_2 (ObjRef x) h = (h_load_field ''value'' x h = (IntVal32 (120)))\" |<br>\n  \"check_result_2 _ _ = False\"</p>\n<p>(* this throws exception Match raised (line 8703…) *)<br>\nvalue \"object_test unit_factAsAnObject_2  ''FactResult''  [(IntVal32 (5))]  check_result_2\"</p>\n<p>Associate Professor Mark Utting<br>\nMSc Waikato, PhD UNSW<br>\nDiscipline Leader, Cyber Security and Software Engineering</p>\n<p>School of Information Technology and Electrical Engineering<br>\nThe University of Queensland<br>\nBrisbane Qld 4072 Australia</p>\n<p>T +61 7 3365 2386<br>\nE m.utting@uq.edu.au&lt;mailto:<a href=\"mailto:m.utting@uq.edu.au\">m.utting@uq.edu.au</a>&gt; W https://cyber.uq.edu.au&lt;<a href=\"https://cyber.uq.edu.au/\">https://cyber.uq.edu.au/</a>&gt;</p>\n<p>CRICOS Provider: 00025B</p>\n<p>[https://support.staff.uq.edu.au/ci/inlineImage/get/4826099/277631508108acd58f44b90a9297a394]</p>\n<p>The University of Queensland is embracing the Green Office philosophy. Please consider the environment before printing this email.</p>\n<p>This email (including any attached files) is intended solely for the addressee and may contain confidential information of The University of Queensland. If you are not the addressee, you are notified that any transmission, distribution, printing or photocopying of this email is prohibited. If you have received this email in error, please delete and notify me. Unless explicitly stated, the opinions expressed in this email do not represent the official position of The University of Queensland.<br>\n<a href=\"/user_uploads/14278/E7DEKBiaKC18JCGLQAefanzm/image001.jpg\">image001.jpg</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/14278/E7DEKBiaKC18JCGLQAefanzm/image001.jpg\" title=\"image001.jpg\"><img src=\"/user_uploads/14278/E7DEKBiaKC18JCGLQAefanzm/image001.jpg\"></a></div>",
        "id": 250099004,
        "sender_full_name": "Email Gateway",
        "timestamp": 1629453527
    },
    {
        "content": "<p>From: Florian Märkl &lt;<a href=\"mailto:isabelle-users@florianmaerkl.de\">isabelle-users@florianmaerkl.de</a>&gt;<br>\nHi Mark,</p>\n<p>it’s hard to reproduce your particular case without the definitions around, but here is a small example to get an exception trace:</p>\n<p>definition broken_deeper :: \"nat ⇒ nat\" where \"broken_deeper n ≡ case n of 0 ⇒ 42\"<br>\ndefinition broken :: \"nat ⇒ nat\" where \"broken n ≡ broken_deeper n\"<br>\ndefinition some_arg :: nat where \"some_arg ≡ 42\"</p>\n<p>declare [[ML_debugger]]<br>\nML‹Runtime.exn_debugger (fn () =&gt; @{code ‹broken›} @{code ‹some_arg›})›</p>\n<p>I recently had to figure this out too and was quite confused by all the different options that exist, but eventually this message by Makarius got me on the right track: <a href=\"https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2019-May/msg00136.html\">https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2019-May/msg00136.html</a></p>\n<p>Cheers<br>\nFlorian</p>",
        "id": 250101672,
        "sender_full_name": "Email Gateway",
        "timestamp": 1629455468
    }
]