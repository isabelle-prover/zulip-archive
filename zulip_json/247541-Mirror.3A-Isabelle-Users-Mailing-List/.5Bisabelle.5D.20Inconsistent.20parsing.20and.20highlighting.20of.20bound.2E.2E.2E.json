[
    {
        "content": "<p>From: Peter Lammich &lt;<a href=\"mailto:lammich@in.tum.de\">lammich@in.tum.de</a>&gt;<br>\nHello List,</p>\n<p>I just ran into an effect where Isabelle syntax-highlights statements in <br>\nan inconsistent way, that suggests a different statement from what is <br>\nactually proved!</p>\n<p>When trying to use constant names as pattern variables in case <br>\nexpressions, something in Isabelle's parser goes utterly wrong:</p>\n<p>definition \"b = 0\"</p>\n<p>...</p>\n<p>Here the b in the pattern is highlighted black (indicating a constant), <br>\nthe type is inferred from the !!-bound variable, but in the actual <br>\nstatement that is proved, the b in \"b=fst a\" refers to the variable <br>\nbound by the case pattern!</p>\n<p>The effect occurs in 2021-1 and 2022-RC2</p>\n<p>-- Peter</p>\n<p>More details and variations of this effect:</p>\n<p>definition \"b≡0\"</p>\n<p>lemma \"case a of (b,c) ⇒ b = fst a\"  *** Not a datatype constructor: <br>\n\"Scratch.b\"</p>\n<p>lemma foo: \"case a of (b,c) ⇒ b = fst a\" for b by auto</p>\n<p>All fine, proves \"case ?a of (bxx,c) ⇒ bxx = fst ?a\", but the b in the <br>\npattern is pretty-printed as constant (black), but not linked to <br>\nScratch.b (via ctrl click). The  b on the rhs (in b = ...) is, however, <br>\nctrl-click linked to the \"for b\" clause.</p>\n<p>lemma \"⋀b. case a of (b,c) ⇒ b=fst a\" by auto<br>\n// same as above. b in pattern highlighted as constant, b on rhs <br>\nctrl-click linked to !!b, but lemma proved is \"case ?a of (bxx, c) ⇒ bxx <br>\n= fst ?a\"</p>\n<p>Even worse, the parsing error even makes it into the type inference:</p>\n<p>lemma \"⋀b::nat. case a of (b,c) ⇒ b=fst a\" by auto<br>\nproves a statement for a::(nat * _)</p>\n<p>term ‹λb. b=0›  *** highlighted as expected<br>\nterm ‹λ(b,c). b=0› *** highlighted as expected<br>\nterm ‹λ(b,c) ⇒ b=0› *** Not a datatype constructor: \"Scratch.b\"</p>\n<p>If you change b to be a datatype constructor, things slightly change, <br>\nbut still go wrong:</p>\n<p>datatype foo = b</p>\n<p>lemma \"case a of (b,c) ⇒ b = fst a\" by (auto split: foo.split) ** as <br>\nexpected</p>\n<p>lemma foo: \"case a of (b,c) ⇒ b = fst a\" for b :: nat by auto</p>\n<p>** b in pattern still highlighted black, statement proved is \"case ?a of <br>\n(bxx::nat,c) ⇒ bxx = fst ?a\"<br>\n<a href=\"/user_uploads/14278/Br4w6QUFMcx6vXrXgCZbJimp/isabelle_strange2.png\">isabelle_strange2.png</a><br>\n<a href=\"/user_uploads/14278/yPkFEw_QyEEYY4PCpW-Na0Tz/isabelle_strange2.png\">isabelle_strange2.png</a><br>\n<a href=\"/user_uploads/14278/eOvs-9xkQfwt2YrXfLMkc8w7/isabelle_strange1.png\">isabelle_strange1.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/14278/Br4w6QUFMcx6vXrXgCZbJimp/isabelle_strange2.png\" title=\"isabelle_strange2.png\"><img src=\"/user_uploads/14278/Br4w6QUFMcx6vXrXgCZbJimp/isabelle_strange2.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/14278/yPkFEw_QyEEYY4PCpW-Na0Tz/isabelle_strange2.png\" title=\"isabelle_strange2.png\"><img src=\"/user_uploads/14278/yPkFEw_QyEEYY4PCpW-Na0Tz/isabelle_strange2.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/14278/eOvs-9xkQfwt2YrXfLMkc8w7/isabelle_strange1.png\" title=\"isabelle_strange1.png\"><img src=\"/user_uploads/14278/eOvs-9xkQfwt2YrXfLMkc8w7/isabelle_strange1.png\"></a></div>",
        "id": 304051687,
        "sender_full_name": "Email Gateway",
        "timestamp": 1665759587
    }
]