[
    {
        "content": "<p>From: Vincent Jackson &lt;<a href=\"mailto:vjjac@student.unimelb.edu.au\">vjjac@student.unimelb.edu.au</a>&gt;<br>\nHello all,</p>\n<p>I have run into a bug in Isabelle2023/HOL with induct. The issue is that <br>\ninduct doesn't fully generalise the variables in the inductive case that <br>\nit generates. (Even though it generalises the same variable in other <br>\nsituations.) I suspect the issue has something to do with how the <br>\nrewrite is performed, higher order unification, as there are several <br>\nwarnings of 'Unification bound exceeded' in the output buffer.</p>\n<p>Here is a minimised example of the strange behaviour:</p>\n<p>inductive ipred :: ‹'a ⇒ 'a ⇒ bool› where<br>\n   ipred0: ‹ipred r g›</p>\n<p>lemma induct_variable_fail:<br>\n   fixes p3 :: ‹('a ⇒ 'a ⇒ bool) ⇒ ('a ⇒ 'a ⇒ bool) ⇒ bool›<br>\n   assumes<br>\n     ‹ipred r g›<br>\n     ‹∀g'. p1 g' g ⟶ p2 (s1 a r g') (f1 (s2 g' r r) (s2 a r g'))›<br>\n     ‹∀g'. p3 g' g ⟶ p4 (s1 a (f2 r a) (f3 r g)) (f4 r r r g g' g' a)›<br>\n   shows<br>\n     ‹ipred r (f5 r a a)›<br>\n   using assms<br>\nproof (induct arbitrary: a rule: ipred.induct)<br>\n   case (ipred0 r g)<br>\n   then show ?case sorry<br>\nqed</p>\n<p>The behaviour that I was expecting was that both /g/s in the inductive <br>\npremises would be bound (green/gold) variables, but instead, one of them <br>\nis an unbound (blue) variable. More curiously, if a /g/ is given as an <br>\nargument to /p2/, it is generalised correctly, even though the /g/ under <br>\n/p1/ is not.</p>\n<p>The example is fairly fragile. Deleting any of the variables makes the <br>\nissue disappear, making the type variables different in the inductive <br>\npredicate also removes the issue, as does removing /p3/'s fixes <br>\ndeclaration. However, the issue does persist when reordering the variables.</p>\n<p>I would be interested to know why this is happening, as the behaviour is <br>\nunintuitive. For now, I am using a logically equivalent assumption that <br>\ncorrectly generalises to get around the issue. But it would be better if <br>\nthis situation was generalised correctly.</p>\n<p>Thanks,<br>\n   Vincent</p>\n<p>-- <br>\nVincent Jackson<br>\nPhD Student<br>\nSchool of Computing and Information Systems<br>\nUniversity of Melbourne<br>\n-- </p>\n<p>P.S. In case it is relevant, here's a minimal version of the actual <br>\nlemma I am proving</p>\n<p>unbundle lattice_syntax</p>\n<p>inductive rgsat :: ‹'c ⇒ ('h ⇒ 'h ⇒ bool) ⇒ ('h ⇒ 'h ⇒ bool) ⇒ ('h ⇒ bool) ⇒ ('h ⇒ bool) ⇒ bool› where<br>\n   ‹rgsat a b c d e›</p>\n<p>definition wsstable :: ‹('a ⇒ bool) ⇒ ('a ⇒ 'a ⇒ bool) ⇒ ('a ⇒ bool)› (\"⌈ _ ⌉⇘_⇙\" [0,0] 90) where<br>\n   ‹wsstable a b ≡ undefined›</p>\n<p>definition sepconj :: ‹('a ⇒ bool) ⇒ ('a ⇒ bool) ⇒ ('a ⇒ bool)› (infixl ‹**› 88) where<br>\n   ‹sepconj a b ≡ undefined›</p>\n<p>lemma rgsat_frame:<br>\n   assumes<br>\n     ‹rgsat c r g p q›<br>\n     ‹∀p g'. g' ≤ g ⟶ (⌈ p <strong> f ⌉⇘r ⊔ g'⇙ ≤ ⌈ p ⌉⇘r ⊔ g'⇙ </strong> ⌈ f ⌉⇘r ⊔ g'⇙)›<br>\n     ‹∀p g'. g' ≤ g ⟶ (⌈ p <strong> ⌈ f ⌉⇘r ⊔ g⇙ ⌉⇘r ⊔ g'⇙ ≤ ⌈ p ⌉⇘r ⊔ g'⇙ </strong> ⌈ ⌈ f ⌉⇘r ⊔ g⇙ ⌉⇘r ⊔ g'⇙)›<br>\n   shows<br>\n     ‹rgsat c r g (p <strong> f) (q </strong> ⌈ f ⌉⇘r ⊔ g⇙)›<br>\n   using assms<br>\n   apply (induct arbitrary: f rule: rgsat.induct)<br>\n   oops</p>",
        "id": 399789137,
        "sender_full_name": "Email Gateway",
        "timestamp": 1698866960
    },
    {
        "content": "<p>From: Lawrence Paulson &lt;<a href=\"mailto:lp15@cam.ac.uk\">lp15@cam.ac.uk</a>&gt;<br>\nDear Vincent, I took a look and I wasn't able to reproduce the output, or the warning, with the default settings. The unification search bound is by default set to 60. I was able to cause a number of perverse behaviours by setting it to lower values. If they are really low, the induction method doesn't terminate, and if they are say 45 then you get the warnings you mentioned and a different output with those g issues. Possibly an ancestor theory is modifying this bound. (That’s a mistake: such changes should be confined to local contexts.) </p>\n<p>So my suggestion is to try the following (possibly with a bigger number): </p>\n<p>declare [[unify_search_bound=60]]</p>\n<p>Also, try this if the tracing messages are annoying:</p>\n<p>declare [[unify_trace_bound=100]]</p>\n<p>Larry Paulson</p>",
        "id": 399922911,
        "sender_full_name": "Email Gateway",
        "timestamp": 1698927472
    },
    {
        "content": "<p>From: Mathias Fleury &lt;<a href=\"mailto:mathias.fleury12@gmail.com\">mathias.fleury12@gmail.com</a>&gt;<br>\nHi all,</p>\n<p>According to a quick grep:</p>\n<p>$ grep -r unify_search_bound *<br>\nthys/PLM/TAO_1_Embedding.thy:declare [[unify_search_bound = 40]] (* <br>\nprevent unification bound errors *)</p>\n<p>Actually I think all of</p>\n<p>declare [[smt_solver = cvc4]]<br>\ndeclare [[simp_depth_limit = 10]] (* prevent the simplifier from running <br>\nforever *)<br>\ndeclare [[unify_search_bound = 40]] (* prevent unification bound errors *)</p>\n<p>should be removed from that theory (I checked, and they are not <br>\nnecessary anyway).</p>\n<p>I see also various changes of simp_depth_limit in the AFP and I don't <br>\nthink that it is a good idea to have them in a non-local context…</p>\n<p>$ grep -r simp_depth_limit * | grep declare<br>\nArrowImpossibilityGS/Thys/Arrow_Order.thy:declare [[simp_depth_limit = 2]]<br>\nArrowImpossibilityGS/Thys/Arrow_Order.thy:declare [[simp_depth_limit = 50]]<br>\nNormByEval/NBE.thy:declare [[simp_depth_limit = 10]]<br>\nNormByEval/NBE.thy:declare [[simp_depth_limit = 50]]<br>\nPLM/TAO_1_Embedding.thy:declare [[simp_depth_limit = 10]] (* prevent the <br>\nsimplifier from running forever *)<br>\nRamsey-Infinite/Ramsey.thy:declare [[simp_depth_limit = 5]]</p>\n<p>Mathias</p>",
        "id": 399938262,
        "sender_full_name": "Email Gateway",
        "timestamp": 1698932397
    },
    {
        "content": "<p>From: Lawrence Paulson &lt;<a href=\"mailto:lp15@cam.ac.uk\">lp15@cam.ac.uk</a>&gt;<br>\nAlready gone!</p>\n<p>Larry</p>",
        "id": 400001333,
        "sender_full_name": "Email Gateway",
        "timestamp": 1698950412
    },
    {
        "content": "<p>From: Vincent Jackson &lt;<a href=\"mailto:vjjac@student.unimelb.edu.au\">vjjac@student.unimelb.edu.au</a>&gt;<br>\nThanks, this is indeed the source of the issue.</p>\n<p>I am using the defaults, but there appears to be some sort of difference <br>\nbetween Isabelle's behaviour on my computer and yours. If I increase the <br>\nbound to 61, the issue disappears on my computer.</p>\n<p>In any case, I now know how to solve this issue when it occurs.</p>\n<p>Thanks again for your assistance,<br>\n   Vincent</p>",
        "id": 400307336,
        "sender_full_name": "Email Gateway",
        "timestamp": 1699111545
    }
]