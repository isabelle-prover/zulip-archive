[
    {
        "content": "<p>From: Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@informatik.tu-muenchen.de\">florian.haftmann@informatik.tu-muenchen.de</a>&gt;</p>\n<blockquote>\n<p>Also an opinion: sdiv and smod being one of the basic operations on <br>\nwords, I do not consider them particularly 'exotic'.</p>\n</blockquote>\n<p>This is a good opportunity to ask a question about signed division on <br>\nwords »as it is by now«.</p>\n<p>Currently, the characteristic equation is:</p>\n<p>‹v {sdiv} w = word_of_int (sint v {sdiv} sint w)›</p>\n<p>The sint conversion is of course inherent to »signed« interpretation of <br>\nwords.</p>\n<p>The »signed« integer division on the RHS is characterized as:</p>\n<p>‹k {sdiv} l = sgn k * sgn l * (¦k¦ {div} ¦l¦)›</p>\n<p>I. e. the pre-existing divison on natural numbers (interpreted as <br>\nnon-negative integers) is extended to algebraically by factoring out the <br>\nsigns, and ‹1 div sgn l = sgn l› yields the product we see above.</p>\n<p>Is this based on existing literature or folklore or just an historic <br>\nartefact, maybe originally induced by the tempting syntactic coincidence <br>\nof sdiv on int and word?</p>\n<p>Why this doubt?  My naive idea of »signed« division on words would <br>\nfollow other »signed« operations, which interpret word representants <br>\ncentered around 0 rather than starting with 0.  Particulary, I would <br>\nexpect sth. like</p>\n<p>‹signed_take_bit n w = w smod (2 ^ Suc n)› (**)</p>\n<p>to hold, which is definitely not that case with current definition, but <br>\nwhich would hold (*) e. g. when using</p>\n<p>‹v {sdiv} w = word_of_int (sint v {rdiv} sint w)›</p>\n<p>as characteristic equation (c.f. HOL-Library.Rounded_Division).</p>\n<p>(Admittedly there is no explicit proof for (*) so far, but it easy to <br>\nagree that there is a definition of smod on words from which (**) would <br>\nfollow)</p>\n<p>Any suggestions on this?</p>\n<p>Cheers,<br>\n    Florian<br>\n<a href=\"/user_uploads/14278/O1NWTh2kLFPJuBMJm4RYdY62/OpenPGP_0xA707172232CFA4E9.asc\">OpenPGP_0xA707172232CFA4E9.asc</a><br>\n<a href=\"/user_uploads/14278/OQvBDlMQeX4N1Oxc-Jb4MFam/OpenPGP_signature\">OpenPGP_signature</a></p>",
        "id": 301942736,
        "sender_full_name": "Email Gateway",
        "timestamp": 1664721805
    },
    {
        "content": "<p>From: Peter Lammich &lt;<a href=\"mailto:lammich@in.tum.de\">lammich@in.tum.de</a>&gt;<br>\nHi Florian,</p>\n<p>I'm not sure if I understand your wording, but for me it looks like sdiv <br>\nis rounding towards zero, while div rounds down.</p>\n<p>Division implementations in computers is usually round towards zero.</p>\n<p>Including rounded division, we now have 3 names around: div, rdiv, sdiv. <br>\nLooks like one too many for me.</p>\n<p>Also, I don't know if there are standard naming conventions. In Haskell, <br>\nthe operations are named quot/rem and div/mod.</p>\n<p><a href=\"https://hackage.haskell.org/package/base-4.17.0.0/docs/Prelude.html#v:quot\">https://hackage.haskell.org/package/base-4.17.0.0/docs/Prelude.html#v:quot</a></p>\n<p>Except from rounding down vs. towards zero, are there any other concepts <br>\nthat we need to map here?</p>",
        "id": 302016333,
        "sender_full_name": "Email Gateway",
        "timestamp": 1664784393
    },
    {
        "content": "<p>From: Gerwin Klein &lt;<a href=\"mailto:kleing@unsw.edu.au\">kleing@unsw.edu.au</a>&gt;<br>\nThe machine word operations were are usually modelled after whatever C does, which tends to be modelled after what the main popular asm instruction sets used to do a few decades ago.</p>\n<p>So I suspect this is where the current sdiv/smod behaviour comes from.</p>\n<p>Cheers,<br>\nGerwin</p>",
        "id": 302023754,
        "sender_full_name": "Email Gateway",
        "timestamp": 1664787690
    },
    {
        "content": "<p>From: Joe Wells &lt;<a href=\"mailto:cl-isabelle-users@lists.cam.ac.uk\">cl-isabelle-users@lists.cam.ac.uk</a>&gt;<br>\nthe standard reference for pairs of division and modulus operations that<br>\ni always give people is:</p>\n<p>daan leijen.<br>\ndivision and modulus for computer scientists.<br>\n2001.</p>\n<p>web search says right now it can be found here:<br>\n<a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/divmodnote-letter.pdf\">https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/divmodnote-letter.pdf</a></p>\n<p>is there something better now?</p>\n<p>best wishes,</p>\n<p>joe</p>\n<hr>\n<p>Founded in 1821, Heriot-Watt is a leader in ideas and solutions. With campuses and students across the entire globe we span the world, delivering innovation and educational excellence in business, engineering, design and the physical, social and life sciences. This email is generated from the Heriot-Watt University Group, which includes:</p>\n<p>1.  Heriot-Watt University, a Scottish charity registered under number SC000278<br>\n  2.  Heriot- Watt Services Limited (Oriam), Scotland's national performance centre for sport. Heriot-Watt Services Limited is a private limited company registered is Scotland with registered number SC271030 and registered office at Research &amp; Enterprise Services Heriot-Watt University, Riccarton, Edinburgh, EH14 4AS.</p>\n<p>The contents (including any attachments) are confidential. If you are not the intended recipient of this e-mail, any disclosure, copying, distribution or use of its contents is strictly prohibited, and you should please notify the sender immediately and then delete it (including any attachments) from your system.</p>",
        "id": 302045859,
        "sender_full_name": "Email Gateway",
        "timestamp": 1664797129
    },
    {
        "content": "<p>From: Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@informatik.tu-muenchen.de\">florian.haftmann@informatik.tu-muenchen.de</a>&gt;<br>\nHi all,</p>\n<p>thanks for the references and comments.</p>\n<p>After a look at it, the situation »as it is« appears to me as follows:</p>\n<ul>\n<li>\n<p><a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/divmodnote-letter.pdf\">https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/divmodnote-letter.pdf</a> <br>\n(*) defines different kinds of integer division with remainder.</p>\n</li>\n<li>\n<p>The »common« div/mod operation in HOL on int in terms of (*) is <br>\nF-division (rounded towards minus infinity) and is advocated by Knuth.</p>\n</li>\n<li>\n<p>The sdiv/smod operation in HOL on int in terms of (*) is T-division <br>\n(rounded towards zero) or (in my own terminology) the natural algebraic <br>\nextension of division on nat to division on int.  It is required to <br>\ndefine sdiv/smod on words which by convention follows ISO C99, which in <br>\nturn adopted the typical behavior of hardware modern in the beginning of <br>\nthe 1990ies.</p>\n</li>\n<li>\n<p>The rdiv/rmod operation is required to define div/mod on Gaussian <br>\nnumbers (the material is still about to emerge).  It is different from <br>\nany approach given in (*) since it centers the modulus towards zero, e. <br>\ng. _ mod 5 yields {-2, -1, 0, 1, 2}.  Lifting that definition to <br>\narbitrary types with bit structure would satisfy</p>\n<p>‹signed_take_bit n a = a rmod (2 ^ Suc n)›</p>\n</li>\n</ul>\n<p>analogously to</p>\n<p>‹take_bit n a = a mod 2 ^ n›,</p>\n<p>(This is just an observation, not a proposal to introduce that <br>\ngeneralization.)</p>\n<ul>\n<li>What is called »euclidean division« in (*) constrains the modulus to <br>\nbe non-negative.  This is different to the use of the same term in HOL, <br>\nwhere euclidean division refers to a generic division with remainder <br>\nconstrained by an euclidean size, cf. class euclidean_semiring.</li>\n</ul>\n<p>This is to record that…</p>\n<ul>\n<li>\n<p>for any existing variant of div/mod on int, there is a motivation or <br>\napplication;</p>\n</li>\n<li>\n<p>the definition of sdiv/smod on words resembles an established <br>\n(although somehow accidental) convention;</p>\n</li>\n<li>\n<p>how our division operations relate to definitions found in literature.</p>\n</li>\n</ul>\n<p>I plan to augment the distribution with references to (*) to clarify the <br>\nsituation.</p>\n<p>Cheers,<br>\n    Florian<br>\n<a href=\"/user_uploads/14278/DRKc5mGl_FiDNnFg1LDm2TFZ/OpenPGP_0xA707172232CFA4E9.asc\">OpenPGP_0xA707172232CFA4E9.asc</a><br>\n<a href=\"/user_uploads/14278/k25S1Ap5RnNe7CKSgIK5D-0s/OpenPGP_signature\">OpenPGP_signature</a></p>",
        "id": 302639622,
        "sender_full_name": "Email Gateway",
        "timestamp": 1665058928
    },
    {
        "content": "<p>From: Peter Lammich &lt;<a href=\"mailto:lammich@in.tum.de\">lammich@in.tum.de</a>&gt;<br>\nHi Florian,</p>\n<p>thanks for the clarification.</p>\n<p>I will now add regression tests into my developments, just in case <br>\nsomeone should change the current meanings of sdiv/smod in the future: <br>\nThis might silently break trusted code bases of PL semantics formalizations.</p>",
        "id": 302640626,
        "sender_full_name": "Email Gateway",
        "timestamp": 1665059311
    },
    {
        "content": "<p>From: Joe Wells &lt;<a href=\"mailto:cl-isabelle-users@lists.cam.ac.uk\">cl-isabelle-users@lists.cam.ac.uk</a>&gt;<br>\nhi florian,</p>\n<p>if your goal is to put the various div/mod definitions in context, you might (or might not) want to look at these references:</p>\n<p>*   a list of many variations (including some not already mentioned) that are used by various languages, standards, machines: What A Stray Mind Coughed Up: A survey of 'divmod'&lt;<a href=\"https://straymindcough.blogspot.com/2012/02/survey-of-divmod.html\">https://straymindcough.blogspot.com/2012/02/survey-of-divmod.html</a>&gt;<br>\n  *   an attempt (possibly successful, i have not carefully inspected it) to generalize over all div/mod definitions: divmod.pdf&lt;<a href=\"http://www.math.bas.bg/bantchev/articles/divmod.pdf\">http://www.math.bas.bg/bantchev/articles/divmod.pdf</a>&gt;<br>\n  *   modulus of intervals (instead of single numbers) which generalizes over many of these ideas: [PDF] Modulo intervals: a proposed notation | Semantic Scholar&lt;<a href=\"https://www.semanticscholar.org/paper/Modulo-intervals%3A-a-proposed-notation-Dershowitz-Reingold/ab9794bb2ec68576d4e2f3830ba35de5fe08e747\">https://www.semanticscholar.org/paper/Modulo-intervals%3A-a-proposed-notation-Dershowitz-Reingold/ab9794bb2ec68576d4e2f3830ba35de5fe08e747</a>&gt;; Modulo.pdf&lt;<a href=\"http://www.cs.tau.ac.il/~nachumd/papers/Modulo.pdf\">http://www.cs.tau.ac.il/~nachumd/papers/Modulo.pdf</a>&gt;<br>\n  *   a predecessor of the paper i mentioned in previous email with more details: The Euclidean definition of the functions div and mod - 452146.pdf&lt;<a href=\"https://biblio.ugent.be/publication/314490/file/452146.pdf\">https://biblio.ugent.be/publication/314490/file/452146.pdf</a>&gt;</p>\n<p>i do not know if the rdiv/rmod you mention is an instance of any of the above.</p>\n<p>are you saying that the \"euclidean division\" in isabelle/hol is not an instance of leijen/boute's euclidean division, and also that leijen/boute's euclidean division is not an instance of \"euclidean division\" in isabelle/hol?</p>\n<p>with my best wishes,</p>\n<p>joe</p>",
        "id": 303012882,
        "sender_full_name": "Email Gateway",
        "timestamp": 1665233040
    },
    {
        "content": "<p>From: Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@informatik.tu-muenchen.de\">florian.haftmann@informatik.tu-muenchen.de</a>&gt;<br>\nHi Joe,</p>\n<p>Am 08.10.22 um 14:43 schrieb Joe Wells:</p>\n<blockquote>\n<p>hi florian,</p>\n<p>if your goal is to put the various div/mod definitions in context, you <br>\nmight (or might not) want to look at these references:</p>\n</blockquote>\n<p>[...]</p>\n<p>thanks for the references, I will have a look at it occassionally.</p>\n<blockquote>\n<p>are you saying that the \"euclidean division\" in isabelle/hol is not an <br>\ninstance of leijen/boute's euclidean division, and also that <br>\nleijen/boute's euclidean division is not an instance of \"euclidean <br>\ndivision\" in isabelle/hol?</p>\n</blockquote>\n<p>To clarify, AFAIU leijen/boute speak about division on integers.</p>\n<p>Whereas the type <em>class</em> »euclidean_semiring« in Isabelle/HOL can be <br>\ninstantiated<br>\nto a variety of different types including naturals, integers, <br>\npolynomials over fields<br>\nand gaussian numbers, using an abstract euclidean norm to constrain the <br>\nmodulus, which<br>\nis the primary motivation for its name.</p>\n<p>The concrete existing traditional instantiation of this type class for <br>\nintegers<br>\nimplements F-division, although I guess in theory there would be enough <br>\nfreedom<br>\nto choose another variant, including leijen/boute's euclidean division.</p>\n<p>Hope this helps,<br>\n    Florian<br>\n<a href=\"/user_uploads/14278/gmrWTKkBufG5a5iOfpM7yMcZ/OpenPGP_0xA707172232CFA4E9.asc\">OpenPGP_0xA707172232CFA4E9.asc</a><br>\n<a href=\"/user_uploads/14278/rRqt5JWrd8Lautp9duyZxPNQ/OpenPGP_signature\">OpenPGP_signature</a></p>",
        "id": 303020583,
        "sender_full_name": "Email Gateway",
        "timestamp": 1665236668
    },
    {
        "content": "<p>From: Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@informatik.tu-muenchen.de\">florian.haftmann@informatik.tu-muenchen.de</a>&gt;<br>\nHi Joe,</p>\n<p>I managed to have a look at those references:</p>\n<p>They augment the picture but do IMHO not fundamentally change it.</p>\n<p>While reading, the following insights came to my mind:</p>\n<ul>\n<li>\n<p>A variant of what I have called »rounded division« (rdiv) is mentioned <br>\nin (*) p. 131 as »f = round« –<br>\ninstead rounding .5 towards plus infinity, it rounds .5 towards the even <br>\nneighbor.  Not clear whether this<br>\nis just an aspect of »fairness« or has algebraic implications. <br>\nWikipedia calls (rdiv) »centered division«,<br>\nwithout explicit reference.  Not sure whether this justifies a renaming <br>\nfrom (rdiv) to (cdiv).</p>\n</li>\n<li>\n<p>The proper »euclidean« division with 0 &lt;= k mod l &lt; abs l has the nice <br>\nproperty that the modulus is equivalent<br>\nmodulo algebraic units, abstractly (**): a mod (b * c) = a mod b if c is <br>\nan algebraic unit.</p>\n<p>* For nat, this is trivial since 1 is the only algebraic unit.<br>\n  * For poly it holds, although there is no explicit theorem yet in the <br>\ndistribution.<br>\n  * For gauss quickcheck finds counter examples; it is not clear to me <br>\nwhether the now-existing definition (in post-Isabelle2022 (!)) can be <br>\ntweaked to avoid this.<br>\n  * For int which is defined as F-division, it does obviously not hold.</p>\n</li>\n</ul>\n<p>Why is (**) a desirable property?  If we compute whole equivalence <br>\nclasses, both _ mod b and _ mod (b * c)<br>\nyield the same equivalence class if c is an algebraic unit.  Hence it is <br>\nstrange to postulate that the<br>\noperations a mod b and a mod (b * c) would yield different representants.</p>\n<p>So far for this evening,<br>\ncheers,<br>\n    Florian</p>",
        "id": 303488332,
        "sender_full_name": "Email Gateway",
        "timestamp": 1665510287
    }
]