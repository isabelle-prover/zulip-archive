[
    {
        "content": "<p>From: Mac Goodwin &lt;<a href=\"mailto:mgoodwin4@sheffield.ac.uk\">mgoodwin4@sheffield.ac.uk</a>&gt;<br>\nHi,</p>\n<p>I am trying to run an Isabelle theory file from the command line that<br>\ncontains a short ML script that should write some exported code to disk.</p>\n<p>Using the command <code>isabelle process -T Calculator</code> I receive the following<br>\nerror:</p>\n<p>*** Malformed command syntax<br>\n*** At command \"&lt;malformed&gt;\" (line 137 of<br>\n\"/cygdrive/d/OneDrive/Documents/IsabelleDSL/Calculator.thy\")<br>\nException- TOPLEVEL_ERROR raised</p>\n<p>Line 137 is where the ML script begins. Is this the correct way to run an<br>\nisabelle file from the command line that contains an ML script? I have also<br>\ntried <code>isabelle build -D .</code> with a ROOT file (attached) which produces the<br>\nsame error.</p>\n<p>Thanks!</p>\n<p>Mac<br>\n<a href=\"/user_uploads/14278/Vxt9WN7DYVhikMPP--L-dEX9/ROOT\">ROOT</a><br>\n<a href=\"/user_uploads/14278/Kj-_iV-aeRmkbYZ4rJUgNOIY/Calculator.thy\">Calculator.thy</a></p>",
        "id": 267181367,
        "sender_full_name": "Email Gateway",
        "timestamp": 1641557066
    },
    {
        "content": "<p>From: Mac Goodwin &lt;<a href=\"mailto:mgoodwin4@sheffield.ac.uk\">mgoodwin4@sheffield.ac.uk</a>&gt;<br>\nHi Dominique,</p>\n<p>Thank you very much for this - replacing the odd characters with &lt; and &gt;<br>\ngave a different but similar error (\"ML source expected, but keyword &lt; was<br>\nfound\") but your comment got me thinking along the lines of checking the ML<br>\nsyntax was correct, and I found that wrapping the ML code inside {* and *}<br>\nfixed the issue!</p>\n<p>Thanks very much for your help,</p>\n<p>Mac</p>",
        "id": 267252923,
        "sender_full_name": "Email Gateway",
        "timestamp": 1641595574
    },
    {
        "content": "<p>From: Mac Goodwin &lt;<a href=\"mailto:mgoodwin4@sheffield.ac.uk\">mgoodwin4@sheffield.ac.uk</a>&gt;<br>\nHi again,</p>\n<p>Thanks for this advice, I've restructured my project as above and it works<br>\na lot better this way. However, I am still unsure how to go from an export<br>\ninside the session, and Isabelle's file-system, to my disk. If I understand<br>\ncorrectly, the 'export artifacts' you described above are not saved to disk</p>\n<ul>\n<li>however, I don't want to use the export artifacts within Isabelle, I'd<br>\nlike to save them for later use by another program, so saving to disk would<br>\nbe ideal.</li>\n</ul>\n<p>Is this possible using the build options as described? I can successfully<br>\nrun and export my 'code' with <code>isabelle build -e -D .</code>, but as far as I can<br>\ntell this doesn't allow further processing of the Haskell files that<br>\nexport_code within Isabelle has produced.</p>\n<p>As for the cartouche syntax - I have replaced my incorrect syntax with the<br>\ncartouche as suggested, but still see this error when attempting to build:</p>\n<blockquote>\n<p>$ isabelle build -e -D .<br>\nRunning Calculator ...<br>\nCalculator FAILED<br>\n(see also<br>\nC:\\Users\\theco\\.isabelle\\Isabelle2021\\heaps\\polyml-5.8.2_x86_64_32-windows\\log\\Calculator)<br>\n*** Malformed command syntax<br>\n*** At command \"&lt;malformed&gt;\" (line 137 of<br>\n\"/cygdrive/d/OneDrive/Documents/IsabelleDSL/Calculator.thy\")</p>\n</blockquote>\n<p>Line 137 here is the beginning of the ML script I originally used to export<br>\ncode to disk. The script works with the old style syntax, but I'd love to<br>\nchange it to make it work better within Isabelle best practices.</p>\n<p>Best wishes,</p>\n<p>Mac</p>\n<p>On Sat, 22 Jan 2022 at 14:27, Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt; wrote:</p>\n<blockquote>\n<p>On 06/01/2022 14:55, Mac Goodwin wrote:</p>\n<blockquote>\n<p>Using the command <code>isabelle process -T Calculator</code> I receive the<br>\nfollowing error:</p>\n<p>Is this the correct way to run an<br>\nisabelle file from the command line that contains an ML script? I have<br>\nalso<br>\ntried <code>isabelle build -D .</code> with a ROOT file (attached) which produces<br>\nthe<br>\nsame error.</p>\n</blockquote>\n<p>Note that \"isabelle process\" is a very low-level way to experiment with an<br>\nML<br>\nprocess that lacks a proper session context. Many things just don't work<br>\nhere;<br>\nyou should avoid it in \"production use\".</p>\n<p>A proper \"isabelle build\" with ROOT is much better.</p>\n<p>Instead of writing out things to the physical file-system, you should work<br>\nwith the export artifacts for the session. In Isabelle/ML this is done via<br>\nExport.export (and derivatives), in Isabelle/Scala there are operations to<br>\nretrieve results from the corresponding session build database: it is like<br>\na<br>\nformal file-system for the session (and not a \"disk\").</p>\n<p>There is also \"isabelle export\" to access exports from the command-line,<br>\ne.g.<br>\n\"isabelle export -l My_Session\". Moreover the \"system\" manual explains<br>\n'export_files' within session ROOT specifications in chapter 2 \"Isabelle<br>\nsessions and build management\".</p>\n<p>Makarius<br>\n</p>\n</blockquote>",
        "id": 273564383,
        "sender_full_name": "Email Gateway",
        "timestamp": 1646087737
    },
    {
        "content": "<p>From: Mac Goodwin &lt;<a href=\"mailto:cl-isabelle-users@lists.cam.ac.uk\">cl-isabelle-users@lists.cam.ac.uk</a>&gt;<br>\nFor anyone with a similar use case/issue, I eventually got this working<br>\nwith the following setup:</p>\n<p>In the ROOT file for the project, add an export_files statement as per<br>\nsystem manual: export_files (in \".\") \"<em>:</em>*.hs\"</p>\n<p>This outputs exports *to *the current directory (indicated by \".\") and<br>\nfilters for haskell files (\"<em>:</em>*.hs\").</p>\n<p>Given an export_code command in your theory file (such as \"export_code<br>\nfunction in Haskell module_name Calculator file_prefix calculator\") it is<br>\nthen possible to retrieve the exported code from Isabelle's virtual file<br>\nsystem using the following command to build, and then export, the files:</p>\n<p>isabelle export -d . -x \"<em>:</em>*.hs\" [SESSION_NAME]</p>\n<p>Where SESSION_NAME is the session name specified in your ROOT file. This<br>\ncommand should be run from the same directory as the ROOT file and theory<br>\nfile.</p>\n<p>This setup then eliminates the need for ML code. For some quick feedback -<br>\nI think the system manual could do with a few more worked examples of how<br>\nto chain these commands together! As a beginner Isabelle user, I personally<br>\nfound it a bit confusing. I did find the Code Generation paper useful when<br>\nfiguring this out: <a href=\"https://isabelle.in.tum.de/doc/codegen.pdf\">https://isabelle.in.tum.de/doc/codegen.pdf</a></p>\n<p>Thanks,</p>\n<p>Mac</p>",
        "id": 278317899,
        "sender_full_name": "Email Gateway",
        "timestamp": 1649430506
    }
]