[
    {
        "content": "<p>From: Jakub Kądziołka &lt;<a href=\"mailto:kuba@kadziolka.net\">kuba@kadziolka.net</a>&gt;<br>\nHello,</p>\n<p>at the Isabelle Zulip, we have just successfully troubleshot an issue<br>\nwith getting Isabelle to recognize AFP component. As it turns out, the<br>\npath that should be included in $ISABELLE_HOME_USER/etc/components<br>\n(which is, by the way, incorrectly referred to by <code>isabelle components --help</code><br>\nas $ISABELLE_HOME_USER/components, without the /etc/ path component),<br>\nis .../afp-2021-05-14/thys, and not just .../afp-2021-05-14.<br>\nMoreover, <code>isabelle components -u</code> will only accept the former,<br>\nrejecting the latter with</p>\n<p>*** Bad component directory: \"/home/kuba/formal/afp-2021-05-14/thys\"</p>\n<p>Manually editing $ISABELLE_HOME_USER/etc/components to include the path<br>\nto .../thys makes things work.</p>\n<p>Regards,<br>\nJakub Kądziołka</p>",
        "id": 240336710,
        "sender_full_name": "Email Gateway",
        "timestamp": 1622040683
    },
    {
        "content": "<p>From: Gerwin Klein &lt;<a href=\"mailto:kleing@unsw.edu.au\">kleing@unsw.edu.au</a>&gt;<br>\nHi Jakub,</p>\n<p>Thanks for helping out with that, I just looked at the Tulip discussion.</p>\n<p>It seems like the component registration does work, but the AFP component does not make the AFP thys directory globally available.</p>\n<p>After the instructions as they are, <code>isabelle afp_build Example-Submission</code> should work, but <code>isabelle jedit</code> alone will not pick them up.</p>\n<p>IIRC we removed the global ROOTS from the component at some point, because including a ROOTS file twice led to problems. That is no longer the case, so including ROOTS again is probably the simplest solution.</p>\n<p>The other lesson from the zulip discussion is that we should not assume that Isabelle is installed in the path. I remember now that I specifically avoided that in the old version of the instructions, but that had its own problems.</p>\n<p>Cheers,<br>\nGerwin</p>",
        "id": 240404509,
        "sender_full_name": "Email Gateway",
        "timestamp": 1622071710
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nAs a \"proof\" for the formal record, here is the public archive of the Zulip<br>\nthread in question:<br>\n<a href=\"https://isabelle.systems/zulip-archive/238552BeginnerQuestions/77272afp.html\">https://isabelle.systems/zulip-archive/238552BeginnerQuestions/77272afp.html</a></p>\n<p>Already in 1990, I have resolved to ignore the real-time chat culture, so it<br>\nis indeed important to copy topics that might be relevant over to the official<br>\nmailing list.</p>\n<p>First some minor notes, especially on the idealized situation for the next<br>\nrelease:</p>\n<ul>\n<li>\n<p>The official way to get usage help for Isabelle tools is via the non-option<br>\n\"-?\": the isabelle executable says that.</p>\n</li>\n<li>\n<p>I have already updated the usage message here:<br>\n<a href=\"https://isabelle.sketis.net/repos/isabelle/rev/f73c691bd679\">https://isabelle.sketis.net/repos/isabelle/rev/f73c691bd679</a></p>\n</li>\n<li>\n<p>\"isabelle components -u\" is indeed a bit rough in Isabelle2021: I introduced<br>\nit for something marginal elsewhere, before it got more attention in the last<br>\nmoment in simplifying AFP setup.</p>\n</li>\n<li>\n<p>The check for etc/settings or etc/components is actually too strict: both<br>\nare optional and a meaningful component directory can have just ROOT and/or<br>\nROOTS as we see in AFP/thys. See also<br>\n<a href=\"https://isabelle.sketis.net/repos/isabelle/rev/c8b4a4f69068\">https://isabelle.sketis.net/repos/isabelle/rev/c8b4a4f69068</a></p>\n</li>\n</ul>\n<p>I will answer Gerwin's answer separately, especially for Isabelle2021 without<br>\nany of these changes.</p>\n<p>Makarius</p>",
        "id": 241652245,
        "sender_full_name": "Email Gateway",
        "timestamp": 1622920699
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nWe can be glad that the Isabelle + AFP repositories don't have Orwellian<br>\nmanipulation of history<br>\n<a href=\"https://www.sparknotes.com/lit/1984/quotes/theme/manipulation-of-history\">https://www.sparknotes.com/lit/1984/quotes/theme/manipulation-of-history</a> ---<br>\nso it is easy to look up things formally when memory becomes unsure.</p>\n<p>The initial AFP/etc/settings go back to Florian Haftmann in Aug-2011, where he<br>\nintroduced $AFP_BASE for the main AFP directory and $AFP for AFP/thys. See also:</p>\n<p><a href=\"https://isabelle-dev.sketis.net/source/afp-devel/history/default/etc/settings\">https://isabelle-dev.sketis.net/source/afp-devel/history/default/etc/settings</a></p>\n<p>changeset:   2357:5b970f669325<br>\nuser:        haftmann<br>\ndate:        Tue Aug 30 23:36:37 2011 +0200<br>\nfiles:       etc/settings tools/testafp<br>\ndescription:<br>\nrudimentary support for AFP as Isabelle component</p>\n<p>The isabelle build setup with ROOT / ROOTS is by myself and Gerwin in<br>\nAug/Sep-2012, when \"isabelle build\" emerged:</p>\n<p>changeset:   2994:3fa9ca7f4a5e<br>\nuser:        wenzelm<br>\ndate:        Sun Aug 05 22:01:12 2012 +0200<br>\nfiles:       thys/ROOT thys/ROOTS tools/afp_mkroot<br>\ndescription:<br>\nmore formal ROOTS catalog file;</p>\n<p>changeset:   3043:c2985e24d5f7<br>\nuser:        Gerwin Klein &lt;<a href=\"mailto:gerwin.klein@nicta.com.au\">gerwin.klein@nicta.com.au</a>&gt;<br>\ndate:        Sun Sep 02 15:15:04 2012 +1000<br>\nfiles:       admin/regression<br>\ndescription:<br>\ninclude ROOTS file to actually build something</p>\n<p>changeset:   11860:6d986a7dc22b<br>\nuser:        Gerwin Klein &lt;<a href=\"mailto:kleing@unsw.edu.au\">kleing@unsw.edu.au</a>&gt;<br>\ndate:        Thu May 27 10:07:17 2021 +1000<br>\nfiles:       ROOTS<br>\ndescription:<br>\nmake AFP ROOTS globally available for component</p>\n<p>My initial change 3fa9ca7f4a5e is where the thys/ROOTS file appears first. We<br>\nnever had a ROOTS in the main AFP directory, not by accident but by design.<br>\nThis was due to my re-interpretation of Florian's $AFP_BASE and $AFP settings<br>\nas follows:</p>\n<p>* $AFP_BASE is the administrative base directory of AFP, providing settings,<br>\nisabelle command-line tools etc.</p>\n<p>* $AFP is a symbolic handle on the actual session directories, with ROOTS as<br>\noverall catalog, and subdirectories with individual ROOT files.</p>\n<p>By initializing only $AFP_BASE as component, but not yet $AFP, it is possible<br>\nto refer to AFP sessions symbolically on demand: the session name space<br>\nremains clear of AFP entries by default.</p>\n<p>This is important for build management of Isabelle and AFP separately:</p>\n<p>isabelle build -a  # build all of Isabelle, without AFP</p>\n<p>isabelle build -a -d '$AFP'  # build all of Isabelle + AFP</p>\n<p>isabelle build -D '$AFP'  # build all of AFP, but only those images of<br>\nIsabelle that are required for it</p>\n<p>The option -d '$AFP' has later become idiomatic for many other Isabelle tools,<br>\nto add the \"AFP aspect\" with minimal complexity. For example for the Prover IDE:</p>\n<p>isabelle jedit -d '$AFP'</p>\n<p>or relatives of \"isabelle build\" that require formal sessions, like \"isabelle<br>\nexport\", \"isabelle document\" etc.</p>\n<p>This well-understood and important behaviour of $AFP_BASE vs. $AFP has been<br>\nlost by the following \"quick-fix\" that has emerged from this thread:</p>\n<p>changeset:   11677:6d986a7dc22b<br>\nuser:        Gerwin Klein &lt;<a href=\"mailto:kleing@unsw.edu.au\">kleing@unsw.edu.au</a>&gt;<br>\ndate:        Thu May 27 10:07:17 2021 +1000<br>\nfiles:       ROOTS<br>\ndescription:<br>\nmake AFP ROOTS globally available for component</p>\n<p>Note that I have already improved my \"isabelle components -u\" for the next<br>\nIsabelle release, to avoid such confusion in the future.</p>\n<p>For Isabelle2021 + AFP, there are at least two possibilities, without the<br>\ndeadly $AFP_BASE/ROOTS catalog:</p>\n<p>(1) Just create AFP/thys/etc/settings as a dummy, to make it look like a<br>\ncomponent directory for Isabelle2021/bin/isabelle components -u.</p>\n<p>(2) Be more ambitious in having the AFP/thys/etc/settings initialize<br>\n$AFP_BASE if not yet done by the user. Thus users get two choices for AFP as<br>\ncomponent:</p>\n<p>(a) use component AFP, but not AFP/thys; thus the important \"isabelle<br>\nbuild -a\" versus \"isabelle build -a -d '$AFP'\" works properly</p>\n<p>(b) use component AFP/thys and let its etc/settings init AFP if required<br>\n(otherwise users would have to init both AFP and AFP/thys manually).</p>\n<p>This is a long explanation for a small change, see the attachment for afp-2021<br>\n(and merge into afp-devel).</p>\n<p>It would be better to have fewer choices and less complexity: ultimately no<br>\nIsabelle/AFP user should be asked to tinker with component configuration: the<br>\nProver IDE should just do it in a prospective \"AFP\" panel.</p>\n<p>This will emerge eventually, but not in the next release (end of 2021).</p>\n<p>Makarius<br>\n<a href=\"/user_uploads/14278/9_5x2i-GnqT6RAFhvJon20EC/ch\">ch</a></p>",
        "id": 241653854,
        "sender_full_name": "Email Gateway",
        "timestamp": 1622923242
    },
    {
        "content": "<p>From: Gerwin Klein &lt;<a href=\"mailto:kleing@unsw.edu.au\">kleing@unsw.edu.au</a>&gt;</p>\n<blockquote>\n<p>On 6 Jun 2021, at 06:00, Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt; wrote:</p>\n<p>The initial AFP/etc/settings go back to Florian Haftmann in Aug-2011, where he<br>\nintroduced $AFP_BASE for the main AFP directory and $AFP for AFP/thys. See also:<br>\n[..]</p>\n</blockquote>\n<p>I agree with all of this.</p>\n<blockquote>\n<p>This is important for build management of Isabelle and AFP separately:</p>\n<p>isabelle build -a  # build all of Isabelle, without AFP</p>\n</blockquote>\n<p>True, I had not anticipated that <code>isabelle build -a</code> is called in contexts where the AFP is registered as component. You'd now have to explicitly exclude the afp group, and that is not very nice.</p>\n<blockquote>\n<p>The option -d '$AFP' has later become idiomatic for many other Isabelle tools,<br>\nto add the \"AFP aspect\" with minimal complexity. For example for the Prover IDE:</p>\n<p>isabelle jedit -d '$AFP'</p>\n</blockquote>\n<p>Agree, that was the canonical way, but that was part of the problem. It doesn't work for users who don't use the command line.</p>\n<p>We had discussions amongst the editors before about having AFP ROOTS available by default -- this what I was referring to about the ROOTS file. You can't find them in the history, because it didn't work when we discussed it, so it was never committed.</p>\n<p>[..]</p>\n<blockquote>\n<p>For Isabelle2021 + AFP, there are at least two possibilities, without the<br>\ndeadly $AFP_BASE/ROOTS catalog:<br>\n[..]<br>\n (2) Be more ambitious in having the AFP/thys/etc/settings initialize<br>\n$AFP_BASE if not yet done by the user. Thus users get two choices for AFP as<br>\ncomponent:</p>\n<p>(a) use component AFP, but not AFP/thys; thus the important \"isabelle<br>\nbuild -a\" versus \"isabelle build -a -d '$AFP'\" works properly</p>\n<p>(b) use component AFP/thys and let its etc/settings init AFP if required<br>\n(otherwise users would have to init both AFP and AFP/thys manually).</p>\n</blockquote>\n<p>This is much better than my solution, and I'd be very happy with it.</p>\n<blockquote>\n<p>This is a long explanation for a small change, see the attachment for afp-2021<br>\n(and merge into afp-devel).</p>\n</blockquote>\n<p>Thanks for that, I'll include it and update the instruction (again ;-))</p>\n<p>Cheers,<br>\nGerwin</p>",
        "id": 241663568,
        "sender_full_name": "Email Gateway",
        "timestamp": 1622939793
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nYes, I am aware of that extra assumption. It is part of the process to rethink<br>\nAFP within the Prover IDE.</p>\n<p>There is another ongoing process of rethinking: how to allow Isabelle/Scala<br>\nmodules within sessions and/or components.</p>\n<p>Maybe I eventually get the right idea, when revisiting this more seriously.</p>\n<p>Makarius</p>",
        "id": 241684558,
        "sender_full_name": "Email Gateway",
        "timestamp": 1622974784
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nGreat.</p>\n<p>I now see change 3a9c2004b599 both on afp-2021 and afp-devel.</p>\n<p>Makarius</p>",
        "id": 241684721,
        "sender_full_name": "Email Gateway",
        "timestamp": 1622975032
    },
    {
        "content": "<p>From: Gerwin Klein &lt;<a href=\"mailto:kleing@unsw.edu.au\">kleing@unsw.edu.au</a>&gt;<br>\nIntegrating the AFP more will probably be the better way long-term, yes.</p>\n<p>Cheers,<br>\nGerwin</p>",
        "id": 241749575,
        "sender_full_name": "Email Gateway",
        "timestamp": 1623057882
    }
]