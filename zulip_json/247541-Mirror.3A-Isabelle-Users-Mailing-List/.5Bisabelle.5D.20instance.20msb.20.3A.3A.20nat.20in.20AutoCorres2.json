[
    {
        "content": "<p>From: Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@cit.tum.de\">florian.haftmann@cit.tum.de</a>&gt;<br>\nHi all,</p>\n<p>in</p>\n<p><a href=\"https://isabelle.sketis.net/repos/afp-devel/file/tip/thys/AutoCorres2/lib/NatBitwise.thy#l19\">https://isabelle.sketis.net/repos/afp-devel/file/tip/thys/AutoCorres2/lib/NatBitwise.thy#l19</a></p>\n<p>there is an instance msb :: nat</p>\n<p>That is trivial, since ‹not (msb n)› for all natural numbers n.</p>\n<p>Given the context and history of that theory that appears to me as some <br>\nkind of accidental artifact. Is that instance actually deliberately used <br>\nsomewhere?</p>\n<p>The reason why I ask is that I am conducting an experiment how to equip <br>\nmsb with an abstract specification, and while it would surely be <br>\npossible to allow degenerated instances like msb :: nat, it would be <br>\ncleaner to base everything on ring_bit_operations, which does not <br>\ninclude nat.</p>\n<p>Cheers,<br>\n    Florian</p>\n<p><a href=\"/user_uploads/14278/kXpi8uAh_WWUtDs8B0C55NnJ/OpenPGP_0xA707172232CFA4E9.asc\">OpenPGP_0xA707172232CFA4E9.asc</a><br>\n<a href=\"/user_uploads/14278/heGumwm9gGBpPMnukCSiolQI/OpenPGP_signature.asc\">OpenPGP_signature.asc</a></p>",
        "id": 507434239,
        "sender_full_name": "Email Gateway",
        "timestamp": 1742636094
    },
    {
        "content": "<p>From: Gerwin Klein &lt;<a href=\"mailto:cl-isabelle-users@lists.cam.ac.uk\">cl-isabelle-users@lists.cam.ac.uk</a>&gt;<br>\nIt’s not accidental,— msb is an operation introduced for Word, and AutoCorres has an option to lift Word arithmetic into nat.</p>\n<p>Cheers,<br>\nGerwin</p>\n<blockquote>\n<p>On 22 Mar 2025, at 20:32, Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@cit.tum.de\">florian.haftmann@cit.tum.de</a>&gt; wrote:</p>\n<p>Hi all,</p>\n<p>in</p>\n<p><a href=\"https://isabelle.sketis.net/repos/afp-devel/file/tip/thys/AutoCorres2/lib/NatBitwise.thy#l19\">https://isabelle.sketis.net/repos/afp-devel/file/tip/thys/AutoCorres2/lib/NatBitwise.thy#l19</a></p>\n<p>there is an instance msb :: nat</p>\n<p>That is trivial, since ‹not (msb n)› for all natural numbers n.</p>\n<p>Given the context and history of that theory that appears to me as some kind of accidental artifact. Is that instance actually deliberately used somewhere?</p>\n<p>The reason why I ask is that I am conducting an experiment how to equip msb with an abstract specification, and while it would surely be possible to allow degenerated instances like msb :: nat, it would be cleaner to base everything on ring_bit_operations, which does not include nat.</p>\n<p>Cheers,<br>\n  Florian<br>\n&lt;OpenPGP_0xA707172232CFA4E9.asc&gt;</p>\n</blockquote>",
        "id": 507505489,
        "sender_full_name": "Email Gateway",
        "timestamp": 1742688188
    },
    {
        "content": "<p>From: Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@cit.tum.de\">florian.haftmann@cit.tum.de</a>&gt;<br>\nHi Gerwin,</p>\n<blockquote>\n<p>It’s not accidental,— msb is an operation introduced for Word, and AutoCorres has an option to lift Word arithmetic into nat.</p>\n</blockquote>\n<p>this statement does not wholly fit the picture as found in the sources.</p>\n<p>a) msb is not restricted to word types, it is generic (currently, purely <br>\nsyntactic); there is an instance on int with ‹msb k &lt;--&gt; k &lt; 0›.</p>\n<p>b) In <br>\n<a href=\"https://isabelle.sketis.net/repos/afp-devel/file/tip/thys/AutoCorres2/lib/NatBitwise.thy#l19\">https://isabelle.sketis.net/repos/afp-devel/file/tip/thys/AutoCorres2/lib/NatBitwise.thy#l19</a> <br>\nthere is the mentioned degenerate instance for nat with ‹not (msb n)›.</p>\n<p>c) When lifting from word to nat, the corresponding operation is <em>not</em> msb:<br>\n    ‹msb w &lt;--&gt; msb (unat w)› does not hold<br>\n    but ‹msb w &lt;--&gt; msb (unat w) (size w - 1)› does</p>\n<p>d) At least concerning AutoCorres2, the degenerate instance nat :: msb <br>\ncan be dropped safely: <br>\n&lt;<a href=\"https://build.proof.cit.tum.de/build?id=e2dd2a76-3b4f-43f9-a83c-564c26bfa910\">https://build.proof.cit.tum.de/build?id=e2dd2a76-3b4f-43f9-a83c-564c26bfa910</a>&gt; <br>\n– there is no theorem in AutoCorres2 referring to that instance.  (I do <br>\nnot know enough about the relationship between AutoCorres and <br>\nAutoCorres2 to judge how this observation transfers to AutoCorres).</p>\n<p>Going back to the original question: is the instance msb :: nat actually <br>\nused somewhere?  The evidence as found in the AFP suggests no, but this <br>\nmight be illusive.</p>\n<p>Cheers,<br>\n    Florian</p>\n<p><a href=\"/user_uploads/14278/J6qtwelaS9C7FEZnHQbQtZtx/OpenPGP_0xA707172232CFA4E9.asc\">OpenPGP_0xA707172232CFA4E9.asc</a><br>\n<a href=\"/user_uploads/14278/naJx5sVa2pROaK2_UfMNqEU_/OpenPGP_signature.asc\">OpenPGP_signature.asc</a></p>",
        "id": 508758265,
        "sender_full_name": "Email Gateway",
        "timestamp": 1743169411
    },
    {
        "content": "<p>From: Norbert Schirmer &lt;<a href=\"mailto:cl-isabelle-users@lists.cam.ac.uk\">cl-isabelle-users@lists.cam.ac.uk</a>&gt;<br>\nHi Florian,</p>\n<blockquote>\n<p>On 28. Mar 2025, at 14:42, Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@cit.tum.de\">florian.haftmann@cit.tum.de</a>&gt; wrote:</p>\n<p>Going back to the original question: is the instance msb :: nat actually used somewhere?  The evidence as found in the AFP suggests no, but this might be illusive.</p>\n</blockquote>\n<p>Thanks for sorting this out. From our perspective and use cases feel free to remove the instance.</p>\n<p>Regards,<br>\nNorbert</p>\n<p>--</p>\n<p>Norbert Schirmer (<a href=\"mailto:nschirmer@apple.com\">nschirmer@apple.com</a>)<br>\n SEG Formal Verification</p>",
        "id": 509145177,
        "sender_full_name": "Email Gateway",
        "timestamp": 1743413137
    },
    {
        "content": "<p>From: Gerwin Klein &lt;<a href=\"mailto:cl-isabelle-users@lists.cam.ac.uk\">cl-isabelle-users@lists.cam.ac.uk</a>&gt;</p>\n<blockquote>\n<p>a) msb is not restricted to word types, it is generic (currently, purely syntactic); there is an instance on int with ‹msb k &lt;--&gt; k &lt; 0›.</p>\n</blockquote>\n<p>Yes, which was introduced later. The operation was originally written for the word type, like almost all bit operations that Isabelle currently supports.</p>\n<blockquote>\n<p>b) In <a href=\"https://isabelle.sketis.net/repos/afp-devel/file/tip/thys/AutoCorres2/lib/NatBitwise.thy#l19\">https://isabelle.sketis.net/repos/afp-devel/file/tip/thys/AutoCorres2/lib/NatBitwise.thy#l19</a> there is the mentioned degenerate instance for nat with ‹not (msb n)›.</p>\n</blockquote>\n<p>Correct. And yes, I agree that it does not appear to be used in AutoCorres the way I thought it was.</p>\n<blockquote>\n<p>d) At least concerning AutoCorres2, the degenerate instance nat :: msb can be dropped safely: &lt;<a href=\"https://build.proof.cit.tum.de/build?id=e2dd2a76-3b4f-43f9-a83c-564c26bfa910\">https://build.proof.cit.tum.de/build?id=e2dd2a76-3b4f-43f9-a83c-564c26bfa910</a>&gt; – there is no theorem in AutoCorres2 referring to that instance.  (I do not know enough about the relationship between AutoCorres and AutoCorres2 to judge how this observation transfers to AutoCorres).</p>\n</blockquote>\n<p>I don’t think the versions have deviated in that point, so that would not be a problem.</p>\n<blockquote>\n<p>Going back to the original question: is the instance msb :: nat actually used somewhere?  The evidence as found in the AFP suggests no, but this might be illusive.</p>\n</blockquote>\n<p>Whether it is used or not was not your original question, and it should not decide the whether the instance should be dropped or not. Your question was whether it was intentional, and it was.</p>\n<p>The real question is whether it is useful or not. I can see some scenarios where being able to write the term <code>msb n</code> for nat is useful, but since the instance is trivial, those can likely be avoided.</p>\n<p>On the other side of the equation: what is the added benefit we get from dropping the nat instance?</p>\n<p>Which instances are you intending for the new type class and which properties are you thinking to use for the axiomatisation? How much annoyance are we accepting if we want nat as an instance?</p>\n<p>I’m not saying we can’t remove it under any circumstances, but we should remove it for the right reasons. You might have those, but that’s what we should be discussing.</p>\n<p>Cheers,<br>\nGerwin</p>",
        "id": 509317501,
        "sender_full_name": "Email Gateway",
        "timestamp": 1743461368
    },
    {
        "content": "<p>From: Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@cit.tum.de\">florian.haftmann@cit.tum.de</a>&gt;<br>\nAm 01.04.25 um 00:48 schrieb Gerwin Klein (via cl-isabelle-users Mailing <br>\nList):</p>\n<blockquote>\n<p>The real question is whether it is useful or not. I can see some scenarios where being able to write the term <code>msb n</code> for nat is useful, but since the instance is trivial, those can likely be avoided.</p>\n<p>On the other side of the equation: what is the added benefit we get from dropping the nat instance?</p>\n<p>Which instances are you intending for the new type class and which properties are you thinking to use for the axiomatisation? How much annoyance are we accepting if we want nat as an instance?</p>\n</blockquote>\n<p>OK, that is actually the next step in this mail thread.</p>\n<p>For my currently favored proposal, see the attached theory.</p>\n<p>There is some history behind.</p>\n<p>The original motivation is to provide a type-agnostic abstract <br>\nspecification for msb.</p>\n<p>a) One idea would have been to restrict msb to word types, where there <br>\nis always a highest bit index. AFAIR, we have discarded this idea – I <br>\ndon’t recall the details but I think there was a mail thread on this.</p>\n<p>b) Another idea is purely hypothetical: There are a couple of operations <br>\nwhich conceptually exist in a »signed« and an »unsigned« variant on word <br>\ntypes. The signed variants correspond to counterparts on int (where <br>\nsigned and unsigned coincide); but the syntax / type classes used on int <br>\nare used for the »unsigned« variants on word, breaking the <br>\ncorrespondence. Examples are (≤s, &gt;&gt;&gt;, signed_take_bit) on word which <br>\ncorrespond to (≤, &gt;&gt;, take_bit) on int.<br>\nWould ≤ be signed and hence correspond to ≤ on int, then ‹msb a ↔ a &lt; 0› <br>\nwould hold. But this is just a theoretic observation: even if that <br>\ncorrespondence would justify to prefer the »signed« variants on word <br>\ntypes, it is now too late to change that.</p>\n<p>c) What is demonstrated in the attached theory: a rather abstract <br>\nspecification which nevertheless allows to deduce generic results like <br>\n‹msb (a AND b) ↔ msb a ∧ msb b›</p>\n<p>The question is of course: how many instances of msb are around there <br>\nnot part of the AFP?</p>\n<p>For nat, it is surely possible to widen the superclass from <br>\nring_bit_operations to semiring_bit_operations. This does however not <br>\nanswer whether there are further instances outside there that would <br>\nrequire appropriate treatment.</p>\n<p>Cheers,<br>\n    Florian</p>\n<p><a href=\"/user_uploads/14278/6RaxnDPgs0s9H6AmlukigEqX/Most_significant_bit.thy\">Most_significant_bit.thy</a><br>\n<a href=\"/user_uploads/14278/jqPB8Pc6u2ixwkJF8qj5O7du/OpenPGP_0xA707172232CFA4E9.asc\">OpenPGP_0xA707172232CFA4E9.asc</a><br>\n<a href=\"/user_uploads/14278/Zof4RmvBh0qq5VqYvTtCViPj/OpenPGP_signature.asc\">OpenPGP_signature.asc</a></p>",
        "id": 509427371,
        "sender_full_name": "Email Gateway",
        "timestamp": 1743507430
    },
    {
        "content": "<p>From: Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@cit.tum.de\">florian.haftmann@cit.tum.de</a>&gt;<br>\nThis thread is still dangling.</p>\n<p>If there is no better conclusion at the moment, I would<br>\na) remove the unused instance msb :: nat from AutoCorres2<br>\nb) base the abstract specification of msb on semiring_bit_operations <br>\nrather than to allow an instance msb :: nat nonetheless</p>\n<p>Florian</p>\n<p>Am 01.04.25 um 13:28 schrieb Florian Haftmann:</p>\n<blockquote>\n<p>Am 01.04.25 um 00:48 schrieb Gerwin Klein (via cl-isabelle-users Mailing <br>\nList):</p>\n<blockquote>\n<p>The real question is whether it is useful or not. I can see some <br>\nscenarios where being able to write the term <code>msb n</code> for nat is <br>\nuseful, but since the instance is trivial, those can likely be avoided.</p>\n<p>On the other side of the equation: what is the added benefit we get <br>\nfrom dropping the nat instance?</p>\n<p>Which instances are you intending for the new type class and which <br>\nproperties are you thinking to use for the axiomatisation? How much <br>\nannoyance are we accepting if we want nat as an instance?</p>\n</blockquote>\n<p>OK, that is actually the next step in this mail thread.</p>\n<p>For my currently favored proposal, see the attached theory.</p>\n<p>There is some history behind.</p>\n<p>The original motivation is to provide a type-agnostic abstract <br>\nspecification for msb.</p>\n<p>a) One idea would have been to restrict msb to word types, where there <br>\nis always a highest bit index. AFAIR, we have discarded this idea – I <br>\ndon’t recall the details but I think there was a mail thread on this.</p>\n<p>b) Another idea is purely hypothetical: There are a couple of operations <br>\nwhich conceptually exist in a »signed« and an »unsigned« variant on word <br>\ntypes. The signed variants correspond to counterparts on int (where <br>\nsigned and unsigned coincide); but the syntax / type classes used on int <br>\nare used for the »unsigned« variants on word, breaking the <br>\ncorrespondence. Examples are (≤s, &gt;&gt;&gt;, signed_take_bit) on word which <br>\ncorrespond to (≤, &gt;&gt;, take_bit) on int.<br>\nWould ≤ be signed and hence correspond to ≤ on int, then ‹msb a ↔ a &lt; 0› <br>\nwould hold. But this is just a theoretic observation: even if that <br>\ncorrespondence would justify to prefer the »signed« variants on word <br>\ntypes, it is now too late to change that.</p>\n<p>c) What is demonstrated in the attached theory: a rather abstract <br>\nspecification which nevertheless allows to deduce generic results like <br>\n‹msb (a AND b) ↔ msb a ∧ msb b›</p>\n<p>The question is of course: how many instances of msb are around there <br>\nnot part of the AFP?</p>\n<p>For nat, it is surely possible to widen the superclass from <br>\nring_bit_operations to semiring_bit_operations. This does however not <br>\nanswer whether there are further instances outside there that would <br>\nrequire appropriate treatment.</p>\n<p>Cheers,<br>\n     Florian</p>\n</blockquote>\n<p><a href=\"/user_uploads/14278/KgjZidMGIdTyYKreHXkYxn4b/OpenPGP_0xA707172232CFA4E9.asc\">OpenPGP_0xA707172232CFA4E9.asc</a><br>\n<a href=\"/user_uploads/14278/iXEFfxmsq1yOEAQdYPxsBv0o/OpenPGP_signature.asc\">OpenPGP_signature.asc</a></p>",
        "id": 513668202,
        "sender_full_name": "Email Gateway",
        "timestamp": 1745343530
    }
]