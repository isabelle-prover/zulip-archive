[
    {
        "content": "<p><strong>From:</strong> Daniel Kirchner &lt;<a href=\"mailto:cl-isabelle-users@lists.cam.ac.uk\">cl-isabelle-users@lists.cam.ac.uk</a>&gt;</p>\n<p>Hi all,</p>\n<p>I'm a bit confused about the recursive behaviour of the polarity of<br>\nunbundle in nested bundles. Consider the following snippet:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">bundle</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"k\">begin</span>\n<span class=\"k\">notation</span><span class=\"w\"> </span><span class=\"n\">implies</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kp\">infix</span><span class=\"w\"> </span><span class=\"s\">\"-&gt;\"</span><span class=\"w\"> </span><span class=\"n\">25</span><span class=\"o\">)</span>\n<span class=\"k\">end</span>\n<span class=\"k\">bundle</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"k\">begin</span>\n<span class=\"n\">unbundle</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"k\">end</span>\n\n<span class=\"kt\">term</span><span class=\"w\"> </span><span class=\"s\">\"a -&gt; b\"</span><span class=\"w\"> </span><span class=\"c\">(* expected: doesn't parse *)</span>\n<span class=\"n\">unbundle</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"kt\">term</span><span class=\"w\"> </span><span class=\"s\">\"a -&gt; b\"</span><span class=\"w\"> </span><span class=\"c\">(* expected: parses *)</span>\n<span class=\"n\">unbundle</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"kt\">term</span><span class=\"w\"> </span><span class=\"s\">\"a -&gt; b\"</span><span class=\"w\"> </span><span class=\"c\">(* unexpected: still parses! *)</span>\n<span class=\"n\">unbundle</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"kt\">term</span><span class=\"w\"> </span><span class=\"s\">\"a -&gt; b\"</span><span class=\"w\"> </span><span class=\"c\">(* only now fails to parse again *)</span>\n</code></pre></div>\n<p>isar-ref.pdf states for the no-prefix of bundles that \"This also works<br>\nrecusively for the unbundle command as declaration inside a bundle<br>\ndefinition: no means that both the order and polarity of declarations<br>\nis reversed\"</p>\n<p>So shouldn't \"unbundle no B\" entail \"unbundle no A\" resulting in the<br>\nnotation to already vanish in the third \"term\" above? It actually<br>\nappears to be the case that \"unbundle no B\" even causes \"unbundle A\"<br>\ninstead of \"unbundle no A\" (replace \"unbundle B\" with \"unbundle no B\"<br>\nin the snippet above and the behaviour remains exactly the same).</p>\n<p>It would be useful to be able to define several fine-grained bundles<br>\nand then combine them into a compound bundle, but due to this<br>\nbehaviour, that doesn't seem to work as expected.</p>\n<p>Interestingly, for \"unbundle no\" within bundles, reversing the polarity<br>\n<em>does</em> seem to work, so this works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Isabelle\"><pre><span></span><code><span class=\"k\">bundle</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"k\">begin</span>\n<span class=\"k\">notation</span><span class=\"w\"> </span><span class=\"n\">implies</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kp\">infix</span><span class=\"w\"> </span><span class=\"s\">\"-&gt;\"</span><span class=\"w\"> </span><span class=\"n\">25</span><span class=\"o\">)</span>\n<span class=\"k\">end</span>\n<span class=\"k\">bundle</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"k\">begin</span>\n<span class=\"n\">unbundle</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"k\">end</span>\n\n<span class=\"kt\">term</span><span class=\"w\"> </span><span class=\"s\">\"a -&gt; b\"</span><span class=\"w\"> </span><span class=\"c\">(* as expected: doesn't parse *)</span>\n<span class=\"n\">unbundle</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"kt\">term</span><span class=\"w\"> </span><span class=\"s\">\"a -&gt; b\"</span><span class=\"w\"> </span><span class=\"c\">(* as expected: parses *)</span>\n<span class=\"n\">unbundle</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"kt\">term</span><span class=\"w\"> </span><span class=\"s\">\"a -&gt; b\"</span><span class=\"w\"> </span><span class=\"c\">(* as expected: doesn't parse *)</span>\n</code></pre></div>\n<p>Is this a bug or am I misunderstanding something here? If the latter,<br>\nis there another way to define a bundle C consisting of several other<br>\nbundles, s.t. \"unbundle C\" unbundles all of them, while \"unbundle no C\"<br>\ncauses \"unbundle no\" for all of them?</p>\n<p>Best wishes,<br>\nDaniel</p>",
        "id": 574269539,
        "sender_full_name": "Email Gateway",
        "timestamp": 1771327912
    }
]