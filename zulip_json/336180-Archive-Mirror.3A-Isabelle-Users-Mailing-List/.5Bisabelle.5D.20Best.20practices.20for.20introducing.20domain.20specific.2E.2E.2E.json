[
    {
        "content": "<p>From: Dominique Unruh &lt;<a href=\"mailto:unruh@ut.ee\">unruh@ut.ee</a>&gt;<br>\nHi,</p>\n<p>one thing that has always been bugging me is the pollution of Isabelle <br>\nsyntax with domain specific notation.</p>\n<p>For example, if I develop a theory involving inner products, I may want <br>\nto introduce the notation \"a · b\" to make my theorems readable.</p>\n<p>But that means that everyone who uses my theory will suddenly have my <br>\nnotation \"·\" in their namespace. Possibly conflicting with syntax from <br>\nother theories.</p>\n<p>Of course, there are mechanisms for local syntax. For example, locals <br>\nand bundles. But I am not sure what the best practices are for using them.</p>\n<p>* With locales, I have the following problems: I cannot separate the<br>\n    notation from the logical context. For example, sometimes my<br>\n    definition will not be in any natural way part of a locale. For<br>\n    example, if I introduce a datatype and an operation on it (say,<br>\n    lists, and · for concatenation) then I would not know where to put<br>\n    the notation. Also, as far as I understand, with locales, there is<br>\n    no way to use the notation (like \"including\" with bundles) locally<br>\n    without actually using the whole logical context of the locale (in<br>\n    particular, if I want to use some notation from a locale in the<br>\n    statement of a lemma by using \"(in name)\", that lemma will then<br>\n    automatically be in the name space of the locale).</p>\n<p>* Bundles seem to have more flexibility. I can put a number of syntax<br>\n    elements together and include them as needed. Unfortunately, it<br>\n    seems that bundles are not extensible. For example, assume a theory<br>\n    that introduces a number of concepts throughout the theory (or even<br>\n    several theories). E.g., inner product, norm, closure of sets,<br>\n    Minkowski product, etc. If I want to use bundles, I have the<br>\n    following choices:<br>\n      o I introduce all the definitions at the beginning of the theory<br>\n        (and thus break the logical structure of the presentation) and<br>\n        make a bundle with syntax at the beginning.<br>\n      o I introduce all the definitions where they fit logically, and<br>\n        introduce syntax only at the very end (as one bundle). Then I<br>\n        cannot use the notation within the theories.<br>\n      o I introduce a new bundle each time I introduce new syntax (and<br>\n        end up with a lot of bundles that I can later combine into one<br>\n        bundle). That avoids the above problems, but it means that I<br>\n        pollute the name space with a lot of temporary bundle names.</p>\n<p>What is the best approach here?</p>\n<p>I feel that a clear guideline for such situations might be useful not <br>\njust for me, but could also make the AFP more reuse-friendly. <br>\n(Currently, I get all the notation introduced by an author when I import <br>\nan AFP theory, even if I only want to use one theorem of theirs for a <br>\ntechnical lemma.) I'd even go so far to say that I think on the long run <br>\nit would be a good idea to require the absence of syntax pollution as <br>\npart of the requirements for AFP submissions.</p>\n<p>Best wishes,<br>\nDominique.</p>",
        "id": 294756266,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197632
    },
    {
        "content": "<p>From: Alexander Krauss &lt;<a href=\"mailto:krauss@in.tum.de\">krauss@in.tum.de</a>&gt;<br>\nHi Dominique, hi all,</p>\n<p>This thread hasn't got much attention so far, but I think it touches an<br>\nissue that is worth discussing. I also want to learn more about this.</p>\n<p>Am 06.05.2019 um 14:50 schrieb Dominique Unruh:</p>\n<blockquote>\n<p>one thing that has always been bugging me is the pollution of Isabelle<br>\nsyntax with domain specific notation.</p>\n<p>For example, if I develop a theory involving inner products, I may want<br>\nto introduce the notation \"a · b\" to make my theorems readable.</p>\n<p>But that means that everyone who uses my theory will suddenly have my<br>\nnotation \"·\" in their namespace. Possibly conflicting with syntax from<br>\nother theories.</p>\n<p>Of course, there are mechanisms for local syntax. For example, locals<br>\nand bundles. But I am not sure what the best practices are for using them.</p>\n<p>* With locales, I have the following problems: I cannot separate the<br>\n   notation from the logical context. For example, sometimes my<br>\n   definition will not be in any natural way part of a locale. For<br>\n   example, if I introduce a datatype and an operation on it (say,<br>\n   lists, and · for concatenation) then I would not know where to put<br>\n   the notation. Also, as far as I understand, with locales, there is<br>\n   no way to use the notation (like \"including\" with bundles) locally<br>\n   without actually using the whole logical context of the locale (in<br>\n   particular, if I want to use some notation from a locale in the<br>\n   statement of a lemma by using \"(in name)\", that lemma will then<br>\n   automatically be in the name space of the locale).</p>\n</blockquote>\n<p>I think locales were built mostly with the logical applications in mind.<br>\nI would consider their use for just syntax/extra-logical matters an<br>\nabuse, although that has been common...</p>\n<blockquote>\n<p>* Bundles seem to have more flexibility. I can put a number of syntax<br>\n   elements together and include them as needed. Unfortunately, it<br>\n   seems that bundles are not extensible. For example, assume a theory<br>\n   that introduces a number of concepts throughout the theory (or even<br>\n   several theories). E.g., inner product, norm, closure of sets,<br>\n   Minkowski product, etc. If I want to use bundles, I have the<br>\n   following choices:<br>\n     o I introduce all the definitions at the beginning of the theory<br>\n       (and thus break the logical structure of the presentation) and<br>\n       make a bundle with syntax at the beginning.<br>\n     o I introduce all the definitions where they fit logically, and<br>\n       introduce syntax only at the very end (as one bundle). Then I<br>\n       cannot use the notation within the theories.<br>\n     o I introduce a new bundle each time I introduce new syntax (and<br>\n       end up with a lot of bundles that I can later combine into one<br>\n       bundle). That avoids the above problems, but it means that I<br>\n       pollute the name space with a lot of temporary bundle names.</p>\n<p>What is the best approach here?</p>\n</blockquote>\n<p>I looked around a bit to see what others do with bundles today. Here are<br>\nsome things I found:</p>\n<ul>\n<li>\n<p>Sometimes there are \"negative\" syntax bundles in the style of</p>\n<p>bundle no_foo_syntax<br>\n  begin<br>\n    no_notation foo    (\"**\")<br>\n  end</p>\n</li>\n<li>\n<p>In particular, I saw this pattern in the end of HOL/Library/Perm.thy,<br>\nwhich I found interesting.</p>\n<p>subsection ‹Syntax›</p>\n<p>bundle no_permutation_syntax<br>\n  begin<br>\n    no_notation swap    (\"⟨_↔_⟩\")<br>\n    no_notation cycle   (\"⟨_⟩\")<br>\n    no_notation \"apply\" (infixl \"⟨$⟩\" 999)<br>\n  end</p>\n<p>bundle permutation_syntax<br>\n  begin<br>\n    notation swap       (\"⟨_↔_⟩\")<br>\n    notation cycle      (\"⟨_⟩\")<br>\n    notation \"apply\"    (infixl \"⟨$⟩\" 999)<br>\n    no_notation \"apply\" (\"(⟨$⟩)\")<br>\n  end</p>\n<p>unbundle no_permutation_syntax</p>\n</li>\n</ul>\n<p>This effectively gives users an \"on/off\" switch, although it is not<br>\nparticularly pretty when the respective (no_)notation declarations are<br>\nstacked onto each other. A similar thing is done in the end of<br>\nHOL/Decision_Procs/Approximation.thy and in several places in the AFP.</p>\n<ul>\n<li>HOL/Main.thy also removes quite a bit of common syntax at the end, and<br>\ndeclares a bundle cardinal_syntax which contains some of the previously<br>\nremoved notation.</li>\n</ul>\n<blockquote>\n<p>I feel that a clear guideline for such situations might be useful not<br>\njust for me, but could also make the AFP more reuse-friendly.</p>\n</blockquote>\n<p>Given the observations above, I think in current Isabelle the best<br>\npractice for library developers would be:</p>\n<ul>\n<li>Provide a canonical entry point for users of your library.</li>\n<li>\n<p>At the end of that entry point, remove any syntax that is specific to<br>\nyour library.</p>\n</li>\n<li>\n<p>Declare a foo_syntax bundle that users can use to activate the syntax,<br>\nand possibly also a no_foo_syntax bundle.</p>\n</li>\n</ul>\n<blockquote>\n<p>(Currently, I get all the notation introduced by an author when I import<br>\nan AFP theory, even if I only want to use one theorem of theirs for a<br>\ntechnical lemma.) I'd even go so far to say that I think on the long run<br>\nit would be a good idea to require the absence of syntax pollution as<br>\npart of the requirements for AFP submissions.</p>\n</blockquote>\n<p>I think not everything was designed for being reused, and this is<br>\nprobably ok, since AFP contains both libraries and applications. But<br>\nwhen something is used as a library, it should avoid syntax pollution.</p>\n<p>Another interesting question is: What concepts should future-Isabelle<br>\nprovide to make this more natural? I find the above pattern quite<br>\nverbose and somewhat unintuitive. Would extensible bundles help?</p>\n<p>Best<br>\nAlex</p>",
        "id": 294756962,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197928
    },
    {
        "content": "<p>From: Lawrence Paulson &lt;<a href=\"mailto:lp15@cam.ac.uk\">lp15@cam.ac.uk</a>&gt;<br>\nCount me in as interested in a better (simpler to set up and use) way of managing syntax. For example, there are some infix operators declared in Algebra that in most cases don’t need to be visible outside.</p>\n<p>Larry</p>",
        "id": 294756990,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197940
    },
    {
        "content": "<p>From: Yakoub Nemouchi &lt;<a href=\"mailto:y.nemouchi@gmail.com\">y.nemouchi@gmail.com</a>&gt;<br>\nHi,</p>\n<p>I am very interested in the topic.<br>\nOur AFP entry (see <a href=\"https://www.isa-afp.org/entries/UTP.html\">https://www.isa-afp.org/entries/UTP.html</a>) suffers from<br>\nsuch a problem.<br>\nActually UTP has a very strong syntactic flavor which I would like to<br>\nactivate and de-activate whenever I want.</p>\n<p>I am thinking of an approach that uses a top-level command that allow me to<br>\nactivate the UTP syntax inside the cartouch and de-activate it whenever I<br>\nam out of the scope of the command.<br>\nOne problem is: it might that my top-level command need the syntax of HOL<br>\nas well as the document model \"HOL\" since I would like to define new<br>\nconcepts or prove new lemmas with the activated syntax.<br>\nBut technically I am not sure how practical is this, since I did not yet<br>\nstart doing it.</p>\n<p>I agree that it is not a trivial problem we have here.</p>\n<p>Best wishes,</p>\n<p>Yakoub.</p>",
        "id": 294757011,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197950
    },
    {
        "content": "<p>From: Dominique Unruh &lt;<a href=\"mailto:unruh@ut.ee\">unruh@ut.ee</a>&gt;<br>\nHi,</p>\n<p>the syntax/nosyntax bundle idea is a nice hack, and possibly the best we <br>\ncan do right now. (I didn't know that one can do no_notation in a <br>\nbundle! :) )</p>\n<p>On the long run, I think the following would be good:</p>\n<p>* Extensible bundles (so that we can add notation throughout the<br>\n    theory as it comes up).</p>\n<p>* Ability to use the bundle syntax everywhere.</p>\n<p>Currently, we can use it in lemma-statements and proofs using<br>\n    includes/include, we cannot use bundled notation in the definition<br>\n    of a locale/class, or in the output of the thm diagnostic command.<br>\n    (We can use unbundle  before the local/thm, of course, but that has<br>\n    a global effect.)</p>\n<p>The syntax/nosyntax hack solves this, though.</p>\n<p>* Some way to also bundle advanced notation. I think there is<br>\n    currently no easy way to bundle syntax that involves parse/print<br>\n    translations.</p>\n<p>(The only current way I see is to create an attribute that sets a<br>\n    flag, in the code of the parse/print translation to check whether<br>\n    that flag is set, and then activate/deactivate the flag using the<br>\n    attribute in a bundle.)</p>\n<p>Best wishes,<br>\nDominique.</p>",
        "id": 294757016,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197952
    },
    {
        "content": "<p>From: Florian Haftmann &lt;<a href=\"mailto:florian.haftmann@informatik.tu-muenchen.de\">florian.haftmann@informatik.tu-muenchen.de</a>&gt;<br>\nHi Alex,</p>\n<blockquote>\n<blockquote>\n<ul>\n<li>In particular, I saw this pattern in the end of HOL/Library/Perm.thy,<br>\nwhich I found interesting.<p>subsection ‹Syntax›</p>\n<p>bundle no_permutation_syntax<br>\n  begin<br>\n    no_notation swap    (\"⟨_↔_⟩\")<br>\n    no_notation cycle   (\"⟨_⟩\")<br>\n    no_notation \"apply\" (infixl \"⟨$⟩\" 999)<br>\n  end</p>\n<p>bundle permutation_syntax<br>\n  begin<br>\n    notation swap       (\"⟨_↔_⟩\")<br>\n    notation cycle      (\"⟨_⟩\")<br>\n    notation \"apply\"    (infixl \"⟨$⟩\" 999)<br>\n    no_notation \"apply\" (\"(⟨$⟩)\")<br>\n  end</p>\n<p>unbundle no_permutation_syntax</p>\n</li>\n</ul>\n<p>This effectively gives users an \"on/off\" switch, although it is not<br>\nparticularly pretty when the respective (no_)notation declarations are<br>\nstacked onto each other. A similar thing is done in the end of<br>\nHOL/Decision_Procs/Approximation.thy and in several places in the AFP.</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>Given the observations above, I think in current Isabelle the best<br>\npractice for library developers would be:</p>\n<ul>\n<li>Provide a canonical entry point for users of your library.</li>\n<li>At the end of that entry point, remove any syntax that is specific to<br>\nyour library.</li>\n<li>Declare a foo_syntax bundle that users can use to activate the syntax,<br>\nand possibly also a no_foo_syntax bundle.</li>\n</ul>\n</blockquote>\n</blockquote>\n<p>thanks for digging into that.</p>\n<p>This indeed resembles the state of the art (which is not applied<br>\neverywhere, though), with the following disadvantages:</p>\n<ul>\n<li>\n<p>The switches have to be maintained by hand; at least they are in local<br>\nproximity, which is far superior than requiring ad-hoc no_notation<br>\ndeclarations which are fragile since priorities must match exactly etc.<br>\n Extensible bundles would be helpful here.</p>\n</li>\n<li>\n<p>There is no way to store global syntax declarations in bundles, see e.<br>\ng. Library/Lattice_Syntax.thy.  This is the reason why e. g. lattice<br>\nsyntax has not been organized using bundles yet.</p>\n</li>\n</ul>\n<blockquote>\n<blockquote>\n<p>I think locales were built mostly with the logical applications in mind.<br>\nI would consider their use for just syntax/extra-logical matters an<br>\nabuse, although that has been common...</p>\n</blockquote>\n</blockquote>\n<p>Indeed.  The »subscriptive« nature of locales also provides no means for<br>\nswitching on and off things, the conceptual main distinction between<br>\nlocales and bundles.</p>\n<p>Cheers,<br>\n    Florian<br>\n<a href=\"/user_uploads/14278/CUKwCBF50YyvuqbdxpvaM0Fi/signature.asc\">signature.asc</a></p>",
        "id": 294757038,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197965
    }
]