[
    {
        "content": "<p>From: Mathias Pfeiffer &lt;<a href=\"mailto:mathias.pfeiffer@rwth-aachen.de\">mathias.pfeiffer@rwth-aachen.de</a>&gt;<br>\nGreetings,</p>\n<p>I am working with a session B that requires session A through the \"session\"<br>\nkeyword (B has further dependencies and cannot make use of the \"parent\"). I<br>\nwant to import a theory TheoryA from A into TheoryB of B. The theory<br>\nTheoryA lies within a subfolder X of A's directory:</p>\n<blockquote>\n<p>session A in \"A\" = HOLCF +<br>\n    theories<br>\n        \"X/TheoryA\"</p>\n</blockquote>\n<p>And B properly specifies its dependency:</p>\n<blockquote>\n<p>session B in \"B\" = HOLCF +<br>\n    sessions<br>\n        \"A\"<br>\n    theories<br>\n        \"TheoryB\"</p>\n</blockquote>\n<p>The import in TheoryB fails in Isabelle2020, succeeds in Isabelle2019:</p>\n<blockquote>\n<p>theory TheoryB<br>\n    imports A.TheoryA (* Bad theory import \"A.TheoryA\" *)<br>\n...</p>\n</blockquote>\n<p>Is this a bug or intended behavior? If the former, when can we expect a<br>\nfix? If the later, where is the appropriate documentation for this behavior<br>\nchange between the two versions of Isabelle?</p>\n<p>Find the minimal working example attached below.</p>\n<p>-Mathias<br>\n<a href=\"/user_uploads/14278/ZMjU83VKWjd7Opbvmm5t2vUJ/mwe_2020.zip\">mwe_2020.zip</a></p>",
        "id": 294826100,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661244498
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nOn 22/04/2020 13:02, Mathias Pfeiffer wrote:</p>\n<blockquote>\n<p>I am working with a session B that requires session A through the \"session\"<br>\nkeyword (B has further dependencies and cannot make use of the \"parent\"). I<br>\nwant to import a theory TheoryA from A into TheoryB of B. The theory<br>\nTheoryA lies within a subfolder X of A's directory:</p>\n</blockquote>\n<p>Such session-subdirectory arrangements often cause confusion, both to the user<br>\nand to the system implementation.</p>\n<p>Since Isabelle2017 we have been moving to get more clarity and sanity, but<br>\nwhen brushing it up again for Isabelle2020, I did already see potential for<br>\nremaining boundary case that won't work.</p>\n<blockquote>\n<p>The import in TheoryB fails in Isabelle2020, succeeds in Isabelle2019:</p>\n<blockquote>\n<p>theory TheoryB<br>\n    imports A.TheoryA (* Bad theory import \"A.TheoryA\" *)<br>\n...</p>\n</blockquote>\n<p>Is this a bug or intended behavior? If the former, when can we expect a<br>\nfix? If the later, where is the appropriate documentation for this behavior<br>\nchange between the two versions of Isabelle?</p>\n</blockquote>\n<p>The words \"bug\" and \"fix\" (and similarly \"feature\") don't make sense in the<br>\nIsabelle context: they are often interchangeable. Trying to \"fix\" something by<br>\ncovering odd cases often introduces a \"bug\" in other cases.</p>\n<p>So I never use these words. Instead it is all about simplicity, clarity, and<br>\nreduction of odd features.</p>\n<p>If you had reported this observation before Isabelle2020 became final on<br>\n15-Apr-2020, I could have looked through the implementation to figure out if<br>\nit is reasonable to cover that case as well.</p>\n<p>The next chance will be in approx. 9 months, when we are heading towards the<br>\nnext release.</p>\n<p>For that, I will seriously consider to disallow session-subdirectories as in<br>\nyour example: I have already written this down some days ago in a commentary<br>\nfor Isabelle2020/NEWS that will be presented on the virtual Isabelle Workshop<br>\n2020. Here is the preliminary text:</p>\n<p>section ‹Distinctive session directories›</p>\n<p>paragraph ‹NEWS›<br>\ntext ‹<br>\n  ▪ Session ▩‹ROOT› files need to specify explicit \\isakeyword{directories}<br>\n  for import of theory files. Directories cannot be shared by different<br>\n  sessions. (Recall that import of theories from other sessions works via<br>\n  session-qualified theory names, together with suitable \\isakeyword{sessions}<br>\n  declarations in the ▩‹ROOT›.)</p>\n<p><span aria-label=\"black small square\" class=\"emoji emoji-25aa\" role=\"img\" title=\"black small square\">:black_small_square:</span> Prover IDE startup is now much faster, because theory dependencies are no<br>\n  longer explored in advance. The overall session structure with its<br>\n  declarations of \\isakeyword{directories} is sufficient to locate theory<br>\n  files<br>\n›</p>\n<p>paragraph ‹Trends›<br>\ntext ‹<br>\n  ▪ Session-qualified theory names have first appeared in Isabelle2017<br>\n  (October 2017). With Isabelle2020, the main aspects of this reform are now<br>\n  settled --- it turned out more tricky than anticipated.</p>\n<p><span aria-label=\"black small square\" class=\"emoji emoji-25aa\" role=\"img\" title=\"black small square\">:black_small_square:</span> As a future clarification of the session structure, session<br>\n  sub-directories could be superseded by <code>tags'' to group theories via\n  </code>topics''. Thus the space of session-qualified theories would directly<br>\n  correspond to the file-system arrangement, without the potential confusion<br>\n  via duplicates in different sub-directories. The Prover IDE would present<br>\n  tags via a suitable GUI presentation, e.g. a ``tag cloud'' instead of an<br>\n  old-fashioned directory tree.</p>\n<p><span aria-label=\"black small square\" class=\"emoji emoji-25aa\" role=\"img\" title=\"black small square\">:black_small_square:</span> A still pending reform is the intra-theory name space: it should the<br>\n  ∗‹long› theory name as prefix instead of the base name (e.g. (e.g.<br>\n  ▩‹HOL.Nat› instead of ▩‹Nat›). This would allow arbitrary merges of theories<br>\n  across sessions without clashes. To get there, we need to accommodate tools<br>\n  that impose their own interpretation on full names for entities (types,<br>\n  consts, theorems etc.), notably traditional ‹Theory.locale.name› vs.<br>\n  prospective ‹Session.Theory.locale.name›.<br>\n›</p>\n<blockquote>\n<p>Find the minimal working example attached below.</p>\n</blockquote>\n<p>Thank you for wrapping up the example nicely.</p>\n<p>You can solve your particular problem by smashing the session-subdirectories:<br>\nthe theory name space for each session is flat anyway.</p>\n<p>Makarius</p>",
        "id": 294826142,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661244526
    },
    {
        "content": "<p>From: Tobias Nipkow &lt;<a href=\"mailto:nipkow@in.tum.de\">nipkow@in.tum.de</a>&gt;<br>\nI also ran into a problem. Some of the text for our book Concrete Semantics <br>\n(<a href=\"http://www.concrete-semantics.org/\">http://www.concrete-semantics.org/</a>) comes from sessions in the distribution. <br>\nThat is, running those sessions generates tex files that are included. However:</p>\n<p>Theories that are imported from other sessions are excluded from the current <br>\nsession document.</p>\n<p>How to best deal with this situation?</p>\n<p>Thanks<br>\nTobias<br>\n<a href=\"/user_uploads/14278/GXqaIuNMU3wMBS9w_We-7N9f/smime.p7s\">smime.p7s</a></p>",
        "id": 294826362,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661244621
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nThat is a quite different problem. Already from the beginnings of<br>\nsession-qualified theory names in Isabelle2017, theories from other sessions<br>\nwere excluded from the current session document.</p>\n<p>The change in Isabelle2020 is that you can no longer \"cheat\" in this respect:<br>\na directory (with its .thy files) \"belongs\" to a single session. You cannot<br>\nre-use the same files in different sessions.</p>\n<p>To imitate the old behaviour for the book, you can try to work with</p>\n<p>isabelle build -o document_output=DIR IMP</p>\n<p>and include the generated .tex files into the session of the text book, using<br>\na separate \"isabelle build\" invocation.</p>\n<p>I did not find the book's sources, and can't say on the spot how this works<br>\nprecisely.</p>\n<p>Or you do copy the .thy files from the Isabelle distribution, to absorb them<br>\ninto your book's session directory.</p>\n<p>Makarius</p>",
        "id": 294826380,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661244633
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nLooking at this again, I found that your example was actually wrong, but the<br>\nerror message too indirect to see it on the spot: a proper specification<br>\n\"directories X\" was missing in ROOT.</p>\n<p>The change<br>\n<a href=\"https://isabelle-dev.sketis.net/rISABELLE4768b1facec2367417ff61d26011f37979b67505\">https://isabelle-dev.sketis.net/rISABELLE4768b1facec2367417ff61d26011f37979b67505</a><br>\nin ongoing Isabelle development improves on that, although it is still unclear<br>\nhow the situation in the next release will be in several months.</p>\n<p>You can also see the error in Isabelle2020, if you restrict the selection to<br>\nsession A of the example:</p>\n<p>$ isabelle2020 build -d mwe_2020 A<br>\n*** Implicit use of directory \"X\" for theory \"A.TheoryA\"<br>\n*** Implicit use of session directories: \"X\"<br>\n*** The error(s) above occurred in session \"A\" (line 1 of<br>\n\"/home/makarius/tmp/mwe_2020/ROOT\")</p>\n<p>Makarius</p>",
        "id": 294831156,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661246675
    }
]