[
    {
        "content": "<p>From: \"C. Diekmann\" &lt;<a href=\"mailto:diekmann@in.tum.de\">diekmann@in.tum.de</a>&gt;<br>\nHi,</p>\n<p>I'm testing Isabelle2016-RC0_app.tar.gz on Ubuntu 14.04.3 LTS, Unity,<br>\nLinux 4.2.0-22-generic x86_64.</p>\n<p>I started it in the shell with<br>\n  ./Isabelle2016-RC0/bin/isabelle jedit</p>\n<p>After I exited jEdit (clicking the x in the window), the process was<br>\nnot gone and it was still active in my shell. The prompt did not<br>\nreturn.</p>\n<p><code>ps aux</code> shows the following processes</p>\n<p>diekmann  2412  0.0  0.0  18316  3572 pts/16   S+   18:05   0:00 bash<br>\n/home/diekmann/Downloads/Isabelle2016-RC0/lib/Tools/java<br>\n-Duser.language=en -Dawt.useSystemAAFontSettings=on<br>\n-Dswing.aatext=true -Dapple.laf.useScreenMenuBar=true<br>\n-Dapple.awt.application.name=Isabelle -Xms512m -Xmx2560m -Xss8m<br>\n-XX:MetaspaceSize=256m isabelle.Main<br>\ndiekmann  2442  4.0 21.0 6546964 1701868 pts/16 Sl+ 18:05   9:40<br>\n/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jdk/x86_64-linux/jre/bin/java<br>\n-server -XX:MinHeapFreeRatio=30 -XX:MaxHeapFreeRatio=60<br>\n-XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled<br>\n-Dfile.encoding=UTF-8 -Disabelle.threads=0 -classpath<br>\n/home/diekmann/Downloads/Isabelle2016-RC0/lib/classes/Pure.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jfreechart-1.0.14-1/lib/iText-2.1.5.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jfreechart-1.0.14-1/lib/jcommon-1.0.18.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jfreechart-1.0.14-1/lib/jfreechart-1.0.14.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/jortho-1.0-2/jortho.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/akka-actor_2.11-2.3.10.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/config-1.2.1.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/jline-2.12.1.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-actors-2.11.0.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-actors-migration_2.11-1.1.0.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-compiler.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-continuations-library_2.11-1.0.2.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-continuations-plugin_2.11.7-1.0.2.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-library.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scalap-2.11.7.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-parser-combinators_2.11-1.0.4.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-reflect.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-swing_2.11-1.0.2.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/scala-2.11.7/lib/scala-xml_2.11-1.0.4.jar:/home/diekmann/Downloads/Isabelle2016-RC0/contrib/xz-java-1.2-1/lib/xz.jar:/home/diekmann/Downloads/Isabelle2016-RC0/src/Tools/jEdit/dist/jedit.jar<br>\n-Duser.language=en -Dawt.useSystemAAFontSettings=on<br>\n-Dswing.aatext=true -Dapple.laf.useScreenMenuBar=true<br>\n-Dapple.awt.application.name=Isabelle -Xms512m -Xmx2560m -Xss8m<br>\n-XX:MetaspaceSize=256m isabelle.Main</p>\n<p>Checking with <code>-H</code>, it seems that 2412 has started 2442.</p>\n<p>ctrl+c in the shell kills the isabelle processes.</p>\n<p>Steps to reproduce:<br>\n1) Load a large theory with many dependencies, let jEdit open the<br>\ntheories the theory depends on.<br>\n2) On my system, the theories had errors (not yet ported for 2016).<br>\n3) Change a file on disc, e.g., <code>mv Scratch.thy Scratch.thy2</code><br>\n4) click away the \"deleted on disc\" info.<br>\n5) While Isabelle is still checking proofs (and finding more errors), close it.</p>\n<p>Best Regards,<br>\n  Cornelius</p>",
        "id": 294663382,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661170794
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nThis sounds like the JVM/AWT shutdown problem, that I've now addressed in <br>\n<a href=\"http://isabelle.in.tum.de/repos/isabelle/rev/8bcbf1c93119\">http://isabelle.in.tum.de/repos/isabelle/rev/8bcbf1c93119</a></p>\n<p>I spent more than half of the day experimenting with variations on the <br>\ntheme.  Hopefully this change is sufficient.</p>\n<p>Makarius</p>",
        "id": 294664242,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661171120
    },
    {
        "content": "<p>From: Lars Hupel &lt;<a href=\"mailto:hupel@in.tum.de\">hupel@in.tum.de</a>&gt;</p>\n<blockquote>\n<p>This sounds like the JVM/AWT shutdown problem, that I've now addressed<br>\nin <a href=\"http://isabelle.in.tum.de/repos/isabelle/rev/8bcbf1c93119\">http://isabelle.in.tum.de/repos/isabelle/rev/8bcbf1c93119</a></p>\n</blockquote>\n<p>For the records, I've also experienced shutdown problems in libisabelle.<br>\nThe main reason is that the threads created by the thread pool are not<br>\nflagged to be daemon, although I don't know whether this is intentional<br>\nor not. I solve it by setting the daemon flag:</p>\n<p>&lt;<a href=\"https://github.com/larsrh/libisabelle/blob/v0.2.2/pide/2015/src/main/scala/impl/Environment.scala#L20-L26\">https://github.com/larsrh/libisabelle/blob/v0.2.2/pide/2015/src/main/scala/impl/Environment.scala#L20-L26</a>&gt;</p>\n<p>Cheers<br>\nLars</p>",
        "id": 294664268,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661171129
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nThe situation is even more entangled.</p>\n<p>Quite long ago I started making various threads daemons, in order to <br>\nincrease chances that the JVM terminates, while these threads are still <br>\nhanging around.</p>\n<p>But this later caused the problem introduced in Isabelle/3ad2b2055ffc <br>\n(05-Oct-2015): the daemon thread was sending something to the AWT thread <br>\nand waiting for the result; the AWT thread was already terminated, because <br>\nit only waits for non-daemon threads before shutting itself down; so the <br>\nwait of the daemon ended up as deadlock.</p>\n<p>Today I first tried to make the daemon thread a non-daemon, but got <br>\nentangled elesewhere, for unknown reasons.</p>\n<p>Then I just gave up the ambition to be ultra-smart in the inter-thread <br>\nping-pong.  So in 8bcbf1c93119 we are back to a situation where a daemon <br>\nthread sends asynchronously a task on the queue of the AWT thread, without <br>\nwaiting for a result.  It means that the whole task stays on the AWT <br>\nthread, when it actually happens -- causing several milliseconds of <br>\npotential GUI lock-up.</p>\n<p>Makarius</p>",
        "id": 294664282,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661171138
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nI've picked up this change as well: <br>\n<a href=\"http://isabelle.in.tum.de/repos/isabelle/rev/6dbeafce6318\">http://isabelle.in.tum.de/repos/isabelle/rev/6dbeafce6318</a></p>\n<p>This means the trend to have service threads as daemons is increased.  It <br>\nalso means that synchronous context switch into the AWT thread needs even <br>\nmore care as usual.  I will double-check all remaining uses of <br>\n<a href=\"http://GUI_Thread.now\">GUI_Thread.now</a>.</p>\n<p>Makarius</p>",
        "id": 294664358,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661171162
    }
]