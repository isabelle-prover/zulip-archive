[
    {
        "content": "<p>From: <a href=\"mailto:Matthew.Brecknell@data61.csiro.au\">Matthew.Brecknell@data61.csiro.au</a><br>\nOn Tue, 2017-08-22 at 11:15 +0200, Makarius wrote:</p>\n<blockquote>\n<p>On 22/08/17 09:01, <a href=\"mailto:Matthew.Brecknell@data61.csiro.au\">Matthew.Brecknell@data61.csiro.au</a> wrote:</p>\n<blockquote>\n<p>We have many theories and other source files which are generated at<br>\nvarious times during our lengthy build process. It seems that before I can<br>\nuse <code>isabelle jedit -d</code> to load even our very first session, I must first<br>\ngenerate all files mentioned in all sessions accessible from the ROOTS<br>\nfile, and all their theories.</p>\n</blockquote>\n<p>This sounds like a conflict of a legacy build process based on \"make\"<br>\nversus Isabelle session structure with \"isabelle build\" and now<br>\nincreasingly inside Isabelle/jEdit.</p>\n<p>At some point you should try to overcome this tension, and do it all<br>\nwithin static theory sources (by loading other files into a theory from<br>\nwithin).</p>\n<blockquote>\n<p>Can this requirement be relaxed again, so that I only need the files for<br>\nthe session I want to load?</p>\n</blockquote>\n<p>See the following NEWS entry:</p>\n<ul>\n<li>Command-line invocation \"isabelle jedit -R -l SESSION\" uses the parent<br>\nimage of the SESSION, with qualified theory imports restricted to that<br>\nportion of the session graph. Moreover, the ROOT entry of the SESSION is<br>\nopened in the editor.</li>\n</ul>\n</blockquote>\n<p>Last week, I finished updating all our proofs to Isabelle2017-RC0,<br>\nwithout significant issues. I am still checking against RC1, but so far<br>\nso good.</p>\n<p>However, I have noticed that in RC1, \"isabelle jedit -R -l SESSION\" no<br>\nlonger ignores sessions that are not ancestors of SESSION. So now, we<br>\nreally do need to generate all files mentioned in all sessions<br>\naccessible from the ROOTS file, and all their theories, before we can<br>\nopen Isabelle/jEdit on any of our sessions.</p>\n<p>This will make life very difficult for us.</p>\n<p>I have thought about this since my previous email, and I doubt we can<br>\never escape what you describe as a \"legacy build process\" based on<br>\n\"make\".</p>\n<p>One of the reasons for this: For our proofs about the seL4 C kernel, we<br>\nrely on the build process for the C kernel to generate preprocessed<br>\nsources. Our C parser, implemented in Isabelle/ML, then generates a C<br>\nspecification from these preprocessed kernel sources. We need to mention<br>\nthe preprocessed sources in a ROOT file, to ensure that Isabelle<br>\nrebuilds the session at the right times.</p>\n<p>Without the leniency of the RC0 behaviour of \"isabelle jedit -R\", our<br>\noptions appear to be:</p>\n<ul>\n<li>Before attempting to open Isabelle/jEdit, run a \"make\" step which<br>\n  generates all the files for all our sessions. While not too<br>\n  inconvenient, it's distasteful that we would need to generate<br>\n  preprocessed kernel sources for a session near the top of our hierarchy,<br>\n  just to work on our library sessions at the leaves.</li>\n</ul>\n<p>There is also the chance that we find ourselves in a chicken-and-egg<br>\n  situation, where we can't generate files because some theory is broken,<br>\n  but we can't edit the theory because we haven't generated files! We<br>\n  would need to temporarily patch our build system to bootstrap ourselves<br>\n  out of such a situation.</p>\n<ul>\n<li>Refactor our ROOT and ROOTS files, so that we can select whichever<br>\n  subset of sessions we want, and exclude sessions which require files<br>\n  we don't yet want to generate. There may be many such subsets, requiring<br>\n  many ROOT and ROOTS files, each with its own directory.</li>\n</ul>\n<p>Obviously, such a structure just re-encodes dependencies that are<br>\n  already present in the ROOT files. So limiting the scope could be (and<br>\n  indeed, was previously) automated by Isabelle/jEdit.</p>\n<p>Neither of these options is attractive. We would really like <em>some</em><br>\nmechanism to limit which sessions Isabelle/jEdit looks at, whether or not<br>\nthat's \"-R\". There may be other options I have not considered, in which<br>\ncase, I would welcome any reasonable suggestions!</p>\n<blockquote>\n<p>Note that after Isabelle2017-RC0 (e.g. in current snapshots from<br>\n<a href=\"http://isabelle.in.tum.de/devel/release_snapshot\">http://isabelle.in.tum.de/devel/release_snapshot</a>) the session-qualified<br>\nimports are even more rigorous. It might cause additional problems for<br>\nyour setup.</p>\n</blockquote>\n<p>On the whole, session-qualified imports seem to be a very positive<br>\nchange.<br>\nHowever, at least from the perspective of a user, they seem<br>\nunrelated to the<br>\nproblem we're facing here.</p>",
        "id": 294718915,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661184113
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nOn 05/09/17 08:02, <a href=\"mailto:Matthew.Brecknell@data61.csiro.au\">Matthew.Brecknell@data61.csiro.au</a> wrote:</p>\n<blockquote>\n<p>I have noticed that in RC1, \"isabelle jedit -R -l SESSION\" no<br>\nlonger ignores sessions that are not ancestors of SESSION. So now, we<br>\nreally do need to generate all files mentioned in all sessions<br>\naccessible from the ROOTS file, and all their theories, before we can<br>\nopen Isabelle/jEdit on any of our sessions.</p>\n</blockquote>\n<p>The idea in Isabelle2017-RC1 actually is to tolerate session import<br>\nerrors during startup of the application, and merely present a big<br>\nwarning dialog. It came out a bit more strict than planned, but you can<br>\ntry <a href=\"http://isabelle.in.tum.de/repos/isabelle/rev/1af360d1cad2\">http://isabelle.in.tum.de/repos/isabelle/rev/1af360d1cad2</a> or wait a<br>\ncouple of days for Isabelle2017-RC2.</p>\n<blockquote>\n<ul>\n<li>Before attempting to open Isabelle/jEdit, run a \"make\" step which<br>\n  generates all the files for all our sessions. While not too<br>\n  inconvenient, it's distasteful that we would need to generate<br>\n  preprocessed kernel sources for a session near the top of our hierarchy,<br>\n  just to work on our library sessions at the leaves.</li>\n</ul>\n</blockquote>\n<p>You could also try to generate empty templates first.</p>\n<blockquote>\n<p>On the whole, session-qualified imports seem to be a very positive<br>\nchange.<br>\nHowever, at least from the perspective of a user, they seem<br>\nunrelated to the<br>\nproblem we're facing here.</p>\n</blockquote>\n<p>The full exploration of the session name space by Isabelle/jEdit is<br>\nrequired to map file names to logical theory names. Without that you<br>\ncannot refer to session-qualified theories.</p>\n<p>Makarius</p>",
        "id": 294719075,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661184143
    },
    {
        "content": "<p>From: <a href=\"mailto:Matthew.Brecknell@data61.csiro.au\">Matthew.Brecknell@data61.csiro.au</a><br>\nOn Tue, 2017-09-05 at 14:41 +0200, Makarius wrote:</p>\n<blockquote>\n<p>The idea in Isabelle2017-RC1 actually is to tolerate session import<br>\nerrors during startup of the application, and merely present a big<br>\nwarning dialog. It came out a bit more strict than planned, but you can<br>\ntry <a href=\"http://isabelle.in.tum.de/repos/isabelle/rev/1af360d1cad2\">http://isabelle.in.tum.de/repos/isabelle/rev/1af360d1cad2</a> or wait a<br>\ncouple of days for Isabelle2017-RC2.</p>\n</blockquote>\n<p>I've tried 1af360d1cad2, and confirm that it resolves our problem.</p>\n<p>Your reply to Florian Haftmann in the thread \"Qualified theory imports and<br>\nisabelle jedit -l … -R …\" now also makes sense to me.</p>\n<blockquote>\n<p>The full exploration of the session name space by Isabelle/jEdit is<br>\nrequired to map file names to logical theory names. Without that you<br>\ncannot refer to session-qualified theories.</p>\n</blockquote>\n<p>Fair enough, although it's still not clear to me why it's necessary, or even<br>\ndesirable, to do this full exploration eagerly at Isabelle/jEdit startup.<br>\nAlthough it would be more fiddly to arrange for the exploration to be done<br>\non demand, surely it is at least possible?</p>\n<p>Anyway, thanks for helping us out of this problem!</p>\n<p>Matthew</p>",
        "id": 294719133,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661184161
    }
]