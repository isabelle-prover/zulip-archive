[
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nThis is one of the open obscurities that requires further investigations.</p>\n<p>I have copied the above example lemma + proof many times, to get many<br>\ntests sequentially (apply ... done) or in parallel (by ...): it works<br>\nfine on Linux and 3 different Windows installations.</p>\n<p>Do you maybe have some anti-malware software that acts itself as<br>\nmalware, by hindering external processes?</p>\n<p>Makarius</p>",
        "id": 294755599,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197323
    },
    {
        "content": "<p>From: Mathias Fleury &lt;<a href=\"mailto:mathias.fleury12@gmail.com\">mathias.fleury12@gmail.com</a>&gt;<br>\nHi Fabian,</p>\n<p>Can you replace in ~~/src/Tools/SMT/smt_systems.ML:</p>\n<p>fun outcome_of unsat sat unknown solver_name line =<br>\n  if String.isPrefix unsat line then SMT_Solver.Unsat<br>\n  else if String.isPrefix sat line then SMT_Solver.Sat<br>\n  else if String.isPrefix unknown line then SMT_Solver.Unknown<br>\n  else raise SMT_Failure.SMT (SMT_Failure.Other_Failure (\"Solver \" ^ quote solver_name ^<br>\n    \" failed -- enable tracing using the \" ^ quote (Config.name_of SMT_Config.trace) ^<br>\n    \" option for details\"))</p>\n<p>by </p>\n<p>fun outcome_of unsat sat unknown solver_name line =<br>\n  if String.isPrefix unsat line then SMT_Solver.Unsat<br>\n  else if String.isPrefix sat line then SMT_Solver.Sat<br>\n  else if String.isPrefix unknown line then SMT_Solver.Unknown<br>\n  else raise SMT_Failure.SMT (SMT_Failure.Other_Failure (\"Solver \" ^ quote solver_name ^<br>\n    \" failed -- enable tracing using the \" ^ quote (Config.name_of SMT_Config.trace) ^<br>\n    \" option for details and the error is \" ^ (@{make_string} line)))</p>\n<p>and then run your example (you will have to recompile HOL and HOL-Analysis) and after that tell me the exact error message?</p>\n<p>Moreover could you run put the SMT problem outside of Isabelle in a terminal (I have attached the file, but it is exactly the problem that is included in your message) with the following command:</p>\n<p>$ ~/.isabelle/contrib/z3-4.4.0pre-2/x86-windows/z3 --st smt.random_seed=1 smt.refine_inj_axioms=false -T:20 &lt;path/to/prob_z3.smt_in&gt;</p>\n<p>I am interested in the statistics at the end, not the proof itself.</p>\n<p>Thanks,<br>\nMathias</p>",
        "id": 294755626,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197331
    },
    {
        "content": "<p>From: Fabian Immler &lt;<a href=\"mailto:immler@in.tum.de\">immler@in.tum.de</a>&gt;<br>\nOn 5/23/2019 5:54 PM, Mathias Fleury wrote:</p>\n<blockquote>\n<p>Hi Fabian,</p>\n<p>Can you replace in ~~/src/Tools/SMT/smt_systems.ML:</p>\n<p>fun outcome_of unsat sat unknown solver_name line =<br>\n   if String.isPrefix unsat line then SMT_Solver.Unsat<br>\n   else if String.isPrefix sat line then SMT_Solver.Sat<br>\n   else if String.isPrefix unknown line then SMT_Solver.Unknown<br>\n   else raise SMT_Failure.SMT (SMT_Failure.Other_Failure (\"Solver \" ^ quote solver_name ^<br>\n     \" failed -- enable tracing using the \" ^ quote (Config.name_of SMT_Config.trace) ^<br>\n     \" option for details\"))</p>\n<p>by</p>\n<p>fun outcome_of unsat sat unknown solver_name line =<br>\n   if String.isPrefix unsat line then SMT_Solver.Unsat<br>\n   else if String.isPrefix sat line then SMT_Solver.Sat<br>\n   else if String.isPrefix unknown line then SMT_Solver.Unknown<br>\n   else raise SMT_Failure.SMT (SMT_Failure.Other_Failure (\"Solver \" ^ quote solver_name ^<br>\n     \" failed -- enable tracing using the \" ^ quote (Config.name_of SMT_Config.trace) ^<br>\n     \" option for details and the error is \" ^ (@{make_string} line)))</p>\n<p>and then run your example (you will have to recompile HOL and HOL-Analysis) and after that tell me the exact error message?<br>\nYes, I replaced it (in ~~/src/HOL/Tools/SMT/smt_systems.ML) and got:<br>\nSolver z3: Solver \"z3\" failed -- enable tracing using the \"smt_trace\" <br>\noption for details and the error is \"\"</p>\n</blockquote>\n<blockquote>\n<p>Moreover could you run put the SMT problem outside of Isabelle in a terminal (I have attached the file, but it is exactly the problem that is included in your message) with the following command:</p>\n<p>$ ~/.isabelle/contrib/z3-4.4.0pre-2/x86-windows/z3 --st smt.random_seed=1 smt.refine_inj_axioms=false -T:20 &lt;path/to/prob_z3.smt_in&gt;<br>\nYes, I ran this from ~/.isabelle/contrib and also from <br>\n.../Isabelle2019-RC2/contrib.<br>\nIt works fine all the time (for 100+ sequential runs)</p>\n</blockquote>\n<blockquote>\n<p>I am interested in the statistics at the end, not the proof itself.<br>\n(:add-rows             23<br>\n  :added-eqs            29<br>\n  :arith-conflicts      1<br>\n  :assert-lower         15<br>\n  :assert-upper         19<br>\n  :conflicts            1<br>\n  :eq-adapter           15<br>\n  :fixed-eqs            6<br>\n  :max-generation       3<br>\n  :memory               0.61<br>\n  :mk-clause            43<br>\n  :num-checks           1<br>\n  :pivots               12<br>\n  :propagations         17<br>\n  :quant-instantiations 27<br>\n  :time                 0.00<br>\n  :total-time           1.16)</p>\n</blockquote>\n<p>Fabian</p>\n<blockquote>\n<p>On 23. May 2019, at 17:19, Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt; wrote:</p>\n<blockquote>\n<p>On 14/05/2019 13:54, Fabian Immler wrote:</p>\n<blockquote>\n<p>With Isabelle2019-RC2 on Windows 10, I get sporadic failures of the smt<br>\nmethod.</p>\n<p>One way to reproduce this is to insert/delete whitespace in the lemma<br>\nstatement below. The error 'Solver z3: Solver \"z3\" failed -- enable<br>\ntracing using the \"smt_trace\" option for details' will occur in about 1<br>\nout of 10 smt invocations.</p>\n<p>I've attached a trace with [[smt_trace]] enabled.</p>\n<p>theory Scratch<br>\n   imports<br>\n     \"HOL-Analysis.Analysis\"<br>\nbegin</p>\n<p>lemma \"fst ((1 - t1) *⇩R fst l1 + t1 *⇩R snd l1) ≤ fst (snd l1)\"<br>\n   if \"t1 ∈ {0..1}\"<br>\n     \"p1 = (1 - t1) *⇩R fst l1 + t1 *⇩R snd l1\"<br>\n     \"fst (fst l1) &lt; fst (snd l1)\"<br>\n     \"fst (fst l2) &lt; fst (snd l2)\"<br>\n     \"fst (snd l1) &lt; fst (fst l2)\"<br>\n   for l1 l2::\"(real<em>real)</em>real*real\"<br>\n   using that<br>\n   by (smt atLeastAtMost_iff fst_add fst_scaleR scaleR_collapse<br>\nscaleR_left_mono)</p>\n<p>end</p>\n</blockquote>\n<p>This is one of the open obscurities that requires further investigations.</p>\n<p>I have copied the above example lemma + proof many times, to get many<br>\ntests sequentially (apply ... done) or in parallel (by ...): it works<br>\nfine on Linux and 3 different Windows installations.</p>\n<p>Do you maybe have some anti-malware software that acts itself as<br>\nmalware, by hindering external processes?</p>\n<p>Makarius</p>\n</blockquote>\n<p><a href=\"/user_uploads/14278/cWPtNkNeauAZLo_ctb2zZ3ZI/smime.p7s\">smime.p7s</a></p>\n</blockquote>",
        "id": 294755664,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197357
    },
    {
        "content": "<p>From: Mathias Fleury &lt;<a href=\"mailto:mathias.fleury12@gmail.com\">mathias.fleury12@gmail.com</a>&gt;<br>\nThank you very much for the detailed information.</p>\n<p>To give you idea, on my mac I get</p>\n<p>:total-time           0.01</p>\n<p>So z3 on my machine is around ten times faster (!) on that problem.</p>\n<p>I will try to play with the timeout to see if I can reproduce the problem.</p>\n<p>Mathias</p>",
        "id": 294755672,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197362
    },
    {
        "content": "<p>From: Mathias Fleury &lt;<a href=\"mailto:mathias.fleury12@gmail.com\">mathias.fleury12@gmail.com</a>&gt;<br>\nHi Fabian,</p>\n<p>I managed to find an old windows machine and I can reproduce the bug (sometimes at least). And the results are just weird.</p>\n<p>smt works as follows:<br>\n  (exec 2&gt;&1; z3 ‹input_file›)&gt; ‹temporary_file›</p>\n<p>From this, two information are extracted:</p>\n<p>1. the return code to indicate the kind of result (error/unknown)<br>\n  2. the temporary_file</p>\n<p>Here comes the interesting part. Under heavy load*, the ‹temporary_file› might not contain what I would expect to be there. The content can be corrupted and in particular, it can be empty.</p>\n<p>I have no idea what changed since Isabelle2018 that could cause a change in the behaviour. I will think about it, but if anyone has an idea…</p>\n<p>Out of curiosity, do you have an SSD or a hard drive?</p>\n<p>Best,<br>\nMathias</p>\n<ul>\n<li>I am running Boggie and SMT_Example in parallel in Isabelle/jEdit, based on Pure.</li>\n</ul>",
        "id": 294755709,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197384
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nThere is a change in the Cygwin version for Windows. Cygwin introduces<br>\nextra complexity and can fail in funny ways, e.g. due to extra nesting<br>\nof processes as above.</p>\n<p>The \"(exec ...) &gt; ...\" scheme goes back to the original version by<br>\nJasmin Blanchette from 2014:<br>\n<a href=\"http://isabelle.in.tum.de/repos/isabelle/rev/624faeda77b5#l12.56\">http://isabelle.in.tum.de/repos/isabelle/rev/624faeda77b5#l12.56</a> -- so<br>\nthe history does not say anything about the reasons for that. Maybe<br>\nJasmin can recall them.</p>\n<p>To robustify that bash script, I have made the following changes for the<br>\nnext release candidate:</p>\n<p>* Update of Cygwin:<br>\n<a href=\"https://isabelle.sketis.net/repos/isabelle-release/rev/b0fd8167bb9b\">https://isabelle.sketis.net/repos/isabelle-release/rev/b0fd8167bb9b</a></p>\n<p>* Avoid extra subprocess:<br>\n<a href=\"https://isabelle.sketis.net/repos/isabelle-release/rev/2e101846ad8f\">https://isabelle.sketis.net/repos/isabelle-release/rev/2e101846ad8f</a></p>\n<p>I will publish Isabelle2019-RC3 tomorrow, with all the other minor<br>\nchanges that have accumulated in the past 2 weeks.</p>\n<p>Makarius</p>",
        "id": 294755718,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197387
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nThe above changes are already in Isabelle2019-RC3. Can you try if it<br>\nmakes a difference.</p>\n<p>On my various test machines (Linux, macOS, Windows) I don't see any such<br>\nproblems.</p>\n<p>Makarius</p>",
        "id": 294755734,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197399
    },
    {
        "content": "<p>From: Fabian Immler &lt;<a href=\"mailto:immler@in.tum.de\">immler@in.tum.de</a>&gt;<br>\nI have an SSD.</p>\n<p>Fabian<br>\n<a href=\"/user_uploads/14278/mDCpyhSPrU0K820mI0mklBZa/smime.p7s\">smime.p7s</a></p>",
        "id": 294755834,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197442
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nIs there an easy way to provide the 400 runs above as isolated example?<br>\nAlternatively something derived from $ISABELLE_HOME/src/HOL/SMT_Examples?</p>\n<p>For completeness, here is a copy from what I wrote on the other<br>\n(potentially unrelated) thread on Z3:</p>\n<p>\"\"\"<br>\nI somehow suspect that the problems we see now are due to the change of<br>\nthe environment, i.e. latent fragilities now become apparent due to one<br>\nor more of these reasons:</p>\n<p>* unknown changes in Cygwin (64bit version, other changes)<br>\n  * unknown changes in Windows 10<br>\n  * unknown changes in the hardware: much faster process creation due to<br>\nSSD etc.<br>\n\"\"\"</p>\n<p>Makarius</p>",
        "id": 294755909,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197467
    },
    {
        "content": "<p>From: Fabian Immler &lt;<a href=\"mailto:immler@in.tum.de\">immler@in.tum.de</a>&gt;<br>\nNot sure if that is what you mean, but I was referring to simply 400 <br>\ncopies of the smt-call that I reported earlier in this thread:</p>\n<p>theory Scratch<br>\n   imports<br>\n     \"HOL-Analysis.Analysis\"<br>\nbegin</p>\n<p>lemma \"fst ((1 - t1) *⇩R fst l1 + t1 *⇩R snd l1) ≤ fst (snd l1)\"<br>\n   if \"t1 ∈ {0..1}\"<br>\n     \"p1 = (1 - t1) *⇩R fst l1 + t1 *⇩R snd l1\"<br>\n     \"fst (fst l1) &lt; fst (snd l1)\"<br>\n     \"fst (fst l2) &lt; fst (snd l2)\"<br>\n     \"fst (snd l1) &lt; fst (fst l2)\"<br>\n   for l1 l2::\"(real<em>real)</em>real*real\"<br>\n   using that<br>\n   by (smt atLeastAtMost_iff fst_add fst_scaleR scaleR_collapse <br>\nscaleR_left_mono)</p>\n<p>Fabian<br>\n<a href=\"/user_uploads/14278/DATk9MztZha88V6uSRfB4990/smime.p7s\">smime.p7s</a></p>",
        "id": 294755928,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197481
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nOK, I will try this. I've thought that you have an actual application<br>\nwith 400 runs somewhere in the background.</p>\n<p>The implicit question behind this: How serious is the impact on<br>\napplications?</p>\n<p>I will make one more round of refinement, but it might be all we can do<br>\nfor now (the Isabelle2019 release).</p>\n<p>Makarius</p>",
        "id": 294755930,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197485
    },
    {
        "content": "<p>From: Fabian Immler &lt;<a href=\"mailto:immler@in.tum.de\">immler@in.tum.de</a>&gt;<br>\nWell, there is a large probability that I cannot build sessions with <br>\nmore than a handful of smt-calls.</p>\n<p>But I realized that Windows' \"Virus &amp; threat protection\" seems to be the <br>\nculprit.</p>\n<p>When building the theory with 400 smt calls, Task Manager shows that <br>\n\"Antimalware Service Executable\" is very active (100-150% CPU).</p>\n<p>Disabling it temporarily<br>\n(Virus &amp; threat protection -&gt;<br>\nVirus &amp; threat protection settings -&gt;<br>\nMange settings -&gt;<br>\nReal-time protection), the problems with smt disappear.</p>\n<p>Fabian<br>\n<a href=\"/user_uploads/14278/DnFItiJUdQ1Erzddyoax09X_/smime.p7s\">smime.p7s</a></p>",
        "id": 294755940,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197492
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nI have experimented with this a bit. Using 500 copies of your example<br>\n(as in the included compressed Test.thy), I see approx. 2 errors on one<br>\nof my Windows 10 test machines.</p>\n<p>In the Windows Defender Settings there is a section \"Virus &amp; threat<br>\nprotection settings\". The second-last item at the bottom is for<br>\n\"Exclusions\". Here I have added the whole Isabelle home directory (as<br>\nover-approximation of all Isabelle components, cygwin bash etc.).</p>\n<p>This appears to help: in a few subsequent tests there were no errors.</p>\n<p>Makarius<br>\n<a href=\"/user_uploads/14278/XrFH4_5ap_ObUYnMQ2Eeu8F7/Test.thy.gz\">Test.thy.gz</a></p>",
        "id": 294755964,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197504
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nThese refinements are:</p>\n<p><a href=\"https://isabelle.sketis.net/repos/isabelle-release/rev/c7e9d3a0a681\">https://isabelle.sketis.net/repos/isabelle-release/rev/c7e9d3a0a681</a><br>\n<a href=\"https://isabelle.sketis.net/repos/isabelle-release/rev/9f3441164e92\">https://isabelle.sketis.net/repos/isabelle-release/rev/9f3441164e92</a></p>\n<p>I have no further ideas in the pipeline. We have already learned that<br>\nthe Windows Defender is the main attack on Isabelle tool integrity.</p>\n<p>You can try that in the informal snapshot Isabelle_27-May-2019 from<br>\n<a href=\"http://www21.in.tum.de/~wenzelm/test/website\">http://www21.in.tum.de/~wenzelm/test/website</a> (it will disappear eventually).</p>\n<p>Here is some text that I wrote some weeks ago about success and failure<br>\nof \"Desktop Application Bundles on Linux, Windows, macOS\":</p>\n<p>\"\"\"<br>\n  {\\success} The majority of users is happy with the all-inclusive Isabelle<br>\n  application bundle (2019: 300\\,MB download size, 1\\,GB unpacked size). It<br>\n  works almost as smoothly as major Open Source products (e.g. Firefox,<br>\n  LibreOffice).</p>\n<p>{\\failure} Full equality of all three platforms families has still not<br>\nbeen<br>\n  achieved. Java GUI rendering on Linux is worse than on Windows and macOS;<br>\n  exotic Linux/X11 window managers can cause problems. Add-on tools are<br>\n  sometimes not as portable (and robust) on Windows: Isabelle often<br>\nrefers to<br>\n  Cygwin as auxiliary POSIX platform, but that may cause its own problems.<br>\n  Even for native Windows tools (e.g. via MinGW) the Unix-style<br>\norchestration<br>\n  of multiple processes can have timing problems (e.g. Sledgehammer provers)<br>\n  or fail due to antivirus software. Moreover, the recent tendency of<br>\nWindows<br>\n  and macOS towards ``application stores'' makes it harder to run downloaded<br>\n  Isabelle bundles on the spot: users need to bypass extra vendor checks.</p>\n<p>\"\"\"</p>\n<p>See also<br>\n<a href=\"https://sketis.net/2019/interaction-with-formal-mathematical-documents-in-isabelle-pide-at-cicm-2019-prague\">https://sketis.net/2019/interaction-with-formal-mathematical-documents-in-isabelle-pide-at-cicm-2019-prague</a><br>\nand<br>\n<a href=\"https://sketis.net/2019/isabelle-presentations-at-lsv-paris-cachan\">https://sketis.net/2019/isabelle-presentations-at-lsv-paris-cachan</a></p>\n<p>Makarius</p>",
        "id": 294755985,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197510
    },
    {
        "content": "<p>From: Fabian Immler &lt;<a href=\"mailto:immler@in.tum.de\">immler@in.tum.de</a>&gt;<br>\nWith Isabelle2019-RC2 on Windows 10, I get sporadic failures of the smt <br>\nmethod.</p>\n<p>One way to reproduce this is to insert/delete whitespace in the lemma <br>\nstatement below. The error 'Solver z3: Solver \"z3\" failed -- enable <br>\ntracing using the \"smt_trace\" option for details' will occur in about 1 <br>\nout of 10 smt invocations.</p>\n<p>I've attached a trace with [[smt_trace]] enabled.</p>\n<p>Best regards,<br>\nFabian</p>\n<p>theory Scratch<br>\n   imports<br>\n     \"HOL-Analysis.Analysis\"<br>\nbegin</p>\n<p>lemma \"fst ((1 - t1) *⇩R fst l1 + t1 *⇩R snd l1) ≤ fst (snd l1)\"<br>\n   if \"t1 ∈ {0..1}\"<br>\n     \"p1 = (1 - t1) *⇩R fst l1 + t1 *⇩R snd l1\"<br>\n     \"fst (fst l1) &lt; fst (snd l1)\"<br>\n     \"fst (fst l2) &lt; fst (snd l2)\"<br>\n     \"fst (snd l1) &lt; fst (fst l2)\"<br>\n   for l1 l2::\"(real<em>real)</em>real*real\"<br>\n   using that<br>\n   by (smt atLeastAtMost_iff fst_add fst_scaleR scaleR_collapse <br>\nscaleR_left_mono)</p>\n<p>end<br>\n<a href=\"/user_uploads/14278/u9eS4tPQBKR743STxOvhyLU3/smt_trace\">smt_trace</a><br>\n<a href=\"/user_uploads/14278/bNFCli_ZDYKOHFjlR3NMc-lW/smime.p7s\">smime.p7s</a></p>",
        "id": 294756784,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197848
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nI have seen such failures sporadically on Linux, too.</p>\n<p>The Z3 setup is unchanged: the situation should be the same as<br>\nIsabelle2018 (see also<br>\n<a href=\"http://isabelle.in.tum.de/repos/isabelle/rev/1463c4996fb2\">http://isabelle.in.tum.de/repos/isabelle/rev/1463c4996fb2</a>).</p>\n<p>Note that I don't understand the details of Z3 / smt myself. Sascha<br>\nBoehme had a look at it recently, but I am unsure if there will be an<br>\nupdate for the Isabelle2019 release (there are still a few weeks left).</p>\n<p>Makarius</p>",
        "id": 294756794,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197854
    },
    {
        "content": "<p>From: Fabian Immler &lt;<a href=\"mailto:immler@in.tum.de\">immler@in.tum.de</a>&gt;<br>\nBut the situation is worse in Isabelle2019-RC2:<br>\nI just tried it once again:<br>\nIn a theory file with 400 smt calls, I got 20 errors with <br>\nIsabelle2019-RC2 and none with Isabelle2018.</p>\n<p>Fabian<br>\n<a href=\"/user_uploads/14278/MLyah1FmiZcEs_-FTdI2pLrm/smime.p7s\">smime.p7s</a></p>",
        "id": 294756829,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661197872
    }
]