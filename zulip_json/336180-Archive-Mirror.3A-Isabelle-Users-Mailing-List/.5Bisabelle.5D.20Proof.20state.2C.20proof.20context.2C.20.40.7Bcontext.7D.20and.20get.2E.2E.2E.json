[
    {
        "content": "<p>From: Rafal Kolanski &lt;<a href=\"mailto:rafalk@cse.unsw.edu.au\">rafalk@cse.unsw.edu.au</a>&gt;<br>\nDear Isabelle Gurus,</p>\n<p>Once more I am wishing for enlightenment. Since I'm doing dependency <br>\ntracking of theorems, I want to basically go up the chain of theorems to <br>\nget to the top, finding dependencies.</p>\n<p>There is a command which does something like this, called thm_deps, <br>\nwhich works nicely in a graphical context. However, I am unable to <br>\nreplicate the functionality at the ML level.</p>\n<p>The problem is as follows, thm_deps is defined in isar_cmd as:</p>\n<p>fun thm_deps args = Toplevel.unknown_theory o Toplevel.keep (fn state =&gt;<br>\n     Thm_Deps.thm_deps (Proof.get_thmss (Toplevel.enter_proof_body <br>\nstate) args))</p>\n<p>I have a simple theory:</p>\n<p>theory DeepDepends imports Plain begin</p>\n<p>lemma lem1: \"A --&gt; A\" by simp</p>\n<p>thm_deps \"lem1\" (* this works great *)</p>\n<p>ML {* (* this does not work *)<br>\n   Proof.get_thmss (Proof.init @{context}) [pair (Facts.Fact \"lem1\") []]<br>\n*}</p>\n<p>I've examined IsarCmd.thm_deps using tracing, and it really only has <br>\n[(Facts.Fact \"lem1\" [])] passed in to it.</p>\n<p>The error I get is:<br>\n*** Failed to retrieve literal fact:<br>\n*** lem1</p>\n<p>I've been running around in the code in circles. The problem is most <br>\nlikely that I have no idea how to get the proper proof context / proof <br>\nstate from the toplevel.</p>\n<p>The reason I'm digging so deep, is because when I get the names of <br>\ndepended-on theorems from the proof term for a theorem, I get names like <br>\nHOL.simp_thms_17, not theorems. To go any further up the dependency <br>\nhierarchy, I need to look up HOL.simp_thms_17, which Isabelle has no <br>\nidea about, as it's the 17th theorem in HOL.simps and its original name <br>\nis something else entirely. This behaviour has always puzzled me, but <br>\nthis time it has really stopped me in my tracks.</p>\n<p>At one point I got Thm_Deps.thm_deps to get going with my request, but <br>\nthen it also bailed on unknown fact \"HOL.simp_thms_17\". At this point I <br>\nam considering catching the exception, stripping the _ and number from <br>\nthe end, looking up the theorem list without the number, and if that <br>\nexists, getting the nth theorem in the theorem list, which is a very <br>\nugly thing to be doing.</p>\n<p>Does anyone see where I went wrong?</p>\n<p>Sincerely,</p>\n<p>Rafal Kolanski.</p>",
        "id": 294111317,
        "sender_full_name": "Email Gateway",
        "timestamp": 1660836920
    }
]