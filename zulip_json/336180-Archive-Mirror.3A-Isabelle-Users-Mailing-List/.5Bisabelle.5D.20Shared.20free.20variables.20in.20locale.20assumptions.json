[
    {
        "content": "<p>From: Martin Desharnais &lt;<a href=\"mailto:martin.desharnais@gmail.com\">martin.desharnais@gmail.com</a>&gt;<br>\nDear Isabelle users,</p>\n<p>I just encountered an unexpected behaviour when stating assumptions of a<br>\nlocale. I would have expected the three following locale definitions to<br>\nbe equivalent, but it turned out that C is invalid.</p>\n<p>locale A =<br>\n  fixes foo :: \"'a ⇒ 'b\" and bar :: \"'b ⇒ 'a\"<br>\n  assumes<br>\n    h1: \"foo (bar x) = x\" and<br>\n    h2: \"bar (foo y) = y\"</p>\n<p>locale B =<br>\n  fixes foo :: \"'a ⇒ 'b\" and bar :: \"'b ⇒ 'a\"<br>\n  assumes<br>\n    h1: \"⋀x. foo (bar x) = x\" and<br>\n    h2: \"⋀x. bar (foo x) = x\"</p>\n<p>(*<br>\nType unification failed</p>\n<p>Type error in application: incompatible operand type</p>\n<p>Operator:  foo :: 'a ⇒ 'b<br>\nOperand:   x :: 'b<br>\n*)<br>\nlocale C =<br>\n  fixes foo :: \"'a ⇒ 'b\" and bar :: \"'b ⇒ 'a\"<br>\n  assumes<br>\n    h1: \"foo (bar x) = x\" and<br>\n    h2: \"bar (foo x) = x\"</p>\n<p>thm A.h1 B.h1 (* C.h1 *)<br>\n(*<br>\n  A ?foo ?bar ⟹ ?foo (?bar ?x) = ?x<br>\n  B ?foo ?bar ⟹ ?foo (?bar ?x) = ?x<br>\n*)</p>\n<p>It turns out that x is shared in the two assumptions, which makes h2<br>\nill-typed.</p>\n<p>In the tutorial on locales, I found the following explication (§2).</p>\n<blockquote>\n<p>Isabelle recognises unbound names as free variables. In locale<br>\nassumptions, these are implicitly universally quantified.</p>\n</blockquote>\n<p>In the isar-ref documentation, I found the following explication (§5.7.2).</p>\n<blockquote>\n<p>assumes a: φ1 ... φn introduces local premises, similar to assume<br>\nwithin a proof (cf. §6.2.1).</p>\n</blockquote>\n<p>I did not notice anything in section 6.2.1 explaining this behaviour. It<br>\nseems that the automatic insertion of universal variables is done on the<br>\nset of assumptions instead of all assumption individually. I was just<br>\nsurprised by this behaviour and wanted to suggest raising this point<br>\nmore clearly in the documentation or tutorial.</p>\n<p>Regards,<br>\nMartin Desharnais<br>\n<a href=\"/user_uploads/14278/LdTNujXMijuYUdUP0G5gAQ4J/signature.asc\">signature.asc</a></p>",
        "id": 294763845,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200938
    }
]