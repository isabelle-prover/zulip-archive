[
    {
        "content": "<p>From: <a href=\"mailto:Matthew.Brecknell@data61.csiro.au\">Matthew.Brecknell@data61.csiro.au</a><br>\nHello,</p>\n<p>We are having some difficulty figuring out how to update some legacy l4-verified proofs to work well with Isabelle2017 session-qualified imports.</p>\n<p>Although all our sessions work with <code>isabelle build</code>, we have a session for which <code>isabelle jedit</code> gives a plugin error like this:</p>\n<p>Cannot start:<br>\n*** Duplicate theory<br>\n\"/path/to/isabelle/src/HOL/Word/HOL-Library.Type_Length.thy\"<br>\nvs.<br>\n\"/path/to/isabelle/src/HOL/Library/Type_Length.thy\"</p>\n<p>None of our theories import Type_Length directly, but we do import HOL/Word/Word using a legacy path-based import.</p>\n<p>We've tried to diagnose this using various combinations of <code>isabelle imports</code>, but we're not sure how to interpret the results.</p>\n<p><code>isabelle imports -D . -I -v ARMModel</code> reports the same error as above.</p>\n<p><code>isabelle imports -d . -I -v ARMModel</code> does not report any  no potential session imports.</p>\n<p><code>isabelle imports -d . -U -i -v ARMModel</code> performs some updates, but Isabelle/jEdit still produces an error, albeit relating to a different theory import.</p>\n<p><code>isabelle imports -D . -U -i -v ARMModel</code> produces the following errors:</p>\n<p>*** No such file: \"/home/matthewb/verification/mainline/isabelle/src/HOL/Word/HOL-Library.Type_Length.thy\"<br>\n*** The error(s) above occurred for theory \"HOL-Library.Type_Length\"<br>\n*** (required by \"ARMModel.arm_model\" via \"ARMModel.arm_model_pre\" via \"ARMModel.WordSetup\" via \"ARMModel.Word_Lemmas_32\" via \"ARMModel.Word_Lemmas\" via \"ARMModel.Aligned\" via \"ARMModel.Word_Lib\" via \"ARMModel.Word_Syntax\" via \"ARMModel.WordBitwise\" via \"ARMModel.Word\") (line 9 of \"/home/matthewb/verification/mainline/isabelle/src/HOL/Word/Word.thy\")<br>\n*** No such file: \"/home/matthewb/verification/mainline/isabelle/src/HOL/Word/HOL-Library.Boolean_Algebra.thy\"<br>\n*** The error(s) above occurred for theory \"HOL-Library.Boolean_Algebra\"<br>\n*** (required by \"ARMModel.arm_model\" via \"ARMModel.arm_model_pre\" via \"ARMModel.WordSetup\" via \"ARMModel.Word_Lemmas_32\" via \"ARMModel.Word_Lemmas\" via \"ARMModel.Aligned\" via \"ARMModel.Word_Lib\" via \"ARMModel.Word_Syntax\" via \"ARMModel.WordBitwise\" via \"ARMModel.Word\") (line 10 of \"/home/matthewb/verification/mainline/isabelle/src/HOL/Word/Word.thy\")<br>\n*** No such file: \"/home/matthewb/verification/mainline/isabelle/src/HOL/Word/HOL-Library.Bit.thy\"<br>\n*** The error(s) above occurred for theory \"HOL-Library.Bit\"<br>\n*** (required by \"ARMModel.arm_model\" via \"ARMModel.arm_model_pre\" via \"ARMModel.WordSetup\" via \"ARMModel.Word_Lemmas_32\" via \"ARMModel.Word_Lemmas\" via \"ARMModel.Aligned\" via \"ARMModel.Word_Lib\" via \"ARMModel.Word_Syntax\" via \"ARMModel.WordBitwise\" via \"ARMModel.Word\" via \"ARMModel.Bits_Bit\") (line 8 of \"/home/matthewb/verification/mainline/isabelle/src/HOL/Word/Bits_Bit.thy\")<br>\n*** No such file: \"/home/matthewb/verification/mainline/isabelle/src/HOL/Word/HOL-Library.Type_Length.thy\"<br>\n*** No such file: \"/home/matthewb/verification/mainline/isabelle/src/HOL/Word/HOL-Library.Boolean_Algebra.thy\"<br>\n*** No such file: \"/home/matthewb/verification/mainline/isabelle/src/HOL/Word/HOL-Library.Bit.thy\"<br>\n*** The error(s) above occurred in session \"ARMModel\" (line 9 of \"/home/matthewb/verification/mainline/l4v/internal/camkes/ROOT\")</p>\n<p>I suspect our problem is that we have a number of library theories which are included in multiple sessions (and therefore are not strongly identified with a single session), and which also include Isabelle theories using legacy path-based imports.</p>\n<p>We would like to embrace session-qualified imports. Can anyone offer advice on how to begin disentangling a nest of legacy path-base imports?</p>\n<p>Thanks,<br>\nMatthew</p>",
        "id": 294722947,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661185472
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nDuring the year I've spent many weeks disentangling theory imports in<br>\nAFP: the \"isabelle imports\" tool was a result of that, but it does not<br>\ncover all oddities seen in the wild.</p>\n<p>Maybe the following Isabelle/Scala invocations help to sort out the<br>\nsituation of theory files in different sessions, leading to confusion<br>\ndue to different qualified names:</p>\n<p>$ isabelle scala -J-Xmx4096m -J-Xss8m</p>\n<p>import isabelle._</p>\n<p>val options = Options.init</p>\n<p>val sessions = Sessions.load(options)</p>\n<p>val deps = Sessions.deps(sessions, global_theories =<br>\nsessions.global_theories)</p>\n<p>deps.all_known.files.toList.filter(p =&gt; p._2.length &gt; 1).sortBy(p =&gt;<br>\np._1.toString).foreach(println)</p>\n<p>Note that Sessions.load has an argument for \"dirs\": it corresponds to<br>\noption -d in command-line tools.</p>\n<p>Makarius</p>",
        "id": 294723004,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661185496
    },
    {
        "content": "<p>From: <a href=\"mailto:Matthew.Brecknell@data61.csiro.au\">Matthew.Brecknell@data61.csiro.au</a><br>\nThanks, Makarius. I haven't had a lot of time to look at this today, but I did find that the call to Sessions.deps threw the \"Duplicate theory\" exception noted in my previous email, so I didn't get as far as the final step of analysing the dependencies.</p>\n<p>I will dig into the sessions.scala source to see if that helps me figure out what we're doing wrong.</p>\n<p>During the year I've spent many weeks disentangling theory imports in<br>\nAFP: the \"isabelle imports\" tool was a result of that, but it does not<br>\ncover all oddities seen in the wild.</p>\n<p>Maybe the following Isabelle/Scala invocations help to sort out the<br>\nsituation of theory files in different sessions, leading to confusion<br>\ndue to different qualified names:</p>\n<p>$ isabelle scala -J-Xmx4096m -J-Xss8m</p>\n<p>import isabelle._</p>\n<p>val options = Options.init</p>\n<p>val sessions = Sessions.load(options)</p>\n<p>val deps = Sessions.deps(sessions, global_theories =<br>\nsessions.global_theories)</p>\n<p>deps.all_known.files.toList.filter(p =&gt; p._2.length &gt; 1).sortBy(p =&gt;<br>\np._1.toString).foreach(println)</p>\n<p>Note that Sessions.load has an argument for \"dirs\": it corresponds to<br>\noption -d in command-line tools.</p>\n<p>Makarius</p>",
        "id": 294723023,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661185504
    }
]