[
    {
        "content": "<p>From: Kevin Kappelmann &lt;<a href=\"mailto:kevin.kappelmann@tum.de\">kevin.kappelmann@tum.de</a>&gt;<br>\nI wanted to use Isabelle2019 with VSCode. However, I cannot open the<br>\nstate panel as the following error is thrown:</p>\n<p>*** Consumer thread failure: \"Session.dispatcher\"<br>\n*** Consumer failed: \"isabelle.vscode.State_Panel\"<br>\n*** java.util.NoSuchElementException: key not found: <a href=\"http://IsabelleDejaVuSans.tt\">IsabelleDejaVuSans.tt</a></p>\n<p>I did install the font on my system (Ubuntu 18.04). In particular, I can<br>\nuse it in VSCode. Anyone any ideas or similar experiences?</p>\n<p>For people using Zulip, here is the corresponding discussion:<br>\n<a href=\"#narrow/stream/202961-general/topic/VS.20Code\">https://isabelle.zulipchat.com/#narrow/stream/202961-general/topic/VS.20Code</a><br>\n(screenshot appended for non-zulip users).</p>\n<p>Best wishes,</p>\n<p>Kevin.<br>\n<a href=\"/user_uploads/14278/7f8qeyb7D52stbtwbV2bPAHx/zulip_vs_code.png\">zulip_vs_code.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/14278/7f8qeyb7D52stbtwbV2bPAHx/zulip_vs_code.png\" title=\"zulip_vs_code.png\"><img src=\"/user_uploads/14278/7f8qeyb7D52stbtwbV2bPAHx/zulip_vs_code.png\"></a></div>",
        "id": 294763064,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200571
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nOn 20/09/2019 11:28, Kevin Kappelmann wrote:</p>\n<blockquote>\n<p>I wanted to use Isabelle2019 with VSCode. However, I cannot open the<br>\nstate panel as the following error is thrown:</p>\n<p>*** Consumer thread failure: \"Session.dispatcher\"<br>\n*** Consumer failed: \"isabelle.vscode.State_Panel\"<br>\n*** java.util.NoSuchElementException: key not found: <a href=\"http://IsabelleDejaVuSans.tt\">IsabelleDejaVuSans.tt</a></p>\n<p>I did install the font on my system (Ubuntu 18.04). In particular, I can<br>\nuse it in VSCode. Anyone any ideas or similar experiences?</p>\n</blockquote>\n<p>Just a guess from a distance:</p>\n<p>apt-get install -y libfontconfig1</p>\n<p>See also <a href=\"https://hub.docker.com/r/makarius/isabelle\">https://hub.docker.com/r/makarius/isabelle</a> for Linux<br>\nrequirements formalized via Docker.</p>\n<p>Note that one thing is the VSCode editor front-end, another thing the<br>\nIsabelle/Scala backend. A Java exception means that the backend cannot<br>\nopen the font, but that is configured automatically via Isabelle system<br>\nsettings.</p>\n<blockquote>\n<p>For people using Zulip, here is the corresponding discussion:<br>\n<a href=\"#narrow/stream/202961-general/topic/VS.20Code\">https://isabelle.zulipchat.com/#narrow/stream/202961-general/topic/VS.20Code</a><br>\n(screenshot appended for non-zulip users).</p>\n</blockquote>\n<p>A discussion over many information exchange platforms is difficult. I<br>\ndon't have the time to follow yet another cool new thing.</p>\n<p>Makarius</p>",
        "id": 294763094,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200588
    },
    {
        "content": "<p>From: Kevin Kappelmann &lt;<a href=\"mailto:kevin.kappelmann@tum.de\">kevin.kappelmann@tum.de</a>&gt;<br>\nThanks for the hint, but sadly, libfontconfig1 is already installed on<br>\nmy machine. I started debugging the extension in VSCode. Here is the<br>\nstack trace I get when trying to open the preview panel:</p>\n<p>[Error - 15:27:42] java.util.NoSuchElementException: key not found:<br>\nIsabelleDejaVuSans.ttf<br>\nException in thread \"event_timer\" java.util.NoSuchElementException: key<br>\nnot found: IsabelleDejaVuSans.ttf<br>\n    at scala.collection.MapLike.default(MapLike.scala:231)<br>\n    at scala.collection.MapLike.default$(MapLike.scala:230)<br>\n    at scala.collection.AbstractMap.default(Map.scala:59)<br>\n    at scala.collection.MapLike.apply(MapLike.scala:140)<br>\n    at scala.collection.MapLike.apply$(MapLike.scala:139)<br>\n    at scala.collection.AbstractMap.apply(Map.scala:59)<br>\n    at isabelle.HTML$.font_face$1(html.scala:366)<br>\n    at isabelle.HTML$.$anonfun$fonts_css$1(html.scala:371)<br>\n    at scala.collection.immutable.List.map(List.scala:282)<br>\n    at isabelle.HTML$.fonts_css(html.scala:371)<br>\n    at isabelle.Present$.output_document$1(present.scala:120)<br>\n    at isabelle.Present$.preview(present.scala:138)<br>\n    at isabelle.vscode.Preview_Panel.$anonfun$flush$2(preview_panel.scala:33)<br>\n    at<br>\nscala.collection.TraversableOnce.$anonfun$foldLeft$1(TraversableOnce.scala:156)<br>\n    at<br>\nscala.collection.TraversableOnce.$anonfun$foldLeft$1$adapted(TraversableOnce.scala:156)<br>\n    at scala.collection.Iterator.foreach(Iterator.scala:937)<br>\n    at scala.collection.Iterator.foreach$(Iterator.scala:937)<br>\n    at scala.collection.AbstractIterator.foreach(Iterator.scala:1425)<br>\n    at scala.collection.TraversableOnce.foldLeft(TraversableOnce.scala:156)<br>\n    at scala.collection.TraversableOnce.foldLeft$(TraversableOnce.scala:154)<br>\n    at scala.collection.AbstractIterator.foldLeft(Iterator.scala:1425)<br>\n    at scala.collection.TraversableOnce.$div$colon(TraversableOnce.scala:150)<br>\n    at scala.collection.TraversableOnce.$div$colon$(TraversableOnce.scala:150)<br>\n    at scala.collection.AbstractIterator.$div$colon(Iterator.scala:1425)<br>\n    at isabelle.vscode.Preview_Panel.$anonfun$flush$1(preview_panel.scala:27)<br>\n    at isabelle.Synchronized.change_result(synchronized.scala:73)<br>\n    at isabelle.vscode.Preview_Panel.flush(preview_panel.scala:24)<br>\n    at isabelle.vscode.Server.$anonfun$delay_preview$2(server.scala:210)<br>\n    at isabelle.Standard_Thread$Delay.run(standard_thread.scala:64)<br>\n    at<br>\nisabelle.Standard_Thread$Delay.$anonfun$invoke$1(standard_thread.scala:77)<br>\n    at isabelle.Event_Timer$$anon$1.run(event_timer.scala:27)<br>\n    at java.base/java.util.TimerThread.mainLoop(Timer.java:556)<br>\n    at java.base/java.util.TimerThread.run(Timer.java:506)</p>\n<p>What source is isabelle.HTML$.font_face using to load fonts? Is it<br>\nlooking in a specific folder or asking the system via some API for the<br>\nfonts?</p>",
        "id": 294763101,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200591
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nThe relevant Isabelle/Scala source is here:</p>\n<p><a href=\"https://isabelle.in.tum.de/repos/isabelle/file/Isabelle2019/src/Pure/Thy/html.scala#l359\">https://isabelle.in.tum.de/repos/isabelle/file/Isabelle2019/src/Pure/Thy/html.scala#l359</a></p>\n<p>You can try to core operation like this:</p>\n<p>$ isabelle scala<br>\n  scala&gt; import isabelle._<br>\n  scala&gt; Isabelle_Fonts.fonts(hidden = true)</p>\n<p>See also<br>\n<a href=\"https://isabelle.in.tum.de/repos/isabelle/file/Isabelle2019/src/Pure/System/isabelle_fonts.scala#l57\">https://isabelle.in.tum.de/repos/isabelle/file/Isabelle2019/src/Pure/System/isabelle_fonts.scala#l57</a></p>\n<p>Makarius</p>",
        "id": 294763112,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200598
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nActually, there is something wrong in Isabelle/VSCode of Isabelle2019: I<br>\nget a similar exception trace.</p>\n<p>Since this thread originated on Zulip Chat, I've somehow fallen into<br>\n\"chat mode\" on this mailing list, too, and thus produced quick answers<br>\ninstead of good ones. I will now take time to figure out what the<br>\nsituation really is ...</p>\n<p>Makarius</p>",
        "id": 294763118,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200603
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nSee now the following change (for the next release after Isabelle2019):<br>\n<a href=\"https://isabelle.in.tum.de/repos/isabelle/rev/342b0a1fc86d\">https://isabelle.in.tum.de/repos/isabelle/rev/342b0a1fc86d</a></p>\n<p>changeset:   70743:342b0a1fc86d<br>\ntag:         tip<br>\nuser:        wenzelm<br>\ndate:        Sun Sep 22 19:04:11 2019 +0200<br>\nsummary:     proper file name instead of font name (amending dc9a39c3f75d);</p>\n<p>This does not help much: VSCode has changed too much recently -- I get a<br>\nlot of JavaScript/TypeScript exceptions when starting up the Isabelle<br>\nextension. (When I tried it for the Isabelle2019 release, the situation<br>\nwas not as bad.)</p>\n<p>Due to the highly dynamic nature of VSCode such total failures of<br>\nexistence are to be expected: When I published Isabelle/VSCode for the<br>\nfirst time with Isabelle2017 (October 2017), it was already clear that a<br>\nproper release would have to bundle a particular version of VSCode, like<br>\nIsabelle already bundles Java, Scala, jEdit and many other things. This<br>\nwould annoy anybody who thinks that \"latest\" means \"best\" version, but<br>\nit is inevitable for a stable application.</p>\n<p>Makarius</p>",
        "id": 294763130,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200609
    },
    {
        "content": "<p>From: Kevin Kappelmann &lt;<a href=\"mailto:kevin.kappelmann@tum.de\">kevin.kappelmann@tum.de</a>&gt;<br>\nThanks for the patch.</p>",
        "id": 294763198,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200640
    },
    {
        "content": "<p>From: Kevin Kappelmann &lt;<a href=\"mailto:kevin.kappelmann@tum.de\">kevin.kappelmann@tum.de</a>&gt;<br>\n(Pressed sent by accident at previous e-mail, sorry)</p>\n<p>Thanks for the patch.<br>\nThe reason the state panel will not open now is that previewHtml was<br>\ndeprecated in November 2019 and removed earlier this year:<br>\n<a href=\"https://github.com/microsoft/vscode/issues/62630\">https://github.com/microsoft/vscode/issues/62630</a><br>\nThe fix is to use the Webview API instead:<br>\n<a href=\"https://code.visualstudio.com/api/extension-guides/webview\">https://code.visualstudio.com/api/extension-guides/webview</a><br>\nI think this sadly cannot be done by just replacing one function call<br>\nsince it seems that the current extension was using content providers<br>\nfor TextDocuments, which I think cannot be used for Webviews.</p>\n<p>I think making the Webview API work with the extension would be quite<br>\nbeneficial since we can then add more visual/interactive plugins to<br>\nIsabelle, e.g. diagrams for category theory.</p>\n<p>Kevin.</p>",
        "id": 294763223,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200652
    },
    {
        "content": "<p>From: Makarius &lt;<a href=\"mailto:makarius@sketis.net\">makarius@sketis.net</a>&gt;<br>\nOn 23/09/2019 17:37, Kevin Kappelmann wrote:</p>\n<blockquote>\n<p>The reason the state panel will not open now is that previewHtml was<br>\ndeprecated in November 2019 and removed earlier this year:<br>\n<a href=\"https://github.com/microsoft/vscode/issues/62630\">https://github.com/microsoft/vscode/issues/62630</a><br>\nThe fix is to use the Webview API instead:<br>\n<a href=\"https://code.visualstudio.com/api/extension-guides/webview\">https://code.visualstudio.com/api/extension-guides/webview</a><br>\nI think this sadly cannot be done by just replacing one function call<br>\nsince it seems that the current extension was using content providers<br>\nfor TextDocuments, which I think cannot be used for Webviews.</p>\n</blockquote>\n<p><a href=\"https://code.visualstudio.com/api/extension-guides/webview\">https://code.visualstudio.com/api/extension-guides/webview</a> is<br>\nindeed the missing link that I was looking for. I have somehow lost<br>\ntrack of the many ongoing changes in VSCode, but this looks like a<br>\nlong-awaited reform for custom HTML content.</p>\n<blockquote>\n<p>I think making the Webview API work with the extension would be quite<br>\nbeneficial since we can then add more visual/interactive plugins to<br>\nIsabelle, e.g. diagrams for category theory.</p>\n</blockquote>\n<p>Yes, I have recently started to look at high-end graph editors like<br>\n<a href=\"https://github.com/jgraph/mxgraph\">https://github.com/jgraph/mxgraph</a></p>\n<p>The HTML container of VSCode might help to make this accessible in the<br>\nIsabelle Prover IDE, but Isabelle/VSCode is a very poor PIDE front-end<br>\nat the moment.</p>\n<p>It might be easier to upgrade the Java/Swing GUI environment of<br>\nIsabelle/jEdit by Java Chromium Embedded<br>\n<a href=\"https://bitbucket.org/chromiumembedded/java-cef\">https://bitbucket.org/chromiumembedded/java-cef</a> and thus have the<br>\nexisting editor augmented by browser technology.</p>\n<p>Makarius</p>",
        "id": 294763531,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661200791
    }
]