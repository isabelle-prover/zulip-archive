[
    {
        "content": "<p>From: Bertram Felgenhauer via Cl-isabelle-users &lt;<a href=\"mailto:cl-isabelle-users@lists.cam.ac.uk\">cl-isabelle-users@lists.cam.ac.uk</a>&gt;<br>\nHi,</p>\n<p>I'm playing with the automatic refinement framework, trying to obtain<br>\npartially correct code. To this end, I found it convenient to assume<br>\n(not assert) that a certain set is finite. As an artificial example,</p>\n<p>definition<br>\n    \"assume_test X ≡ do { ASSUME (finite X); RETURN X }\"</p>\n<p>Next, I want to do a data refinement from sets to lists. This implies<br>\nthat the finiteness assumption is always satisfied:</p>\n<p>lemma [simp]:<br>\n    \"(X', X) ∈ ⟨Id⟩list_set_rel ⟹ finite X\"<br>\n    by (auto simp: list_set_rel_def br_def)</p>\n<p>That in turns means that the assumption can be omitted in the refined<br>\nimplementation:</p>\n<p>lemma assume_test_refine:<br>\n    assumes \"(X', X) ∈ ⟨Id⟩list_set_rel\"<br>\n    shows \"(RETURN X', assume_test X) ∈ ⟨⟨Id⟩list_set_rel⟩nres_rel\"<br>\n    using assms<br>\n    unfolding nres_rel_def assume_test_def<br>\n    by (auto simp: assume_test_def)</p>\n<p>My question, now, is whether this can be automated, which would allow<br>\nthis idea to be applied in the middle of a larger refinement that is<br>\notherwise automatic. I tried this:</p>\n<p>schematic_goal assume_test_refine:<br>\n    assumes [autoref_rules]: \"(X', X) ∈ ⟨Id⟩list_set_rel\"<br>\n    shows \"(?f, assume_test X) ∈ ⟨⟨Id⟩list_set_rel⟩nres_rel\"<br>\n    unfolding assume_test_def<br>\n    using [[autoref_trace_failed_id]]<br>\n    apply (autoref (keep_goal))<br>\n    (* some goal involving op_nres_ASSUME_bnd remains *)<br>\n    oops</p>\n<p>Can this work? I suspect that it is a matter of adding a suitable rule<br>\nto [autoref_rules], but my two attempts (see the attached theory) failed.</p>\n<p>Cheers,</p>\n<p>Bertram<br>\n<a href=\"/user_uploads/14278/apq7zayyvygG-WFp4hJZmzxk/Scratch.thy\">Scratch.thy</a></p>",
        "id": 294730302,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661187770
    },
    {
        "content": "<p>From: Peter Lammich &lt;<a href=\"mailto:lammich@in.tum.de\">lammich@in.tum.de</a>&gt;<br>\nHi Bertram,</p>\n<p>find attached my commented debugging session that shows how to find and<br>\nfix the problem.</p>\n<p>In short: When trying to show \"finite X\", Autoref knows nothing about<br>\nthe refinement of X to X', and you have to manually add this fact to<br>\nthe simpset.</p>\n<p>I have never used assumptions too much, I only added them because they<br>\nare the natural dual to assertions. Thus, I don't have too much<br>\nexperience where they are actually useful. What is your actual<br>\nexample?<br>\n<a href=\"/user_uploads/14278/UuZUpqpCNmh8rsluRjSJuP6q/Scratch1.thy\">Scratch1.thy</a></p>",
        "id": 294730675,
        "sender_full_name": "Email Gateway",
        "timestamp": 1661187904
    }
]